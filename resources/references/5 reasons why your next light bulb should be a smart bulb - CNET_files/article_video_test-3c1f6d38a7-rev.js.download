define('managers/tealium',["jquery","version!fly/managers/debug","managers/page-vars","managers/client-storage","managers/tracking","optional!"+(window.CnetPageVars.services.tealium&&window.CnetPageVars.services.tealium.enabled?"tealium":"feature-disabled")],function(t,e,a,i,r){var n=e.get("tealium"),o={timeThreshold:4e3,requestThreshold:10,requestCount:0},c={_getCollectionId:function(){var t="";return"object"==typeof a.tracking.data.collectionId?t=a.tracking.data.collectionId[0]:"string"==typeof a.tracking.data.collectionId&&(t=a.tracking.data.collectionId),t},getDwTag:function(t,e){var a=[];e=e||3;do{t=t.parents("[section],[id]"),t.attr("section")?a.push(t.attr("section")):t.attr("id")&&a.push(t.attr("id"))}while(a.length<e&&0<t.length);return a.reverse().join("|")},getHbParams:function(e){utag_data.videoAutoPlay="off"===i.read("autoplayEnabled")?"off":"on";var r=new Array("bm_name","bm_type","brand","siteEdition","siteSection","siteType","articleId","articleType","articleTitle","mediaAutoPlay","mfr","pageType","pageTypeId","pageOntologyId","pageViewGuid","productId","productName","productSeriesId","productSeriesName","productSlug","productType","showId","showTitle","showEpisodeId","showEpisodeTitle","userState","userId","userType","userRegId","deviceType","dwAnonId","videoAutoPlay"),n=new Array,o={};e=e||{};for(var c=0;c<r.length;c++)utag_data[r[c]]&&(n[r[c]]=utag_data[r[c]]);return t.extend(o,n,{siteRsids:utag_data._scAccount,siteCode:utag_data._siteCode,pageUrl:utag_data._pageUrl,sitePrimaryRsid:utag_data._sitePrimaryRsid,userStatus:utag_data.userType,siteHier:utag_data._siteCode&&utag_data.siteHier&&utag_data.siteHier.length>0?utag_data._siteCode+":"+utag_data.siteHier.join("|"):"",topicPrimaryId:utag_data._topicPrimaryId,authorList:utag_data._authorList,test:a.tracking.data.testName?a.tracking.data.testName+"|"+a.tracking.data.testVersion+"|"+a.tracking.data.testGroup:""},e),o},_getUdoStockData:function(){var t=a.tracking.data;return{siteEdition:t.siteEdition,pageViewGuid:t.pageViewGuid,pageType:t.pageType,siteHier:t.siteHier,siteType:t.siteType,deviceType:t.deviceType,articleId:t.articleId,articleTitle:t.articleTitle,articleType:t.articleType,articlePubDate:t.articlePubDate,articleAuthorId:t.articleAuthorId,articleAuthorName:t.articleAuthorName,topicId:t.topicId,topicName:t.topicName}},_initRequestTracking:function(){if("article"===a.tracking.data.pageType){var t=0,e=this;window.setInterval(function(){try{var a=window.performance.getEntriesByType("resource");for(t=t>=a.length?0:t;t<a.length;){var i=a[t];e._trackServiceRequest(i),t++}}catch(t){n.error("Failed to monitor tracking requests:",t)}},500)}},_initSourcePointTracking:function(){var e=this;if(a.sourcepoint&&a.sourcepoint.data)this._trackSourcePoint();else{var e=this;n.info("SourcePoint data was NOT available on page load"),t("body").on("sp_object_available",function(){e._trackSourcePoint()})}},_trackClickViaUtag:function(e,i,o,c,d){try{if(!0===a.tracking.enabled){d="object"!=typeof d?{}:d;var s={_test:a.tracking.data.testName?a.tracking.data.testName+"|"+a.tracking.data.testVersion+"|"+a.tracking.data.testGroup:"",userState:a.tracking.data.userState,userType:a.tracking.data.userType};if(c="object"!=typeof c?{}:c,c=t.extend({},d,s,c,r.getServiceVars()),t.inArray(e,["om","omnitureMgr","utag"])>=0){n.info(o+" ping: ",c);var u=n.enabled?t.extend({},c):{};if("view"===i?r.trackPageView({path:window.location.pathname,data:c}):r.trackPageEvent({path:window.location.pathname,data:c}),c.dwLinkTag?window.dwTag=c.dwLinkTag:window.dwTag&&(c.dwLinkTag=window.dwTag),window[e][i](c),delete window.dwTag,"object"==typeof window.s&&(window.s.events="",window.s.eVar21="",window.s.eVar37="",window.s.eVar38=""),n.enabled){for(var l in u)c[l]!==u[l]&&n.warn("Tealium overrode our data: "+l+' was changed from "'+u[l]+'" to "'+c[l]+'"');var g={};for(var l in c)void 0===u[l]&&(g[l]=c[l]);0!==g.length&&n.log("Tealium added the following data to the tracking call: ",g)}}else n.error("Invalid tracking object",e)}else n.info(o+" aborted; tracking is not enabled!")}catch(t){n.error(o+" failed:",t)}},trackComment:function(e,i,r){var n={link_text:e,_clickAction:r||e,socialService:"cnet",brand:a.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:i.sharebarSection};this._trackClickViaUtag("utag","link",e,i,t.extend({},this._getUdoStockData(),n))},trackCustomEvent:function(t,e,a){var i={link_text:t,_clickAction:a||"trackClick"};this._trackClickViaUtag("utag","link",t,e,i)},trackExternalLink:function(t){this._trackClickViaUtag("om","trackClick","trackExternalLink",t)},trackForum:function(t,e){this._trackClickViaUtag("om","trackForum",t,e)},trackLead:function(t){var e=jQuery.extend({},a.tracking.data,{_merchantId:t.merid,_leadType:t.ltype,_destCat:t.destcat,leadCpc:t.leadcpc,productName:t.productTitle,_videoAction:"",videoSegments:"",_leadProdPrice:t.productPrice,videoTime:0,_clickAction:"leadClick",link_text:"clickLead"},t);this._trackClickViaUtag("utag","link","trackLeadClick",t,e)},trackPageLoad:function(e){this._trackClickViaUtag("utag","view","Track view",e,a.tracking.data),t(window).trigger("dynamicloadcomplete"),r.trackChartbeatPageView()},trackPodcast:function(t){this._trackClickViaUtag("om","trackPodcast","trackPodcast",t)},_trackServiceRequest:function(e){for(var i in this.monitoredServices){var r=this.monitoredServices[i];r.fireCount<r.maxFireCount&&-1!==e.name.indexOf(r.requestPrefix)&&(n.info("Tracking the request: "+r.timerName,e.fetchStart),this.trackCustomEvent(r.timerName,t.extend({},a.tracking.data)),r.fireCount++)}},_trackSlaRequest:function(e){if(o.timeThreshold<=e.duration&&o.requestThreshold>o.requestCount){var i=document.createElement("a");if(i.href=e.name,"".endsWith&&!i.host.endsWith(".cnet.com")&&!i.pathname.endsWith(".mp4")){o.requestCount++;var r=Math.round(e.duration/1e3);n.info("slow request ("+r+" seconds)",e.name),this.trackCustomEvent("trackSlaEnforcement",t.extend({serviceWorkerDomain:i.host,serviceWorkerRequestTime:r,serviceWorkerConnection:window.navigator.connection?window.navigator.connection.effectiveType:"unsupported"},a.tracking.data))}}},trackSocial:function(t){var e={brand:a.tracking.data.brand,_collectionPrimaryId:this._getCollectionId(),dwLinkTag:t.sharebarSection};this._trackClickViaUtag("om","trackSocialClick","trackSocialClick",t,e)},_trackSourcePoint:function(){if(a.sourcepoint.beaconFired=!0,a.sourcepoint.data&&a.sourcepoint.data.info&&a.sourcepoint.data.info.prtn_uuid){var e=r.getSourcePointData(a.sourcepoint.data.info.prtn_uuid);n.info("SourcePoint data now available",e),this.trackCustomEvent("trackSourcePointResult",t.extend({},a.tracking.data,e))}},trackSuggestedSearch:function(t){this._trackClickViaUtag("om","trackSuggestedSearchClick","trackSuggestedSearchClick",t)},trackVideo:function(t,e,i){var r=t.charAt(0).toUpperCase()+t.slice(1),n=0===e?"Start":100===e?"Complete":e+"Percent",o="pause"===t?"videoTime":"video"+r+n,c=a.tracking.data,d={_videoAction:o,link_text:o,siteHier:c.siteHier,siteSection:c.siteSection,siteEdition:c.siteEdition,brand:c.brand,siteType:c.siteType,deviceType:c.deviceType,pageType:c.pageType,pageNum:null!=c.pageNum?c.pageNum:1,topicId:c.topicId,pageViewGuid:c.pageViewGuid,articleAuthorId:c.articleAuthorId,articleAuthorName:c.articleAuthorName,articleId:c.articleId,articleTitle:c.articleTitle,articleType:c.articleType,productId:c.productId,productName:c.productName};this._trackClickViaUtag("utag","link",o,i,d)}};return c._initSourcePointTracking(),c._initRequestTracking(),c});
define('translations/form-validate',["managers/edition"],function(e){var a={en:{required:{field:"This field is required",radio:"One of these fields is required"},availableEmail:"This e-mail address is already in use. Please choose another.",availableUsername:"That username is already taken. Try another.",validPassword:"Your password needs at least 6 characters, and 3 of these 4: special characters, numbers, or upper or lowercase letters.",minlength:"This field must be at least {minlength} characters",maxlength:"This field must be no more than {maxlength} characters",email:"That’s not a valid email address. Try another.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Please use only alphanumeric characters, underscores "_", and dashes "-"',usernameCharacterLength:"Your username must be between 3 and 25 characters.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"Oops! Something went wrong, try again.","invalid.loginpassword":"Oops! That’s not the password for this account, try again.","locked.account":"Too many attempts. Wait 5 minutes and try again, or reset your password.","invalid.email":"That’s not a valid email address. Try another.","inuse.userName":"That username is already taken. Try another."},es:{required:{field:"Campo requerido",radio:"One of these fields is required"},availableEmail:"Este email esta en uso.  Elige otro.",availableUsername:"Ese nombre de usuario ya existe. Inténtalo de nuevo.",validPassword:"Tu contraseña debe incluir al menos seis caracteres sin espacios y contar con un número, un símbolo especial y una mayúscula.",minlength:"Este campo debe tener al menos {minlength} caracteres",maxlength:"This field must be no more than {maxlength} characters",email:"Tu cuenta de e-mail no es válida, inténtalo de nuevo.",noUrl:"A url is not allowed in this field",noSpecialCharacters:"The special characters @, &, and % are not allowed in this field",equalTo:"Fields do not match",usernameSpecialCharacters:'Por favor, usa solamente caracteres alfanuméricos, guiones bajos "_", y guiones "-"',usernameCharacterLength:"Tu nombre de usuario debe contener entre 3 y 23 letras.",atLeastOneAlphanumeric:"You must include at least one alphanumeric character",generic:"¡Lo sentimos! Algo no está funcionando, inténtalo más tarde.","invalid.loginpassword":"¡Lo sentimos! Esa no es la contraseña correcta. Inténtalo de nuevo.","locked.account":"Ingresaste una contraseña equivocada demasiadas veces. Espera 5 minutos para intentarlo de nuevo o restablece tu contraseña.","invalid.email":"Tu cuenta de e-mail no es válida, inténtalo de nuevo.","inuse.userName":"Ese nombre de usuario ya existe. Inténtalo de nuevo."}};return e.getTranslation(a)});

define('utils/urs-helper',["jquery","version!fly/managers/debug","managers/page-vars","optional!urs"],function(n,e,t){e=e.init("ursHelper");var r={16:257,103:259,222:263,225:265,242:266,256:268,295:298,358:359,363:361,364:362,368:365,369:366,370:367,372:371,403:401,404:402,9:269,36:270,74:278,305:304,27:280,374:373,376:375,202:394,393:394,395:396,397:398};return{getSocialAppId:function(n){return r[n]},getUrs:function(n,e){var r={};return"object"==typeof window.URS&&"function"==typeof URS.getInstance&&"function"==typeof URS.newInstance&&((r=URS.getInstance(n,"v2.2"))||(r=URS.newInstance({appId:n,clientToken:"12d6d06e118e4a90",environment:t.environment.indexOf("prod")>-1?URS.ursEnvironments.LIVE:URS.ursEnvironments.QA,version:"v2.2"}),e&&e(r))),r}}});
/* 
 * String Variables
 * Compile variables in a string with the format {varName}
 * 
 * Compiling:
 *  Example:
 *    compile('Hello {name}, Good {time}', {name: 'Lucy', time: 'Morning' });
 *    returns: Hello Lucy, Good Morning
 * 
 * Modifiers - Modify the value of the compiled string:
 *  Example:
 *    {name|upper} - Upper cases the name
 *    {name|urlencode} - Urlencode the name
 *
 */

 define('fly/utils/string-vars-1.0',['jquery'], function ($) {
 
    return {

        compile: function(val, data, globalMods) {
            var self = this;
            
            if (typeof val !== 'string') {
                return '';
            }
            
            globalMods = $.makeArray(globalMods);

            //find variables {siteId}
            val = val.replace(/\{([^}]+)\}/g, function(match) {
                var mods = globalMods,
                    dataVal = '';
                
                //find modifiers {XXXX|lower}
                match = match.replace(/\|[^\}|]+/g, function(mod) {
                    // add to modifier array
                    mods.push(mod.substr(1));

                    return '';
                });
                
                dataVal = data[match.replace(/[{}]+/g, '')] || '';
                
                $.each(mods, function(i, mod) {
                    dataVal = self.modify(mod, dataVal);
                });
                
                return dataVal;
            });

            return val;
        },
        
        modify: function(modifier, val) {
            switch(modifier) {
                case 'lower':
                    val = val.toLowerCase();
                    break;
                case 'upper':
                    val = val.toUpperCase();
                    break;
                case 'urlencode':
                    val = encodeURIComponent(val);
            }
            
            return val;
        }
    };

});


define('fly/components/form-validate-1.0',[
    'jquery', 
    'version!fly/utils/string-helper',
    'version!fly/utils/string-vars',
    'version!fly/managers/debug',    
    'version!fly/components/base'
], function($, strHlpr, strVars, debugMgr) {

    // support touch events
    var clickEventName = ($.support.touch) ? 'vclick' : 'click',
        debug = debugMgr.init('formValidate');

    /**
     * Validate a form by checkgng if the fields pass their requirements.
     *
     * @extends fly.base
     * 
     * Example Usage:
     *  $('my-form').formValidate({
     *      success: function(e, data) {
     *          // do something - submits by default
     *      }
     *  });
     *
     *  <form id="my-form">
     *      <input required maxlength="10" …> // via attrs
     *      <input data-validate="email no-url" …> // space sep data
     *      <input data-validate='["email", "mailcheck"]' …> // data array
     *      <inpit data-validate="availableEmail" data-remote-url="/ajax/url" …> //remote url check
     *
     */
    $.widget( 'fly.formValidate', $.fly.base, {
        
        /**
         * Optional data configuration
         * @define {object}
         */
        options: {
            inlineErrorTemplate: '<label for="{id}" class="validate-{type}">{message}</label>',
            globalErrorTemplate: '<div class="alert alert-{type}">{message}</div>',
            classFieldStatus: 'validate-{type}', // class to add to field upon error
            animation: 'slide', // 'slide' || 'none'
            fieldSelector: '[data-item="field"]',
            ignoreHidden: true, //should hidden fields be validated
            ignoreSelector: null,
            validateOnChange: true,
            scrollToErrors: false,
            attributes: ['required', 'maxlength', 'minlength'],
            rules: {}, // allow additional rules to be passed in as options
            success: function(e, data) {
                data.$form.submit();
            },
            failure: function(e, data) {},
            // allow field position to be customized
            placeError: function($error, $field) {
                if ($field.is(':checkbox, :radio') && $field.parent('label').length) {
                    $error.insertAfter($field.parent('label'));
                } else {
                    $error.insertAfter($field);
                }
            }
            //validate
            //validated
            //success
            //failure
            //errorAdded
            //errorRemoved
            //scroll
        },
        
        rules: {
            required: {
                message: function($field) {
                    return ($field.is(':radio')) ? 'One of these fields is required' : 'This field is required';
                },
                test: function($field) {
                    var $fields,
                        val;
                    // validate all radio buttons of the same name
                    if ($field.is(':radio')) {
                        $fields = $field.closest('form').find(':radio[name="'+$field.attr('name')+'"]');
                        return $fields.is(':checked');
                    } else {
                        val = ($field.is(':checkbox')) ? $field.is(':checked') : $field.val();
                        return (val) ? true : false;
                    }
                }
            },
            
            mailcheck: {
                type: 'warning',
                message: null, //set from test
                test: function($field, queue) {
                    var self = this,
                        $form = $field.closest('form');
                        
                    require(['fly/libs/mailcheck-1.1'], function() {
                        $field.mailcheck({
                            suggested: function(element, suggestion) {                
                                self.message = 'Did you mean <a class="mailcheck" data-_insert="mailcheck">'+ suggestion.domain +'</a>?';
                                
                                $form.on(clickEventName+'.mailcheck', '[data-_insert="mailcheck"]', function() {
                                    $field.val(suggestion.full).trigger('change');                          
                                });
    
                                queue.reject('mailcheck');
                            },
                            empty: function(element) {
                                $form.off('.mailcheck');
                                queue.resolve();
                            }
                        });
                    });
    
                    return queue.promise();
                }
            },
            
            availableEmail: {
                remote: true,
                message: 'Email is already in use'
            },
            
            availableUsername: {
                remote: true,
                message: 'User Name is already in use'
            },

            minlength: {
                message: function($field) {
                    return 'This field must be at least '+$field.attr('minlength')+' characters';
                },
                test: function($field) {
                    return ($field.val().length >= $field.attr('minlength'));
                }
            },
            
            maxlength: {
                message: function($field) {
                    return 'This field must be no more than '+$field.attr('maxlength')+' characters';
                },
                test: function($field) {
                    return ($field.val().length <= $field.attr('maxlength'));
                }
            },
            
            email: {
                message: 'Please enter a valid email',
                test: function($field) {
                    return (/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i.test( $field.val() ));
                }
            },
            
            noUrl: {
                message: 'A url is not allowed in this field',
                test: function($field) {
                    return !(/http:\/\//i.test( $field.val() ));
                }
            },
            
            noSpecialCharacters: {
                message: 'The special characters @, &, and % are not allowed in this field',
                test: function($field) {
                    return (/^[^@&%]+$/i.test( $field.val() ));
                }
            },
            
            equalTo: {
                //Show validation error if two fields do not match
                //pass in data-validate-confirm-with=fieldname to confirm with
                message: 'Fields do not match',
                test: function($field) {
                    var $match = $('input[name="'+$field.data('validate-equal-to')+'"]');
                    return ($match.length && $field.val() === $match.val());
                }
            }
        },

        wasSubmitted: false, // has form submit been attempted
        isWorking: false, // is the form currently busy validating
        isFormValid: false, // is the form in a valid state


        /**
         * Instantiate Form Validate
         * @constructor
         */
        _create: function() {
            var o = this.options,
                ignore,
                eventMap = {};
            
            this._setup();
                                    
            this.$form = this.$element;
            
            // Disabled HTML5 validation
            this.$form.attr('novalidate', 'novalidate');

            this.globalErrors = [];
            
            // field that should not be validated
            this.ignoreSelector = ':submit, :reset, :image, [disabled]';
            if (o.ignoreHidden) {
                this.ignoreSelector += ', :hidden';
            }
            if (o.ignoreSelector) {
                this.ignoreSelector += ', '+o.ignoreSelector;
            }
            
            // merge in options rules
            this.addRules(o.rules);
            
            // add submit event
            this._on(this.$form, {'submit': '_handleSubmit'});

            // add change events
            if (o.validateOnChange) {
                eventMap['focusout :input:not('+this.ignoreSelector+', [data-_enabled])'] = '_handleFocusOut';
                eventMap['keyup :input:not('+this.ignoreSelector+', [readonly])'] = '_handleChange';
                eventMap['change :input:not('+this.ignoreSelector+')'] = '_handleChange';
                this._on(this.$form, eventMap);
            }
        },

        /**
         * Handle the form submit event
         *
         * @param e The event object
         * @private
         */        
        _handleSubmit: function(e) {
            this._off(this.$form, 'focusout');
            this.wasSubmitted = true;

            if (this.isFormValid) return;
            
            e.preventDefault();
            e.stopImmediatePropagation();
                
            this.validate();
        },
        
        _handleFocusOut: function(e) {
            var $field = $(e.target);
            
            $field.attr('data-_enabled', 'true');

            this._handleChange(e);
        },

        _handleChange: function(e) {
            var $field = $(e.target);
            
            this.isFormValid = false;
            
            if (this.wasSubmitted || $field.data('_enabled')) {
                $field.data('_passed', false);
                this.testField($field);
            }
        },

        getRule: function(name) {
            if (typeof this.rules[name] != 'undefined') {
                return this.rules[name];
            } else {
                return false;
            }
        },
        
        getRulesToValidate: function($field) {
            var self = this,
                validateData = $field.data('validate') || [],
                ruleNames = ($.isArray(validateData)) ? validateData : validateData.split(' ');

            $.each(this.options.attributes, function(index, attribute) {
                if ($field.attr(attribute)) {
                    ruleNames.unshift(attribute);
                }
            });

            return $.grep(ruleNames, function(name, index){
                return (self.getRule(name));
            });
        },
        
        addRules: function(rules) {
            if ($.isPlainObject(rules)) {
                $.extend(this.rules, rules);
            }
        },
        
        removeRule: function(name) {
            if (this.getRule(name) !== false) {
                delete this.rules[name];
            }
        },
        
        setFieldDelegate: function($field) {
            var $delegate = null;
            
            if ($field.is(':radio')) {
                $delegate = this.$form.find(':radio[name="'+$field.attr('name')+'"]').first();
            }
            
            $field.data('_field_delegate', $delegate);

            return $field;
        },
        
        testField: function($field) {                   
            var self = this,
                promises = [],
                rules,
                data = $field.data() || {},
                currError = data.error || {},
                fieldQueue = $.Deferred();

            //field value already tested
            if (data._passed) {
                fieldQueue.resolve();
                return fieldQueue.promise();
            }
            
            this.setFieldDelegate($field);

            // abort running requests
            if (data.remoteRequest) data.remoteRequest.abort();
            
            rules = this.getRulesToValidate($field);
            debug.log('test field: ', $field, ' w/ rules:', rules);

            $.each(rules, function(index, ruleName){
                var rule = self.getRule(ruleName),
                    passed = true,
                    isRemote = (rule.remote) ? true : false,
                    remoteUrl = null,
                    promise;
                            
                if (isRemote) {
                    remoteUrl = rule.remoteUrl || $field.data('remoteUrl');
                    self.removeError($field); // remove previous remote errors
                }
                
                // Create promise for rule
                promise = function() {
                    var queue = $.Deferred(),
                        result = null;
                    
                    if (isRemote) {
                        result = self.requestRemote(remoteUrl, $field, ruleName, queue);
                    } else {
                        result = rule.test($field, queue);
                    }
                            
                    if (result === false) {
                        passed = false;
                        queue.reject(ruleName);
                    } else if (result === true) {
                        queue.resolve(ruleName);
                    }
                    
                    // else reject or resolve must be called by function
                    return queue.promise();
                };
                
                promise = promise();
                promises.push(promise);
                
                // remove error on passing test
                $.when(promise)
                .fail(function() {
                    debug.log('rule failed: ', ruleName, $field);
                })
                .then(function() {
                    if (currError.name === ruleName) {
                        self.removeError($field);
                    }
                    debug.log('rule passed: ', ruleName, $field);
                });

                // Break loop if failed
                if (!passed) return false;
            });

            // Test field against all rules
            $.when.apply(null, promises)                    
            .fail(function(ruleName) {
                var rule = self.getRule(ruleName),
                    type = (rule.type) ? rule.type : 'error',
                    fieldData = $field.data(),
                    fieldCurrError = fieldData.error || {};

                // clear/abort any ongoing request
                if (fieldData.remoteTimeout) clearTimeout(fieldData.remoteTimeout);
                if (fieldData.remoteRequest) fieldData.remoteRequest.abort();

                if (fieldCurrError.message != self.getMessage(ruleName, $field)) {
                    self.removeError($field);
                    self.addInlineError($field, ruleName);
                }
                
                if (type !== 'error') {
                    fieldQueue.resolve();
                    debug.log('field passed: ', $field, ' type: ', type);
                } else {
                    fieldQueue.reject();
                    debug.log('field failed: ', $field);
                }
            })
            .then(function() {
                $field.data('_passed', true);
                self.removeError($field);
                fieldQueue.resolve();
                debug.log('field passed: ', $field);
            });
            
            return fieldQueue.promise();
        },
        
        requestRemote: function(url, $field, ruleName, queue) {
            var params = {},
                request = null,
                timeout = null,
                data = $field.data() || {};
            
            if (data.remoteTimeout) {
                clearTimeout(data.remoteTimeout);
                data.remoteQueue.resolve(ruleName);
            }
            
            params[$field.attr('name')] = $field.val();
            
            timeout = setTimeout(function() {
                request = $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: url,
                    data: params,
                    timeout: 5000,
                    success: function(res) {
                        switch (res) {
                            case true:
                                queue.resolve(ruleName);
                                break;
                            case false:
                                queue.reject(ruleName);
                                break;
                            default:
                                if( $.isPlainObject(res) && res.status) {
                                    if(res.status === 'success') {
                                        queue.resolve(ruleName);
                                    }
                                    else {
                                        queue.reject(ruleName);
                                    }
                                }
                                //If response is empty, accept value
                                else {
                                    queue.resolve(ruleName);
                                }
                        }
                    },
                    complete: function() {
                        $field.data('remoteRequest', null);
                    },
                    error: function(jqXHR, status) {
                        queue.resolve(ruleName);
                        $field.data('_passed', false);
                    }
                });
                
                $field.data({
                    'remoteRequest': request,
                    'remoteQueue': null,
                    'remoteTimeout': null
                });
                    
            }, 300);
            
            $field.data({
                'remoteQueue': queue,
                'remoteTimeout': timeout
            });
        },
        
        validate: function() {
            var o = this.options,
                self = this,
                fieldPromises = [];
            
            if (this.isWorking) return;
            if (this._trigger('validate') === false) return;
            
            this.isWorking = true;
            
            this.removeGlobalErrors();

            this.$form.find(':input').not(this.ignoreSelector).each(function() {
                var $field = $(this);

                fieldPromises.push(self.testField($field));
            });

            $.when.apply(null, fieldPromises)                       
            .fail(function() {
                debug.log('validate failed');
                
                // trigger failure event
                self._trigger('failure', null, {
                    $form: self.$form
                });

                if(o.scrollToErrors) {
                    self.scrollToErrors();
                }
            })
            .then(function() {
                debug.log('validate success');
                // trigger success event
                self.isFormValid = true;
                
                self._trigger('success', null, {
                    $form: self.$form
                });
                
                self.isFormValid = false;
            })
            .always(function() {
                self._trigger('validated');
                self.isWorking = false;
            });
        },
        
        scrollToErrors: function() {
            var o = this.options,
                $error = this.$form.find('[data-validate-error]').first(),
                $parent = $error.closest(o.fieldSelector),
                offset = ($parent.length ? $parent : $error).offset().top;
            
            if (this._trigger('scroll', null, {offset: offset}) === false) return;

            // don't position right at the top of the screen
            // TODO: this would be better if we only scroll
            // when the error is off screen
            offset = offset - (this.$window.height() / 6);

            $('html, body').animate({
                scrollTop: offset
            }, 'fast');
        },
        
        removeError: function($field) {
            $field = $field.data('_field_delegate') || $field;
            
            var self = this,
                o = this.options,
                data = $field.data('error');

            if(!data) return;

            if (o.animation === 'slide') {
                data.$error.slideUp('fast', function() {
                    $(this).remove();
                    self._completeRemoveError(data, $field);
                });
            } else {
                $field.remove();
                this._completeRemoveError(data, $field);
            }
            
            $field.removeClass(data.fieldClass).removeData('error');
        },
        
        getMessage: function(ruleName, $field) {
            var rule = this.getRule(ruleName),
                msg = $field.data('validate-message-'+ruleName) || $field.data('validate-message-'+ruleName.toLowerCase());

            if (!msg && msg !== false) {
                msg = ($.isFunction(rule.message)) ? rule.message($field) : rule.message;
            }

            return msg;
        },

        /**
         * Add an inline error next to field
         */  
        addInlineError: function($field, ruleName) {
            $field = $field.data('_field_delegate') || $field;
            
            var self = this,
                o = this.options,
                data = $field.data('error') || {},
                rule,
                type,
                message,
                template,
                errorObj = {
                    name: ruleName,
                    position: 'inline'
                };

            //only show one error at a time 
            if(data.type === 'error') return;
            
            message = this.getMessage(ruleName, $field);
            rule = this.getRule(ruleName);
            type = rule.type || 'error';

            template = strVars.compile(o.inlineErrorTemplate, {
                type: type,
                id: $field.attr('id'),
                message: message
            });
            
            $.extend(errorObj, {
                type: type,
                message: message,
                $error: $(template).attr('data-validate-error', true),
                fieldClass: strVars.compile(this.options.classFieldStatus, {type: type})
            });

            $field
                .addClass(errorObj.fieldClass)
                .data('error', errorObj);
            
            if (message !== false) {
                if (o.animation === 'slide') {
                    errorObj.$error = $('<div />').wrapInner(errorObj.$error);
                    errorObj.$error.hide();
                    o.placeError.call(this, errorObj.$error, $field);
                    errorObj.$error.slideDown('fast', function() {
                        self._completeAddError(errorObj, $field);
                    });
                } else {
                    o.placeError.call(this, errorObj.$error, $field);
                    this._completeAddError(errorObj, $field);
                }
            }
        },

        /**
         * Add global error to the top of the form
         */   
        addGlobalError: function(message, type) {
            type = type || 'error';
                        
            var self = this,
                o = this.options,
                template,
                errorObj = {
                    position: 'global',
                    type: type,
                    message: message
                };

            template = strVars.compile(o.globalErrorTemplate, {
                type: type,
                message: message
            });

            $.extend(errorObj, {
                $error: $(template).attr('data-validate-error', true)
            });

            if (o.animation === 'slide') {
                errorObj.$error = $('<div />').wrapInner(errorObj.$error);
                errorObj.$error.hide().prependTo(this.$form).slideDown('fast', function() {
                    self._completeAddError(errorObj);
                });
            } else {
                this.$form.prepend(errorObj.$error);
                this._completeAddError(errorObj);
            }

            this.globalErrors.push(errorObj);
        },
        
        removeGlobalErrors: function() {
            var self = this;
            
            $.each(this.globalErrors, function(i, errorObj) {
                errorObj.$error.remove();
                self._completeRemoveError(errorObj);
            });
        },
        
        removeInlineErrors: function() {
            var self = this;
        
            this.$form.find('[data-validate-error]').each(function() {
                var $field = $(this),
                    fieldData = $field.data();
                //TODO: make this work properly 
                //[data-validate-error] is not the $field, i think

                if (fieldData.error) {
                    self.removeError($field);
                }
                // abort running requests
                if (fieldData.remoteRequest) {
                    fieldData.remoteRequest.abort();
                }
            });
        },

        _completeAddError: function(errorObj, $field) {     
            this._trigger('errorAdded', null, $.extend(errorObj, {$field: $field}));
            this.$document.trigger('displayChange', {type: 'errorAdded'});
        },

        _completeRemoveError: function(errorObj, $field) {     
            this._trigger('errorRemoved', null, $.extend(errorObj, {$field: $field}));
            this.$document.trigger('displayChange', {type: 'errorRemoved'});
        },
        
        _disable: function() {
            this.removeGlobalErrors();
            this.removeInlineErrors();
        },
        
        _destroy: function() {
            this._disable();
        }
    });
});



define('components/form-validate',["jquery","version!fly/managers/debug","translations/form-validate","version!fly/utils/string-vars","version!fly/components/form-validate"],function(e,a,r,t){a.init("formValidate"),e.widget("cnet.formValidate",e.fly.formValidate,{options:{validateOnBlur:!1},rules:{required:{message:function(e){return e.is(":radio")?r.required.radio:r.required.field}},mailcheck:{message:null},availableEmail:{message:r.availableEmail},availableUsername:{message:r.availableUsername},validPassword:{message:r.validPassword,test:function(e){var a=e.val(),r=0;return/[0-9]+/.test(a)&&r++,/[a-z]+/.test(a)&&r++,/[A-Z]+/.test(a)&&r++,/[\(\)\.@`!#\$%\^&*+=\-\[\]\\';,\/\{\}\|":<>\?~_]+/.test(a)&&r++,r>=3&&a.length>=6&&-1==a.indexOf(" ")}},minlength:{message:function(e){return t.compile(r.minlength,{minlength:e.attr("minlength")})}},maxlength:{message:function(e){return t.compile(r.maxlength,{maxlength:e.attr("maxlength")})}},email:{message:r.email,test:function(e){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,}$/i.test(e.val())}},noUrl:{message:r.noUrl},noSpecialCharacters:{message:r.noSpecialCharacters},equalTo:{message:r.equalTo},usernameSpecialCharacters:{message:r.usernameSpecialCharacters,test:function(e){return/^[a-z0-9\-_]*$/i.test(e.val())}},usernameCharacterLength:{message:r.usernameCharacterLength,test:function(e){var a=e.val().length;return a>=3&&a<=25}},atLeastOneAlphanumeric:{message:r.atLeastOneAlphanumeric,test:function(e){return/.*[a-z0-9]+.*/i.test(e.val())}}},_create:function(){var e=this.options,a={};this._super(),e.validateOnBlur&&(a["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",a["blur :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleChange",this._on(this.$form,a))},getMessage:function(e,a){return this._super(e,a)||r[e||"generic"]||r.generic},addInlineError:function(a,r){a=a.data("_field_delegate")||a;var i,s,n,l,o=this.options,m=a.data("error")||{},d={name:r,position:"inline"};"error"!==m.type&&(n=this.getMessage(r,a),i=this.getRule(r),s=i.type||"error",l=t.compile(o.inlineErrorTemplate,{type:s,id:a.attr("id"),message:n}),e.extend(d,{type:s,message:n,$error:e(l).attr("data-validate-error",!0),fieldClass:t.compile(this.options.classFieldStatus,{type:s})}),a.addClass(d.fieldClass).data("error",d),a.attr("aria-invalid","true"),!1!==n&&("slide"===o.animation?(d.$error=e("<div />").wrapInner(d.$error),o.placeError.call(this,d.$error,a),this._completeAddError(d,a)):(o.placeError.call(this,d.$error,a),this._completeAddError(d,a))))},removeError:function(e){e=e.data("_field_delegate")||e;var a=this.options,r=e.data("error");r&&("slide"===a.animation?r.$error.remove():(e.remove(),this._completeRemoveError(r,e)),e.removeClass(r.fieldClass).removeData("error"),e.attr("aria-invalid","false"),this._completeRemoveError(r,e))}})});
define('translations/loading',["managers/edition"],function(n){var r={en:{loading:"Loading",end:"The End",error:"Error Encountered"},es:{loading:"Cargando",end:"Fin",error:"Error Encontrado"}};return n.getTranslation(r)});
define('fly/components/loading-1.0',[
    'jquery', 
    'version!fly/utils/string-vars',
    'version!fly/components/base'
], function($, strVars) {
    
    /**
     *
     * @extends cbsi.component
     *
     * Displays and/or tracks status. Can be used to add/remove a loader gif,
     * as well as manage more complex states, such as 'start', 'end', 'error', etc.
     *
     * Each state should have a name (ex: loading, end, start), and should be given a class 
     * and text string in the options if the status is to be displayed to the user. 
     *
     * The default variables for the template are: state, baseClass, stateClass, text
     * Ex: '<div class="{baseClass} {stateClass}">{state}: {text}</div>'
     * Calling: loader.update('end');
     * Would compile to: <div class="loader load-end">end: The end</div>
     *
     * Custom data passed to update allows for custom variables on template:
     * Ex: '<div>{state}: {foo}, {bar}, {baz}</div>'
     * Calling: loader.update('test', {foo: '1', bar: '2'});
     * The 'end' state would compile to: <div>test: 1, 2</div>
     *
     * Optionally, you could only use loading to internally manage the state of a system,
     * and never show anything to the user
     *
     * 
     * Example Usage: 
     *  
     *      var loader = $.fly.loading(options);
     *  
     *  Show template:
     *  Inject the loader.$element someplace in the DOM
     *
     *      loader.$element.appendTo($('#show-loading-here'));
     *
     *  Simple loading:
     *      
     *      loader.add();
     *      loader.remove();
     *      loader.isLoading() // returns true or false
     *
     *  Loading States:
     *      Update to a state:
     *      loader.update(state);
     *
     *      Update to a state w/ custom data:
     *      loader.update(state, {foo: 'bar'});
     *
     * Notes:
     *  In the future, loading may be re-written as a component that
     *  extends a general status component. This script really contains
     *  multiple types of functionality that don't fit under the name loading
     *
     */
     
    $.widget( 'fly.loading', $.fly.base, {
        
        /**
         * Optional data configuration
         * @define {object}
         */
        options: {
            disabled: false,
            delay: 100, // start delay to reduce flicker from quick removal
            timeout: 25000, // miliseconds before loading is stopped
            initState: '', // idle|loading|etc..
            template: '<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',
            classes: {
                base: 'loader',
                idle: '',
                loading: 'loading',
                end: 'load-end',
                error: 'load-error'
            },
            text: {
                idle: '',
                loading: 'Loading',
                end: 'The End',
                error: 'Error Encountered :('
            }

            //add: $.noop
            //added: $.noop
            //remove: $.noop
            //removed: $.noop
            //updated: $.noop
        },

        /**
         * Instantiate Tabs
         * @constructor
         */
        _create: function() {
            this._setup();
            
            this._state = null;
            this._timeoutId = null;
        },

        _init: function() {
            var o = this.options;
            
            if (!o.disabled && o.initState) {
                this._setContent(o.initState);
                
                this._state = o.initState;
            }
        },
        
        _setContent: function(state, data) {
            var o = this.options,
                template;
                
            if (state === 'remove') {
                this.$element.empty();
                return;
            }
            
            template = strVars.compile(o.template, $.extend({
                'state': state,
                'baseClass': o.classes.base,
                'stateClass': o.classes[state],
                'text': o.text[state]
            }, data));
                
            this.$element.html(template);
        },

        add: function() {
            var o = this.options;
            
            if (this._trigger('add') === false) return;

            this.update('loading');
            
            // stop loading after timeout
            if (typeof o.timeout === 'number' && o.timeout > 0) {
                this._timeoutId = setTimeout($.proxy(this.remove, this), o.timeout);
            }

            this._trigger('added');
        },

        remove: function() {
            if (this._trigger('remove') === false) return;

            this.update('remove');
            
            this._trigger('removed');
        },

        update: function(state, data) {
            var o = this.options,
                eventData = {state: state};
            
            if (this._trigger('update', null, eventData) === false) return;

            this._state = state;
            
            // if disabled don't set content
            if (o.disabled) return;

            // cancel loading timeout
            clearTimeout(this._timeoutId);
            
            this._setContent(state, data);
            
            this._trigger('updated', null, eventData);
        },

        isLoading: function() {
            return (this._state === 'loading') ? true : false;
        },

        getState: function() {
            return this._state;
        },

        /**
         * Respond to option setting 
         * @private
         */
        _setOption: function(key, value) {
            var o = this.options;
            
            // handle data
            if (key === 'data') {
                this.$element.data('data', value); 
            // handle disabled
            } else if (key === 'disabled') {
                if (value === true) {
                    this.$element.empty();
                } else {
                    this._setContent(o.initState);
                }
            }
            
            this._super(key, value);
        },
        
        _destroy: function() {
            this.$element.remove();
        }
    });

});



define('components/loading',["jquery","version!fly/managers/debug","translations/loading","version!fly/components/loading"],function(e,a,n){a=a.init("loading"),e.widget("cnet.loading",e.fly.loading,{options:{template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loadingCircle",end:"load-end",error:"load-error"},text:n},add:function(){this._super(),this.$element.parent().addClass("loadingArea")},remove:function(){this._super(),this.$element.parent().removeClass("loadingArea")}})});
define('components/authentication',["jquery","version!fly/managers/debug","version!fly/managers/components","utils/cookie","managers/edition","managers/page-vars","managers/tealium","translations/form-validate","utils/urs-helper","version!fly/utils/url-helper","version!fly/components/base","components/form-validate","components/loading"],function(e,t,a,s,r,n,i,o,d,c){t=t.init("authentication"),e.widget("cnet.authentication",e.fly.base,{options:{classSelected:"selected",classShow:"show",classActive:"active",classFade:"fade"},appId:376,entryPoints:{375:"brand_nav",270:"comments",280:"forums",265:"polls",263:"my_list",367:"brand_nav",359:"my_list",394:"brand_nav",398:"comments",376:"brand_nav",36:"comments",27:"forums",225:"polls",222:"my_list",361:"sweepstakes",370:"brand_nav",358:"my_list",368:"sweepstakes",393:"brand_nav",397:"comments",386:"sweepstakes"},$form:null,$modal:null,loading:!1,nextAction:null,refresh:!1,socialRegistration:!1,step:"start",regService:"",steps:["facebookRegister","forgot","interests","login","loginOrRegister","register","start","username"],userData:null,_baseTrackingData:{_pageTitle:n.tracking.data._pageTitle,siteSection:n.tracking.data.siteSection,pageType:n.tracking.data.pageType,siteEdition:n.tracking.data.siteEdition,siteType:n.tracking.data.siteType,siteHier:n.tracking.data.siteHier,brand:n.tracking.data.brand,_pageChannelType:n.tracking.data._pageChannelType,audienceManagerBlob:n.tracking.data.guid,pageViewGuid:n.guid},_create:function(){this._setup(),this._setupPageEvents(),this._loadUserData(),this._checkForOpenLoginOnLoad()},_close:function(){this.$modal.removeClass(this.options.classShow),e("body").removeClass("noScroll")},_completeLogin:function(){var t=this,a=n.tracking.data;this.getUserData(function(e){"function"==typeof t.nextAction&&(t.refresh=t.nextAction(e),t.nextAction=null),!0===t.refresh&&window.location.reload()}),i.trackCustomEvent("trackLogin",e.extend(!0,{},this._baseTrackingData,{userId:a.userId,userState:"authenticated",userType:"registered",regService:t.regService,regDriver:t.entryPoints[t.appId]}),"login")},_displayError:function(e){var t=this.$form.find('[data-global-errors*="'+e+'"]'),a=this.$form.data("formValidate");0===t.length?a.addGlobalError(o[e||"generic"]||o.generic,"error"):a.addInlineError(t,e)},getUserData:function(e){this.userData?e(null,this.userData):this.$element.one("userdataloaded",e)},hasAccess:function(t){var a=this;t=e.extend(!0,{nextAction:null,requireUsername:!1},t),t.appId&&(a.appId=t.appId),this.getUserData(function(e,s){s.isLoggedIn?t.requireUsername&&!s.userName?(a.nextAction=t.nextAction,a._show("username")):"function"==typeof t.nextAction&&t.nextAction(s):(a.nextAction=t.nextAction,a._show("start"),a._trackCustomEvent("tap","start_authentication"))})},_loadUserData:function(){var t=this;this.userData=null,s.read("purs_1")?e.ajax({dataType:"json",url:n.user.urls.userData}).done(function(a){t.userData=e.extend(!0,a.user,{isLoggedIn:a.isLoggedIn}),window._cbq.push(["_acct","lgdin"]),t._updateDisplay(),t.$element.trigger("userdataloaded",[t.userData])}):(this.userData={isLoggedIn:!1},window._cbq.push(["_acct","anon"]))},logout:function(){var t=this;n.tracking.data,e.ajax({dataType:"json",url:e('[data-user-action="logout"]').attr("href")}).done(function(a){t.userData={isLoggedIn:!1},i.trackCustomEvent("trackLogout",e.extend(!0,{},t._baseTrackingData,{userId:"",userState:"not authenticated",userType:"anon",regService:t.regService,regDriver:t.entryPoints[t.appId]}),"logout"),window._cbq.push(["_acct","anon"]),t._updateDisplay(),t.$element.trigger("userhasloggedout")})},_setStep:function(t){var a=this;if(this.$modal){var s=this.$modal.find("._"+this.step+" input[type=email]").val();this.$modal.find("._"+t+" input[type=email]").val(s)}this.step=t,this.$modal&&(this.$modal.removeClass(this.steps.join(" ")).addClass(this.step).addClass(this.options.classShow),this.$modal.find("._"+this.step).addClass(this.options.classActive),this.$modal.find("input:not([type=hidden])").attr("disabled","disabled"),this.$modal.find("._"+this.step+" input").removeAttr("disabled"),this.$modal.find("[data-app-ids]").each(function(t,s){var r=e(s);r.data("appIds").indexOf(a.appId)<0&&r.attr("disabled","disabled")}),this.$modal.find('[data-focus="'+this.step+'"]').trigger("focus"),e("body").addClass("noScroll"))},_fadeOutStep:function(){var t=this;t.$modal.find(".fade").removeClass(this.options.classFade);var a=t.$modal.find(".active");a&&(e(a).removeClass(t.options.classActive),e(a).addClass(t.options.classFade))},_setupModalEvents:function(){var a=this;this.$modal&&(this.$modal.find('[data-action="close"]').on("click",function(e){a._close()}),this.$modal.find('[data-action="urs"]').on("tap",function(e){a.regService="urs",a._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="facebook"]').on("tap",function(e){d.getUrs(d.getSocialAppId(a.appId),a._setupSocialEvents.bind(a)).social.authenticate("facebook"),a.regService="facebook",a._trackCustomEvent("tap","choose_authentication_method")}),this.$modal.find('[data-action="forgot"]').on("tap",function(t){var s=a.$form.data("formValidate"),r=a.$form.find("#authentication_login_email");s.testField(r)&&e.ajax({data:{email:r.val(),csrf:a.$form.find("#authentication_csrf").val()},dataType:"json",type:"POST",url:n.user.urls.forgot}).done(function(e){a._show("forgot")})}),this.$modal.find("[data-interest]").on("tap",function(t){var s=e(this),r=s.data("interest");e(this).toggleClass(a.options.classSelected),a._trackCustomEvent("tap","mark_interest|"+r.tracking)}),this.$form.formValidate({validateOnBlur:!0,validateOnChange:!1,success:function(s){s.preventDefault();var o=a.$form.serializeArray(),c={appId:a.appId},l=0===o.length?c:o.reduce(function(e,t){return e[t.name]=t.value,e},c),u=a.$form.find('[data-component="loading"]').data("cnetLoading");switch(a.step){case"start":a._show("loginOrRegister");break;case"facebookRegister":d.getUrs(d.getSocialAppId(a.appId),a._setupSocialEvents.bind(a)).social.authenticate("facebook",!0,{userName:a.$form.find("#authentication_facebook_username").val()});break;case"loginOrRegister":u.add(),e.ajax({data:l,dataType:"json",type:"POST",url:n.user.urls.checkEmail}).done(function(e){if(e.success){var t=e.taken?"signin_started":"registration_started";a._trackCustomEvent("enterData","email|"+t),a._show(e.taken?"login":"register")}else a._displayError(e.error);a.$modal.find("#authentication_csrf").val(e.csrf),u.remove()});break;case"register":u.add(),e.ajax({data:l,dataType:"json",type:"POST",url:n.user.urls.register}).done(function(t){t.success?(a._loadUserData(),r.isEspanol()?(a._close(),a._completeLogin()):a._show("interests"),i.trackCustomEvent("trackRegistration",e.extend(!0,{},a._baseTrackingData,{userid:n.tracking.data.userId,regService:a.regService,regDriver:a.entryPoints[a.appId],userState:"authenticated",userType:"registered"}),"confirmRegistration")):(a._displayError(t.error),"inuse.userName"===t.error?a._trackCustomEvent("enterData","username|taken"):"invalid.email"===t.error&&a._trackCustomEvent("enterData","email|invalid")),a.$modal.find("#authentication_csrf").val(t.csrf),u.remove()});break;case"interests":u.add();var p=a.$form.find("[data-interest]."+a.options.classSelected).get().reduce(function(t,a){var s=e(a).data("interest");return t.interests.push(s.interest),t.newsletters.push(s.newsletter),t},{interests:[],newsletters:[]});a._trackCustomEvent("tap","submit_interest|"+p.interests.length),a.getUserData(function(t,s){e.ajax({data:{interests:p.interests.join(","),newsletters:p.newsletters.join(","),regId:s.registrationId},dataType:"json",type:"POST",url:n.user.urls.interests}).done(function(e){e.success?(a._close(),a._completeLogin()):a._displayError(e.error),a.$modal.find("#authentication_csrf").val(e.csrf),u.remove()})});break;case"login":u.add(),e.ajax({data:l,dataType:"json",type:"POST",url:n.user.urls.login}).done(function(e){e.success?(a._close(),a._loadUserData(),a._completeLogin()):(a._displayError(e.error),"invalid.loginpassword"===e.error&&a._trackCustomEvent("enterData","password|wrong")),a.$modal.find("#authentication_csrf").val(e.csrf),u.remove()});break;case"forgot":a._close();break;case"username":u.add(),e.ajax({data:l,dataType:"json",type:"POST",url:n.user.urls.username}).done(function(e){e.success?(a._close(),a._loadUserData(),a._completeLogin()):(a._displayError(e.error),"inuse.userName"===e.error&&a._trackCustomEvent("enterData","username|taken")),u.remove()});break;default:t.log("Current step not recognized.")}},placeError:function(e,t){t.is(":checkbox, :radio")&&t.parent("label").length?e.insertBefore(t.parent("label")):e.insertBefore(t)},errorAdded:function(e,t){"email"===t.name?a._trackCustomEvent("enterData","email|invalid"):"validPassword"===t.name?a._trackCustomEvent("enterData","password|invalid"):"usernameSpecialCharacters"!==t.name&&"usernameCharacterLength"!==t.name||a._trackCustomEvent("enterData","username|invalid")}}))},_setupPageEvents:function(){var t=this;this.$document.on("tap","[data-authentication]",function(a){var s=e(this).data("authentication");s.appId&&(t.appId=s.appId),"boolean"==typeof s.refresh&&(t.refresh=s.refresh),t.socialRegistration=!1,t._trackCustomEvent("tap","start_authentication"),t.getUserData(function(e,a){a.isLoggedIn&&s.requireUsername&&!a.userName?t._show("username"):t._show("start")})}),"true"==e('[data-user-action="logout"]').attr("data-user-suppress-refresh")&&this.$document.on("tap",'[data-user-action="logout"]',function(e){e.preventDefault(),t.logout()})},_setupSocialEvents:function(t){var a=this;t.common.addEventListener(URS.events.AUTH_COMPLETE,function(t,o){if(o.response.status.errors&&o.response.status.errors.length>0){var d=e.map(o.response.status.errors,function(e,t){return e.applicationCode});d.indexOf("invalid.noLink")>=0?(a.socialRegistration=!0,a._show("facebookRegister"),a._trackCustomEvent("enterData","facebook_credentials|registration_started")):(a._displayError(d[0]),d.indexOf("inuse.userName")>=0&&a._trackCustomEvent("enterData","username|taken"))}else s.write(a.options.cookieUserRecognized,JSON.stringify({username:o.response.receipt.account.displayName,socialSite:o.response.socialSite}),{expires:365}),e.post("/user/social-login/",{email:o.response.receipt.account.emailAddress},function(t){"success"===t.status&&(a.socialRegistration&&!r.isEspanol()?(i.trackCustomEvent("trackRegistration",e.extend(!0,{},a._baseTrackingData,{userid:n.tracking.data.userId,regService:"facebook",regDriver:a.entryPoints[a.appId],userState:"authenticated",userType:"registered"}),"confirmRegistration"),a._show("interests")):(a._close(),a._completeLogin()),a._loadUserData())},"json")})},_show:function(t){var s=this;if(!this.loading)if(["start","username"].indexOf(t)>=0)this.loading=!0,this.$modal&&this.$modal.remove(),e.ajax({url:n.user.urls.modal}).done(function(r){s.$modal=e(r.html).addClass("appId"+s.appId).appendTo(e("body")),s._setStep(t),s.$form=s.$modal.find("form"),a.process(s.$modal),s._setupModalEvents(),s.loading=!1,e(window).trigger("authenticationLoaded")});else{this.$form.data("formValidate").removeGlobalErrors();var r=this.$modal.find("._"+this.step),i=100*(3*r[0].children.length+5);setTimeout(function(){s._setStep(t)},i),s._fadeOutStep()}},_updateDisplay:function(){var t=this,a=e("body");this.userData.isLoggedIn?(e("[data-user-var]").each(function(){var a=e(this),s=a.data("userVar"),r=a.data("userVarAttr"),i=t.userData[s];"userName"===s?(i||(i=t.userData.displayName),i.length>13&&"mobile"==n.device&&(i=i.substr(0,13)+"...")):"profileLink"===s&&(r="href",i=a.attr("data-template").replace("__username__",t.userData.userName?t.userData.userName.replace(/ /g,"+").toLowerCase():t.userData.registrationId)),i&&(r?a.attr(r,i):"avatar"===s?(a.html('<img src="'+i+'" />'),a.addClass("profilePic")):a.text(i))}),a.addClass("is-logged-in").removeClass("not-logged-in")):(e("[data-user-var]").each(function(){var a=e(this),s=a.data("userVar"),r=a.data("userVarAttr"),n=t.userData[s];"userName"===s?n=" ":"profileLink"===s&&(r="href",n="#"),n&&(r?a.attr(r,n):"avatar"===s?(a.find("img").remove(),a.removeClass("profilePic")):a.text(n))}),a.removeClass("is-logged-in").addClass("not-logged-in"),e("#loginTab").removeClass("selected"),e("#rbHeader").removeClass("menuOpen"))},_checkForOpenLoginOnLoad:function(){"1"==c.getParam("openLogin")&&e("[data-authentication]").first().trigger("tap")},_trackCustomEvent:function(a,s){t.log("Track custom event: "+a),n.tracking.data,i.trackCustomEvent(a,e.extend(!0,{},this._baseTrackingData,{clickGenericText:s,regService:this.regService,regDriver:this.entryPoints[this.appId]}),"trackClick")}})});
/*  
 *  Taken from jQuery UI Core
 *  http://api.jqueryui.com/data-selector/
 *
 *  Ex: jQuery( ":data(key)" )
 */
define('fly/utils/data-selector-1.0',['jquery'], function($) { 

    $.extend( $.expr[ ':' ], {
        data: $.expr.createPseudo(function( dataName ) {
            return function( elem ) {
                return !!$.data( elem, dataName );
            };
        })
    });

});

define('components/tabs-modal',["jquery","managers/tealium","managers/page-vars","version!fly/components/base","version!fly/utils/data-selector"],function(e,t,a){e.widget("cnet.tabsModal",e.fly.base,{options:{classOverlay:"loadingArea",classSelected:"selected",classOpen:"modalopen",closeModalSelector:'[data-item="close"]',enableDeselect:!1,enableEsc:!1,idOverlay:"bodyWrapper",notRoadshow:!1,selectorFocus:'[data-item="focus"]',tabSelector:'[data-item="trigger"]',closeOnScroll:!1},$currentTab:null,_baseTrackingData:{_pageTitle:a.tracking.data._pageTitle,siteSection:a.tracking.data.siteSection,pageType:a.tracking.data.pageType,siteEdition:a.tracking.data.siteEdition,siteType:a.tracking.data.siteType,siteHier:a.tracking.data.siteHier,brand:a.tracking.data.brand,_pageChannelType:a.tracking.data._pageChannelType},_create:function(){var e=this.options,t={},a=this;this._setup(),t["click "+e.tabSelector]="_handleClick",this._on(this.$element,t),this.$element.on("click",this.options.closeModalSelector,function(){a._hide(a.$currentTab)}),this.options.enableEsc&&this.$element.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),a._hide(a.$currentTab))})},_handleClick:function(t){var a=this.options,s=e(t.target).closest(a.tabSelector);t.preventDefault(),this.change(s)},_handleScroll:function(){this.$window.off("scroll.tabsModal"),this._hide(this.$currentTab)},_getContent:function(t){var a,s=t.data()||{},i=s.$content||[];return i.length?i:(a=s.target||t.attr("href"),i=e(a),t.data("$content",i),i)},_show:function(a){var s,i=this.options,n=this;if(!1!==this._trigger("show",null,{$tab:a})){this.$currentTab=a,s=this._getContent(a),e("html").addClass("scrollDisabled"),a.addClass(i.classSelected),s.addClass(i.classSelected),this._trigger("shown",null,{$tab:a,$content:s});var l="false"===a.attr("aria-expanded");a.attr("aria-expanded",l),s.attr("aria-hidden",!l),this.showOverlay();var o=e.extend(n._baseTrackingData,{clickGenericText:n.$currentTab.data("clicktracking")+"|open"});t.trackCustomEvent(n.$currentTab.data("eventName"),o,"trackClick"),setTimeout(function(){s.find(n.options.selectorFocus).focus()},300),i.closeOnScroll&&this.$window.on("scroll.tabsModal",this._handleScroll.bind(this))}},_hide:function(a){var s,i=this.options,n=this;if(!1!==this._trigger("hide",null,{$tab:a})){s=this._getContent(a),a.removeClass(i.classSelected),s.removeClass(i.classSelected),e("html").removeClass("scrollDisabled"),this._trigger("hidden",null,{$tab:a,$content:s});var l="false"===a.attr("aria-expanded");if(a.attr("aria-expanded",l),s.attr("aria-hidden",!l),this.hideOverlay(),n.$currentTab){var o=e.extend(n._baseTrackingData,{clickGenericText:n.$currentTab.data("clicktracking")+"|close"});t.trackCustomEvent(n.$currentTab.data("eventName"),o,"trackClick")}this.$currentTab=null}},change:function(e){var t,a=this.options;if(t=this.$element.find(a.tabSelector+"."+a.classSelected),e.data(),e.hasClass(a.classSelected))return void(a.enableDeselect&&this._hide(t));this._hide(t),this._show(e)},showOverlay:function(){var t=e("<div>",{id:this.options.idOverlay,class:this.options.classOverlay});this.options.notRoadshow?e("#rbHeader").addClass(this.options.classOpen):e(".autoHeader").addClass(this.options.classOpen),e("body").append(t);var a=this;t.on("click",function(){a.change(e(a.options.tabSelector+"."+a.options.classSelected,a.$element))})},hideOverlay:function(){e(".autoHeader").removeClass(this.options.classOpen),e("#rbHeader").removeClass(this.options.classOpen),e("#"+this.options.idOverlay).remove()}})});
define('components/site-header',["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("siteHeader"),e.widget("cnet.siteHeader",e.fly.base,{options:{},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var t=this,n=e("#searchMenu");n.click(function(){n.find("input").focus()});var s=this.$element.find(".menu");s.on("focusout",function(n){e.contains(n.currentTarget,n.relatedTarget)||(s.not(e(n.currentTarget)).removeClass("hover"),t.$element.removeClass("passthru intentionalHover"))}),s.on("keydown",function(n){switch(n.which){case 38:n.preventDefault(),s.removeClass("hover"),t.$element.removeClass("passthru intentionalHover");break;case 32:case 40:n.preventDefault(),"searchMenu"===n.currentTarget.id?e(n.currentTarget).trigger("click"):(s.removeClass("hover"),t.$element.addClass("passthru intentionalHover"),e(this).addClass("hover"))}})}})});
define('components/auto-suggest',["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,s,a){t=t.init("autoSuggest"),e.widget("cnet.autoSuggest",e.fly.base,{options:{limit:null,classMenuShow:"active",classOpen:"open",classReady:"ready",classSelected:"selected",selectorMenu:".menuWrapper",selectorSuggestions:"li:not(.hed)",url:"/autosuggest/xhr/",showLimit:10,clickable:!1},suggestXhr:null,$searchBox:null,$submitButton:null,_didTrackEnterSubmit:!1,_baseTrackingData:{_pageTitle:a.tracking.data._pageTitle,siteSection:a.tracking.data.siteSection,pageType:a.tracking.data.pageType,siteEdition:a.tracking.data.siteEdition,siteType:a.tracking.data.siteType,siteHier:a.tracking.data.siteHier,brand:a.tracking.data.brand,_pageChannelType:a.tracking.data._pageChannelType},_create:function(){this._setup(),this.$searchBox=this.$element.find("input"),this.$submitButton=this.$element.find('[type="submit"]'),this.$siteHeader=e("#rbHeader"),this._setupEvents(),this._setupTracking()},_setupEvents:function(){var t=this;this.$element.on("submit",function(s){var a=e(t.options.selectorSuggestions,t.$element).filter("."+t.options.classSelected),i=a.text(),n=a.attr("href");n?(s.preventDefault(),window.location.href=n):i&&t.$searchBox.val(i)}),this.$element.on("mousedown",this.options.selectorSuggestions,function(s){var a=e(this).attr("href");if(a)window.location=a;else{var i=e(t.options.selectorSuggestions,t.$element).filter("."+t.options.classSelected);""!==i.text()&&i.removeClass(t.options.classSelected),t._submitAutoSuggest(s)}}),this.$searchBox.on("focusout",function(s){0==e(s.relatedTarget).closest(".menuWrapper").length&&t._hideAutoSuggest()}),this.$searchBox.on("keyup",function(e){e.which>=37&&e.which<=40||t._doAutoSuggest()}),this.$searchBox.on("keydown",function(e){e.which>=37&&e.which<=40&&t._doArrowKey(e)}),e('[data-component="siteHeader"]').on("siteheadersectionchange",function(){t._updateSmartSearchTracking()}),e("#searchMenu [data-searchoverlay]").on("click",function(){t.$siteHeader.hasClass("showSearch")&&t.$siteHeader.removeClass("showSearch")})},_doAutoSuggest:function(){var s=this,a=s.options;if(s.suggestXhr&&4!=s.suggestXhr.readyState&&0!==s.suggestXhr.readyState&&s.suggestXhr.abort(),""!==s.$searchBox.val()){var i=a.url+"?query="+s.$searchBox.val();a.limit&&(i=i+"&limit="+a.limit),a.showLimit&&(i=i+"&showLimit="+a.showLimit),t.log("AutoSuggestXHR: ",i),this.$submitButton.addClass(this.options.classReady),this.$searchBox.addClass(this.options.classReady),!1===this.options.clickable&&(this.$siteHeader.hasClass("showSearch")||this.$siteHeader.addClass("showSearch")),s.suggestXhr=e.ajax({url:i,dataType:"json",context:document.body}).done(function(t){s.$element.addClass(a.classMenuShow);var i=e(e.parseHTML(e.trim(t.html)));e(a.selectorSuggestions,i).length>0?(0===e(a.selectorMenu,s.$element).length?i.appendTo(s.$element):e(a.selectorMenu,s.$element).replaceWith(i),s._setupAdditionalResults()):(s._hideAutoSuggest(),e(a.selectorMenu,s.$element).html(""))}).fail(function(){s._hideAutoSuggest()})}else s._hideAutoSuggest(),e(a.selectorMenu,s.$element).html(""),this.$siteHeader.hasClass("showSearch")&&this.$siteHeader.removeClass("showSearch"),this.$submitButton.removeClass(this.options.classReady),this.$searchBox.removeClass(this.options.classReady)},_doArrowKey:function(t){var s=e(this.options.selectorSuggestions,this.$element),a=s.filter("."+this.options.classSelected),i=s.index(a);if(38===t.which)a.removeClass(this.options.classSelected),i<=0?s.last().addClass(this.options.classSelected):s.eq(i-1).addClass(this.options.classSelected);else if(40===t.which)a.removeClass(this.options.classSelected),i<0||i===s.length-1?s.first().addClass(this.options.classSelected):s.eq(i+1).addClass(this.options.classSelected);else if(37===t.which||39===t.which){var n=a.closest("[data-additional-results]");n.length>0&&this._toggleAdditionalResults(this.$element.find("[data-additional-results]"),n,39===t.which)}},_hideAutoSuggest:function(){var e=this,t=e.options;e.$element.removeClass(t.classMenuShow)},_updateSmartSearchTracking:function(){var t=e("#searchTab [data-searchtracking]");if(t.length>0){var s=e("#rbHeader > nav[section]").attr("section")?e("#rbHeader > nav[section]").attr("section"):"";t.attr("section",s)}},_submitAutoSuggest:function(t){var a=e(t.target),i=a.text();s.trackSuggestedSearch({searchTerm:i,dwLinkTag:"search|suggestedSearch|"+a.prevAll().length}),this.$searchBox.val(i),this.$element.submit()},_setupAdditionalResults:function(){var t=this,s=this.$element.find("[data-additional-results]");s.each(function(a,i){var n=e(i);n.find('[data-auto-suggest-item="trigger"]').on("click",function(){t._toggleAdditionalResults(s,n)})})},_toggleAdditionalResults:function(t,s,a){var i=this,n=s.find('[data-auto-suggest-item="container"]');n.html()?s.toggleClass(function(e,t,s){return s||n.find("."+i.options.classSelected).removeClass(i.options.classSelected),i.options.classOpen},a):!1!==a&&e.ajax({dataType:"json",type:"GET",url:s.data("additionalResults")}).done(function(e){e.html&&(n.html(e.html),s.addClass(i.options.classOpen))}),t.not(s).removeClass(this.options.classOpen)},_setupTracking:function(){t.log("Setting up Smart Search tracking");var s=this,a=s.$element,i=a.find('input[type="search"]'),n=a.find(".submit");e('[data-target="#search"]'),i.on("keydown.smartSearchTracking",function(e){13===e.keyCode&&(s._trackSubmit("enter"),s._didTrackEnterSubmit=!0)}),n.on("click.smartSearchTracking",function(){s._didTrackEnterSubmit||s._trackSubmit("button")}),a.on("click",'[data-smartsearch="seeall"]',function(){s._didTrackEnterSubmit||s._trackSubmit("seeall")}),a.on("click.smartSearchTrackingMakeAndModel",".makesAndModels a",function(t){s._trackMakeModelClick(e(this))}),a.on("click.smartSearchTrackingContent",".results a",function(t){s._trackContentLinkClick(e(this))})},_trackSubmit:function(a){t.log("Track submit with "+a);var i=this.$element.find('input[type="search"]').val();t.log("Typed text: "+i);var n="search|submit|"+a;if(this.$element.find("button[data-smartsearch]").attr("data-smartsearch"))var o=this.$siteHeader.hasClass("fixed")?"popup":"top",n="brand_nav|"+o+"|search|typed|"+a;s.trackCustomEvent("searchSubmit",e.extend(this._baseTrackingData,{_searchTerm:i.toLowerCase(),clickGenericText:n}),"trackClick")},_trackMakeModelClick:function(a){t.log("Track make and model click");var i=a.text(),n=(e('.autoHeader input[type="search"]').val(),a.attr("data-category")),o=a.parent().index()+1,r="search|suggested"+n+"|"+o,c=e.extend(this._baseTrackingData,{searchTerm:i.toLowerCase(),clickGenericText:r});s.trackCustomEvent("searchResultClick",c,"trackClick")},_trackContentLinkClick:function(a){t.log("Track content link click");var i=e('.autoHeader input[type="search"]').val(),n=a.parent().index()+1,o="search|suggestedContent|"+n;s.trackCustomEvent("searchResultClick",e.extend(this._baseTrackingData,{searchTerm:i,clickGenericText:o}),"trackClick")}})});
define('components/lazyload-component',["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(t,o,e){o=o.init("lazyloadComponent"),t.widget("cnet.lazyloadComponent",t.fly.base,{options:{endpoint:"",slug:"",view:"",familyName:"",typeName:"",limit:""},_create:function(){this._setup();var e=this.options.endpoint+"?endpoint=%2Fapi%2Fcomponent%2Fcomponent%2F"+this.options.slug+"&view="+this.options.view+"&familyName="+this.options.familyName+"&typeName="+this.options.typeName;""!==this.options.limit&&(e+="&limit="+this.options.limit),o.log("URL: ",e),t.ajax({url:e,dataType:"json",context:{context:this}}).done(this._onSuccess).fail(this._onError)},_onSuccess:function(o){"use strict";var n=this.context.$element,i=t(t.parseHTML(t.trim(o.component.html)));n.append(i),n.removeClass("hide"),n.addClass("show"),e.process(n)},_onError:function(){"use strict"}})});
/*!
Waypoints - 3.1.1
Copyright © 2011-2015 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/waypoints/blog/master/licenses.txt
*/

!function(){"use strict";function t(o){if(!o)throw new Error("No options passed to Waypoint constructor");if(!o.element)throw new Error("No element option passed to Waypoint constructor");if(!o.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+e,this.options=t.Adapter.extend({},t.defaults,o),this.element=this.options.element,this.adapter=new t.Adapter(this.element),this.callback=o.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=t.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=t.Context.findOrCreateByElement(this.options.context),t.offsetAliases[this.options.offset]&&(this.options.offset=t.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),i[this.key]=this,e+=1}var e=0,i={};t.prototype.queueTrigger=function(t){this.group.queueTrigger(this,t)},t.prototype.trigger=function(t){this.enabled&&this.callback&&this.callback.apply(this,t)},t.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete i[this.key]},t.prototype.disable=function(){return this.enabled=!1,this},t.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},t.prototype.next=function(){return this.group.next(this)},t.prototype.previous=function(){return this.group.previous(this)},t.invokeAll=function(t){var e=[];for(var o in i)e.push(i[o]);for(var n=0,r=e.length;n<r;n++)e[n][t]()},t.destroyAll=function(){t.invokeAll("destroy")},t.disableAll=function(){t.invokeAll("disable")},t.enableAll=function(){t.invokeAll("enable")},t.refreshAll=function(){t.Context.refreshAll()},t.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},t.viewportWidth=function(){return document.documentElement.clientWidth},t.adapters=[],t.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},t.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=t}(),function(){"use strict";function t(t){window.setTimeout(t,1e3/60)}function e(t){this.element=t,this.Adapter=n.Adapter,this.adapter=new this.Adapter(t),this.key="waypoint-context-"+i,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},t.waypointContextKey=this.key,o[t.waypointContextKey]=this,i+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}var i=0,o={},n=window.Waypoint,r=window.onload;e.prototype.add=function(t){var e=t.options.horizontal?"horizontal":"vertical";this.waypoints[e][t.key]=t,this.refresh()},e.prototype.checkEmpty=function(){var t=this.Adapter.isEmptyObject(this.waypoints.horizontal),e=this.Adapter.isEmptyObject(this.waypoints.vertical);t&&e&&(this.adapter.off(".waypoints"),delete o[this.key])},e.prototype.createThrottledResizeHandler=function(){function t(){e.handleResize(),e.didResize=!1}var e=this;this.adapter.on("resize.waypoints",function(){e.didResize||(e.didResize=!0,n.requestAnimationFrame(t))})},e.prototype.createThrottledScrollHandler=function(){function t(){e.handleScroll(),e.didScroll=!1}var e=this;this.adapter.on("scroll.waypoints",function(){e.didScroll&&!n.isTouch||(e.didScroll=!0,n.requestAnimationFrame(t))})},e.prototype.handleResize=function(){n.Context.refreshAll()},e.prototype.handleScroll=function(){var t={},e={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in e){var o=e[i],n=o.newScroll>o.oldScroll,r=n?o.forward:o.backward;for(var s in this.waypoints[i]){var a=this.waypoints[i][s],l=o.oldScroll<a.triggerPoint,h=o.newScroll>=a.triggerPoint,p=l&&h,c=!l&&!h;(p||c)&&(a.queueTrigger(r),t[a.group.id]=a.group)}}for(var u in t)t[u].flushTriggers();this.oldScroll={x:e.horizontal.newScroll,y:e.vertical.newScroll}},e.prototype.innerHeight=function(){return this.element==this.element.window?n.viewportHeight():this.adapter.innerHeight()},e.prototype.remove=function(t){delete this.waypoints[t.axis][t.key],this.checkEmpty()},e.prototype.innerWidth=function(){return this.element==this.element.window?n.viewportWidth():this.adapter.innerWidth()},e.prototype.destroy=function(){var t=[];for(var e in this.waypoints)for(var i in this.waypoints[e])t.push(this.waypoints[e][i]);for(var o=0,n=t.length;o<n;o++)t[o].destroy()},e.prototype.refresh=function(){var t,e=this.element==this.element.window,i=this.adapter.offset(),o={};this.handleScroll(),t={horizontal:{contextOffset:e?0:i.left,contextScroll:e?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:e?0:i.top,contextScroll:e?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}};for(var n in t){var r=t[n];for(var s in this.waypoints[n]){var a,l,h,p,c,u=this.waypoints[n][s],d=u.options.offset,f=u.triggerPoint,w=0,y=null==f;u.element!==u.element.window&&(w=u.adapter.offset()[r.offsetProp]),"function"==typeof d?d=d.apply(u):"string"==typeof d&&(d=parseFloat(d),u.options.offset.indexOf("%")>-1&&(d=Math.ceil(r.contextDimension*d/100))),a=r.contextScroll-r.contextOffset,u.triggerPoint=w+a-d,l=f<r.oldScroll,h=u.triggerPoint>=r.oldScroll,p=l&&h,c=!l&&!h,!y&&p?(u.queueTrigger(r.backward),o[u.group.id]=u.group):!y&&c?(u.queueTrigger(r.forward),o[u.group.id]=u.group):y&&r.oldScroll>=u.triggerPoint&&(u.queueTrigger(r.forward),o[u.group.id]=u.group)}}for(var g in o)o[g].flushTriggers();return this},e.findOrCreateByElement=function(t){return e.findByElement(t)||new e(t)},e.refreshAll=function(){for(var t in o)o[t].refresh()},e.findByElement=function(t){return o[t.waypointContextKey]},window.onload=function(){r&&r(),e.refreshAll()},n.requestAnimationFrame=function(e){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||t).call(window,e)},n.Context=e}(),function(){"use strict";function t(t,e){return t.triggerPoint-e.triggerPoint}function e(t,e){return e.triggerPoint-t.triggerPoint}function i(t){this.name=t.name,this.axis=t.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),o[this.axis][this.name]=this}var o={vertical:{},horizontal:{}},n=window.Waypoint;i.prototype.add=function(t){this.waypoints.push(t)},i.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},i.prototype.flushTriggers=function(){for(var i in this.triggerQueues){var o=this.triggerQueues[i],n="up"===i||"left"===i;o.sort(n?e:t);for(var r=0,s=o.length;r<s;r+=1){var a=o[r];(a.options.continuous||r===o.length-1)&&a.trigger([i])}}this.clearTriggerQueues()},i.prototype.next=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i===this.waypoints.length-1?null:this.waypoints[i+1]},i.prototype.previous=function(e){this.waypoints.sort(t);var i=n.Adapter.inArray(e,this.waypoints);return i?this.waypoints[i-1]:null},i.prototype.queueTrigger=function(t,e){this.triggerQueues[e].push(t)},i.prototype.remove=function(t){var e=n.Adapter.inArray(t,this.waypoints);e>-1&&this.waypoints.splice(e,1)},i.prototype.first=function(){return this.waypoints[0]},i.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},i.findOrCreate=function(t){return o[t.axis][t.name]||new i(t)},n.Group=i}(),function(){"use strict";function t(t){this.$element=e(t)}var e=window.jQuery,i=window.Waypoint;e.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(e,i){t.prototype[i]=function(){var t=Array.prototype.slice.call(arguments);return this.$element[i].apply(this.$element,t)}}),e.each(["extend","inArray","isEmptyObject"],function(i,o){t[o]=e[o]}),i.adapters.push({name:"jquery",Adapter:t}),i.Adapter=t}(),function(){"use strict";function t(t){return function(){var i=[],o=arguments[0];return t.isFunction(arguments[0])&&(o=t.extend({},arguments[1]),o.handler=arguments[0]),this.each(function(){var n=t.extend({},o,{element:this});"string"==typeof n.context&&(n.context=t(this).closest(n.context)[0]),i.push(new e(n))}),i}}var e=window.Waypoint;window.jQuery&&(window.jQuery.fn.waypoint=t(window.jQuery)),window.Zepto&&(window.Zepto.fn.waypoint=t(window.Zepto))}();
define("libs/waypoints/jquery.waypoints-3.1.1", function(){});


/*!
* jQuery throttle / debounce - v1.1 - 3/7/2010
* http://benalman.com/projects/jquery-throttle-debounce-plugin/
*
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/

// Script: jQuery throttle / debounce: Sometimes, less is more!
//
// *Version: 1.1, Last updated: 3/7/2010*
//
// Project Home - http://benalman.com/projects/jquery-throttle-debounce-plugin/
// GitHub - http://github.com/cowboy/jquery-throttle-debounce/
// Source - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.js
// (Minified) - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.min.js (0.7kb)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// Throttle - http://benalman.com/code/projects/jquery-throttle-debounce/examples/throttle/
// Debounce - http://benalman.com/code/projects/jquery-throttle-debounce/examples/debounce/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - none, 1.3.2, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome 4-5, Opera 9.6-10.1.
// Unit Tests - http://benalman.com/code/projects/jquery-throttle-debounce/unit/
//
// About: Release History
//
// 1.1 - (3/7/2010) Fixed a bug in <jQuery.throttle> where trailing callbacks
// executed later than they should. Reworked a fair amount of internal
// logic as well.
// 1.0 - (3/6/2010) Initial release as a stand-alone project. Migrated over
// from jquery-misc repo v0.4 to jquery-throttle repo v1.0, added the
// no_trailing throttle parameter and debounce functionality.
//
// Topic: Note for non-jQuery users
//
// jQuery isn't actually required for this plugin, because nothing internal
// uses any jQuery methods or properties. jQuery is just used as a namespace
// under which these methods can exist.
//
// Since jQuery isn't actually required for this plugin, if jQuery doesn't exist
// when this plugin is loaded, the method described below will be created in
// the `Cowboy` namespace. Usage will be exactly the same, but instead of
// $.method() or jQuery.method(), you'll need to use Cowboy.method().


define('fly/libs/jquery.throttle-debounce-1.1',['jquery'], function($) { 

  '$:nomunge'; // Used by YUI compressor.
  
  // Since jQuery really isn't required for this plugin, use `jQuery` as the
  // namespace only if it already exists, otherwise use the `Cowboy` namespace,
  // creating it if necessary.
  //var $ = window.jQuery || window.Cowboy || ( window.Cowboy = {} ),
    
    // Internal method reference.
  var jq_throttle;
  
  // Method: jQuery.throttle
  //
  // Throttle execution of a function. Especially useful for rate limiting
  // execution of handlers on events like resize and scroll. If you want to
  // rate-limit execution of a function to a single time, see the
  // <jQuery.debounce> method.
  //
  // In this visualization, | is a throttled-function call and X is the actual
  // callback execution:
  //
  // > Throttled with `no_trailing` specified as false or unspecified:
  // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
  // > X X X X X X X X X X X X
  // >
  // > Throttled with `no_trailing` specified as true:
  // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
  // > X X X X X X X X X X
  //
  // Usage:
  //
  // > var throttled = jQuery.throttle( delay, [ no_trailing, ] callback );
  // >
  // > jQuery('selector').bind( 'someevent', throttled );
  // > jQuery('selector').unbind( 'someevent', throttled );
  //
  // This also works in jQuery 1.4+:
  //
  // > jQuery('selector').bind( 'someevent', jQuery.throttle( delay, [ no_trailing, ] callback ) );
  // > jQuery('selector').unbind( 'someevent', callback );
  //
  // Arguments:
  //
  // delay - (Number) A zero-or-greater delay in milliseconds. For event
  // callbacks, values around 100 or 250 (or even higher) are most useful.
  // no_trailing - (Boolean) Optional, defaults to false. If no_trailing is
  // true, callback will only execute every `delay` milliseconds while the
  // throttled-function is being called. If no_trailing is false or
  // unspecified, callback will be executed one final time after the last
  // throttled-function call. (After the throttled-function has not been
  // called for `delay` milliseconds, the internal counter is reset)
  // callback - (Function) A function to be executed after delay milliseconds.
  // The `this` context and all arguments are passed through, as-is, to
  // `callback` when the throttled-function is executed.
  //
  // Returns:
  //
  // (Function) A new, throttled, function.
  
  $.throttle = jq_throttle = function( delay, no_trailing, callback, debounce_mode ) {
    // After wrapper has stopped being called, this timeout ensures that
    // `callback` is executed at the proper times in `throttle` and `end`
    // debounce modes.
    var timeout_id,
      
      // Keep track of the last time `callback` was executed.
      last_exec = 0;
    
    // `no_trailing` defaults to falsy.
    if ( typeof no_trailing !== 'boolean' ) {
      debounce_mode = callback;
      callback = no_trailing;
      no_trailing = undefined;
    }
    
    // The `wrapper` function encapsulates all of the throttling / debouncing
    // functionality and when executed will limit the rate at which `callback`
    // is executed.
    function wrapper() {
      var that = this,
        elapsed = +new Date() - last_exec,
        args = arguments;
      
      // Execute `callback` and update the `last_exec` timestamp.
      function exec() {
        last_exec = +new Date();
        callback.apply( that, args );
      };
      
      // If `debounce_mode` is true (at_begin) this is used to clear the flag
      // to allow future `callback` executions.
      function clear() {
        timeout_id = undefined;
      };
      
      if ( debounce_mode && !timeout_id ) {
        // Since `wrapper` is being called for the first time and
        // `debounce_mode` is true (at_begin), execute `callback`.
        exec();
      }
      
      // Clear any existing timeout.
      timeout_id && clearTimeout( timeout_id );
      
      if ( debounce_mode === undefined && elapsed > delay ) {
        // In throttle mode, if `delay` time has been exceeded, execute
        // `callback`.
        exec();
        
      } else if ( no_trailing !== true ) {
        // In trailing throttle mode, since `delay` time has not been
        // exceeded, schedule `callback` to execute `delay` ms after most
        // recent execution.
        //
        // If `debounce_mode` is true (at_begin), schedule `clear` to execute
        // after `delay` ms.
        //
        // If `debounce_mode` is false (at end), schedule `callback` to
        // execute after `delay` ms.
        timeout_id = setTimeout( debounce_mode ? clear : exec, debounce_mode === undefined ? delay - elapsed : delay );
      }
    };
    
    // Set the guid of `wrapper` function to the same of original callback, so
    // it can be removed in jQuery 1.4+ .unbind or .die by using the original
    // callback as a reference.
    if ( $.guid ) {
      wrapper.guid = callback.guid = callback.guid || $.guid++;
    }
    
    // Return the wrapper function.
    return wrapper;
  };
  
  // Method: jQuery.debounce
  //
  // Debounce execution of a function. Debouncing, unlike throttling,
  // guarantees that a function is only executed a single time, either at the
  // very beginning of a series of calls, or at the very end. If you want to
  // simply rate-limit execution of a function, see the <jQuery.throttle>
  // method.
  //
  // In this visualization, | is a debounced-function call and X is the actual
  // callback execution:
  //
  // > Debounced with `at_begin` specified as false or unspecified:
  // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
  // > X X
  // >
  // > Debounced with `at_begin` specified as true:
  // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
  // > X X
  //
  // Usage:
  //
  // > var debounced = jQuery.debounce( delay, [ at_begin, ] callback );
  // >
  // > jQuery('selector').bind( 'someevent', debounced );
  // > jQuery('selector').unbind( 'someevent', debounced );
  //
  // This also works in jQuery 1.4+:
  //
  // > jQuery('selector').bind( 'someevent', jQuery.debounce( delay, [ at_begin, ] callback ) );
  // > jQuery('selector').unbind( 'someevent', callback );
  //
  // Arguments:
  //
  // delay - (Number) A zero-or-greater delay in milliseconds. For event
  // callbacks, values around 100 or 250 (or even higher) are most useful.
  // at_begin - (Boolean) Optional, defaults to false. If at_begin is false or
  // unspecified, callback will only be executed `delay` milliseconds after
  // the last debounced-function call. If at_begin is true, callback will be
  // executed only at the first debounced-function call. (After the
  // throttled-function has not been called for `delay` milliseconds, the
  // internal counter is reset)
  // callback - (Function) A function to be executed after delay milliseconds.
  // The `this` context and all arguments are passed through, as-is, to
  // `callback` when the debounced-function is executed.
  //
  // Returns:
  //
  // (Function) A new, debounced, function.
  
  $.debounce = function( delay, at_begin, callback ) {
    return callback === undefined
      ? jq_throttle( delay, at_begin, false )
      : jq_throttle( delay, callback, at_begin !== false );
  };
  
});

define('managers/waypoints',["jquery","version!fly/managers/debug","version!libs/waypoints/jquery.waypoints","version!fly/libs/jquery.throttle-debounce"],function(n,i){i=i.init("waypoints");var e=!1;return{init:function(){e||(e=!0,n(window).on("scroll",n.throttle(500,function(){Waypoint.refreshAll()})))}}});
define('components/taboola',["jquery","version!fly/managers/debug","managers/page-vars","managers/global-functions","managers/tealium","version!fly/utils/url-helper","managers/client-storage","managers/edition","managers/waypoints","version!fly/components/base"],function(e,a,t,o,i,n,l,s,r){a=a.init("taboola"),r.init(),t.services.taboola.enabled&&e.widget("cnet.taboola",e.fly.base,{options:{mode:null,container:null,lazyload:!1,lazyloadOffset:0,placement:null,prependPlacement:!0,targetType:"mix",url:null,pushPlacement:null,assetSelector:"[data-item-id]"},_baseTrackingData:{_pageTitle:t.tracking.data._pageTitle,siteSection:t.tracking.data.siteSection,pageType:t.tracking.data.pageType,siteEdition:t.tracking.data.siteEdition,siteType:t.tracking.data.siteType,siteHier:t.tracking.data.siteHier,brand:t.tracking.data.brand,_pageChannelType:t.tracking.data._pageChannelType},initOptions:null,isLoaded:!1,waypoint:null,_create:function(){var o=this;if(this._super(),this.initOptions={},!this.isLoaded){var i=0<e("[data-component=videoPlayer]").length,s="off"===n.getParam("autoplayEnabled")||"off"===l.read("autoplayEnabled"),r="article"===t.pageType&&"desktop"===t.device;this.options.lazyload?this.waypoint=new Waypoint({element:this.$element,handler:function(e){o._loadTaboola(),this.destroy()},offset:this.options.lazyloadOffset}):r&&i&&!s?t.video&&t.video.performance&&(t.video.performance.adstart||t.video.performance.contentstart)?(a.log("Load Taboola; video content already started"),o._loadTaboola()):e(window).on("cnet_video.adstart cnet_video.contentstart cnet_video.error",function(){o.isLoaded||(a.log("Load Taboola on cnet_video.adstart / cnet_video.contentstart"),o._loadTaboola())}):(a.log("Load Taboola regardless of cnet_video"),this._loadTaboola())}},_loadTaboola:function(){this.isLoaded=!0;var e=this;o.gdprConsentCallback("script_taboola",function(){require([s.isEspanol()?"taboola-es":"taboola"],function(o){if(!0===t.ads.enabled){o=window._taboola||[],a.log("Taboola widget created");var i=e.options;pageType=e._getPageType(),a.log("Taboola Page Type: "+pageType),e.initOptions[pageType]="auto",e.initOptions.visibile=!!i.mode,i.url&&(e.initOptions.url=i.url),i.pushPlacement=i.prependPlacement?t.tracking.data.pageType+" "+t.device+" "+i.placement:i.placement,e._pushTaboola(o)}else a.log("Ads disabled")})})},_getPageType:function(){var e={front_door:"home",article:"article",video_page:"video",image_gallery:"photo",section_door:"category",image_gallery_list:"category",search:"search",search_null:"search"},a="other";return e[t.pageType]&&(a=e[t.pageType]),a},_pushTaboola:function(e){var a=this.options;a.mode&&e.push({mode:a.mode,container:a.container,placement:a.pushPlacement,target_type:a.targetType}),e.push(this.initOptions),e.push({listenTo:"click",handler:this._clickTracking.bind(this)})},_clickTracking:function(t){var o=(this.options,this);a.log("Taboola Element Clicked, Tracking Now");var n=t.detail.type;"sponsored"==n?n="paid":"organic"==n&&(n="recirc"),i.trackCustomEvent("TaboolaClick",e.extend({},o._baseTrackingData,{dwLinkTag:this._setupDwTag(this.$element)+"|"+n+"["+(t.detail.slot+1)+"]",contentWidget:o.options.container}))}})});
define('components/mobile-footer-link',["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","version!fly/components/base"],function(e,i,t,n){i=i.init("mobileFooterLink"),e.widget("cnet.mobileFooterLink",e.fly.base,{options:{},_create:function(){this._setup();var e=this;t.read("mobileRedirect")&&(e.$element.append('<li><a class="view">Switch to mobile</a></li>'),this._setEvent())},_setEvent:function(){this.$element.find("a.view").on("click",function(){n.write("fly_device","mobile"),t.erase("mobileRedirect"),window.location.reload(!0)})}})});

define('fly/components/modal-1.0',[
    'jquery', 
    'version!fly/components/base'
], function($) {

    // support touch events
    var clickEventName = ($.support.touch) ? 'vclick' : 'click';

    /**
     * Creates a modal element
     *
     * @extends cbsi.base
     * 
     * Examples: 
     * 
     *      var modal = $.fly.modal(options);
     *      modal.open();
     *       
     *      or
     *
     *      $(selector).modal();
     *      $(selector).modal('open');
     *
     * Data api:
     * 
     *      <a data-open="modal" (href="#my-modal" or data-target="#my-modal")>Open Modal</a>
     *
     *      <div id="#my-modal" data-modal-options='{}'></div>
     *
     */
    $.widget( 'fly.modal', $.fly.base, {

        options: {
            content: null, 
            position: 'absolute', // absolute | fixed
            classModal: 'modal',
            classBackdrop: 'modal-backdrop',
            classShow: 'show',
            classFixed: 'fixed',
            enableKeyEvents: true,
            openOnInit: false,
            template: null
            
            //open: $noop, // open canceled if false returned
            //opened: $noop,
            //close: $noop, // close canceled if false returned
            //closed: $noop,
            //contentSet: $noop,
            //positioned: $noop
        },

        // VARS
        $modal: null, // {Object} the modal element
        $backdrop: null, // {Object} the background element
        $body: null, // {Object} body
        
        isOpen: false,
        eventData: {}, // data to pass w/ triggered events

        /**
         * Instantiate modal
         *
         * @public
         */
        _create: function() {
            var o = this.options,
                classPos = (o.position === 'fixed') ? ' '+o.classFixed : '',
                eventMapBackdrop = {},
                eventMapClose = {};
            
            this._setup();
        
            this.$modal = this.$element.addClass(o.classModal + classPos);
            this.$backdrop = $('<div>').addClass(o.classBackdrop + classPos);
            this.$body = $(document.body);
            
            // capture this before element gets appended to DOM
            this.top = parseInt(this.$modal.css('top'), 10 );

            if (o.content) {
                this.setContent(o.content);
            }
            
            this.eventData = {
                '$modal': this.$modal,
                '$backdrop': this.$backdrop
            };
            
            // set event maps
            eventMapBackdrop[clickEventName] = '_handleClose';
            eventMapClose[clickEventName +' [data-close="modal"]'] = '_handleClose';
            
            this._on(this.$backdrop, eventMapBackdrop);
            this._on(this.$modal, eventMapClose);
        },

        /**
         * Allow the modal to be opened by on init
         *
         * @private
         */
        _init: function(){
            if (this.options.openOnInit) {
                this.open();
            }
        },

        /**
         * Handle the keyboard event
         *
         * @private
         */        
        _handleKeyboard: function(e) {
            // close on esc
            if (e.keyCode == 27) {
                this.close();
            }   
        },

        /**
         * Handle the close event
         *
         * @param {Event} e Click event
         * @private
         */
        _handleClose: function(e) {
            e.preventDefault();
        
            this.close();
        },
        
        /**
         * Open the modal
         *
         * @public
         */
        open: function(){
            var o = this.options;
            
            if (this.isOpen) return;

            if (this._trigger('open', null, this.eventData) === false) return;

            this.$backdrop.addClass(o.classShow).appendTo(this.$body);            
            this.$modal.addClass(o.classShow).appendTo(this.$body);
        
            this.position();

            if (o.enableKeyEvents) {
                this._on(this.$document, {
                    'keyup': '_handleKeyboard'
                });
            }
            
            this.isOpen = true;

            this._trigger('opened', null, this.eventData);
        },
    
        /**
         * Close the modal
         *
         * @public
         */
        close: function(){
            var o = this.options;

            if (!this.isOpen) return;
            
            if (this._trigger('close', null, this.eventData) === false) return;

            this.$backdrop.removeClass(o.classShow);            
            this.$modal.removeClass(o.classShow);

            this._off(this.$document, 'keyup');
            
            this.isOpen = false;

            this._trigger('closed', null, this.eventData);
        },
        

        /**
         * Set Modal Content
         *
         * @param {mixed} content
         * @public
         */
        setContent: function(content){
            var o = this.options,
                self = this,
                $content = $(content),
                attrs;
            
            // id the modal container is already in the source
            // remove it and copy all it's attrs over the generated container
            if ($content.hasClass(o.classModal)) {
                $content.removeClass(o.classModal);
                
                attrs = $content.prop('attributes');

                $.each(attrs, function() {
                    if (this.name === 'class') {
                        self.$modal.addClass(this.value);
                    } else {
                        self.$modal.attr(this.name, this.value);
                    }
                });
                
                $content = $content.children();
            }
        
            this.$modal.empty().append($content);
            
            this._trigger('contentSet', null, $.extend({}, this.eventData, {
                $modal: this.$modal,
                $content: $content
            }));
        },
    

        /**
         * Positions the modal
         *
         * @private
         */
        position: function(){
            var o = this.options,
                winHeight = this.$window.height(),
                //try to use CSS top first, then calculate a top
                top = (!isNaN(this.top)) ? this.top : (winHeight - this.$modal.outerHeight()) / 3;
            
            if (top < 20) top = 20; //set a minmum top
            
            if (o.position == 'absolute'){
                top = top + this.$window.scrollTop();
                
                this.$backdrop.css({
                    height: this.$document.height()
                });
            }

            this.$modal.css({
                'top': top
            });

            this._trigger('positioned', null, {
                $modal: this.$modal
            });
        },
        
        _destroy: function() {
            this.$backdrop.remove();
        }
    });
    

    // External Data-api
    $(document).on(clickEventName+'.modal-api.data-api', '[data-open="modal"]', function(e) {
        var $this = $(this),
            data = $this.data(),
            $modal = data.$modal;
        
        e.preventDefault();
        
        if (!$modal) {
            $modal = $(data.target || $this.attr('href'));
            
            $this.data('$modal', $modal);
        }
        
        if ($modal.length) {
            $modal.modal().modal('open');
        }            
    });
    
});



define('components/global-modal',["jquery","managers/tealium","managers/page-vars","version!fly/managers/components","version!fly/components/modal"],function(t,e,i,n){t.widget("cnet.globalModal",t.fly.modal,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',container:null,setContentOnInit:!0,trackModal:null},_baseTrackingData:{_pageTitle:i.tracking.data._pageTitle,siteSection:i.tracking.data.siteSection,pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,siteHier:i.tracking.data.siteHier,brand:i.tracking.data.brand,_pageChannelType:i.tracking.data._pageChannelType},_create:function(){var i=this,n=null;this.options.setContentOnInit||(n=this.options.content,this.options.content=null),this._super(),this.options.setContentOnInit||(this.options.content=n,this.$element.on("modalopen",function(){if(!i.options.setContentOnInit&&i.options.content&&(i.setContent(i.options.content),i.options.trackModal)){var n=t.extend({},i._baseTrackingData,{clickGenericText:i.options.trackModal+"|open"});e.trackCustomEvent("modalTracking",n,"trackClick")}})),this.$body=this.options.container?t(this.options.container):this.$body},close:function(){if(this._super(),this.options.trackModal){var i=t.extend({},this._baseTrackingData,{clickGenericText:this.options.trackModal+"|close"});e.trackCustomEvent("modalTracking",i,"trackClick")}},setContent:function(e){var i,o=this.options,s=this;if("string"==typeof e){var a=t(e);this.$modal.html(o.modalTemplate.replace("{{content}}",null!=a.context?a.html():e))}else e.hasClass(o.classModal)&&(e.removeClass(o.classModal),i=e.prop("attributes"),t.each(i,function(){"class"===this.name?s.$modal.addClass(this.value):s.$modal.attr(this.name,this.value)}),e=o.modalTemplate.replace("{{content}}",e.html())),this.$modal.empty().append(e),this._trigger("contentSet",null,t.extend({},this.eventData,{$modal:this.$modal,$content:e}));n.process(this.$element)},position:function(){var e,i,n,o,s,a,l=this.options;this.$body.is(t(document.body))?(e=this.$window.height(),n=this.$window.scrollTop(),s=this.$document.height(),a=this.$window.width()/2,o=this.$window.scrollLeft()):(e=this.$body.height(),n=this.$body.scrollTop(),s=e,a=this.$body.width()/2,o=this.$body.scrollLeft()),i=isNaN(this.top)?(e-this.$modal.outerHeight())/2:this.top,i<20&&(i=20),"absolute"==l.position&&(i+=n,this.$backdrop.css({height:s})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal}),this.$element.css("left",a+o-this.$element.outerWidth()/2)}})});

define('fly/components/modal-iframe-1.0',[
    'jquery',
    'version!fly/utils/object-helper',
    'version!fly/utils/url-helper',
    'version!fly/components/modal',
    'version!fly/components/loading'
], function($, objHlpr, urlHlpr) {

    // support touch events
    var clickEventName = ($.support.touch) ? 'vclick' : 'click';

    /**
     * Creates a modal element w/ content loaded asynchronously
     *
     * @extends cbsi.base
     * 
     * Examples: 
     * 
     *      var modal = $.fly.modalAsync(options);
     *      modal.open();
     *
     * Data api:
     * 
     *      <a data-open="modalAsync" data-modal-async-url="/path/to/modal/content">Open Modal</a>
     *
     */
    $.widget( 'fly.modalIframe', $.fly.modal, {

        options: {
            url: null,
            requestData: {},
            messages: {},
            loader: {
                disabled: false
            } // takes all options of $.fly.loader
            
            //iframeReady: $.noop
        },
        
        messenger: null,

        /**
         * Instantiate async modal
         *
         * @public
         */
        _create: function() {
            
            this._super();
            
            this._setupLoader();
        },
        
        _setupLoader: function() {
            var self = this;
            
            this.loader = $.fly.loading($.extend(this.options.loader, {
                shown: function() {
                    self.$element.addClass(self.loader.options.classes.loading);
                },
                hidden: function() {
                    self.$element.removeClass(self.loader.options.classes.loading);
                }
            }));
            
            this.loader.$element.appendTo(this.$element);
        },

        open: function() {
            if (this.isOpen) return;
            
            this.loader.add();
            
            this.loadContent();
        
            this._super();
        },
        
        _getUrl: function() {
            var o = this.options,
                url = o.url;

            if (o.requestData) {
                url = url + (url.indexOf('?') > 0 ? '&' : '?') + $.param(o.requestData);
            }

            return url;
        },

        /**
         * Load Iframe
         *
         */
        loadContent: function(){
            var o = this.options,
                self = this;

            this.messenger = this.$element.iframeMessenger({
                remoteUrl: this._getUrl(),
                receivableMessages: $.extend({}, o.messages, {
                    ready: function() {
                        self._trigger('iframeReady');
                        self.loader.remove();
                    },
                    closeModal: function() {
                        self.close();
                    },
                    scroll: function(data) {
                        var offset = self.$element.offset().top + data.offset;

                        // don't position right at the top of the screen
                        offset = offset - (self.$window.height() / 6);
                        
                        $('html, body').animate({
                            scrollTop: offset
                        }, 'fast');
                    }
                })
            });
        }
    });

});



define('components/modal-iframe',["jquery","version!fly/managers/debug","version!fly/components/modal-iframe","components/loading"],function(e,t){t=t.init("modalIframe"),e.widget("fly.modalIframe",e.fly.modalIframe,{options:{modalTemplate:'<svg class="close" data-close="modal"><use xlink:href="#close" /></svg>{{content}}',loader:{classes:{loading:"loadingCircle"}}},$body:null,_create:function(){this._super(),this.$body=e(document.body),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var t=this;this.loader=e.cnet.loading(e.extend(this.options.loader,{shown:function(){t.$element.addClass(t.loader.options.classes.loading)},hidden:function(){t.$element.removeClass(t.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super(),this.centerHorizontally())},loadContent:function(){var t=this.options,o=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:e.extend({},t.messages,{ready:function(){o._trigger("iframeReady"),o.loader.remove(),setTimeout(o.centerHorizontally.bind(o),250)},closeModal:function(){o.close()}})})},centerHorizontally:function(){this.$element.css("margin-left",-this.$element.width()/2)},position:function(){var e=this.options,t=this.$window.height(),o=isNaN(this.top)?(t-this.$modal.outerHeight())/3:this.top;o<20&&(o=20),"absolute"==e.position&&(o+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:o}),this._trigger("positioned",null,{$modal:this.$modal})}})});
define('managers/user',["jquery","components/authentication"],function(n){return n.cnet.authentication()});
define('translations/modal-email',["managers/edition"],function(e){var a={en:{confirmation:"Your e-mail was sent successfully!",incorrectCaptcha:"The response you entered was incorrect.  Please try again.",notice:"Keep your friends up to date on your wish list.",messageA:"Click the",messageB:"to share the products you want with your friends.",ok:"OK, Got it"},es:{confirmation:"Tu email fue enviado exitosamente!",incorrectCaptcha:"La Captcha no es correcta. Por favor, inténtalo otra vez.",notice:"Mantén a tus amigos informados sobre tu lista.",messageA:"Haz clic en el",messageB:"para que tus amigos vean los productos que quieres.",ok:"De acuerdo"}};return e.getTranslation(a)});
define('components/modal-email',["jquery","version!fly/managers/debug","version!fly/managers/components","managers/edition","managers/user","translations/modal-email","components/global-modal","components/loading","version!fly/components/form-validate"],function(e,a,t,i,n,o){a=a.init("modalEmail"),e.widget("cnet.modalEmail",e.cnet.globalModal,{options:{emailType:"friend",pageTitle:function(){return document.title},pageUrl:function(){return window.location.href},recipientId:null,recipientName:"",messageThankYou:o.confirmation},emailTypes:{friend:{url:{us:"/email/friend/",uk:"/uk/email/friend/",au:"/au/email/friend/",es:"/es/email/friend/"},requireUsername:!1},friendRoadshow:{url:{us:"/email/friend/roadshow/",uk:"/uk/email/friend/roadshow/",au:"/au/email/friend/roadshow/",es:"/es/email/friend/roadshow/"},requireUsername:!1},member:{url:{us:"/email/member/",uk:"/uk/email/member/",au:"/au/email/member/",es:"/es/email/member/"},requireUsername:!0},editor:{url:{us:"/email/editor/",uk:"/uk/email/editor/",au:"/au/email/editor/",es:"/es/email/editor/"},requireUsername:!1},flag:{url:{us:"/email/flag/",uk:"/uk/email/flag/",au:"/au/email/flag/",es:"/es/email/flag/"},requireUsername:!0},video:{url:{us:"/email/video-feedback/",uk:"/uk/email/video-feedback/",au:"/au/email/video-feedback/",es:"/es/email/video-feedback/"},requireUsername:!1}},errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to send an e-mail.","cnet.notloggedin":"You must be logged in to send an e-mail.","cnet_recaptcha.incorrect-captcha-sol":o.incorrectCaptcha,"cnet_recaptcha.missing-input-response":o.incorrectCaptcha},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){this.loader=e.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){var e=this,a=this.emailTypes[this.options.emailType];this.isOpen||(a.requireUsername?(n.hasAccess({requireUsername:!0,nextAction:function(t){e._openEmailType(a)}}),e._super()):(this._openEmailType(a),e._super()))},_openEmailType:function(a){var n=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),e.ajax({url:a.url[i.getEdition()],data:this.options.recipientId?{regId:this.options.recipientId}:null,dataType:"text"}).done(function(a){n.loader.remove(),n.setContent(a),n.position(),n._setupEvents(),e("[data-email-var]",n.$element).each(function(a,t){var i=e(t),o=i.data("emailVar");"pageTitle"===o?i.text(n.options.pageTitle):"recipientName"===o&&i.text(n.options.recipientName)}),e('input[name="emailFriend[pageTitle]"]',n.$element).val(n.options.pageTitle);var i="string"==typeof n.options.pageUrl?n.options.pageUrl:n.options.pageUrl();e('input[name="emailFriend[pageUrl]"]',n.$element).val(i),t.process(n.$element)}).always(function(){n.loader.remove()})},_setupEvents:function(){var a=this,t=e("form",this.$element),i=e('[data-component="recaptcha"], .g-recaptcha',a.$element),n=e('[data-email-var="error"]',t);t.formValidate({success:function(o){o.preventDefault(),e.ajax({dataType:"json",type:"POST",url:t.attr("action"),data:t.serialize()}).done(function(e){"success"===e.status?(t.html(a.options.messageThankYou),a.position()):(e.errors?n.text(e.errors[0]):n.text(a.errorMessages[e.message]),i.recaptcha("reload"))})}})}}),e(document).on("click.modalEmail-api.data-api",'[data-open="modalEmail"]',function(a){var t,i=e(this),n=i.data(),o=n.$modal;a.preventDefault(),o?o.open():(t=i.data("modalEmailOptions")||i.dataPrefix("modalEmail"),i.data("$modal",e.cnet.modalEmail(e.extend(t,{openOnInit:!0,destroy:function(){i.data("$modal",null)}}))))})});
define('managers/components.desktop',["jquery","version!fly/managers/components","version!fly/managers/debug","managers/tealium","managers/page-vars","components/authentication","components/tabs-modal","components/site-header","components/auto-suggest","components/lazyload-component","components/taboola","components/mobile-footer-link","components/global-modal","components/modal-iframe","components/modal-email"],function(e,o,r,n,t){r=r.init("componentManager");var s="uvpjs_upgrade"===t.tracking.data.testName&&"test"===t.tracking.data.testGroup;return o.register({authentication:{},tabsModal:{},siteHeader:{},autoSuggest:{},lazyloadComponent:{},taboola:{},mobileFooterLink:{},globalModal:{},modalIframe:{},modalEmail:{},accordion:{require:"version!fly/components/accordion"},addthisevent:{require:"components/add-this-event"},alert:{require:"version!fly/components/alert"},amazonAd:{require:"components/amazon-ad"},article:{require:"components/article"},audioPlayer:{require:"components/audio-player"},backgroundVideo:{require:"components/background-video"},bestFitVideoPromo:{require:"components/best-fit-video-promo"},bestList:{require:"components/best-list"},bestListing:{require:"components/best-listing"},breakingNews:{require:"components/breaking-news"},carFinder:{require:"components/car-finder"},carousel:{require:"version!fly/components/carousel",options:{slidechanged:function(o){e(window).trigger("scroll")}}},carouselDesktop:{require:"components/carousel.desktop"},carouselFull:{require:"components/carousel-full"},cbsiFeedWidget:{require:"components/cbsi-feed-widget"},clipboard:{require:"components/clipboard"},commands:{require:"components/commands"},commentDownloader:{require:"components/comment-downloader"},connectComponent:{require:"components/connect-es-component"},contactUs:{require:"components/contact-us"},couponsDesktop:{require:"components/coupons-page.desktop"},dropdown:{require:"components/dropdown"},dealsActivator:{require:"components/deals-activator.desktop"},dealsUpdater:{require:"components/deals-updater"},dfllActivator:{require:"components/dfll-activator.desktop"},dfllActivatorV2:{require:"components/dfll-activator-v2.desktop"},dfllUpdater:{require:"components/dfll-updater.desktop"},dfllUpdaterV2:{require:"components/dfll-updater-v2.desktop"},disqusCount:{require:"components/disqus-count"},editorsChoiceToggle:{require:"components/editors-choice-toggle"},ellipsis:{require:"components/ellipsis"},expando:{require:"components/expando"},HGGFD:{require:"components/hgg-door"},holidayNav:{require:"components/holiday-nav"},inlineProductCarousel:{require:"components/inline-product-carousel"},topStories:{require:"components/top-stories"},errorModal:{require:"components/error-modal"},expiredDealModal:{require:"components/expired-deal-modal.desktop"},externalLink:{require:"components/external-link"},autoCalcIframe:{require:"components/auto-calc-iframe"},fixate:{require:"components/fixate"},formAjax:{require:"components/form-ajax"},formTrim:{require:"components/form-trim"},formValidate:{require:"components/form-validate"},forumsBestAnswer:{require:"components/forums-best-answer"},forumsEditPost:{require:"components/forums-edit-post"},forumsMarkAsRead:{require:"components/forums-mark-as-read"},forumsRealtime:{require:"components/forums-realtime"},forumsPostToggle:{require:"components/forums-post-toggle"},forumsPostPreview:{require:"components/forums-post-preview"},forumsPostFlag:{require:"components/forums-post-flag"},forumsPermalink:{require:"components/forums-permalink"},forumsLoadForm:{require:"components/forums-load-form"},forumsSearchUpdater:{require:"components/forums-search-updater"},forumsTools:{require:"components/forums-tools"},forumsTrack:{require:"components/forums-track"},forumsVote:{require:"components/forums-vote"},fullScreenSlides:{require:"components/full-screen-slides"},genericTracker:{require:"components/generic-tracker"},googleCsa:{require:"components/google-csa"},iframeAdTracker:{require:"components/iframe-ad-tracker"},iframeHoverFix:{require:"components/iframe-hover-fix"},imageGallery:{require:"components/image-gallery"},imageGalleryAuto:{require:"components/image-gallery-auto"},imageGalleryModal:{require:"components/image-gallery-modal"},indepthReview:{require:"components/indepth-review"},instagramFetcher:{require:"components/instagram-fetcher"},interactiveFloorPlans:{require:"components/interactive-floor-plans"},interactiveVideoPlayer:{require:"components/interactive-video-player"},inviewElement:{require:"quantum/inviewElement"},joinCnet:{require:"components/join-cnet"},lazyloadImages:{require:"components/lazyload-images"},lazyloadElement:{require:"components/lazyload-element"},leadsTracker:{require:"components/leads-tracker"},linkTracker:{require:"components/link-tracker"},loading:{require:"components/loading"},loadMore:{require:"components/load-more"},loadNewest:{require:"components/load-newest",options:{clickGenericText:"refresh-river"}},longform:{require:"components/longform"},magnet:{require:"components/magnet"},modal:{require:"version!fly/components/modal"},modalEnlargeImage:{require:"components/modal-enlarge-image"},modalNewsletter:{require:"components/modal-newsletter"},moduleAssetTracker:{require:"components/module-asset-tracker"},mostPopularDeal:{require:"components/most-popular-deal.desktop"},mostPopularDealListing:{require:"components/most-popular-deal-listing.desktop",options:{contentSet:function(e){o.process(e.$content)}}},myLists:{require:"components/mylists"},myListsButton:{require:"components/mylists-button"},myListsCount:{require:"components/mylists-count"},myListsEmail:{require:"components/mylists-email"},newsletterSubscription:{require:"components/newsletter-subscription"},newsCarousel:{require:"components/news-carousel"},page:{require:"components/page"},pageHeader:{require:"components/page-header"},parallaxReveal:{require:"components/parallax-reveal"},poll:{require:"components/poll"},pricesByZip:{require:"components/prices-by-zip"},productMediaCarousel:{require:"components/product-media-carousel"},productSeriesModal:{require:"components/product-series",options:{contentSet:function(e,r){o.process(r.$content)}}},productSpecs:{require:"components/product-specs"},productReviewVideo:{require:"components/product-review-video"},profileReauth:{require:"components/profile-reauth"},progressiveAd:{require:"components/progressive-ad"},scrollTracking:{require:"components/scroll-tracking"},popOnScroll:{require:"components/pop-on-scroll"},profileSubscriptions:{require:"components/profile-subscriptions",options:{contentSet:function(e){o.process(e.$content)}}},profileModal:{require:"components/profile-modal",options:{contentSet:function(e){o.process(e.$content)}}},profileUpdate:{require:"components/profile-update",options:{contentSet:function(e){o.process(e.$content)}}},profileUgc:{require:"components/profile-ugc",options:{contentSet:function(e){o.process(e.$content)}}},profileDiscussions:{require:"components/profile-discussions"},radio:{require:"components/radio"},readMore:{require:"components/read-more"},realtimeData:{require:"components/realtime-data"},realtimeDrawer:{require:"components/realtime-drawer"},realtimeTicker:{require:"components/realtime-ticker"},recaptcha:{require:"components/recaptcha"},reposition:{require:"components/reposition"},scrollbarArea:{require:"components/scrollbar-area"},searchBar:{require:"components/search-bar"},searchPagination:{require:"components/search-paginator",options:{contentSet:function(e){o.process(e.$content)}}},searchSort:{require:"components/search-sort"},selfishScroll:{require:"components/selfish-scroll"},sharebar:{require:"components/sharebar"},shortcodeGallery:{require:"components/shortcode-gallery"},shortcodeGalleryController:{require:"components/shortcode-gallery-controller"},showcaseHeroTabs:{require:"components/showcase-hero-tabs"},showcaseRailBody:{require:"components/showcase-rail-body"},showcaseVideos:{require:"components/showcase-videos"},sideNav:{require:"components/side-nav"},sideqik:{require:"components/sideqik"},slider:{require:"components/slider"},slidingElement:{require:"components/sliding-element"},snappyCarousel:{require:"quantum/snappyCarousel"},stacklaEvents:{require:"components/stackla-events"},uiSlider:{require:"version!libs/jquery/ui/jquery.ui.slider"},socialButton:{require:"version!fly/components/social-button"},socialCounts:{require:"components/social-counts"},socialMenu:{require:"components/social-menu"},socialTracking:{require:"components/social-tracking"},stickyColumn:{require:"components/sticky-column"},stickyElement:{require:"components/sticky-element"},stickyLeader:{require:"components/sticky-leader"},subratingModalToggle:{require:"components/subrating-modal-toggle"},swipeAway:{require:"quantum/swipeAway"},tableSorter:{require:"components/table-sorter"},tabs:{require:"version!fly/components/tabs"},tabsAsync:{require:"components/tabs-async",options:{contentSet:function(e){o.process(e.$content)}}},tabsRefresh:{require:"components/tabs-refresh"},tagLetterSorter:{require:"components/tag-letter-sorter"},textCounter:{require:"components/text-counter"},tileSpecialNav:{require:"components/tile-special-nav"},tocNav:{require:"components/toc-nav"},toggle:{require:"components/toggle"},tooltip:{require:"components/tooltip"},touchMenuHover:{require:"components/touch-menu-hover"},trackDownload:{require:"components/track-download"},trackImpression:{require:"components/track-impression"},tvFeature:{require:"components/tv-feature"},twitterFetcher:{require:"components/twitter-fetcher"},updateArea:{require:"components/update-area"},versusModelSwitcher:{require:"components/versus-model-switcher"},videoPlaceholder:{require:"components/video-placeholder"},videoPlayer:{require:s?"quantum/videoPlayer_upgrade":"quantum/videoPlayer"},videoListing:{require:"components/video-listing"},videoPlaylistConnector:{require:"components/video-playlist-connector"},videoShowGallery:{require:"components/video-show-gallery"},waypointPromo:{require:"component/waypoint-promo"},zipCode:{require:"components/zip-code"},zoom:{require:"quantum/zoom"},profileNewsletterSubscription:{require:"components/profile-newsletter-subscription"},bandwidthMeterBar:{require:"components/bandwidth-meter-bar"}}),o});
define('managers/edition-notifications',["jquery","version!fly/managers/debug","managers/device","components/global-modal"],function(n,e,i,t){return e=e.init("editionNotifications"),{init:function(){if(i.isDesktop()){var e=n("body").data("edition-redirect-alert");e&&e.length>0&&n.cnet.globalModal({content:e,openOnInit:!0})}}}});
define('managers/promotionals.desktop',["jquery","version!fly/managers/debug","managers/client-storage","utils/cookie","managers/edition","managers/page-vars","managers/user","version!libs/modernizr.custom"],function(o,i,n,t,e,a,r){i=i.init("promotionals"),i.log("promos here");var s=null,c={cookiesNotification:{limit:3,isActive:function(){return e.isUnitedKingdom()&&!n.read("suppressCookiesNotification",!0)&&s.cookiesNotification<c.cookiesNotification.limit},init:function(){require(["components/cookies-notification.desktop"],function(){o.cnet.cookiesNotification(),s.cookiesNotification++,n.write("promotionalSettings",s),n.write("suppressCookiesNotification",!0,!0)})}},espanolPromo:{limit:2,isActive:function(){var o=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;return o||(o="es"===t.read("fly_default_edition")),!e.isEspanol()&&o&&!n.read("suppressEspanolPromo",!0)&&s.espanolPromo<c.espanolPromo.limit},init:function(){require(["components/espanol-promo.desktop"],function(){o.cnet.espanolPromo(),s.espanolPromo++,n.write("promotionalSettings",s),n.write("suppressEspanolPromo",!0,!0)})}},espanolMatch:{limit:1,isActive:function(){var o=(window.navigator.userLanguage||window.navigator.language).indexOf("es")>=0;o||(o="es"===t.read("fly_default_edition"));var i=t.read("fly_geo")?JSON.parse(t.read("fly_geo")):"",a=!!t.read("fly_esMatchShown");return!e.isEspanol()&&o&&"us"==i.countryCode&&!a&&!n.read("suppressEspanolMatch",!0)},init:function(){require(["components/espanol-match"],function(){var i=o("[data-espanol-match-options]");i.espanolMatch(i.data("espanolMatchOptions")),s.espanolMatch++,n.write("promotionalSettings",s),t.write("fly_esMatchShown","true",{expires:1})})}},autoSocialPromo:{limit:4,isActive:function(){var o="front_door"==a.tracking.data._pageType&&"auto"==a.tracking.data.slug,i=s.autoSocialPromo<c.autoSocialPromo.limit;return o&&i},init:function(){require(["components/waypoint-promo"],function(){o.cnet.waypointPromo()})}},urbanAirshipPromo:{isActive:function(){return!0},init:function(){require(["components/urban-airship"],function(){try{o.cnet.urbanAirship()}catch(o){i.log("UrbanAirship component not available")}})}}};return{init:function(){var i=function(){!1===o.cnet.breakingNewsActive&&(c.cookiesNotification.isActive()?c.cookiesNotification.init():c.espanolPromo.isActive()&&c.espanolPromo.init())};s=n.read("promotionalSettings")||{};for(var t in c)c.hasOwnProperty(t)&&(s[t]=s[t]||0);c.autoSocialPromo.isActive()&&c.autoSocialPromo.init(),c.urbanAirshipPromo.isActive()&&c.urbanAirshipPromo.init(),c.espanolMatch.isActive()&&c.espanolMatch.init(),void 0===o.cnet.breakingNewsActive?o(window).on("breakingNewsComplete",function(){i()}):i()},suppress:function(o){s[o]=c[o].limit,n.write("promotionalSettings",s)},increment:function(o){s[o]++,n.write("promotionalSettings",s)}}});
define('managers/third-party/social',["version!fly/managers/debug","managers/page-vars","managers/global-functions"],function(e,t,i){function n(e){"string"==typeof s[e]&&i.gdprConsentCallback("script_"+e,function(){require([s[e]],function(t){s[e]=t,t.init()})})}e=e.init("social");var s={linkedIn:"managers/third-party/linked-in",pinterest:"managers/third-party/pinterest",twitter:"managers/third-party/twitter",disqus:"managers/third-party/disqus"};return{init:function(){t.services.linkedin.enabled&&$('[data-social="linkedIn"]').length>0&&n("linkedIn"),t.services.pinterest.enabled&&$('[data-social="pinterest"]').length>0&&n("pinterest"),t.services.twitterwidget.enabled&&$('[data-social="twitter"]').length>0&&n("twitter"),t.services.disqus.enabled&&$('[data-social="disqus"]').length>0&&"comments_permalink"==t.pageType&&n("disqus")},parse:function(e){e=e||null,t.services.linkedin.enabled&&$('[data-social="linkedIn"]',e).length>0&&("string"==typeof s.linkedIn?n("linkedIn"):s.linkedIn.parse(e)),t.services.pinterest.enabled&&$('[data-social="pinterest"]',e).length>0&&"string"==typeof s.pinterest&&n("pinterest"),t.services.twitterwidget.enabled&&$('[data-social="twitter"]',e).length>0&&("string"==typeof s.twitter?n("twitter"):s.twitter.parse()),t.services.disqus.enabled&&$('[data-social="disqus"]',e).length>0&&("string"==typeof s.disqus?n("disqus"):s.disqus.parse(e))}}});
/*
* jQuery Mobile v1.4.0-alpha.1
* http://jquerymobile.com
*
* Copyright 2010, 2013 jQuery Foundation, Inc. and other contributors
* Released under the MIT license.
* http://jquery.org/license
*
*/

!function(t,e,n){"function"==typeof define&&define.amd?define('libs/jquery/mobile-1.4.0a1',["jquery"],function(o){return n(o,t,e),o.mobile}):n(t.jQuery,t,e)}(this,document,function(t,e,n,o){!function(t,e,n,o){function i(t){for(;t&&void 0!==t.originalEvent;)t=t.originalEvent;return t}function s(e,n){var s,a,r,u,c,l,p,h,d,v=e.type;if(e=t.Event(e),e.type=n,s=e.originalEvent,a=t.event.props,v.search(/^(mouse|click)/)>-1&&(a=S),s)for(p=a.length,u;p;)u=a[--p],e[u]=s[u];if(v.search(/mouse(down|up)|click/)>-1&&!e.which&&(e.which=1),-1!==v.search(/^touch/)&&(r=i(s),v=r.touches,c=r.changedTouches,l=v&&v.length?v[0]:c&&c.length?c[0]:o))for(h=0,d=M.length;h<d;h++)u=M[h],e[u]=l[u];return e}function a(e){for(var n,o,i={};e;){n=t.data(e,y);for(o in n)n[o]&&(i[o]=i.hasVirtualBinding=!0);e=e.parentNode}return i}function r(e,n){for(var o;e;){if((o=t.data(e,y))&&(!n||o[n]))return e;e=e.parentNode}return null}function u(){H=!1}function c(){H=!0}function l(){q=0,z.length=0,F=!1,c()}function p(){u()}function h(){d(),x=setTimeout(function(){x=0,l()},t.vmouse.resetTimerDuration)}function d(){x&&(clearTimeout(x),x=0)}function v(e,n,o){var i;return(o&&o[e]||!o&&r(n.target,e))&&(i=s(n,e),t(n.target).trigger(i)),i}function f(e){var n,o=t.data(e.target,X);F||q&&q===o||(n=v("v"+e.type,e))&&(n.isDefaultPrevented()&&e.preventDefault(),n.isPropagationStopped()&&e.stopPropagation(),n.isImmediatePropagationStopped()&&e.stopImmediatePropagation())}function m(e){var n,o,s,r=i(e).touches;r&&1===r.length&&(n=e.target,o=a(n),o.hasVirtualBinding&&(q=V++,t.data(n,X,q),d(),p(),j=!1,s=i(e).touches[0],B=s.pageX,N=s.pageY,v("vmouseover",e,o),v("vmousedown",e,o)))}function g(t){H||(j||v("vmousecancel",t,a(t.target)),j=!0,h())}function b(e){if(!H){var n=i(e).touches[0],o=j,s=t.vmouse.moveDistanceThreshold,r=a(e.target);j=j||Math.abs(n.pageX-B)>s||Math.abs(n.pageY-N)>s,j&&!o&&v("vmousecancel",e,r),v("vmousemove",e,r),h()}}function w(t){if(!H){c();var e,n,o=a(t.target);v("vmouseup",t,o),j||(e=v("vclick",t,o))&&e.isDefaultPrevented()&&(n=i(t).changedTouches[0],z.push({touchID:q,x:n.clientX,y:n.clientY}),F=!0),v("vmouseout",t,o),j=!1,h()}}function T(e){var n,o=t.data(e,y);if(o)for(n in o)if(o[n])return!0;return!1}function D(){}var E,k,y="virtualMouseBindings",X="virtualTouchID",Y="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),M="clientX clientY pageX pageY screenX screenY".split(" "),P=t.event.mouseHooks?t.event.mouseHooks.props:[],S=t.event.props.concat(P),I={},x=0,B=0,N=0,j=!1,z=[],F=!1,H=!1,L="addEventListener"in n,O=t(n),V=1,q=0;for(t.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},k=0;k<Y.length;k++)t.event.special[Y[k]]=function(e){var n=e.substr(1);return{setup:function(){T(this)||t.data(this,y,{}),t.data(this,y)[e]=!0,I[e]=(I[e]||0)+1,1===I[e]&&O.bind(n,f),t(this).bind(n,D),L&&(I.touchstart=(I.touchstart||0)+1,1===I.touchstart&&O.bind("touchstart",m).bind("touchend",w).bind("touchmove",b).bind("scroll",g))},teardown:function(){--I[e],I[e]||O.unbind(n,f),L&&(--I.touchstart||O.unbind("touchstart",m).unbind("touchmove",b).unbind("touchend",w).unbind("scroll",g));var o=t(this),i=t.data(this,y);i&&(i[e]=!1),o.unbind(n,D),T(this)||o.removeData(y)}}}(Y[k]);L&&n.addEventListener("click",function(e){var n,o,i,s,a,r=z.length,u=e.target;if(r)for(n=e.clientX,o=e.clientY,E=t.vmouse.clickDistanceThreshold,i=u;i;){for(s=0;s<r;s++)if(a=z[s],i===u&&Math.abs(a.x-n)<E&&Math.abs(a.y-o)<E||t.data(i,X)===a.touchID)return e.preventDefault(),void e.stopPropagation();i=i.parentNode}},!0)}(t,0,n),function(t){t.mobile={}}(t),function(t,e){var o={touch:"ontouchend"in n};t.mobile.support=t.mobile.support||{},t.extend(t.support,o),t.extend(t.mobile.support,o)}(t),function(t,e,o){function i(e,n,o){var i=o.type;o.type=n,t.event.dispatch.call(e,o),o.type=i}var s=t(n),a=t.mobile.support.touch,r=a?"touchstart":"mousedown",u=a?"touchend":"mouseup",c=a?"touchmove":"mousemove";t.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(e,n){t.fn[n]=function(t){return t?this.bind(n,t):this.trigger(n)},t.attrFn&&(t.attrFn[n]=!0)}),t.event.special.scrollstart={enabled:!0,setup:function(){function e(t,e){n=e,i(s,n?"scrollstart":"scrollstop",t)}var n,o,s=this;t(s).bind("touchmove scroll",function(i){t.event.special.scrollstart.enabled&&(n||e(i,!0),clearTimeout(o),o=setTimeout(function(){e(i,!1)},50))})},teardown:function(){t(this).unbind("touchmove scroll")}},t.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var e=this,n=t(e),o=!1;n.bind("vmousedown",function(a){function r(){clearTimeout(l)}function u(){r(),n.unbind("vclick",c).unbind("vmouseup",r),s.unbind("vmousecancel",u)}function c(t){u(),o||p!==t.target?o&&t.stopPropagation():i(e,"tap",t)}if(o=!1,a.which&&1!==a.which)return!1;var l,p=a.target;n.bind("vmouseup",r).bind("vclick",c),s.bind("vmousecancel",u),l=setTimeout(function(){t.event.special.tap.emitTapOnTaphold&&(o=!0),i(e,"taphold",t.Event("taphold",{target:p}))},t.event.special.tap.tapholdThreshold)})},teardown:function(){t(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),s.unbind("vmousecancel")}},t.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:10,verticalDistanceThreshold:75,start:function(e){var n=e.originalEvent.touches?e.originalEvent.touches[0]:e;return{time:(new Date).getTime(),coords:[n.pageX,n.pageY],origin:t(e.target)}},stop:function(t){var e=t.originalEvent.touches?t.originalEvent.touches[0]:t;return{time:(new Date).getTime(),coords:[e.pageX,e.pageY]}},handleSwipe:function(e,n,o,s){if(n.time-e.time<t.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-n.coords[0])>t.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-n.coords[1])<t.event.special.swipe.verticalDistanceThreshold){var a=e.coords[0]>n.coords[0]?"swipeleft":"swiperight";return i(o,"swipe",t.Event("swipe",{target:s,swipestart:e,swipestop:n})),i(o,a,t.Event(a,{target:s,swipestart:e,swipestop:n})),!0}return!1},setup:function(){var e=this,n=t(e);n.bind(r,function(o){function i(n){a&&(s=t.event.special.swipe.stop(n),l||(l=t.event.special.swipe.handleSwipe(a,s,e,r)),Math.abs(a.coords[0]-s.coords[0])>t.event.special.swipe.scrollSupressionThreshold&&n.preventDefault())}var s,a=t.event.special.swipe.start(o),r=o.target,l=!1;n.bind(c,i).one(u,function(){l=!0})})},teardown:function(){t(this).unbind(r).unbind(c).unbind(u)}},t.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(e,n){t.event.special[e]={setup:function(){t(this).bind(n,t.noop)},teardown:function(){t(this).unbind(n)}}})}(t)});

define('main.desktop',["jquery","managers/client-storage","managers/components.desktop","managers/device","managers/edition-notifications","managers/page-vars","managers/promotionals.desktop","managers/third-party/social","managers/tracking","managers/tealium","version!libs/modernizr.custom","version!fly/utils/data-prefix","utils/function-natives","version!libs/jquery/mobile","managers/user"],function(i,a,e,n,s,t,r,o,m){i(document).ready(function(){m.resetTrackingData(t.tracking.data),n.init(t.device),a.init(),e.process(i("body")),r.init(),s.init(),o.init()})});
//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

(function() {
  var _global = this;

  // Unique ID creation requires a high quality random # generator.  We feature
  // detect to determine the best RNG source, normalizing to a function that
  // returns 128-bits of randomness, since that's what's usually required
  var _rng;

  // Node.js crypto-based RNG - http://nodejs.org/docs/v0.6.2/api/crypto.html
  //
  // Moderately fast, high quality
  if (typeof(_global.require) == 'function') {
    try {
      var _rb = _global.require('crypto').randomBytes;
      _rng = _rb && function() {return _rb(16);};
    } catch(e) {}
  }

  if (!_rng && _global.crypto && crypto.getRandomValues) {
    // WHATWG crypto-based RNG - http://wiki.whatwg.org/wiki/Crypto
    //
    // Moderately fast, high quality
    var _rnds8 = new Uint8Array(16);
    _rng = function whatwgRNG() {
      crypto.getRandomValues(_rnds8);
      return _rnds8;
    };
  }

  if (!_rng) {
    // Math.random()-based (RNG)
    //
    // If all else fails, use Math.random().  It's fast, but is of unspecified
    // quality.
    var  _rnds = new Array(16);
    _rng = function() {
      for (var i = 0, r; i < 16; i++) {
        if ((i & 0x03) === 0) r = Math.random() * 0x100000000;
        _rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
      }

      return _rnds;
    };
  }

  // Buffer class to use
  var BufferClass = typeof(_global.Buffer) == 'function' ? _global.Buffer : Array;

  // Maps for number <-> hex string conversion
  var _byteToHex = [];
  var _hexToByte = {};
  for (var i = 0; i < 256; i++) {
    _byteToHex[i] = (i + 0x100).toString(16).substr(1);
    _hexToByte[_byteToHex[i]] = i;
  }

  // **`parse()` - Parse a UUID into it's component bytes**
  function parse(s, buf, offset) {
    var i = (buf && offset) || 0, ii = 0;

    buf = buf || [];
    s.toLowerCase().replace(/[0-9a-f]{2}/g, function(oct) {
      if (ii < 16) { // Don't overflow!
        buf[i + ii++] = _hexToByte[oct];
      }
    });

    // Zero out remaining bytes if string was short
    while (ii < 16) {
      buf[i + ii++] = 0;
    }

    return buf;
  }

  // **`unparse()` - Convert UUID byte array (ala parse()) into a string**
  function unparse(buf, offset) {
    var i = offset || 0, bth = _byteToHex;
    return  bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]];
  }

  // **`v1()` - Generate time-based UUID**
  //
  // Inspired by https://github.com/LiosK/UUID.js
  // and http://docs.python.org/library/uuid.html

  // random #'s we need to init node and clockseq
  var _seedBytes = _rng();

  // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
  var _nodeId = [
    _seedBytes[0] | 0x01,
    _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]
  ];

  // Per 4.2.2, randomize (14 bit) clockseq
  var _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;

  // Previous uuid creation time
  var _lastMSecs = 0, _lastNSecs = 0;

  // See https://github.com/broofa/node-uuid for API details
  function v1(options, buf, offset) {
    var i = buf && offset || 0;
    var b = buf || [];

    options = options || {};

    var clockseq = options.clockseq != null ? options.clockseq : _clockseq;

    // UUID timestamps are 100 nano-second units since the Gregorian epoch,
    // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
    // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
    // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.
    var msecs = options.msecs != null ? options.msecs : new Date().getTime();

    // Per 4.2.1.2, use count of uuid's generated during the current clock
    // cycle to simulate higher resolution clock
    var nsecs = options.nsecs != null ? options.nsecs : _lastNSecs + 1;

    // Time since last uuid creation (in msecs)
    var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;

    // Per 4.2.1.2, Bump clockseq on clock regression
    if (dt < 0 && options.clockseq == null) {
      clockseq = clockseq + 1 & 0x3fff;
    }

    // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
    // time interval
    if ((dt < 0 || msecs > _lastMSecs) && options.nsecs == null) {
      nsecs = 0;
    }

    // Per 4.2.1.2 Throw error if too many uuids are requested
    if (nsecs >= 10000) {
      throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');
    }

    _lastMSecs = msecs;
    _lastNSecs = nsecs;
    _clockseq = clockseq;

    // Per 4.1.4 - Convert from unix epoch to Gregorian epoch
    msecs += 12219292800000;

    // `time_low`
    var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
    b[i++] = tl >>> 24 & 0xff;
    b[i++] = tl >>> 16 & 0xff;
    b[i++] = tl >>> 8 & 0xff;
    b[i++] = tl & 0xff;

    // `time_mid`
    var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;
    b[i++] = tmh >>> 8 & 0xff;
    b[i++] = tmh & 0xff;

    // `time_high_and_version`
    b[i++] = tmh >>> 24 & 0xf | 0x10; // include version
    b[i++] = tmh >>> 16 & 0xff;

    // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)
    b[i++] = clockseq >>> 8 | 0x80;

    // `clock_seq_low`
    b[i++] = clockseq & 0xff;

    // `node`
    var node = options.node || _nodeId;
    for (var n = 0; n < 6; n++) {
      b[i + n] = node[n];
    }

    return buf ? buf : unparse(b);
  }

  // **`v4()` - Generate random UUID**

  // See https://github.com/broofa/node-uuid for API details
  function v4(options, buf, offset) {
    // Deprecated - 'format' argument, as supported in v1.2
    var i = buf && offset || 0;

    if (typeof(options) == 'string') {
      buf = options == 'binary' ? new BufferClass(16) : null;
      options = null;
    }
    options = options || {};

    var rnds = options.random || (options.rng || _rng)();

    // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
    rnds[6] = (rnds[6] & 0x0f) | 0x40;
    rnds[8] = (rnds[8] & 0x3f) | 0x80;

    // Copy bytes to buffer, if provided
    if (buf) {
      for (var ii = 0; ii < 16; ii++) {
        buf[i + ii] = rnds[ii];
      }
    }

    return buf || unparse(rnds);
  }

  // Export public API
  var uuid = v4;
  uuid.v1 = v1;
  uuid.v4 = v4;
  uuid.parse = parse;
  uuid.unparse = unparse;
  uuid.BufferClass = BufferClass;

  // Publish as global (in browsers)
  var _previousRoot = _global.uuid;

  // **`noConflict()` - (browser only) to reset global 'uuid' var**
  uuid.noConflict = function() {
    _global.uuid = _previousRoot;
    return uuid;
  };

  _global.uuid = uuid;

}).call(this);
define("fly/libs/guid-1.0", function(){});


define('managers/recommendation',[
    'jquery',
    'managers/page-vars',
    'managers/global-functions',
    'managers/tealium',
    'version!fly/managers/debug',
    'version!fly/libs/guid',
    'version!fly/libs/jquery.throttle-debounce'
], function(
    $,
    pageVars,
    globalFunctions,
    tealium,
    debug
) {
    var MANAGER_NAME = "recommendationManager";
    var LOCAL_STORAGE_VIEW_KEY = "CnetViewList";
    var LOCAL_STORAGE_UNFOLLOW_KEY = "CnetUnfollowList";
    var LOCAL_STORAGE_ANON_KEY = "CnetAnon";
    var FUNCTION_HOST = window.location.host === "www.cnet.com" ?
        "https://us-central1-i-cnet-prod.cloudfunctions.net/userInterestsStore" :
        "https://us-central1-i-cnet-dev.cloudfunctions.net/userInterestsStore";
    var MAX_VIEW_LENGTH = 100;
    var MAX_AGE = 1000 * 60 * 60 * 24 * 30; // 30 days in milliseconds
    var MIN_THRESHOLD_FOR_INTEREST = 2;
    debug = debug.init(MANAGER_NAME);

    var recommendations = {
        /**
         * Function that creates/logs page view events
         *
         * @public
         * @method registerPageView
         * @param {boolean} isImplicit - Flag indicating if view is implicit
         */
        registerPageView: function(isImplicit) {
            // if local storage is not available, exit
            // should not use cookies, since we could be storing far more data that cookies allow for
            if (!testForLocalStorage()) {
                return;
            }

            // Set isImplicit default value to true while supporting older IE browsers
            if (isImplicit === undefined) {
                isImplicit = true;
            }

            // view events are stored in ascending order by create date
            var views = JSON.parse(localStorage.getItem(LOCAL_STORAGE_VIEW_KEY));

            if (!views) {
                views = [];
            }

            var view = createNewViewEvent();
            views.push(view);
            views = pruneViews(views, view);

            createInterests(views, view);
            createUAInterests(views, view, isImplicit);

            if (isImplicit) {
                // Save updated views array to local storage for implicit only
                writeViewsArray(views);
            }
        },
        /**
         * Function that registers a page view on scroll
         *
         * @public
         * @method registerOnScroll
         * @param {object} scrollParent
         */
        registerOnScroll: function (scrollParent) {
            var self = this;

            if (!scrollParent) {
                scrollParent = window;
            }

            var $scrollParent = $(scrollParent);
            $scrollParent.on('scroll.' + MANAGER_NAME, $.throttle(500, function() {
                self.registerPageView();
                $scrollParent.off('scroll.' + MANAGER_NAME);
            }));
        },
        /**
         * Function that returns the latest view or null if unavailable.
         *
         * @public
         * @method getLatestView
         *
         * @return {object} - The last view in local storage (null if unavailable)
         */
        getLatestView: function () {
            if (testForLocalStorage()) {
                var views = JSON.parse(localStorage.getItem(LOCAL_STORAGE_VIEW_KEY));
                if (Array.isArray(views) && views.length > 0) {
                    return views[views.length - 1];
                }
            }

            return null;
        },
        /**
         * Function that actually adds tag to UA channel if tag isn't already added, and UA is registered
         *
         * @public
         * @method addUATag
         *
         * @param {object}  currentView
         * @param {string}  interestType
         * @param {boolean} isImplicit
         */
        addUATag: function(currentView, interestType, isImplicit) {
            window.UA.then(function(sdk) {
                currentView.interest_type = interestType;
                currentView.implicit = isImplicit;

                var unfollowedInterests = JSON.parse(localStorage.getItem(LOCAL_STORAGE_UNFOLLOW_KEY));
                if (unfollowedInterests) {
                    var idx = unfollowedInterests.indexOf(currentView.broad_interest);
                    if (idx > -1) {
                        if (isImplicit) {
                            return; // Do NOT add UA tag if implicit AND broad interest is marked as unfollowed
                        } else {
                            // Quick removal of interest in unfollowedInterests array
                            unfollowedInterests[idx] = unfollowedInterests[unfollowedInterests.length - 1];
                            unfollowedInterests.pop();

                            // Update unfollowed interests localStorage
                            try {
                                localStorage.setItem(LOCAL_STORAGE_UNFOLLOW_KEY, JSON.stringify(unfollowedInterests));
                            } catch (error) {
                                debug.error("Writing to localStorage failed for removal of unfollowed interest.");
                            }
                        }
                    }
                }

                if (sdk.channel) {
                    if (!sdk.channel.tags.has('Interest_' + currentView.broad_interest)) {
                        debug.log("Adding interests in UA API: " + currentView.broad_interest);
                        sdk.channel.tags.add('Interest_' + currentView.broad_interest);

                        var trackingData = pageVars.tracking.data;
                        tealium.trackCustomEvent(isImplicit ? 'background' : 'tap', {
                            pageViewGuid:      trackingData.pageViewGuid,      //v24
                            _dwAnonId:         trackingData._dwAnonId,         //v35
                            articleId:         trackingData.articleId,         // evar30
                            clickGenericText:  'add_interest|' + currentView.broad_interest,          // evar46
                            pageType:          trackingData.pageType,          // evar10
                            siteEdition:       trackingData.siteEdition,       // evar2
                            siteHier:          trackingData.siteHier,          // evar6
                            siteSection:       trackingData.siteSection        // channel
                        }, 'trackClick');
                    }

                    currentView.ua_channel_id = sdk.channel.id;
                }

                // add interest to backend DB
                $.post(FUNCTION_HOST, currentView, function(response) {
                    debug.log("Successfully created interest " + currentView.broad_interest + " in DB")
                });
            });
        },
        /**
         * Function that actually removes a tag from the UA channel
         *
         * @public
         * @method removeUATag
         *
         * @param {object} currentView
         */
        removeUATag: function(currentView) {
            window.UA.then(function(sdk) {
                currentView.interest_type = "unfollowed";
                currentView.implicit = false;

                var unfollowedInterests = JSON.parse(localStorage.getItem(LOCAL_STORAGE_UNFOLLOW_KEY));
                if (!unfollowedInterests) {
                    unfollowedInterests = [currentView.broad_interest];
                } else if (unfollowedInterests.includes(currentView.broad_interest)) {
                    return; // Do not need to do anything else when interest is already unfollowed
                } else {
                    unfollowedInterests.push(currentView.broad_interest);
                }

                var trackingData = pageVars.tracking.data;
                currentView.date_created = Date.now(),
                currentView.content_entity_id = trackingData.contentId,
                currentView.anon_id = getAnon();

                if (sdk.channel) {
                    if (sdk.channel.tags.has('Interest_' + currentView.broad_interest)) {
                        debug.log("Removing UA interest: " + currentView.broad_interest);
                        sdk.channel.tags.remove('Interest_' + currentView.broad_interest);

                        tealium.trackCustomEvent('tap', {
                            pageViewGuid:      trackingData.pageViewGuid,      //v24
                            _dwAnonId:         trackingData._dwAnonId,         //v35
                            articleId:         trackingData.articleId,         // evar30
                            clickGenericText:  'remove_interest|' + currentView.broad_interest, // evar46
                            pageType:          trackingData.pageType,          // evar10
                            siteEdition:       trackingData.siteEdition,       // evar2
                            siteHier:          trackingData.siteHier,          // evar6
                            siteSection:       trackingData.siteSection        // channel
                        }, 'trackClick');
                    }

                    currentView.ua_channel_id = sdk.channel.id;
                }


                // Add unfollowed interest to backend DB
                $.post(FUNCTION_HOST, currentView, function(response) {
                    debug.log("Successfully added unfollow interest " + currentView.broad_interest + " to DB")
                });

                // Add unfollowed interest to localStorage
                try {
                    localStorage.setItem(LOCAL_STORAGE_UNFOLLOW_KEY, JSON.stringify(unfollowedInterests));
                } catch (error) {
                    debug.error("Writing to localStorage failed for unfollowed interest.");
                }
            });
        }
    };

    /**
     * Function that tests for localStorage API support
     *
     * @private
     * @method testForLocalStorage
     *
     * @return {boolean}
     */
    function testForLocalStorage() {
        try {
            localStorage.setItem("test", "test");
            localStorage.removeItem("test");
            return true;
        } catch (error) {
            return false;
        }
    };

    /**
     * Function that removes view events from our views array if:
     * 1. Max count of views has been exceeded, or
     * 2. The view is older than the max TTL
     *
     * @private
     * @method pruneViews
     *
     * @param {array} views - The list of views to prune
     *
     * @return {array} - The new list
     */
    function pruneViews(views) {
        // prune views if length has exceeded max length
        while (views.length >= MAX_VIEW_LENGTH) {
            views.shift();
        }

        // prune views to get rid of views that are older than 30 days
        if (views.length > 0) {
            var viewItem = views[0];
            var now = Date.now();
            while (viewItem.date_created + MAX_AGE < now) {
                views.shift();
                if (views.length > 0) {
                    viewItem = views[0];
                } else {
                    break;
                }
            }
        }

        var dedupedViews = [];
        //backwards loop in order to keep the most recent view
        for (var i = views.length - 1; i >= 0; i--) {
            //check if new deduped array already contains an entry for that piece of content
            var alreadyContained = dedupedViews.some(function(view) {
                return (view.content_entity_id === views[i].content_entity_id && view.content_type === views[i].content_type);
            });

            if (!alreadyContained) {
                dedupedViews.push(views[i]);
            }
        }

        // reverse, so that it's still sorted in ascending order
        return dedupedViews.reverse();
    }

    /**
     * Function that creates a view event from tracking data
     *
     * @private
     * @method createNewViewEvent
     *
     * @return {object} - The new view event
     */
    function createNewViewEvent() {
        // short hand variable
        var trackingDataParent = pageVars.tracking.data;

        var broadInterest = trackingDataParent.broadInterest;
        if (broadInterest && broadInterest === "none") {
            broadInterest = undefined;
        } else if (broadInterest) {
            broadInterest = broadInterest.toUpperCase();
        }

        var view = {
            content_entity_id: trackingDataParent.contentId,
            content_type: 'content_' + trackingDataParent.contentType,
            site: trackingDataParent.brand,
            dev: trackingDataParent.isDev,
            view_guid: trackingDataParent.pageViewGuid,
            page_type: trackingDataParent.pageType,
            user_id: trackingDataParent.userId,
            anon_id: getAnon(),
            deviceType: trackingDataParent.deviceType,
            date_created: Date.now(),
            annotations: trackingDataParent.annotations || [],
            broad_interest: broadInterest,
            edition: trackingDataParent.siteEdition
        };

        return view;
    }

    /**
     * Get the anon if it exists, otherwise generates one and return.
     *
     * @private
     * @method getAnon
     *
     * @return {string} - The anon
     */
    function getAnon() {
        var anon = localStorage.getItem(LOCAL_STORAGE_ANON_KEY);

        if (!anon) {
            anon = window.uuid.v4();
        }

        try {
            localStorage.setItem(LOCAL_STORAGE_ANON_KEY, anon);
        } catch (error) {
            debug.error("Writing to localStorage for anon failed.");

            anon = "00000000-0000-0000-0000-000000000000";
        }

        return anon;
    }

    /**
     * Function that aggregates the number of annotations from different pieces of content the user has viewed
     *
     * @private
     * @method aggregateAnnotations
     *
     * @param {array} views - The list of views to aggregate from
     *
     * @return {object} - The list of all aggregation values and their counts
     */
    function aggregateAnnotations(views) {
        let counts = {};
        views.forEach(function(view) {
            view.annotations.forEach(function(annotation) {
                if (counts[annotation]) {
                    counts[annotation]++;
                } else {
                    counts[annotation] = 1;
                }
            });
        });

        return counts;
    };

    /**
     * Function that calls the recommendation API to create an interest if the threshold is met and current page has that interest
     *
     * @private
     * @method createInterests
     *
     * @param {array} views - The list of views for a user
     * @param {object} currentView - The current view event
     */
    function createInterests(views, currentView) {
        var annotationCounts = aggregateAnnotations(views);

        var qualifyingAnnotations = Object.keys(annotationCounts).filter(function(annotation) {
            return annotationCounts[annotation] >= MIN_THRESHOLD_FOR_INTEREST && currentView.annotations.indexOf(annotation) !== -1;
        });

        if (qualifyingAnnotations.length > 0) {
            globalFunctions.gdprConsentCallback("recommendationInterestAdd", function() {
                debug.log("Adding interests in recommendation API: " + qualifyingAnnotations);
            });
        }
    }

    /**
     * Function that aggregates broad interest data for urban airship tags
     *
     * @private
     * @method aggregateUAInterests
     *
     * @param {array} views - The list of views for a user
     */
    function aggregateUAInterests(views) {
        let counts = {};
        views.forEach(function(view) {
            if (!view.broad_interest) {
                return;
            }

            if (counts[view.broad_interest]) {
                counts[view.broad_interest]++;
            } else {
                counts[view.broad_interest] = 1;
            }
        });

        return counts;
    }

    /**
     * Function that determines if UA API needs to be called, and then calls UA once we know UA is loaded.
     *
     * @private
     * @method createUAInterests
     *
     * @param {array} views - The list of views for a user
     * @param {object} currentView - The current view event
     * @param {boolean} isImplicit - Flag indicating if view is implicit
     */
    function createUAInterests(views, currentView, isImplicit) {
        var broadInterestCounts = aggregateUAInterests(views);

        if (broadInterestCounts[currentView.broad_interest] >= 2 || !isImplicit) {
            globalFunctions.gdprConsentCallback("UAInterestAdd", function() {
                //add UA tag
                if (window.UA) {
                    recommendations.addUATag(currentView, 'broad', isImplicit);
                } else {
                    $(window).on('urban-airship-loaded', function() {
                        recommendations.addUATag(currentView, 'broad', isImplicit);
                    });
                }
            });
        }
    }

    /**
     * Function that writes the views to localStorage, and returns whether or not the write was successful
     *
     * @private
     * @method writeViewsArray
     *
     * @param {array} views- The list of views for a user
     * @returns {boolean}
     */
    function writeViewsArray(views) {
        // save updated views array
        var writeSuccess = false;
        try {
            localStorage.setItem(LOCAL_STORAGE_VIEW_KEY, JSON.stringify(views));
            writeSuccess = true;
        } catch (error) {
            debug.error("Writing to localStorage failed, attempting to prune view data...");
            // if writing to localStorage fails, probably due to space restrictions. Try removing bottom 10% of entries, and try again
            for(var i = 0; i < views.length / 10; i++) {
                views.shift();
            }
            try {
                localStorage.setItem(LOCAL_STORAGE_VIEW_KEY, JSON.stringify(views));
                writeSuccess = true;
            } catch (error2) {
                debug.error("Writing to localStorage failed, even after pruning 10% of view data.");
                writeSuccess = false;
            }
        }

        return writeSuccess;
    }

    return recommendations;
});
define('fly/components/fixate-1.0',[
    'jquery',
    'version!fly/components/base'
], function($) {
    /**
     * Fix an element on scroll.
     *
     * @extends fly.base
     *
     * Example Usage:
     *
     *      $('#my-widget').fixate();
     *
     *      <div id="my-widget" data-fixate-options="'{}'"></div>
     *
     */
    $.widget( 'fly.fixate', $.fly.base, {

        /**
         * Optional data configuration
         * @define {object}
         */
        options: {
            classFixed: 'fixed',
            classUnfixed: 'unfixed',

            primaryEdge: 'top', // 'top' or 'bottom'

            offset: {
                top: 20,
                bottom: 20
            },

            // If true, stops the fixed element when it reaches the top or bottom of the left or right guides, respectively.
            stickToLeft: false,
            stickToRight: false,

            // Guides can be a selector string or an element.
            guideTop: null,
            guideBottom: null,
            guideLeft: null,
            guideRight: null
        },

        // Vars
        hasEvents: false, // {Bool} Events have been added
        isFixed: false,
        boundary: { // Negative indicates no boundary specified.
            top: -1,
            bottom: -1,
            left: -1,
            right: -1
        },

        // DOM Vars {JQuery Object}
        $element: null,
        $window: $(window),
        $document: $(document),

        /**
         * Initialize the fixate.
         * @constructor
         */
        _create: function() {
            // call base
            this._super('_create');

            // Set guides and boundaries.
            this._setBoundaries();

            // add events
            this._addEvents();

            this.checkPosition();
        },

        /**
         * Attach all events
         * @private
         */
        _addEvents: function() {
            var o = this.options;

            if ( this.hasEvents || this.disabled ) {
                return;
            }

            this.hasEvents = true;

            this.$window.on('scroll.fixate', $.proxy(this.checkPosition, this));
            this.$window.on('resize.fixate', $.proxy(this.checkPosition, this));
        },

        /**
         * Unbind all previously attached events
         * @private
         */
        _removeEvents: function() {
            this.hasEvents = false;
        },

        /**
         * Set the boundaries of the fixated element.
         * @private
         */
        _setBoundaries: function() {
            var o = this.options,
                offset = null,
                $guideTop = null,
                $guideBottom = null,
                $guideLeft = null,
                $guideRight = null;

            // Reset the boundaries.
            this.boundary = {
                top: -1,
                bottom: -1,
                left: -1,
                right: -1
            };

            // Find the actual boundaries.
            if(o.guideTop) {
                $guideTop = $(o.guideTop);
                offset = $guideTop.offset();

                // Stop the fixed element from moving when it reaches the top guide.
                this.boundary.top = offset.top + $guideTop.outerHeight();
            }
            if(o.guideBottom) {
                $guideBottom = $(o.guideBottom);
                offset = $guideBottom.offset();

                // Stop the fixed element from moving when it reaches the bottom guide.
                this.boundary.bottom = offset.top;
            }
            if(o.guideLeft) {
                $guideLeft = $(o.guideLeft);
                offset = $guideLeft.offset();

                // Stop the fixed element from moving when it reaches the top or bottom of the left guide.
                if(o.stickToLeft) {
                    if(this.boundary.top < 0 || offset.top > this.boundary.top) {
                        this.boundary.top = offset.top;
                    }

                    if(this.boundary.bottom < 0 || offset.top + $guideLeft.outerHeight() < this.boundary.bottom) {
                        this.boundary.bottom = offset.top + $guideLeft.outerHeight();
                    }
                }
            }
            if(o.guideRight) {
                $guideRight = $(o.guideRight);
                offset = $guideRight.offset();

                // Stop the fixed element from moving when it reaches the top or bottom of the right guide.
                if(o.stickToRight) {
                    if(this.boundary.top < 0 || offset.top > this.boundary.top) {
                        this.boundary.top = offset.top;
                    }

                    if(this.boundary.bottom < 0 || offset.top + $guideRight.outerHeight() < this.boundary.bottom) {
                        this.boundary.bottom = offset.top + $guideRight.outerHeight();
                    }
                }
            }
        },

        /**
         * Fix the element to the window.
         *
         * @private
         */
        _fix: function() {
            var o = this.options;

            this.isFixed = true;

            this.$element.addClass(o.classFixed).removeClass(o.classUnfixed);

            if(o.primaryEdge === 'top') {
                this.$element.css('top', o.offset.top);
            } else {
                this.$element.css('top', this.$window.height() - o.offset.bottom - this.$element.height());
            }

            this._placeHorizontally();
        },

        /**
         * Unfix the element from the window.
         *
         * @param edge - (string) Either "top" or "bottom"; indicates which boundary the element should be attached to when unfixed.
         * @private
         */
        _unfix: function(edge) {
            var o = this.options;

            this.isFixed = false;

            this.$element.addClass(o.classUnfixed).removeClass(o.classFixed);

            if(edge === 'top') {
                this.$element.css('top', this.boundary.top + o.offset.top - this.$window.scrollTop());
            } else {
                this.$element.css('top', this.boundary.bottom - o.offset.bottom - this.$element.height() - this.$window.scrollTop());
            }

            this._placeHorizontally();
        },

        /**
         * Position the fixated element horizontally on the page.
         *
         * @private
         */
        _placeHorizontally: function() {
            var o = this.options,
                scrollLeft = this.$window.scrollLeft(),
                $guideLeft = null,
                $guideRight = null;

            if(o.guideLeft) {
                $guideLeft = $(o.guideLeft);
                // Position the fixed element to the right of the left guide.
                this.$element.css('left', $guideLeft.offset().left + $guideLeft.outerWidth() - scrollLeft);
            } else if(o.guideRight) {
                $guideRight = $(o.guideRight);
                // Position the fixed element to the left of the right guide.
                this.$element.css('left', $guideRight.offset().left - this.$element.width() - scrollLeft);
            }
        },

        /**
         * Compare the position of the fixated element with its boundaries and fix or unfix accordingly.
         */
        checkPosition: function() {
            var o = this.options,
                scrollTop = this.$window.scrollTop(),
                scrollBottom = scrollTop + this.$window.height(),
                elementHeight = this.$element.height();

            // Update the boundaries.
            this._setBoundaries();

            // Determine whether to fix or unfix the element.
            if(o.primaryEdge === 'top') {
                if(scrollTop < this.boundary.top) {
                    this._unfix('top');
                } else if(this.boundary.bottom >= 0 && (scrollTop + o.offset.top + elementHeight + o.offset.bottom > this.boundary.bottom)) {
                    this._unfix('bottom');
                } else {
                    this._fix();
                }
            } else {
                if(scrollBottom > this.boundary.bottom) {
                    this._unfix('bottom');
                } else if(scrollBottom - o.offset.bottom - elementHeight - o.offset.top < this.boundary.top) {
                    this._unfix('top');
                } else {
                    this._fix();
                }
            }
        },

        /**
         * Unbind all events and uninstantiate
         */
        destroy: function() {
            this._removeEvents();

            this._super('destroy');
        }
    });
});



define('components/fixate',["jquery","version!fly/managers/debug","version!fly/components/fixate"],function(t,s){s=s.init("fixate"),t.widget("fly.fixate",t.fly.fixate,{options:{classFixedParent:"fixed-parent",guideContainer:null,guideTopPlus:null,innerGuideLeft:null,classTop:"top",classBottom:"bottom",offset:{topPlus:0,omnibar:50},minHeight:null},_create:function(){this._super();var s=this.options,e=null;if(s.guideBottom&&s.minHeight){e=t(s.guideBottom).offset();var o=this.$element.offset();e.top-o.top<s.minHeight&&this.$element.addClass("cancelfix")}},_setBoundaries:function(){this._super();var s=this.options,e=null;this.options.guideContainer&&(this.options.guideContainer=t(this.options.guideContainer),e=this.options.guideContainer.offset(),(this.boundary.top<0||e.top>this.boundary.top)&&(this.boundary.top=e.top),(this.boundary.bottom<0||e.top+this.options.guideContainer.outerHeight()<this.boundary.bottom)&&(this.boundary.bottom=e.top+this.options.guideContainer.outerHeight())),s.guideTopPlus&&(s.guideTopPlus=t(s.guideTopPlus),e=s.guideTopPlus.offset(),this.boundary.top=e.top+s.guideTopPlus.outerHeight()-s.offset.topPlus)},_fix:function(){var s=this.options;this.isFixed=!0,this.$element.addClass(s.classFixed).removeClass(s.classUnfixed).removeClass(s.classBottom).removeClass(s.classTop),"top"===s.primaryEdge?t("body").hasClass("omnibar")?this.$element.css("top",s.offset.top+s.offset.omnibar):this.$element.css("top",s.offset.top):this.$element.css("top",this.$window.height()-s.offset.bottom-this.$element.height()),this._placeHorizontally(),this.$element.parent().addClass(this.options.classFixedParent)},_unfix:function(t){var s=this.options;this.isFixed=!1,this.$element.addClass(s.classUnfixed).removeClass(s.classFixed),"top"===t?(this.$element.css("top",this.boundary.top-this.$window.scrollTop()),this.$element.addClass(s.classTop).removeClass(s.classBottom)):(this.$element.css("top",this.boundary.bottom-this.$element.height()-this.$window.scrollTop()),this.$element.addClass(s.classBottom).removeClass(s.classTop)),this._placeHorizontally(),this.$element.parent().removeClass(this.options.classFixedParent)},_placeHorizontally:function(){var s=this.options,e=null,o=this.$window.scrollLeft();s.innerGuideLeft&&(e=t(s.innerGuideLeft),this.$element.css("left",e.offset().left-o))}})});
define('components/iframe-hover-fix',["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,i){i=i.init("iframeHoverFix"),e.widget("cnet.iframeHoverFix",e.fly.base,{options:{},_create:function(){var i=this;this._setup(),e.browser.msie&&(this.$element.live("mouseenter",function(){i.$element.addClass("hover")}),this.$element.find("iframe").live("hover",function(){i.$element.addClass("hover")}),this.$element.live("mouseleave",function(){i.$element.removeClass("hover")}))}})});
/*
 * History Manager
 *
 * I consider this a temporary solution of history management
 * Ideally would like to just use Backbone to handle this once
 *  it has been integrated into the stack
 *
 */

define('fly/managers/history-2.0',[
    'jquery',
    'version!fly/utils/string-vars'
], function ($, strVars) {

    'use strict';

    /**
     * Usage:
     *
     *  Initalize an instance:
     *  ----------------------
     *      historyMgr.init(options, initState);
     *
     *      examples:
     *      ---------
     *      var historyInst = historyMgr.init(
     *          {
     *              route: '/articles/{foo}/{page}',
     *              title: 'Article {foo} - Page {page}'
     *          },
     *          {
     *              page: 1,
     *              foo: 'bar'
     *          }
     *      );
     *
     *      options:
     *          - route: url template - state data is used to compile vars
     *          - title: title template - state data as well as original page title
     *              passed as {title} are used to compile vars
     *
     *          Note: route and title can be either a string or a function that
     *              returns a string. The function is passed the state data on navigate
     *
     *
     *      initState: data that will be store w/ the initial page using replaceStat.
     *          The data can then be used w 'stateChange' to perform some logic
     *
     *
     *  Update url and title via pushState/replaceState
     *  -----------------------
     *      historyInst.navigate(state, options);
     *
     *      Ex: only passing state data to compile agaist route and title
     *      ----
     *      historyInst.navigate({
     *          page: 2,
     *          foo: 'baz'
     *      });
     *      results in:
     *           - url change to '/articles/baz/2',
     *           - title change to 'Article baz - Page 2'
     *
     *      Ex: passing url and title directly
     *      ----
     *      historyInst.navigate({foo: bar}, {
     *          url: '/my/custom/url,
     *          title: 'My custom title'
     *      });
     *
     *      Note: If you want to use replaceState instead of pushState pass
     *          replace: true w/ the options
     *
     *
     *  Respond to state change via popState
     *  ---------------------------
     *      historyInst.stateChange(callback);
     *          - callback is passed the stored state data
     *
     *      Ex:
     *      ----
     *      historyInst.stateChange(function(state) {
     *          if (state.page === 1) {
     *              // setup page 1
     *          }
     *
     *          if (state.foo === 'baz') {
     *              // do something
     *          }
     *      });
     *
     */

    var history = window.history,
        $window = $(window),
        methods,
        instCount = 0,
        stateChangeCallback,
        // taken from jquery mobile
        hasPushState = 'pushState' in history &&
            'replaceState' in history &&
            !( window.navigator.userAgent.indexOf('Firefox') >= 0 && window.top !== window );

    /*
     * Initialize History
     *
     * @constructor
     * @param {object} [options] - Options for instance
     * @param {mixed} [options.title] Title template
     * @param {mixed} [options.route] Url Template
     * @param {object} [initState] - Data to be stored w/ original page
     */
    var History = function(options, initState) {
        options = options || {};

        // give instance a unique id
        instCount = instCount + 1;
        this.id = 'history-'+ instCount;

        this.title = options.title;
        this.route = options.route;
        this.originalTitle = document.title;

        if (initState) {
            this.navigate(initState, {replace: true});
        }
    };

    History.prototype = {
        constructor: History,

        navigate: function(stateData, options) {
            if (!hasPushState) return false;

            $.extend(true, stateData, {historyId: this.id});
            options = options || {};

            var title = options.title || this.title,
                url = options.url || this.route;

            title =  strVars.compile(($.isFunction(title) ? title(stateData) : title), $.extend({title: this.originalTitle}, stateData));
            url = strVars.compile(($.isFunction(url) ? url(stateData) : url), stateData);

            history[options.replace ? 'replaceState' : 'pushState'](stateData, title, url);

            // manually set title
            if (title) {
                document.title = title;
            }
        },

        stateChange: function(callback) {
            if (!hasPushState) return false;

            var self = this;

            $window.on('popstate.'+ this.id, function() {
                var state = history.state || {};

                if (state.historyId === self.id && $.isFunction(callback)) {
                    callback(state);
                }
            });
        },

        stop: function() {
            if (!hasPushState) return false;

            $window.off('popstate.'+ this.id);
        }
    };

    return {
        /*
         * Create an instance of History
         *
         * @param {object} options
         * @param {object} initState
         */
        init: function(options, initState) {
            return new History(options, initState);
        }
    };

});



/*!
Waypoints Inview Shortcut - 3.1.1
Copyright © 2011-2015 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/waypoints/blog/master/licenses.txt
*/

define('libs/waypoints/inview-3.1.1',["version!libs/waypoints/jquery.waypoints"],function(){"use strict";function t(){}function e(t){this.options=i.Adapter.extend({},e.defaults,t),this.axis=this.options.horizontal?"horizontal":"vertical",this.waypoints=[],this.createWaypoints()}var i=window.Waypoint;e.prototype.createWaypoints=function(){for(var t={vertical:[{down:"enter",up:"exited",offset:"100%"},{down:"entered",up:"exit",offset:"bottom-in-view"},{down:"exit",up:"entered",offset:-1},{down:"exited",up:"enter",offset:function(){return-this.adapter.outerHeight()}}],horizontal:[{right:"enter",left:"exited",offset:"100%"},{right:"entered",left:"exit",offset:"right-in-view"},{right:"exit",left:"entered",offset:0},{right:"exited",left:"enter",offset:function(){return-this.adapter.outerWidth()}}]},e=0,i=t[this.axis].length;e<i;e++){var n=t[this.axis][e];this.createWaypoint(n)}},e.prototype.createWaypoint=function(t){var e=this;this.waypoints.push(new i({element:this.options.element,handler:function(t){return function(i){e.options[t[i]].call(this,i)}}(t),offset:t.offset,horizontal:this.options.horizontal}))},e.prototype.destroy=function(){for(var t=0,e=this.waypoints.length;t<e;t++)this.waypoints[t].destroy();this.waypoints=[]},e.defaults={enter:t,entered:t,exit:t,exited:t},i.Inview=e});

define('components/magnet',["jquery","version!fly/managers/debug","version!fly/managers/components","managers/page-vars","managers/tracking","managers/tealium","managers/guid","managers/ad","version!fly/managers/history","managers/waypoints","version!fly/utils/url-helper","managers/client-storage","version!fly/components/base","components/loading","version!libs/waypoints/inview"],function(t,e,s,a,i,n,o,r,d,c,h,l){var p=e.init("magnet");c.init(),t.widget("cnet.magnet",t.fly.base,{options:{adRefreshTimeout:0,topItemOffset:79,tocWrapper$$:".tocNav"},isAdCallsPaused:!1,history:null,webWorker:null,waiter:null,assetIds:[],assetData:{},assetMeta:{},$tocWrapper:null,playFeaturedVideo:!0,autoPlayVideo:!0,_create:function(){p.log("Initializing"),this._setup(),this.$tocWrapper=t(this.options.tocWrapper$$).first(),this.waiter=t.cnet.loading();var e="",s=(window.location.search?"&":"?")+"articleIndex=",i=this.$element.children().first().find(".howto").length>0?0:1;t("[data-toc-asset-options]",this.$tocWrapper).each(function(a,n){e=t(n).data("toc-asset-options"),0===this._getContainer(e.id).length&&this.$element.append('<div class="pageContainer" data-container-asset-id="'+e.id+'" data-teads-num="'+(a+1)+'"></div>'),this.assetIds[a]=e.id,this.assetData[e.id]={},this.assetMeta[e.id]={waypoints:[],ajaxUrl:e.ajaxUrl+window.location.search+s+(a+i)}}.bind(this)),t.extend(!0,this.assetData[this.assetIds[0]],{adData:a.ads.data,trackingData:a.tracking.data,path:window.location.pathname,url:window.location.href,title:window.document.title}),t.extend(!0,this.assetMeta[this.assetIds[0]],{isInMemory:!1,isInDom:!0,isActivated:!0,isInFocus:!0}),window.Worker,this.history=d.init(),this._setupWaypoints(this.assetIds[0]),this._setupEvents(),this._autoplayVideo(this.assetIds[0])},_setupEvents:function(){this.history.stateChange(function(t){p.log("PushState state changed; requested asset ",t.index),void 0!=t.index?this.jumpToAsset(t.index):p.log("PushState state asset unavailable!")}.bind(this)),this.$tocWrapper.on("tocNavRequest",function(t,e){this.autoPlayVideo=!0,this.jumpToAsset(e.assetId)}.bind(this)),this.webWorker&&this.webWorker.addEventListener("message",function(e){"fetchAsset"===e.cmd&&("success"===e.status?(t.extend(!0,this.assetData[e.data.id],e.data),this._injectAsset(e.data.id,e.data)):(p.log("WebWorker request failed",e.error),this.waiter.remove(),this.waiter.$element.remove()))}.bind(this),!1)},_fetchAsset:function(e,s){this.assetMeta[e].isInDom?(p.log("Asset #"+t.inArray(e,this.assetIds)+" already on the page."),"function"==typeof s&&s(e)):this.assetMeta[e].isInMemory?(p.log("Asset #"+t.inArray(e,this.assetIds)+" already in memory."),this._injectAsset(e,this.assetData[e]),"function"==typeof s&&s(e)):this.webWorker?(p.log("Fetching asset #"+t.inArray(e,this.assetIds)+" via Web Worker."),this.webWorker.postMessage({cmd:"fetchAsset",data:url})):(p.log("Fetching asset #"+t.inArray(e,this.assetIds)+" via AJAX."),t.ajax({dataType:"json",url:this.assetMeta[e].ajaxUrl}).done(function(a){"string"==typeof a&&(a=JSON.parse(t.trim(a))),"object"==typeof a&&a.template?(t.extend(!0,this.assetData[e],a),t.extend(!0,this.assetMeta[e],{isInMemory:!0}),this._injectAsset(e,a),"function"==typeof s&&s(e)):(p.log("AJAX response could not be processed."),this.waiter.remove(),this.waiter.$element.remove())}.bind(this)).fail(function(t,e,s){p.log("AJAX request failed:",s),this.waiter.remove(),this.waiter.$element.remove()}.bind(this)))},_injectAsset:function(e,a){p.log("Injecting asset #"+t.inArray(e,this.assetIds));var i=this._getContainer(e),n=t.inArray(e,this.assetIds)+1,o=t.inArray(e,this.assetIds);0===o||o>0&&!this.assetMeta[this.assetIds[o-1]].isInDom?(this._pauseWaypoints(!0),i.html(a.template),this._pauseWaypoints(!1),this.assetMeta[e].isInDom=!0,s.process(i),this._pauseWaypoints(!0),this.$window.scrollTop(this.$window.scrollTop()+i.outerHeight(!0)),this._pauseWaypoints(!1)):(i.html(a.template),this.assetMeta[e].isInDom=!0,s.process(i)),t(i).find("#rbSkin").attr("data-article-num",n),this._setupWaypoints(e)},jumpToAsset:function(e,s){s=s||"scrollTo";var a=this._getContainer(e);this.assetMeta[e].isInDom?(p.log("Jumping to asset #"+t.inArray(e,this.assetIds+" already in the DOM.")),this.$window.scrollTop(a.offset().top-this.options.topItemOffset),this._trackCustomEvent("trackMagnetJumpNewPage",s+"."+t.inArray(e,this.assetIds))):(p.log("Fetching, injecting, and jumping to asset #"+t.inArray(e,this.assetIds)),this.waiter.$element.appendTo(this.$element),this.waiter.add(),this._fetchAsset(e,function(){this._pauseWaypoints(!0),this.$window.scrollTop(a.offset().top-this.options.topItemOffset),this._pauseWaypoints(!1),this._trackCustomEvent("trackMagnetJumpNewPage",s+"."+t.inArray(e,this.assetIds)),this._showAsset(e);var i=t.inArray(e,this.assetIds);i>0&&this._fetchAsset(this.assetIds[i-1]),i<this.assetIds.length-1&&this._fetchAsset(this.assetIds[i+1])}.bind(this)))},_showAsset:function(e){if(this.assetMeta[e].isInFocus)p.log("Asset #"+t.inArray(e,this.assetIds)+" already in focus.");else{p.log("Showing & activating asset #"+t.inArray(e,this.assetIds));var s=this.assetData[e];t("body").attr("data-cms-edit",'{"url":"http:\\/\\/cms-beta.cnet.com\\/content\\/article\\/'+e+'"}'),t('head link[rel="canonical"]').attr("href",s.url),this.history.navigate({index:e},{title:s.title,url:s.path.split("?")[0]+this._getParamUrl()}),a.ads.data=s.adData,i.resetTrackingData(s.trackingData),o.resetViewGuid(),this._loadAds(e,this.assetMeta[e].isActivated),this._trackPageLoad(),this.$tocWrapper.trigger("tocNavSelection",{index:t.inArray(e,this.assetIds)}),this.assetMeta[e].isActivated=!0,t.each(this.assetMeta,function(t,e){e.isInFocus=!1}),this.assetMeta[e].isInFocus=!0,this.waiter.remove(),this.waiter.$element.remove(),this._autoplayVideo(e),this._performMaintenance(e)}},_autoplayVideo:function(t){p.log("Autoplay video",l.read("autoplayEnabled"),this.autoPlayVideo);var e=this.autoPlayVideo;if(this.autoPlayVideo=!1,"off"!=l.read("autoplayEnabled")&&0!=e){var s;s=this.playFeaturedVideo?'.videoPlayer[data-component="cnetVideo"]':'.video.shortcode .videoPlayer[data-component="cnetVideo"]',this.playFeaturedVideo=!1;var a=this._getContainer(t),i=a.find(s+" .videoPromo").first(),n=a.find(s).first();if(p.log("Autoplay video",n,i),n.length>0)try{p.log("Check popout"),this._isInViewport(n)?p.log("no popout"):(n.parent().addClass("popOut"),p.log("do popout",n)),n.cnetVideo("inited")&&(i.trigger("click"),p.log("Click triggered",i))}catch(t){p.log("Video not ready",t),n.on("onVideoPlayerReady",function(t){p.log("Video ready. Trigger click",t),i.trigger("click")})}else p.log("No video to autoplay");p.log("/Autoplay")}},_performMaintenance:function(e){p.log("Cleaning up containers based on current asset #"+t.inArray(e,this.assetIds));var s=this._getContainer(e),a=[s.prev("[data-container-asset-id]").data("container-asset-id"),e,s.next("[data-container-asset-id]").data("container-asset-id")];t.each(this.assetIds,function(e,s){-1===t.inArray(s,a)&&this.assetMeta[s].isInDom&&this._purgeAsset(s)}.bind(this))},_purgeAsset:function(e){p.log("Emptying container for asset #"+t.inArray(e,this.assetIds));var s=this._getContainer(e);t.each(this.assetMeta[e].waypoints,function(t,e){e.destroy()});var a=s.find('[data-component="cnetVideo"]');t.each(a,function(e,s){t(s).cnetVideo("destroy")}),this.assetData[e]={},t.extend(!0,this.assetMeta[e],{isInMemory:!1,isInDom:!1,isActivated:!1,isInFocus:!1});var i=t.inArray(e,this.assetIds);if(0===i||i>0&&!this.assetMeta[this.assetIds[i-1]].isInDom){var n=this.$window.scrollTop()-s.outerHeight(!0);this._pauseWaypoints(!0),s.empty(),this.$window.scrollTop(n),this._pauseWaypoints(!1)}else s.empty()},_loadAds:function(e,s){var a=s?"refresh":"load";try{if(p.log("Ad "+a+" requested for asset #"+t.inArray(e,this.assetIds)),this.isAdCallsPaused)p.log("Ad "+a+" aborted for asset #"+t.inArray(e,this.assetIds));else{var i=this.assetData[e];if(s)r.refreshImproved({adData:i.adData,containerId:i.adData.gpt.containerId});else{r.loadImproved({adData:i.adData});var n=t("#taboola-"+i.slug+"-article-below-article-thumbnails");n.taboola(n.data("taboola"))}this.isAdCallsPaused=!0,window.setTimeout(function(){this.isAdCallsPaused=!1}.bind(this),this.options.adRefreshTimeout)}}catch(s){p.log("Ad "+a+" failed for asset #"+t.inArray(e,this.assetIds),s)}},_trackCustomEvent:function(t,e){p.log("Track custom event: "+t);var s=a.tracking.data;n.trackCustomEvent(t,{articleTitle:s.articleTitle,_articleId:s.articleId,_authorPrimaryName:s._authorPrimaryName,_articleType:s.articleType,_pageType:s.pageType,_test:s._test,siteEdition:s._siteEdition,brand:s.brand,siteSection:s._siteSection,_siteTypeDevice:s._siteTypeDevice,_siteHier:s._siteHier,_pageViewGuid:s._pageViewGuid,browserTitle:document.title,topicId:s.topicId,collectionId:s.collectionId?s.collectionId:"",articleAuthorName:s.articleAuthorName,articleAuthorGuid:s.articleAuthorId,clickGenericText:e},"trackClick")},_trackPageLoad:function(){p.log("Track page load event"),n.trackPageLoad(t.extend(!0,{},trackingData,{viewguid:a.pageViewGuid,title:trackingData.articleTitle,_pageViewGuid:a.pageViewGuid,_topicPrimaryId:trackingData.topicId[0],_pageUrl:window.location.href}))},_setupWaypoints:function(e){p.log("Waypoints attached for asset #"+t.inArray(e,this.assetIds));var s=this._getContainer(e),a=this,i=t("article",s).first();this.$document.context.activeElement.className.contains("buyingGuide")||(this.assetMeta[e].waypoints.push(new Waypoint.Inview({element:i,exit:function(i){p.log("Waypoint (injection) reached for asset #"+t.inArray(e,a.assetIds));var n="down"===i?s.next("[data-container-asset-id]"):s.prev("[data-container-asset-id]");n.length>0&&!t.trim(n.html())&&a._isInViewport(t(this.element).parents("[data-container-asset-id]")[0])&&a._fetchAsset(n.data("container-asset-id"))}})),this.assetMeta[e].waypoints.push(new Waypoint.Inview({element:i,enter:function(s){p.log("Waypoint (activation) reached for asset #"+t.inArray(e,a.assetIds)),!a.assetMeta[e].isInFocus&&a._isInViewport(this.element)&&(a._trackCustomEvent("trackMagnetScrollNewPage",s+"."+t.inArray(e,a.assetIds)),a._showAsset(e))}})),this.assetMeta[e].waypoints.push(new Waypoint.Inview({element:i,entered:function(t){"down"===t&&a._trackCustomEvent("percentageScrollTracking","scroll100")}})))},_pauseWaypoints:function(e){t.each(this.assetMeta,function(s,a){t.each(a.waypoints,function(s,a){t.each(a.waypoints,function(t,s){e?s.disable():s.enable()})})}),p.log(e?"Waypoints disabled":"Waypoints enabled")},_isInViewport:function(e){e=t(e);var s=this.$window.scrollTop(),a=s+this.$window.height(),i=e.offset().top,n=i+e.outerHeight();return i<a&&n>s},_getContainer:function(e){return e?t("[data-container-asset-id="+e+"]",this.$element):t("[data-container-asset-id]",this.$element)},_getParamUrl:function(){var e=["ab","adNetwork","debug","twigComments","adRegion","adCountry","adSession","adSubSession","jsDebug","setDevice"],s=h.getAllParams(),a="?";return t.each(s,function(s,i){""==s||-1==t.inArray(s,e)&&-1==s.search("adTargeting_")||(a+=s+"="+i+"&")}),a=a.substring(0,a.length-1)}})});
define('components/toc-nav',["jquery","version!fly/managers/debug","managers/page-vars","managers/tealium","managers/waypoints","version!libs/jquery/mobile","version!libs/waypoints/inview"],function(e,t,i,o,n){var a=t.init("tocNav");n.init(),e.widget("cnet.tocNav",e.fly.base,{options:{applyClassOnHover:!0,closeOnSelect:!0,isIntegratedWithHeader:!0,isExpandableOnHover:!0,isExpandableOnSwipe:!1,isExpandableOnClick:!0,isVisibleOnLoad:!1,stopTouchPropagation:!1,adjustHeight:!1},$header:null,$body:null,_create:function(){a.log("Initializing"),this._setup(),this.$body=e("body"),this.$header=e("#rbHeader .fixation, #cesHeaderWrap.fixation, .headerContainer, #specialHeader .fixation"),this._setupEvents(),this.options.isVisibleOnLoad||this.options.isIntegratedWithHeader&&(e("img[data-original]").each(function(t,i){i.src=e(i).data("original")}),this.$header.hasClass("fixed"))},_setupEvents:function(){var t=this;this.options.isIntegratedWithHeader&&(this.$header.on("stickyElementStuck",function(){}),this.$header.on("stickyElementUnstuck",function(){t.$body.removeClass("tocNavOpen"),t.$body.removeClass("tocNavVisible")})),this.options.isExpandableOnHover&&this.$element.hover(function(){t._trackCustomEvent("expandToc","expandToc"),t.$header.hasClass("fixed")||!t.options.isIntegratedWithHeader?(t.options.applyClassOnHover&&t.$body.addClass("tocNavOpen"),t._trigger("open")):(t.options.applyClassOnHover&&t.$body.removeClass("tocNavOpen"),t._trigger("closed"))},function(){t.options.applyClassOnHover&&t.$body.removeClass("tocNavOpen"),t._trigger("closed")}),this.options.isExpandableOnSwipe&&(this.$element.on("swiperight",function(){t.$body.addClass("tocNavOpen"),t._trigger("open"),t._trackCustomEvent("expandToc","expandToc")}),this.$element.on("swipeleft",function(){t.$body.removeClass("tocNavOpen"),t._trigger("closed")})),this.options.isExpandableOnClick&&e(".expand",this.$element).click(function(){t.$body.hasClass("tocNavOpen")?(t.$body.removeClass("tocNavOpen"),t._trigger("closed")):(t.$body.addClass("tocNavOpen"),t._trigger("open")),t._trackCustomEvent("expandToc","expandToc"),t.$body.on("click.tocNav",function(i){0===e(i.target).closest(t.$element).length&&(t.$body.removeClass("tocNavOpen"),t._trigger("closed"),t.$body.off("click.tocNav"))})}),e("[data-toc-asset-options]",this.$element).click(function(i){i.preventDefault();var o=e(this);if(o.parent().hasClass("selected"))a.log("Element already selected; ignoring click.");else{var n=o.data("toc-asset-options").id;a.log("Firing event to request asset "+n),t.$element.trigger("tocNavRequest",{assetId:n})}t.options.closeOnSelect&&(t.$body.removeClass("tocNavOpen"),t._trigger("closed"))}),this.$element.on("tocNavSelection",function(i,o){a.log("Updating selected asset to #"+o.index),e("li.selected",t.$element).removeClass("selected");var n=e(e("[data-toc-asset-options]",t.$element)[o.index]).parent("li");n.addClass("selected");var s=n.parent("ul"),l=s.scrollTop()+n.position().top;s.animate({scrollTop:l},500)}),this.options.stopTouchPropagation&&this.$element.on("touchmove",function(e){e.stopPropagation()});var o=e(".ad-omnibar-top"),n=function(){if(o.length>0){var e=o.children("div").children("div"),n=i.ads.data.gpt.adConfig.adUnits.omnibarTop.crawlAdPresent,a=e.css("height")||"0px";t.$element.css("height",n&&"0px"!==a?"calc(100% - "+a+")":"100%")}};n(),o.on("adContentModified",n),this.options.adjustHeight&&new Waypoint.Inview({element:e("#rbFooter")[0],enter:function(i){t.$element.height(e(window).height()-85),window.setTimeout(function(){t.$element.find("ul").first().scrollTop(t.$element.find(".selected").position().top)},500)},exited:function(e){t.$element.height("100%")}})},_trackCustomEvent:function(e,t){a.log("Track custom event: "+e);var n=i.tracking.data;o.trackCustomEvent(e,{articleTitle:n.articleTitle,articleType:n.articleType,articleId:n.articleId,_authorPrimaryName:n._authorPrimaryName,_pageType:n.pageType,brand:n.brand,pageNum:n.pageNum,_test:n._test,siteEdition:n._siteEdition,siteSection:n._siteSection,_siteTypeDevice:n._siteTypeDevice,_siteHier:n._siteHier,_pageViewGuid:n._pageViewGuid,browserTitle:document.title,topicId:n.topicId,collectionId:n.collectionId?n.collectionId:"",articleAuthorName:n.articleAuthorName,articleAuthorGuid:n.articleAuthorId,clickGenericText:t},"trackClick")}})});
define('fly/components/dropdown-1.0',[
    'jquery', 
    'version!fly/components/base'
], function($) {

    //Determines which click event to use depending if jQuery mobile is used and if it is a touch device
    var isTouchDevice = (('ontouchstart' in window) || ('onmsgesturechange' in window)) ? true : false,
        clickEventName = ($.mobile) ? 'vclick' : 'click';
    

    /**
     * Show and hide content based on a set of tabs
     *
     * @extends cbsi.component
     * 
     * Example Usage: 
     *      
     *      $('#my-dropdown').dropdown();
     *      
     *      <div id="my-dropdown" data-dropdown-options='{}'></a>
     *          <a data-item="trigger">Dropdown</a>
     *          <div>Content</div>
     *      </div>
     *
     */
    $.widget( 'fly.dropdown', $.fly.base, {
        
        /**
         * Optional data configuration
         * @define {object}
         */
        options: {
            classSelected: 'selected',
            event: 'click', // click | hover
            selectorTrigger: '[data-item="trigger"]'
            //shown: $.noop dropdown is shown
            //hidden: $.noop dropdown is hidden
        },

        // Vars
        $element: null, // {Object} Dropdown element
        $trigger: null, // {Object} Dropdown trigger element

        enterTimeout: null,
        leaveTimeout: null,
        
        /**
         * Instantiate Tabs
         * @constructor
         */
        _create: function() {
            var o = this.options,
                eventMap = {};
            
            this._setup();
            
            //If touch is supported, force the event to be click
            if (isTouchDevice) {
                o.event = 'click';
            }
            
            // DOM els
            this.$element = this.$element;
            this.$trigger = this.$element.find(o.selectorTrigger).first();

            // click 
            if ('click' === o.event) {
                eventMap[clickEventName] = '_handleClick';
                this._on(this.$trigger, eventMap);
            // hover
            } else if ('hover' === o.event) {
                this._on(this.$element, {
                    'mouseenter': '_handleMouseEnter',
                    'mouseleave': '_handleMouseLeave'
                });
            }
        
            
        },

        /**
         * Handle the tab click event
         *
         * @param e The click event
         * @private
         */        
        _handleClick: function(e) {
            e.preventDefault();
            //e.stopPropagation();
        
            this.toggle();
        },


        /**
         * Handle the mouseenter event
         *
         * @param e The click event
         * @private
         */        
        _handleMouseEnter: function(e) {
            var self = this;
            
            clearTimeout(this.leaveTimeout);
            
            this.enterTimeout = setTimeout(function() {
                self.show();
            }, 50);
        },

        /**
         * Handle the mouseleave event
         *
         * @param e The click event
         * @private
         */        
        _handleMouseLeave: function(e) {
            var self = this;
            
            clearTimeout(this.enterTimeout);

            this.leaveTimeout = setTimeout(function() {
                self.hide();
            }, 150);
        },

        /**
         * Close dropdown on a click outside of it
         *
         * @param e The click event
         * @private
         */  
        _handleDocClick: function(e) {
            var $el = $(e.target);
        
            // If the element clicked on is not a child of the dropdown and is still in the doc
            // then allow hide
            if (this.$element.has($el).length === 0 && $.contains(document.documentElement, $el[0])) {
                this.hide();
            }
        },

        /**
         * Show the dropdown
         */ 
        show: function() {
            var self = this,
                o = this.options,
                eventMapClick = {};
            
            this.$element.addClass(o.classSelected);
            
            // delay docClick so it doesn't fire on show click
            setTimeout(function() {
                eventMapClick[clickEventName] = '_handleDocClick';
                self._on(self.$document, eventMapClick);
            }, 1);
            
            this._trigger('shown', null, {
                $element: this.$element,
                $trigger: this.$trigger
            });
        },

        /**
         * Hide the dropdown
         */ 
        hide: function() {
            var o = this.options;
            
            this.$element.removeClass(o.classSelected);
            
            this._off(this.$document, clickEventName); 
            
            this._trigger('hidden', null, {
                $element: this.$element,
                $trigger: this.$trigger
            });
        },

        /**
         * Toggle the show/hide states of the dropdown
         */ 
        toggle: function() {
            var o = this.options,
                isSelected = this.$element.hasClass(o.classSelected);

            this[(isSelected) ? 'hide' : 'show' ]();
        }
    });
});



define('components/dropdown',["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/dropdown"],function(t,e,i,n){e=e.init("dropdown"),t.widget("cnet.dropdown",t.fly.dropdown,{options:{trackingOptions:{trackDropdown:!1,dropdownIndex:null,trackNameShow:"show",trackNameHide:"hide",ariaExpand:'[data-item="ariaDropdown"]'},disableClose:!1},$ariaExpand:null,_create:function(){var t=this.options,e={};this._setup(),("ontouchstart"in window||"onmsgesturechange"in window)&&(t.event="click"),this.$trigger=this.$element.find(t.selectorTrigger).first(),this.$ariaExpand=this.$element.find(t.ariaExpand).first(),"click"===t.event?(e.tap="_handleClick",this._on(this.$trigger,e)):"hover"===t.event&&this._on(this.$element,{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"})},_handleDocClick:function(e){var i=t(e.target);0===this.$element.has(i).length&&t.contains(document.documentElement,i[0])&&0==this.options.disableClose&&this.hide()},show:function(){var t=this,e=this.options,i={};this.$element.addClass(e.classSelected),setTimeout(function(){i.tap="_handleDocClick",t._on(t.$document,i)},1),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!0),e.trackingOptions.trackDropdown&&this._trackToggle("show")},hide:function(){var t=this.options;this.$element.removeClass(t.classSelected),this._off(this.$document,"tap"),this._trigger("hidden",null,{$element:this.$element,$trigger:this.$trigger}),this.toggleAriaState(!1),t.trackingOptions.trackDropdown&&this._trackToggle("hide")},toggleAriaState:function(t){this.$trigger.attr("aria-expanded",t),this.$ariaExpand.attr("aria-hidden",!t)},_trackToggle:function(t){var a="",o=this.options;a="show"==t?o.trackingOptions.trackNameShow:o.trackingOptions.trackNameHide,o.trackingOptions.dropdownIndex&&(a+="."+o.trackingOptions.dropdownIndex),e.log("Track dropdown event: "+a),trackingData=n.tracking.data,i.trackCustomEvent("dropdownEvent",{siteEdition:trackingData.siteEdition,siteHier:trackingData.siteHier,pageType:trackingData.pageType,articleTitle:trackingData.articleTitle,articleType:trackingData.articleType,topicId:trackingData.topicId,pageViewGuid:trackingData.pageViewGuid,collectionId:trackingData.collectionId,clickGenericText:a},"trackClick")}})});
define('components/toggle',["jquery","version!fly/managers/debug","components/dropdown"],function(n,t){t=t.init("toggle"),n.widget("cnet.toggle",n.cnet.dropdown,{options:{closeOnUrlChange:!1,openOnInit:!1},_create:function(){var n=this;this._super(),this.options.closeOnUrlChange&&this.$window.on("urlChanged",function(){n.hide()}),this.options.openOnInit&&this.show()},show:function(){this.$element.addClass(this.options.classSelected),this._trigger("shown",null,{$element:this.$element,$trigger:this.$trigger}),this.options.trackingOptions.trackDropdown&&this._trackToggle("show")}})});
define('components/touch-menu-hover',["jquery","version!fly/managers/debug","managers/device","managers/page-vars","version!fly/components/base"],function(e,n,a,o){n=n.init("touchMenuHover"),e.widget("cnet.touchMenuHover",e.fly.base,{options:{hoverClass:"hover",moreButton:"moreButton",header:!1},_create:function(){this._setup(),"mobile"!=o.tracking.data.deviceType&&!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&e(".social-login").css("display","none"),Modernizr.touch&&this._setupEvents()},_setupEvents:function(){var o=this,s=o.$element,t=e('[data-trigger="menu"]',s);0===t.length&&(t=s),t.on(a.getImmediateClickType(),function(t){e(":cnet-touchMenuHover").not(s).removeClass(o.options.hoverClass),o.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),s.hasClass(o.options.hoverClass)?s.hasClass(o.options.moreButton)?(n.log("Link click on active more share menu : leaving hover class"),e(document).on(a.getImmediateClickType(),null,{self:o},o._handleClickOutsideMenu)):(s.removeClass(o.options.hoverClass),n.log("Link click on active : removing hover class"),o.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),e(document).off(a.getImmediateClickType(),null,o._handleClickOutsideMenu)):(t.preventDefault(),s.addClass(o.options.hoverClass),o.options.header&&(e("#rbHeader").removeClass("fadeOut"),e("#rbHeader").addClass("passthru intentionalHover")),n.log("Link click on non-active : preventing link and adding hover class"),e(document).on(a.getImmediateClickType(),null,{self:o},o._handleClickOutsideMenu))})},_handleClickOutsideMenu:function(o){var s=o.data.self;0===e(o.target).parents(":cnet-touchMenuHover").length&&(n.log("Body click : removing hover class"),s.$element.removeClass(s.options.hoverClass),s.options.header&&(e("#rbHeader").removeClass("passthru intentionalHover"),e("#rbHeader").addClass("fadeOut")),e(document).off(a.getImmediateClickType(),null,s._handleClickOutsideMenu))}})});
define('components/sticky-element',["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base","version!libs/waypoints/inview"],function(e,t,i){t=t.init("stickyElement"),i.init(),e.widget("cnet.stickyElement",e.fly.base,{options:{classFixed:"fixed",classHidden:"hidden",classPlaceholder:"sticky-element-placeholder",offset:0,primaryEdge:"top",selectorElementHide:"",selectorPageBottom:"",hideDirection:"top",unstickAtPageBottom:!1},$placeholder:null,waypoint:null,endWaypoint:null,_create:function(){this._setup(),this._setupPlaceholder(),this._setupEvents()},_setupPlaceholder:function(){this.$placeholder=e('<div class="'+this.options.classPlaceholder+" "+this.options.classHidden+'"></div>'),this.$placeholder.height(this.$element.outerHeight(!0)),"top"===this.options.primaryEdge?this.$element.before(this.$placeholder):"bottom"===this.options.primaryEdge&&this.$element.after(this.$placeholder)},_setupEvents:function(){var t=this;t.pauseFlag=!1,0===this.options.offset?this.waypoint=new Waypoint.Inview({element:this.$placeholder[0],entered:function(e){"top"===t.options.primaryEdge&&"up"===e?t._unstick():"bottom"===t.options.primaryEdge&&"down"===e&&(t._stick(),t.pauseFlag=!0)},exit:function(e){"top"===t.options.primaryEdge&&"down"===e?t._stick():"bottom"===t.options.primaryEdge&&"up"===e&&t._unstick()}}):t.options.selectorElementHide||(this.waypoint=new Waypoint({element:this.$placeholder[0],handler:function(e){"top"===t.options.primaryEdge&&"up"===e||"bottom"===t.options.primaryEdge&&"down"===e?t._unstick():t._stick()},offset:this.options.offset})),t.options.selectorElementHide&&(this.endWaypoint=new Waypoint({element:t.$element.closest(t.options.selectorElementHide),handler:function(e){"top"==t.options.hideDirection?1==t.pauseFlag&&"down"==e?t._unstick():t._stick():1==t.pauseFlag&&"down"==e?t._stick():t._unstick()},offset:"bottom-in-view"})),t.options.selectorPageBottom&&(this.endWaypoint=new Waypoint.Inview({element:e(t.options.selectorPageBottom),entered:function(e){"top"===t.options.primaryEdge&&"down"===e&&t._unstick()},exit:function(e){"top"===t.options.primaryEdge&&"up"===e&&t._stick()}})),t.options.unstickAtPageBottom&&(this.endWaypoint=new Waypoint({element:t.$element.parents("[data-page-options]").find(".pageBottom"),handler:function(e){"down"==e?t._unstick():"up"==e&&t._stick()},offset:e(".shortLeader").length?76:100}))},_stick:function(){this.$placeholder.removeClass(this.options.classHidden),this.$element.addClass(this.options.classFixed),this.$element.trigger("stickyElementStuck")},_unstick:function(){this.$placeholder.addClass(this.options.classHidden),this.$element.removeClass(this.options.classFixed),this.$element.trigger("stickyElementUnstuck")}})});
define('components/form-trim',["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("formTrim"),e.widget("cnet.formTrim",e.fly.base,{options:{},_create:function(){var t=this;t._setup(),t.$element.on("submit",e.proxy(function(n){e("input[type=text]",t.$element).each(function(){e(this).val(e(this).val().replace(/\s+/g," ").trim())})},this))}})});
/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2013 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.9.3
 *
 */

!function(e,t,i,o){var n=e(t);e.fn.lazyload=function(o){function r(){var t=0;l.each(function(){var i=e(this);if(!a.skip_invisible||i.is(":visible"))if(e.abovethetop(this,a)||e.leftofbegin(this,a));else if(e.belowthefold(this,a)||e.rightoffold(this,a)){if(++t>a.failure_limit)return!1}else i.trigger("appear"),t=0})}var f,l=this,a={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return o&&(void 0!==o.failurelimit&&(o.failure_limit=o.failurelimit,delete o.failurelimit),void 0!==o.effectspeed&&(o.effect_speed=o.effectspeed,delete o.effectspeed),e.extend(a,o)),f=void 0===a.container||a.container===t?n:e(a.container),0===a.event.indexOf("scroll")&&f.bind(a.event,function(){return r()}),this.each(function(){var t=this,i=e(t);t.loaded=!1,void 0!==i.attr("src")&&!1!==i.attr("src")||i.is("img")&&i.attr("src",a.placeholder),i.one("appear",function(){if(!this.loaded){if(a.appear){var o=l.length;a.appear.call(t,o,a)}e("<img />").bind("load",function(){var o=i.attr("data-"+a.data_attribute);i.hide(),i.is("img")?i.attr("src",o):i.css("background-image","url('"+o+"')"),i[a.effect](a.effect_speed),t.loaded=!0;var n=e.grep(l,function(e){return!e.loaded});if(l=e(n),a.load){var r=l.length;a.load.call(t,r,a)}}).attr("src",i.attr("data-"+a.data_attribute))}}),0!==a.event.indexOf("scroll")&&i.bind(a.event,function(){t.loaded||i.trigger("appear")})}),n.bind("resize",function(){r()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&n.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&l.each(function(){e(this).trigger("appear")})}),e(i).ready(function(){r()}),this},e.belowthefold=function(i,o){return(void 0===o.container||o.container===t?(t.innerHeight?t.innerHeight:n.height())+n.scrollTop():e(o.container).offset().top+e(o.container).height())<=e(i).offset().top-o.threshold},e.rightoffold=function(i,o){return(void 0===o.container||o.container===t?n.width()+n.scrollLeft():e(o.container).offset().left+e(o.container).width())<=e(i).offset().left-o.threshold},e.abovethetop=function(i,o){return(void 0===o.container||o.container===t?n.scrollTop():e(o.container).offset().top)>=e(i).offset().top+o.threshold+e(i).height()},e.leftofbegin=function(i,o){return(void 0===o.container||o.container===t?n.scrollLeft():e(o.container).offset().left)>=e(i).offset().left+o.threshold+e(i).width()},e.inviewport=function(t,i){return!(e.rightoffold(t,i)||e.leftofbegin(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document);
define("libs/jquery/lazyload-1.9.3", function(){});


define('components/lazyload-images',["jquery","version!fly/components/base","version!libs/jquery/lazyload"],function(e){e.widget("cnet.lazyloadImages",e.fly.base,{options:{threshold:200,skip_invisible:!1},_create:function(){this._super(),this._setupEvents(),this._lazyLoadImages()},_setupEvents:function(){this._on(this.$element,{ajaxStop:this._lazyLoadImages})},_lazyLoadImages:function(){this.$element.find("img.lazy").lazyload(this.options).removeClass("lazy")}})});
define('components/modal-enlarge-image',["jquery","managers/page-vars","managers/tealium","version!fly/components/base","components/global-modal"],function(e,i,t){e.widget("cnet.modalEnlargeImage",e.cnet.globalModal,{options:{},_create:function(){this._super();var a=this.$element.data().target;this._on(e(a),{modalopened:function(i){e("body").addClass("modalImage")},modalclosed:function(i){e("body").removeClass("modalImage")}}),this.$element.on("click",function(){var e=i.tracking.data;t.trackCustomEvent("trackClickToEnlarge",{_articleTitle:e.articleTitle,articleTitle:e.articleTitle,_articleId:e.articleId,articleId:e.articleId,_authorPrimaryName:e._authorPrimaryName,articleType:e.articleType,_articleType:e.articleType,_pageType:e.pageType,siteSection:e.siteSection,_test:e._test,_topicPrimaryId:e.topicId.toString(),siteEdition:e._siteEdition,_siteTypeDevice:e._siteTypeDevice,_siteHier:e._siteHier,pageViewGuid:e._pageViewGuid,_pageViewGuid:e._pageViewGuid,_dwAnonId:e._dwAnonId,dwAnonId:e._dwAnonId,_collectionPrimaryId:e._collectionPrimaryId,viewguid:e.pageViewGuid,clickGenericText:"click-to-enlarge"},"trackClick")})}})});
define('components/article',["jquery","version!fly/managers/debug","managers/client-storage","managers/page-vars","version!fly/utils/url-helper","version!fly/components/base"],function(o,e,t,i,a){e=e.init("article"),o.widget("cnet.article",o.fly.base,{options:{autoplayVideo:!1},data:null,_create:function(){this._setup(),this._autoplayVideo()},_autoplayVideo:function(){if(e.info("Autoplay video",t.read("autoplayEnabled"),this.options.autoplayVideo),"off"!=t.read("autoplayEnabled")&&!1!==this.options.autoplayVideo&&"off"!==a.getParam("autoplayEnabled")){var i=o('.video.shortcode .videoPlayer[data-component^="cnetVideo"], #featuredVideo .videoPlayer[data-component^="cnetVideo"]').first(),n=i.find(".videoPromo");if(e.log("Autoplay video",i,n),i.length>0)try{e.log("Check popout"),this._isInViewport(i)?e.log("no popout"):(i.parent().addClass("popOut"),e.log("do popout",i)),i.cnetVideo("inited")&&(n.trigger("click",{autoplay:!0}),e.log("Click triggered",n))}catch(o){e.warn("Video not ready",o),i.on("onVideoPlayerReady",function(o){e.log("Video ready. Trigger click",o),n.trigger("click",{autoplay:!0})})}else e.info("No video to autoplay");e.log("/Autoplay")}},_isInViewport:function(e){e=o(e);var t=this.$window.scrollTop(),i=t+this.$window.height(),a=e.offset().top,n=a+e.outerHeight();return a<i&&n>t}})});
define('components/page',["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/managers/history","managers/waypoints","managers/tracking","managers/tealium","managers/ad","managers/guid","managers/page-vars","version!fly/utils/url-helper","version!fly/utils/string-helper","version!fly/components/base","version!libs/waypoints/inview"],function(t,e,a,i,n,s,o,r,l,d,p,h){e=e.init("page"),n.init();var c=!1;t.widget("cnet.page",t.fly.base,{options:{ajaxOffset:0,ajaxUrl:null,allowAds:!1,browserTitle:null,browserUrl:null,classCurrent:"current",cmsUrl:null,containedAdNames:[],dwTagOverride:null,hasSubPages:!1,initialPage:!1,limit:-1,loadParentAd:!1,manuallyRefreshClearedAds:!0,manuallyRefreshUnclearedAds:!0,onlyViewPageOnce:!0,preserveQueryString:!0,redirectUrl:null,refreshViewGuid:!0,replaceState:!1,resetAdPosition:!1,taboolaElement:null,trackingEventData:null,trackingPageLoadData:null,trackPageChange:!1,unloadAdsOutOfView:!1,trackScroll25:!1,trackScroll50:!1,trackScroll75:!1,trackScroll100:!1},$parentPage:null,adData:null,adsCleared:!1,adsInitialized:!0,ajaxWaypoint:null,destructorWaypoints:null,inviewWaypoints:null,inviewWaypointTriggered:!1,loaded:!1,scrollPercentageWaypoints:null,trackingData:null,viewed:!1,_create:function(){this._setup(),this._initHistoryManager(),this.viewed=this.options.initialPage,this.loaded=!this.options.ajaxUrl,this.$parentPage=this.$element.parents("[data-page-options]"),this.$parentPage.length>0&&this.$parentPage.data("page")&&!this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!1),this._initWaypoints()},_initHistoryManager:function(){window.history.scrollRestoration="manual",this.history=i.init(),this.history.stateChange(function(e){if(e.id){var a=t("#"+e.id);a.length>0&&(c=!0,t("html, body").animate({scrollTop:a.offset().top},250,function(){c=!1}))}})},_initWaypoints:function(){var t=this;if(this.options.redirectUrl?this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(e){t._redirect()},offset:this.options.ajaxOffset}):this.options.ajaxUrl&&(this.ajaxWaypoint=new Waypoint({element:this.$element[0],handler:function(e){t._ajaxContent(),this.destroy()},offset:this.options.ajaxOffset})),this.inviewWaypoints=[],this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(e){"down"===e&&(t.inviewWaypointTriggered=!0,t.loaded&&t._viewPage(e))},offset:function(){var e=.5*window.innerHeight;return t.$parentPage.length>0&&(e=window.innerHeight),e}})),this.inviewWaypoints.push(new Waypoint({enabled:!this.loaded||this.$parentPage.length>0,element:this.$element[0],handler:function(e){"up"===e&&(t.inviewWaypointTriggered=!0,t.loaded&&t._viewPage(e))},offset:function(){var e=.5*window.innerHeight-this.element.clientHeight;return t.$parentPage.length>0&&(e=-this.element.clientHeight),e}})),this.options.ajaxUrl||this._initTrackingWaypoints(),"gallery"===d.tracking.data.testName&&"control"!==d.tracking.data.testGroup&&d.tracking.data.maxSlide>8&&this._setupGalleryWaypoint(),this.loaded)for(var e=0;e<this.inviewWaypoints.length;e++)this.inviewWaypoints[e].enable();this.options.unloadAdsOutOfView&&(this.destructorWaypoints=[],this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(e){"down"===e&&t._unloadAds(t.$element)},offset:"-200%"})),this.destructorWaypoints.push(new Waypoint({element:this.$element[0],handler:function(e){"up"===e&&t._unloadAds(t.$element)},offset:"200%"})))},_initTrackingWaypoints:function(){this.scrollPercentageWaypoints=[],this.options.trackScroll25&&this._setupScrollTrackingWayPoint(.25,"scroll25"),this.options.trackScroll50&&this._setupScrollTrackingWayPoint(.5,"scroll50"),this.options.trackScroll75&&this._setupScrollTrackingWayPoint(.75,"scroll75"),this.options.trackScroll100&&this._setupScrollTrackingWayPoint(1,"scroll100")},_setupGalleryWaypoint:function(){var e=t(".stickyColumnElement .ad-mpu-top").parent(),a=t(".ad-leader-top").parent(),i=new Waypoint.Inview({element:t(".image-gallery .ad-flex-incontent-ad-bottom"),enter:function(t){i&&"none"!==i.options.element.css("display")&&(a.addClass("hidden"),e.addClass("hidden"))},exit:function(t){i&&"none"!==i.options.element.css("display")&&(a.addClass("hidden"),e.addClass("hidden"))},exited:function(t){i&&"none"!==i.options.element.css("display")&&(a.removeClass("hidden"),e.removeClass("hidden"))}})},_setupScrollTrackingWayPoint:function(t,e){var a=this;this.scrollPercentageWaypoints.push(new Waypoint({element:this.$element[0],offset:function(){return-this.element.clientHeight*t+window.innerHeight},handler:function(t){"down"===t&&(a._customTrackingCall("percentageScrollTracking",e),this.destroy())}}))},_redirect:function(){var e=this.options.redirectUrl;if(this.options.preserveQueryString){var a=t.extend({},p.getAllParams(),p.getAllParams(this.options.ajaxUrl));e=p.buildUrl("",p.getPath(e),a)}window.location=e},_ajaxContent:function(){var i=this,n=this.options.ajaxUrl;if(this.options.preserveQueryString){var s=t.extend({},p.getAllParams(),p.getAllParams(this.options.ajaxUrl));n=p.buildUrl("",p.getPath(n),s)}e.log("Loading new page: "+n),t.ajax({dataType:"json",url:n}).done(function(n){if(n.template){i.loaded=!0,i.adData=n.adData,i.adsInitialized=!1,i.trackingData=n.trackingData,i.$element.html(n.template),n.featureFlags&&(d.services=n.featureFlags),a.process(i.$element),i.inviewWaypointTriggered&&i._viewPage("down"),i._initTrackingWaypoints();var s=t("[data-page-options]").filter(function(e,a){return 0===t(a).parent().closest("[data-page-options]").length});if(n.after&&(i.options.limit<0||s.length<i.options.limit)){var o=t(n.after);i.$element.after(o),a.process(o)}}else e.log("No content template found.")})},_viewPage:function(t){if(this._updateUrl(),!this.options.onlyViewPageOnce||!this.viewed)if(this.viewed=!0,this.options.hasSubPages)this.options.trackingEventData&&this._trackEvent(t);else if(this._updatePageVars(),this.options.trackingPageLoadData&&this._trackPV(t),this.options.allowAds){var e=this.options.loadParentAd?this.$parentPage:this.$element;this._loadAds(e,this.options.containedAdNames)}this.options.trackPageChange&&this.options.trackingEventData&&this._trackEvent(t)},_getContainedAds:function(e,a){var i=[],n=[],s=e.find("[data-ad]"),o={};return d.ads&&d.ads.data&&d.ads.data.gpt&&d.ads.data.gpt.adConfig&&d.ads.data.gpt.adConfig.adUnits&&(o=d.ads.data.gpt.adConfig.adUnits),s.each(function(e,s){var r=t(s),l=o[h.toCamelCase(r.data("ad"))],d=l.disableInitialLoad||l.delayLoad||!0===r.data("disableInitialLoad");(!0!==a||!0===a&&d)&&(i.push(r.data("ad")),n.push(r.attr("id")))}),{adUnitNames:i,adDivIds:n}},_loadAds:function(t,a){this.options.resetAdPosition&&r.resetPosition(),this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adsInitialized&&(this.adsInitialized=!0);var i=!1;if(this.adsInitialized||(e.log("loaded all ads within this page",t),r.loadImproved(this.adData),this.adsInitialized=!0,i=!0,this.$parentPage.length>0&&this.$parentPage.data("page")&&(this.$parentPage.data("page").adsInitialized=!0)),this.options.manuallyRefreshClearedAds&&this.adsCleared||this.options.manuallyRefreshUnclearedAds&&!this.adsCleared){e.log("refreshing all ads contained within",t);var n=this._getContainedAds(t,i);0==a.length&&(a=n.adUnitNames),0<a.length&&(r.refreshImproved({adData:this.adData,adUnitNames:a,reset:!1,allowedDivIds:n.adDivIds,targeting:t.data("customAdVars")}),this.adsCleared=!1)}this._initTaboola()},_initTaboola:function(){if(d.services.taboola.enabled){var e=t("#"+this.options.taboolaElement);e.length>0&&e.taboola(e.data("taboola"))}},_unloadAds:function(t){if(this.adsInitialized){e.log("Unloading all ads contained within",t);var a=this._getContainedAds(t);r.removeAds(void 0,void 0,a.adDivIds,!1),this.adsCleared=!0}},_updatePageVars:function(){this.trackingData?s.resetTrackingData(this.trackingData):this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").trackingData&&(this.trackingData=t.extend(!0,{},d.tracking.data,this.$parentPage.data("page").trackingData),s.resetTrackingData(this.trackingData)),this.adData?d.ads.data=this.adData:this.$parentPage.length>0&&this.$parentPage.data("page")&&this.$parentPage.data("page").adData&&(d.ads.data=this.adData=this.$parentPage.data("page").adData),this.options.refreshViewGuid&&l.resetViewGuid()},_updateUrl:function(){if(this.options.browserUrl&&!c){var e=this.options.browserUrl;if(this.options.preserveQueryString){var a=t.extend({},p.getAllParams(),p.getAllParams(this.options.browserUrl));e=p.buildUrl("",p.getPath(e),a)}this.history.navigate({id:this.$element.attr("id")},{title:this.options.browserTitle||document.title,url:e,replace:this.options.replaceState}),t("[data-page-options]").removeClass(this.options.classCurrent),this.$element.addClass(this.options.classCurrent),this.options.cmsUrl&&t("body").attr("data-cms-edit",'{"url":"'+this.options.cmsUrl+'"}'),this.$window.trigger("urlChanged")}},_trackEvent:function(e){var a=t("[data-page-options]").filter(function(e,a){return 0===t(a).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===e?1:0),i=e+"."+a;this._customTrackingCall("trackPageEvent",i)},_trackPV:function(e){var a=d.tracking.data,i=t("[data-page-options]").filter(function(e,a){return 0===t(a).parent().closest("[data-page-options]").length}).index(this.$element)+("up"===e?1:0),n="";this.options.dwTagOverride?n=this.options.dwTagOverride:i>=0&&(n=e+"."+i),o.trackPageLoad(t.extend(!0,{articleId:a.articleId,articleTitle:a.articleTitle,articleType:a.articleType,articleAuthorName:a.articleAuthorName,brand:a.brand,clickGenericText:"",collectionId:a.collectionId,dwLinkTag:n,event:"log",mfr:a.mfr,pageTitle:a.articleTitle,riaevent:"view",siteEdition:a.siteEdition,siteHier:a.siteHier,siteSection:a.siteSection,_pageFindingMethods:"",_pageViewGuid:a.pageViewGuid,_siteEdition:a.siteEdition,_topicPrimaryId:a.topicId?a.topicId[0]:null},this.options.trackingPageLoadData||{}))},_customTrackingCall:function(e,a){var i=d.tracking.data;o.trackCustomEvent(e,t.extend(!0,{articleId:i.articleId,articleTitle:i.articleTitle,articleType:i.articleType,clickGenericText:a,collectionId:i.collectionId,pageTitle:i.photoGalleryTitle,pageType:i.pageType,pageViewGuid:i.pageViewGuid,siteEdition:i.siteEdition,siteHier:i.siteHier,siteSection:i.siteSection,topicId:i.topicId,_dwAnonId:i._dwAnonId},this.options.trackingEventData||{}),"trackClick")}})});
define('components/sliding-element',["jquery","version!fly/managers/debug","managers/waypoints","version!fly/components/base"],function(t,e,o){e=e.init("slidingElement"),o.init(),t.widget("cnet.slidingElement",t.fly.base,{options:{classFixed:"fixed",classReady:"ready",offset:0,offsetGuideParallelBottom:0,offsetGuideParallelTop:0,selectorGuideBottom:null,selectorGuideParallel:null,selectorGuideTop:null,stickTo:"top"},$guideBottom:null,$guideParallel:null,$guideTop:null,$html:null,boundaryBottom:0,boundaryTop:0,stickToBottom:!1,waypoints:null,_create:function(){this._setup(),this.stickToBottom="bottom"===this.options.stickTo,this._setupElements(),this._setupEvents(),this.$element.addClass(this.options.classReady)},_setupElements:function(){this.$html=t("html"),this.options.selectorGuideBottom&&(this.$guideBottom=t(this.options.selectorGuideBottom)),this.options.selectorGuideParallel&&(this.$guideParallel=t(this.options.selectorGuideParallel)),this.options.selectorGuideTop&&(this.$guideTop=t(this.options.selectorGuideTop)),this.$guideParallel&&!this.$guideTop&&(this.boundaryTop="string"==typeof this.options.offsetGuideParallelTop?parseInt(this.options.offsetGuideParallelTop,10)*this.$guideParallel.outerHeight()/100:this.options.offsetGuideParallelTop,this.$element.css({top:this.boundaryTop+"px"}))},_setupEvents:function(){var t=this;this.waypoints=[],this.$guideTop?this.waypoints.push(new Waypoint({element:this.$guideTop,handler:this._topWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,o=t.options.offset-t.$guideTop.outerHeight();return t.stickToBottom&&(o=(o-t.$element.outerHeight())*e+t.$window.height()),o}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._topWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,o=t.options.offset-t.boundaryTop;return t.stickToBottom&&(o=(o-t.$element.outerHeight())*e+t.$window.height()),o}})),this.$guideBottom?this.waypoints.push(new Waypoint({element:this.$guideBottom,handler:this._bottomWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1,o=t.options.offset+t.$element.outerHeight();return t.stickToBottom&&(o=(o-t.$element.outerHeight())*e+t.$window.height()),o}})):this.$guideParallel&&this.waypoints.push(new Waypoint({element:this.$guideParallel,handler:this._bottomWaypointHandler.bind(this),offset:function(){var e=t.$html.css("zoom")||1;t.boundaryBottom=t.$guideParallel.outerHeight()-t.$element.outerHeight()-("string"==typeof t.options.offsetGuideParallelBottom?parseInt(t.options.offsetGuideParallelBottom,10)*t.$guideParallel.outerHeight()/100:t.options.offsetGuideParallelBottom);var o=t.options.offset-t.boundaryBottom;return t.stickToBottom&&(o=(o-t.$element.outerHeight())*e+t.$window.height()),o}}))},_topWaypointHandler:function(t){if("down"===t)this.$element.addClass(this.options.classFixed);else{var e=this.boundaryTop;if(this.$guideTop){var o=this.$guideTop.offset(),i=this.$element.parent().offset();e=o.top+this.$guideTop.outerHeight()-i.top}this.$element.removeClass(this.options.classFixed).css({top:e+"px"})}},_bottomWaypointHandler:function(t){if("down"===t){var e=this.boundaryBottom;if(this.$guideBottom){var o=this.$guideBottom.offset(),i=this.$element.parent().offset();e=o.top-i.top-this.$element.outerHeight()}this.$element.removeClass(this.options.classFixed).css({top:e+"px"})}else this.$element.addClass(this.options.classFixed)}})});
define('components/sticky-column',["jquery","managers/tealium","version!fly/managers/debug","managers/waypoints","version!fly/libs/jquery.throttle-debounce","version!fly/components/base"],function(t,e,i,s){i=i.init("stickyColumn"),s.init(),t.widget("cnet.stickyColumn",t.fly.base,{options:{classFixed:"fixed",classReady:"ready",minimumGap:250,offset:0,selectorHeightConstraint:""},$constraint:null,divisionSize:0,height:0,waypoints:null,_create:function(){this._setup();var e=this;e._setupElements(),e._setupEvents(),i.log("First sticky column setup"),t(window).on("resize",t.throttle(250,function(){t.each(e.waypoints,function(){this.destroy()}),e._clearHeight(),e._setupElements(),e._setupEvents(),i.log("Resized sticky column setup")}))},_setupElements:function(){this.$constraint=this.$element.closest(this.options.selectorHeightConstraint),0===this.$constraint.length&&(this.$constraint=t(this.options.selectorHeightConstraint).first()),this._setHeight(),this._hideExtraOptionalElements(),this._createElementDivisions(),this.$element.addClass(this.options.classReady)},_setHeight:function(){var e=this.$element.children('[data-meta*="type":"static"], [data-meta*="type":"required"]'),s=(e.length-1)*this.options.minimumGap;e.each(function(e,i){var n=t(i);s+=n.data("meta").height||n.outerHeight()}),this.height=Math.max(s,this.$constraint.outerHeight()),this.$element.height(this.height),i.log("Height: ",this.height),i.log("Min-height: ",s),i.log("Required children: ",e.length)},_clearHeight:function(){this.height=0,this.$element.height("auto")},_hideExtraOptionalElements:function(){var e=this,s=this.$element.children(),n=s.filter('[data-meta*="type":"optional"]');if(n.length>0){var o=(s.length-1)*e.options.minimumGap;for(s.each(function(e,i){var s=t(i);o+=s.data("meta").height||s.outerHeight()});o>e.height&&n&&n.length>0;){var a=n.last();o-=a.outerHeight()+e.options.minimumGap,n=n.slice(0,-1),a.remove()}}i.log("Opt. children: ",n.length)},_createElementDivisions:function(){var t=this.$element.children();this.divisionSize=this.height/t.length;for(var e=1;e<t.length;e++){var s=e*this.divisionSize,n=t.eq(e),o=n.data("meta")&&n.data("meta").height?n.data("meta").height:n.outerHeight(),a=o-this.divisionSize;a>0&&(s-=a),n.css("top",s+"px")}i.log("Division size: ",this.divisionSize)},_setupEvents:function(){var i=this.$element.children();this.waypoints=[];for(var s=0;s<i.length;s++){var n=i.eq(s);if(n.data("meta")&&"static"!==n.data("meta").type){var o=n.data("meta").height||n.outerHeight(),a=s*this.divisionSize,h=(s+1)*this.divisionSize-o,l=s+1===i.length;this.divisionSize>o&&(this.waypoints.push(new Waypoint({element:this.$element,handler:this._topWaypointHandler.bind(this,n,a),offset:this.options.offset-a})),this.waypoints.push(new Waypoint({element:this.$element,handler:this._bottomWaypointHandler.bind(this,n,h,o,l),offset:l?this._getLastBottomOffset.bind(this,o):this.options.offset-h})))}}new Waypoint({element:this.$element,handler:function(s){if("down"===s)for(var n=0;n<i.length;n++){var o=i.eq(n);if(o.data("meta")&&o.data("meta").trackingData){var a=t.extend(!0,{},this._baseTrackingData,o.data("meta").trackingData);e.trackCustomEvent("impression",a,"trackClick")}}},offset:"100%"})},_topWaypointHandler:function(t,e,i){"down"===i?t.addClass(this.options.classFixed):t.removeClass(this.options.classFixed).css({top:e+"px"})},_bottomWaypointHandler:function(t,e,i,s,n){s&&(e=this.$constraint.outerHeight()-i),"down"===n?t.removeClass(this.options.classFixed).css({top:e+"px"}):t.addClass(this.options.classFixed)},_getLastBottomOffset:function(t){var e=this.$constraint.outerHeight()-t;return i.log("Bottom offset: ",this.options.offset-e),this.options.offset-e}})});
define('components/selfish-scroll',["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){t=t.init("selfishScroll"),e.widget("cnet.selfishScroll",e.fly.base,{options:{threshold:5},_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var e=this;this.$element.on("wheel",function(t){var n=t.currentTarget,o=t.originalEvent.deltaY<=0&&Math.floor(n.scrollTop)<=e.options.threshold,l=t.originalEvent.deltaY>=0&&Math.ceil(n.scrollTop+n.clientHeight)>=n.scrollHeight-e.options.threshold;(o||l)&&t.preventDefault()})}})});
define('components/update-area',["jquery","version!fly/managers/debug","version!fly/managers/components","version!fly/components/base"],function(e,a,t){a=a.init("updateArea"),e.widget("cnet.updateArea",e.fly.base,{options:{url:""},_create:function(){this._super(),this._setupEvents()},_setupEvents:function(){var e=this;e.options.url.length>0&&this.doAjax(e.options.url)},doAjax:function(a){var t=this;e.ajax({url:a,dataType:"json"}).done(function(a){e.each(a.pageElements,function(e){var n=a.pageElements[e].html;t.updateView(n,e)})})},updateView:function(a,n){var i=e("[data-update-area="+n+"]");i.html(a),t.process(i);var o=i.find("[data-video-playlist]");o.length>0&&require(["quantum/videoPlayer","quantum/inviewElement"],function(){e("body").hasClass("videoPlayerReady")?e(window).trigger("appendPlaylist",{data:o.data("videoPlaylist")}):e('[data-component="videoPlayer"]').one("onVideoPlayerReady",function(){e(window).trigger("appendPlaylist",{data:o.data("videoPlaylist")})})})}})});
define('components/sticky-leader',["jquery","version!fly/managers/debug","managers/page-vars","components/sticky-element","version!libs/waypoints/jquery.waypoints"],function(e,t,n){t=t.init("stickyLeader"),e.widget("cnet.stickyLeader",e.cnet.stickyElement,{options:{classFadeOut:"fadeOut",topOffset:null,bottomOffset:-60,alwaysSticky:!1},beginWaypoint:null,endWaypoint:null,_create:function(){null===this.options.topOffset&&(this.options.topOffset=e("body.omnibar").not(".crawlAd")?125:80),this._super()},_setupEvents:function(){var e=this,t=this.$placeholder[0];this.beginWaypoint=new Waypoint({element:t,handler:function(t){"down"===t?(e.$placeholder.removeClass(e.options.classHidden),e.$element.addClass(e.options.classFixed)):(e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed))},offset:e.options.topOffset}),0==e.options.alwaysSticky&&(this.endWaypoint=new Waypoint({element:t,handler:function(t){"down"===t&&(e.beginWaypoint.disable(),e.endWaypoint&&e.endWaypoint.disable(),e.$element.addClass("fadeOut"),setTimeout(function(){e.$placeholder.addClass(e.options.classHidden),e.$element.removeClass(e.options.classFixed+" fadeOut")},500))},offset:e.options.bottomOffset}))}})});
define('components/track-download',["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,a,i){t=t.init("trackDownload"),e.widget("cnet.trackDownload",e.fly.base,{options:{},_create:function(){this._super(),this.$element.on("click",function(){a.trackCustomEvent("trackDownload",{clickGenericText:"HeadertoDL",_siteSection:i.tracking.data.siteSection,siteEdition:i.tracking.data.siteEdition,_siteTypeDevice:i.tracking.data.deviceType,_pageType:i.tracking.data.pageType},"trackClick")})}})});
define('components/social-tracking',["jquery","version!fly/managers/debug","managers/tealium","version!fly/components/base"],function(e,i,t){i=i.init("socialTracking"),e.widget("cnet.socialTracking",e.fly.base,{options:{socialSite:"notSet"},_create:function(){this._setup(),this._setupTracking()},_setupTracking:function(){i.log("Setting up social tracking");var n=this.options;e(this.$element).on("click",function(o){i.log("Social Element Clicked, Tracking Now");var a=n.socialSite,c={facebooksend:1,facebook:2,googlePlus:3,linkedin:21,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,email:10,delicious:12,tumblr:14},l=t.getDwTag(e(o.target));t.trackSocial({socialService:a,event:"share",eventt:"socialsite",socialId:c[a],wd:"sharelink",dwLinkTag:l,sharebarSection:l}),i.log("Social Element Tracked")})}})});
define('components/external-link',["jquery","version!fly/managers/debug","version!fly/components/base","managers/tealium"],function(e,n,i){var t=n.init("tracking");e.widget("cnet.externalLink",e.fly.base,{options:{},_create:function(){this._setup(),this.$element.click(function(e){i.trackExternalLink({clickGenericText:"trackExternalLink"}),t.log("External link clicked.")}.bind(this))}})});
define('translations/video',["managers/edition"],function(e){var o={en:{resume:"Your video will resume in ",resumeShortly:"Your video will resume shortly",seconds:" seconds",adBlock:{title:"Sorry about that",message:"It looks like you're using an ad blocker. We know you don't love ads. But they allow us to pay the writers, editors and producers who work to make your favorite CNET videos. To watch this video, please disable your ad blocker and refresh the page. Thanks for tuning in. You're the best."},firefoxUpgrade:{title:"Your version of Firefox is no longer supported.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Click here to download the latest version.</a>'},videoNotAvailable:{title:"We're sorry, but this video is no longer available.",message:"Please watch this next video instead."},upnext:"up next",autoplay:"Autoplay",on:"on",off:"off",cannotPlay:"This device is unable to play the requested video.",by:"by",playSound:"Play Sound"},es:{resume:"El vídeo se reanudará en ",resumeShortly:"El vídeo se reanudará en breve",seconds:" segundos",adBlock:{title:"Lo sentimos",message:"Parece que estás usando un software para bloquear anuncios. Sabemos que a mucha gente no lo encantan los anuncios, pero nos ayudan a pagarle a nuestro equipo de profesionales que hacen tus videos favoritos. Para ver este video, por favor desactiva el software y vuelve a cargar la página. ¡Mil gracias!"},firefoxUpgrade:{title:"La versión de Firefox que usas no está actualizada.",message:'<a href="http://download.cnet.com/s/firefox/" target="_blank">Por favor descarga la versión más reciente.</a>'},videoNotAvailable:{title:"Lo sentimos, pero este video ya no está disponible.",message:"Por favor, vea el siguiente video en su lugar."},upnext:"Siguiente",autoplay:"Autoplay",on:"Sí",off:"No",cannotPlay:"Este dispositivo no puede reproducir el video solicitado.",by:"por",playSound:"¿Reproducir sonido?"}};return e.getTranslation(o)});
define('managers/events',["jquery","version!fly/managers/debug"],function(n,r){r=r.init("events");var e={};return{publish:function(n,r){for(var i=0;i<n.length;i++)if(e[n[i]]&&e[n[i]][r])for(var f=0;f<e[n[i]][r].length;f++)e[n[i]][r][f]()},subscribe:function(n,r){for(var i in r)if(r.hasOwnProperty(i)){e[i]=e[i]||{};for(var f in r[i])r[i].hasOwnProperty(f)&&(e[i][f]=e[i][f]||[],e[i][f].push(n[r[i][f]].bind(n)))}}}});
/**
     * @license
     * Lodash (Custom Build) <https://lodash.com/>
     * Build: `lodash include="noConflict,compact,drop,indexOf,pull,sortBy,without,every,find,forEach,includes,map,some,debounce,throttle,clone,cloneDeep,isArray,isBoolean,isDate,isEmpty,isFunction,isNull,isNumber,isNaN,isUndefined,isObject,isPlainObject,isString,indexOf,assign,extend,get,forOwn,omitBy,capitalize,endsWith,has,inRange,min,padStart,round,startsWith,template,toJSON" --development --source-map --output lib/lodash.js`
     * Copyright JS Foundation and other contributors <https://js.foundation/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */

/* utf.js - UTF-8 <=> UTF-16 convertion
                         *
                         * Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
                         * Version: 1.0
                         * LastModified: Dec 25 1999
                         * This library is free.  You can redistribute it and/or modify it.
                         */

// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

/**
                     * Copyright 2013 vtt.js Contributors
                     *
                     * Licensed under the Apache License, Version 2.0 (the "License");
                     * you may not use this file except in compliance with the License.
                     * You may obtain a copy of the License at
                     *
                     *   http://www.apache.org/licenses/LICENSE-2.0
                     *
                     * Unless required by applicable law or agreed to in writing, software
                     * distributed under the License is distributed on an "AS IS" BASIS,
                     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                     * See the License for the specific language governing permissions and
                     * limitations under the License.
                     */

/**
                     *
                     * This code was ported from the dash.js project at:
                     *   https://github.com/Dash-Industry-Forum/dash.js/blob/development/externals/cea608-parser.js
                     *   https://github.com/Dash-Industry-Forum/dash.js/commit/8269b26a761e0853bb21d78780ed945144ecdd4d#diff-71bc295a2d6b6b7093a1d3290d53a4b2
                     *
                     * The original copyright appears below:
                     *
                     * The copyright in this software is being made available under the BSD License,
                     * included below. This software may be subject to other third party and contributor
                     * rights, including patent rights, and no such rights are granted under this license.
                     *
                     * Copyright (c) 2015-2016, DASH Industry Forum.
                     * All rights reserved.
                     *
                     * Redistribution and use in source and binary forms, with or without modification,
                     * are permitted provided that the following conditions are met:
                     *  1. Redistributions of source code must retain the above copyright notice, this
                     *  list of conditions and the following disclaimer.
                     *  * Redistributions in binary form must reproduce the above copyright notice,
                     *  this list of conditions and the following disclaimer in the documentation and/or
                     *  other materials provided with the distribution.
                     *  2. Neither the name of Dash Industry Forum nor the names of its
                     *  contributors may be used to endorse or promote products derived from this software
                     *  without specific prior written permission.
                     *
                     *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY
                     *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
                     *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
                     *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
                     *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
                     *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
                     *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
                     *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
                     *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
                     *  POSSIBILITY OF SUCH DAMAGE.
                     */

// copyright sign

// if licenseXhrSetup did not yet call open, let's do it now

/**
                         * @param {object} keysListItem
                         * @param {ArrayBuffer} keyMessage
                         * @returns {ArrayBuffer} Challenge data posted to license server
                         */

/*
                                 if (this.licenseType !== this.LICENSE_TYPE_WIDEVINE) {
                                 // For PlayReady CDMs, we need to dig the Challenge out of the XML.
                                 var keyMessageXml = new DOMParser().parseFromString(String.fromCharCode.apply(null, new Uint16Array(keyMessage)), 'application/xml');
                                 if (keyMessageXml.getElementsByTagName('Challenge')[0]) {
                                 challenge = atob(keyMessageXml.getElementsByTagName('Challenge')[0].childNodes[0].nodeValue);
                                 } else {
                                 throw 'Cannot find <Challenge> in key message';
                                 }
                                 var headerNames = keyMessageXml.getElementsByTagName('name');
                                 var headerValues = keyMessageXml.getElementsByTagName('value');
                                 if (headerNames.length !== headerValues.length) {
                                 throw 'Mismatched header <name>/<value> pair in key message';
                                 }
                                 for (var i = 0; i < headerNames.length; i++) {
                                 xhr.setRequestHeader(headerNames[i].childNodes[0].nodeValue, headerValues[i].childNodes[0].nodeValue);
                                 }
                                 }
                                 */

/*! http://mths.be/endswith v0.2.0 by @mathias */

//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

/**
             * Object containing the current content video metadata.
             * @typedef {Object} contentVideoState
             * @property {Array} abrInfo - Contains an array of objects with nominal info about how many levels there are.
             * @property {String} assetURL - URL of the video asset.
             * @property {String} audioPreviewImageUrl - URL of the audio preview image.
             * @property {String} category - From the Platform metadata of RCO.
             * @property {String} cdn - The Content Distribution Network for the current video, typically 'akamai' or 'akamai_hd'.
             * @property {Array} chapterStartTimes - array of chapter start times in seconds.
             * @property {String} closedCaptionDivName - element ID of the closed Captions div
             * @property {String} closedCaptionPath - URL of the closed captions sidecar file.
             * @property {String} closedCaptionType - tbd
             * @property {String} cms - Current Content Management Server.
             * @property {String} cmsRefGuid - platfrom 'guid' prop or RCO cmsRefGuid property.
             * @property {String} contentType - BU-specific label
             * @property {Object} contextMetadata - arbitrary set of name/value pairs supplied by user (in resource cfg)
             * @property {String} contPlayState - Continuous Play State from previdus video, '', 'endcard' or 'endcard_click'.
             * @property {String} copyright - from Platform metadata or RCO
             * @property {Number} defaultBitrate - 0,
             * @property {String} deliveryType - uvpjs.mediaCapabilities.PROGRESSIVE or uvpjs.mediaCapabilities.STREAMING
             * @property {String} dfpMediaId - the content video id to be used for ad calls
             * @property {Number} duration - Video duration in seconds.
             * @property {Number} endTime - Video end time in seconds.
             * @property {String} episodeAbstract - from Platform metadata or RCO.
             * @property {Boolean} episodeFlag - from Platform metadata or RCO.
             * @property {String} episodeNumber - from Platform metadata or RCO.
             * @property {String} episodeTitle - from Platform metadata or RCO.
             * @property {String} excludeNielsenTracking - from Platform; default false
             * @property {String} fileType - 'm3u', 'mp4', .
             * @property {Boolean} isAffiliateFeed - false,
             * @property {Boolean} isEmbedable - false,
             * @property {Boolean} isGeoRestricted - false,
             * @property {Boolean} isLive - false,
             * @property {Boolean} isPaidContent - false,
             * @property {Boolean} isResumed - false,
             * @property {Boolean} isFlash - false Set to TRUE if using UVP Flash
             * @property {String} keywords - from Platform metadata.
             * @property {String} mediaId - from Platform metadata.
             * @property {String} overrideAssetURL - Override asset URL used for dynamic variant playlists.
             * @property {String} ozTamMediaId - Media Id specific to OzTam Tracking
             * @property {Boolean} ozTamOptOut - Flag to opt out of OzTam Tracking
             * @property {String} pid - Platform Public ID.
             * @property {String} restrictionCheckResult.
             * @property {Boolean} sendResumeEvent used in local and global resume cases.
             * @property {Number} elapsedTime - Integer seconds. If not available default to zero.
             * @property {Boolean} showPreroll: false - Boolean. Never show preroll in global resume case. Default true.
             * @property {Number} playedChapterTime - Integer seconds. Derive this from Platform Chapter times or IMA cue points.
             * @property {String} previousSessionId - String, MD5 hash session ID.
             * @property {String} seasonNumber - from Platform metadata.
             * @property {String} seriesTitle - from Platform metadata.
             * @property {Number} sourceHeight - 0.
             * @property {String} sourceOwner.
             * @property {Number} sourceWidth - 0.
             * @property {Number} startTime - 0.
             * @property {Boolean} useWatermark - false.
             * @property {String} videoTitle
             * @property {Boolean} is360 - false.
             * @public
             */

// Sent when Safari has proccessed an HLS manifest using FairPlay and needs to acquire a license key

/*
         SWFObject v2.3.20130521 http://github.com/swfobject/swfobject
         Released under the MIT License http://www.opensource.org/licenses/mit-license
         */

/**
             * Extracts/builds license server URL & content id.
             * Registers WebKitMediaKeys with correct Key System(com.apple.fps.1_0)
             * Creates webkitKeys sessions and pass in the combined initData(initData, contentId, appCertData)
             * Registers event handlers on the keySession
             *
             * @memberof uvpjs.FairPlayDRM#
             */

/**
             * When FairPlay CDM is ready, build the SPC payload and send it to license server to get CKC for playback
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {String} url URL of license server to send SPC to, for Irdecto, usually at the /getckc path
             * @param {Object} event Event object
             */

/**
             * Parses the FairPlay initData and constructs a license server URL.  If there is a value set for this.drm.fairplay.licenseURL - we override what is in the initData and LA URL in manifest!!
             * skd:// is swapped to https://
             * If sessionID or ticket are set on the contentVideoState.drm they are appened to the URL
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {Uint16Array} initData Inititialization data from webkitneedkey, usually contains the URI from HLS manifest
             * @returns {String} URL for the license server, this is usually a /getckc URL for Irdeto
             */

/**
             * Extracts the ContentId value from a license server URL
             *
             * @memberof uvpjs.FairPlayDRM#
             * @param {String} licenseServerUrl License server URL
             * @returns {String} Content Id value for Irdeto || assetId for DRMToday
             */

!function(){var t,e;(function(){function e(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function i(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function s(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function n(t,e){for(var i=-1,s=null==t?0:t.length,n=0,a=[];++i<s;){var r=t[i];e(r,i,t)&&(a[n++]=r)}return a}function a(t,e){return!!(null==t?0:t.length)&&p(t,e,0)>-1}function r(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function o(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function d(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function l(t,e,i,s){var n=-1,a=null==t?0:t.length;for(s&&a&&(i=t[++n]);++n<a;)i=e(i,t[n],n,t);return i}function u(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}function h(t){return t.split("")}function c(t,e,i,s){for(var n=t.length,a=i+(s?1:-1);s?a--:++a<n;)if(e(t[a],a,t))return a;return-1}function p(t,e,i){return e===e?O(t,e,i):c(t,g,i)}function v(t,e,i,s){for(var n=i-1,a=t.length;++n<a;)if(s(t[n],e))return n;return-1}function g(t){return t!==t}function f(t){return function(e){return null==e?xs:e[t]}}function _(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}function E(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}function A(t){return function(e){return t(e)}}function m(t,e){return o(e,function(e){return t[e]})}function y(t,e){return t.has(e)}function S(t,e){for(var i=t.length,s=0;i--;)t[i]===e&&++s;return s}function D(t){return"\\"+wa[t]}function T(t,e){return null==t?xs:t[e]}function I(t){return Oa.test(t)}function b(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}function C(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}function R(t,e){return function(i){return t(e(i))}}function P(t,e){for(var i=-1,s=t.length,n=0,a=[];++i<s;){var r=t[i];r!==e&&r!==Ws||(t[i]=Ws,a[n++]=i)}return a}function M(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function O(t,e,i){for(var s=i-1,n=t.length;++s<n;)if(t[s]===e)return s;return-1}function L(t){return I(t)?k(t):Ja(t)}function N(t){return I(t)?U(t):h(t)}function k(t){for(var e=Ma.lastIndex=0;Ma.test(t);)++e;return e}function U(t){return t.match(Ma)||[]}function w(t){if(ss(t)&&!ho(t)&&!(t instanceof F)){if(t instanceof j)return t;if(sr.call(t,"__wrapped__"))return Ei(t)}return new j(t)}function B(){}function j(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=xs}function F(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=fn,this.__views__=[]}function G(){var t=new F(this.__wrapped__);return t.__actions__=De(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=De(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=De(this.__views__),t}function V(){if(this.__filtered__){var t=new F(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function x(){var t=this.__wrapped__.value(),e=this.__dir__,i=ho(t),s=e<0,n=i?t.length:0,a=Ye(0,n,this.__views__),r=a.start,o=a.end,d=o-r,l=s?o:r-1,u=this.__iteratees__,h=u.length,c=0,p=Cr(d,this.__takeCount__);if(!i||!s&&n==d&&p==d)return ue(t,this.__actions__);var v=[];t:for(;d--&&c<p;){l+=e;for(var g=-1,f=t[l];++g<h;){var _=u[g],E=_.iteratee,A=_.type,m=E(f);if(A==hn)f=m;else if(!m){if(A==un)continue t;break t}}v[c++]=f}return v}function H(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function K(){this.__data__=Ur?Ur(null):{},this.size=0}function Y(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function W(t){var e=this.__data__;if(Ur){var i=e[t];return i===Ys?xs:i}return sr.call(e,t)?e[t]:xs}function z(t){var e=this.__data__;return Ur?e[t]!==xs:sr.call(e,t)}function q(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Ur&&e===xs?Ys:e,this}function X(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function J(){this.__data__=[],this.size=0}function Q(t){var e=this.__data__,i=Et(e,t);return!(i<0||(i==e.length-1?e.pop():fr.call(e,i,1),--this.size,0))}function Z(t){var e=this.__data__,i=Et(e,t);return i<0?xs:e[i][1]}function $(t){return Et(this.__data__,t)>-1}function tt(t,e){var i=this.__data__,s=Et(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this}function et(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function it(){this.size=0,this.__data__={hash:new H,map:new(Or||X),string:new H}}function st(t){var e=Ve(this,t).delete(t);return this.size-=e?1:0,e}function nt(t){return Ve(this,t).get(t)}function at(t){return Ve(this,t).has(t)}function rt(t,e){var i=Ve(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this}function ot(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new et;++e<i;)this.add(t[e])}function dt(t){return this.__data__.set(t,Ys),this}function lt(t){return this.__data__.has(t)}function ut(t){var e=this.__data__=new X(t);this.size=e.size}function ht(){this.__data__=new X,this.size=0}function ct(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function pt(t){return this.__data__.get(t)}function vt(t){return this.__data__.has(t)}function gt(t,e){var i=this.__data__;if(i instanceof X){var s=i.__data__;if(!Or||s.length<Hs-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new et(s)}return i.set(t,e),this.size=i.size,this}function ft(t,e){var i=ho(t),s=!i&&uo(t),n=!i&&!s&&co(t),a=!i&&!s&&!n&&fo(t),r=i||s||n||a,o=r?E(t.length,String):[],d=o.length;for(var l in t)!e&&!sr.call(t,l)||r&&("length"==l||n&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||$e(l,d))||o.push(l);return o}function _t(t,e,i){var s=t[e];sr.call(t,e)&&qi(s,i)&&(i!==xs||e in t)||yt(t,e,i)}function Et(t,e){for(var i=t.length;i--;)if(qi(t[i][0],e))return i;return-1}function At(t,e){return t&&Te(e,ms(e),t)}function mt(t,e){return t&&Te(e,ys(e),t)}function yt(t,e,i){"__proto__"==e&&mr?mr(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function St(t,e){for(var i=-1,s=e.length,n=Array(s),a=null==t;++i<s;)n[i]=a?xs:_s(t,e[i]);return n}function Dt(t,e,i){return t===t&&(i!==xs&&(t=t<=i?t:i),e!==xs&&(t=t>=e?t:e)),t}function Tt(t,e,s,n,a,r){var o,d=e&zs,l=e&qs,u=e&Xs;if(s&&(o=a?s(t,n,a,r):s(t)),o!==xs)return o;if(!is(t))return t;var h=ho(t);if(h){if(o=qe(t),!d)return De(t,o)}else{var c=to(t),p=c==In||c==bn;if(co(t))return pe(t,d);if(c==Mn||c==En||p&&!a){if(o=l||p?{}:Xe(t),!d)return l?be(t,mt(o,t)):Ie(t,At(o,t))}else{if(!ka[c])return a?t:{};o=Je(t,c,d)}}r||(r=new ut);var v=r.get(t);if(v)return v;if(r.set(t,o),go(t))return t.forEach(function(i){o.add(Tt(i,e,s,i,t,r))}),o;if(vo(t))return t.forEach(function(i,n){o.set(n,Tt(i,e,s,n,t,r))}),o;var g=u?l?Be:we:l?ys:ms,f=h?xs:g(t);return i(f||t,function(i,n){f&&(n=i,i=t[n]),_t(o,n,Tt(i,e,s,n,t,r))}),o}function It(t,e,i,s){var n=-1,d=a,l=!0,u=t.length,h=[],c=e.length;if(!u)return h;i&&(e=o(e,A(i))),s?(d=r,l=!1):e.length>=Hs&&(d=y,l=!1,e=new ot(e));t:for(;++n<u;){var p=t[n],v=null==i?p:i(p);if(p=s||0!==p?p:0,l&&v===v){for(var g=c;g--;)if(e[g]===v)continue t;h.push(p)}else d(e,v,s)||h.push(p)}return h}function bt(t,e){var i=!0;return zr(t,function(t,s,n){return i=!!e(t,s,n)}),i}function Ct(t,e,i){for(var s=-1,n=t.length;++s<n;){var a=t[s],r=e(a);if(null!=r&&(o===xs?r===r&&!ls(r):i(r,o)))var o=r,d=a}return d}function Rt(t,e,i,s,n){var a=-1,r=t.length;for(i||(i=Ze),n||(n=[]);++a<r;){var o=t[a];e>0&&i(o)?e>1?Rt(o,e-1,i,s,n):d(n,o):s||(n[n.length]=o)}return n}function Pt(t,e){return t&&qr(t,e,ms)}function Mt(t,e){return n(e,function(e){return ts(t[e])})}function Ot(t,e){e=he(e,t);for(var i=0,s=e.length;null!=t&&i<s;)t=t[gi(e[i++])];return i&&i==s?t:xs}function Lt(t,e,i){var s=e(t);return ho(t)?s:d(s,i(t))}function Nt(t){return null==t?t===xs?wn:Pn:Ar&&Ar in Object(t)?Ke(t):li(t)}function kt(t,e){return null!=t&&sr.call(t,e)}function Ut(t,e){return null!=t&&e in Object(t)}function wt(t,e,i){return t>=Cr(e,i)&&t<br(e,i)}function Bt(t,i,s){i=he(i,t),t=hi(t,i);var n=null==t?t:t[gi(Ti(i))];return null==n?xs:e(n,t,s)}function jt(t){return ss(t)&&Nt(t)==En}function Ft(t){return ss(t)&&Nt(t)==Sn}function Gt(t,e,i,s,n){return t===e||(null==t||null==e||!ss(t)&&!ss(e)?t!==t&&e!==e:Vt(t,e,i,s,Gt,n))}function Vt(t,e,i,s,n,a){var r=ho(t),o=ho(e),d=r?An:to(t),l=o?An:to(e);d=d==En?Mn:d,l=l==En?Mn:l;var u=d==Mn,h=l==Mn,c=d==l;if(c&&co(t)){if(!co(e))return!1;r=!0,u=!1}if(c&&!u)return a||(a=new ut),r||fo(t)?Ne(t,e,i,s,n,a):ke(t,e,d,i,s,n,a);if(!(i&Js)){var p=u&&sr.call(t,"__wrapped__"),v=h&&sr.call(e,"__wrapped__");if(p||v){var g=p?t.value():t,f=v?e.value():e;return a||(a=new ut),n(g,f,i,s,a)}}return!!c&&(a||(a=new ut),Ue(t,e,i,s,n,a))}function xt(t){return ss(t)&&to(t)==Cn}function Ht(t,e,i,s){var n=i.length,a=n,r=!s;if(null==t)return!a;for(t=Object(t);n--;){var o=i[n];if(r&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<a;){o=i[n];var d=o[0],l=t[d],u=o[1];if(r&&o[2]){if(l===xs&&!(d in t))return!1}else{var h=new ut;if(s)var c=s(l,u,d,t,e,h);if(!(c===xs?Gt(u,l,Js|Qs,s,h):c))return!1}}return!0}function Kt(t){return!(!is(t)||ni(t))&&(ts(t)?dr:fa).test(fi(t))}function Yt(t){return ss(t)&&to(t)==Nn}function Wt(t){return ss(t)&&es(t.length)&&!!Na[Nt(t)]}function zt(t){return"function"==typeof t?t:null==t?Ns:"object"==typeof t?ho(t)?$t(t[0],t[1]):Zt(t):js(t)}function qt(t){if(!ai(t))return Ir(t);var e=[];for(var i in Object(t))sr.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Xt(t){if(!is(t))return di(t);var e=ai(t),i=[];for(var s in t)("constructor"!=s||!e&&sr.call(t,s))&&i.push(s);return i}function Jt(t,e){return t<e}function Qt(t,e){var i=-1,s=Xi(t)?Array(t.length):[];return zr(t,function(t,n,a){s[++i]=e(t,n,a)}),s}function Zt(t){var e=xe(t);return 1==e.length&&e[0][2]?oi(e[0][0],e[0][1]):function(i){return i===t||Ht(i,t,e)}}function $t(t,e){return ei(t)&&ri(e)?oi(gi(t),e):function(i){var s=_s(i,t);return s===xs&&s===e?As(i,t):Gt(e,s,Js|Qs)}}function te(t,e,i){var s=-1;return e=o(e.length?e:[Ns],A(Ge())),_(Qt(t,function(t,i,n){return{criteria:o(e,function(e){return e(t)}),index:++s,value:t}}),function(t,e){return me(t,e,i)})}function ee(t,e,i){for(var s=-1,n=e.length,a={};++s<n;){var r=e[s],o=Ot(t,r);i(o,r)&&re(a,he(r,t),o)}return a}function ie(t){return function(e){return Ot(e,t)}}function se(t,e,i,s){var n=s?v:p,a=-1,r=e.length,d=t;for(t===e&&(e=De(e)),i&&(d=o(t,A(i)));++a<r;)for(var l=0,u=e[a],h=i?i(u):u;(l=n(d,h,l,s))>-1;)d!==t&&fr.call(d,l,1),fr.call(t,l,1);return t}function ne(t,e){var i="";if(!t||e<1||e>pn)return i;do{e%2&&(i+=t),(e=Sr(e/2))&&(t+=t)}while(e);return i}function ae(t,e){return io(ui(t,e,Ns),t+"")}function re(t,e,i,s){if(!is(t))return t;e=he(e,t);for(var n=-1,a=e.length,r=a-1,o=t;null!=o&&++n<a;){var d=gi(e[n]),l=i;if(n!=r){var u=o[d];(l=s?s(u,d,o):xs)===xs&&(l=is(u)?u:$e(e[n+1])?[]:{})}_t(o,d,l),o=o[d]}return t}function oe(t,e,i){var s=-1,n=t.length;e<0&&(e=-e>n?0:n+e),i=i>n?n:i,i<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(n);++s<n;)a[s]=t[s+e];return a}function de(t,e){var i;return zr(t,function(t,s,n){return!(i=e(t,s,n))}),!!i}function le(t){if("string"==typeof t)return t;if(ho(t))return o(t,le)+"";if(ls(t))return Yr?Yr.call(t):"";var e=t+"";return"0"==e&&1/t==-cn?"-0":e}function ue(t,e){var i=t;return i instanceof F&&(i=i.value()),l(e,function(t,e){return e.func.apply(e.thisArg,d([t],e.args))},i)}function he(t,e){return ho(t)?t:ei(t,e)?[t]:so(gs(t))}function ce(t,e,i){var s=t.length;return i=i===xs?s:i,!e&&i>=s?t:oe(t,e,i)}function pe(t,e){if(e)return t.slice();var i=t.length,s=cr?cr(i):new t.constructor(i);return t.copy(s),s}function ve(t){var e=new t.constructor(t.byteLength);return new hr(e).set(new hr(t)),e}function ge(t,e){var i=e?ve(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function fe(t){var e=new t.constructor(t.source,pa.exec(t));return e.lastIndex=t.lastIndex,e}function _e(t){return Kr?Object(Kr.call(t)):{}}function Ee(t,e){var i=e?ve(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function Ae(t,e){if(t!==e){var i=t!==xs,s=null===t,n=t===t,a=ls(t),r=e!==xs,o=null===e,d=e===e,l=ls(e);if(!o&&!l&&!a&&t>e||a&&r&&d&&!o&&!l||s&&r&&d||!i&&d||!n)return 1;if(!s&&!a&&!l&&t<e||l&&i&&n&&!s&&!a||o&&i&&n||!r&&n||!d)return-1}return 0}function me(t,e,i){for(var s=-1,n=t.criteria,a=e.criteria,r=n.length,o=i.length;++s<r;){var d=Ae(n[s],a[s]);if(d)return s>=o?d:d*("desc"==i[s]?-1:1)}return t.index-e.index}function ye(t,e,i,s){for(var n=-1,a=t.length,r=i.length,o=-1,d=e.length,l=br(a-r,0),u=Array(d+l),h=!s;++o<d;)u[o]=e[o];for(;++n<r;)(h||n<a)&&(u[i[n]]=t[n]);for(;l--;)u[o++]=t[n++];return u}function Se(t,e,i,s){for(var n=-1,a=t.length,r=-1,o=i.length,d=-1,l=e.length,u=br(a-o,0),h=Array(u+l),c=!s;++n<u;)h[n]=t[n];for(var p=n;++d<l;)h[p+d]=e[d];for(;++r<o;)(c||n<a)&&(h[p+i[r]]=t[n++]);return h}function De(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}function Te(t,e,i,s){var n=!i;i||(i={});for(var a=-1,r=e.length;++a<r;){var o=e[a],d=s?s(i[o],t[o],o,i,t):xs;d===xs&&(d=t[o]),n?yt(i,o,d):_t(i,o,d)}return i}function Ie(t,e){return Te(t,Zr(t),e)}function be(t,e){return Te(t,$r(t),e)}function Ce(t){return ae(function(e,i){var s=-1,n=i.length,a=n>1?i[n-1]:xs,r=n>2?i[2]:xs;for(a=t.length>3&&"function"==typeof a?(n--,a):xs,r&&ti(i[0],i[1],r)&&(a=n<3?xs:a,n=1),e=Object(e);++s<n;){var o=i[s];o&&t(e,o,s,a)}return e})}function Re(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Wr(t.prototype),s=t.apply(i,e);return is(s)?s:i}}function Pe(t,e,i,s,n,a,r,o,d,l){function u(){for(var _=arguments.length,E=Array(_),A=_;A--;)E[A]=arguments[A];if(v)var m=Fe(u),y=S(E,m);if(s&&(E=ye(E,s,n,v)),a&&(E=Se(E,a,r,v)),_-=y,v&&_<l){var D=P(E,m);return Oe(t,e,Pe,u.placeholder,i,E,D,o,d,l-_)}var T=c?i:this,I=p?T[t]:t;return _=E.length,o?E=ci(E,o):g&&_>1&&E.reverse(),h&&d<_&&(E.length=d),this&&this!==Ga&&this instanceof u&&(I=f||Re(I)),I.apply(T,E)}var h=e&rn,c=e&Zs,p=e&$s,v=e&(en|sn),g=e&on,f=p?xs:Re(t);return u}function Me(t,e){e=e===xs?" ":le(e);var i=e.length;if(i<2)return i?ne(e,t):e;var s=ne(e,yr(t/L(e)));return I(e)?ce(N(s),0,t).join(""):s.slice(0,t)}function Oe(t,e,i,s,n,a,r,o,d,l){var u=e&en,h=u?r:xs,c=u?xs:r,p=u?a:xs,v=u?xs:a;e|=u?nn:an,(e&=~(u?an:nn))&tn||(e&=~(Zs|$s));var g=[t,e,n,p,h,v,c,o,d,l],f=i.apply(xs,g);return si(t)&&eo(f,g),f.placeholder=s,pi(f,t,e)}function Le(t,e,i,s){return t===xs||qi(t,tr[i])&&!sr.call(s,i)?e:t}function Ne(t,e,i,s,n,a){var r=i&Js,o=t.length,d=e.length;if(o!=d&&!(r&&d>o))return!1;var l=a.get(t);if(l&&a.get(e))return l==e;var h=-1,c=!0,p=i&Qs?new ot:xs;for(a.set(t,e),a.set(e,t);++h<o;){var v=t[h],g=e[h];if(s)var f=r?s(g,v,h,e,t,a):s(v,g,h,t,e,a);if(f!==xs){if(f)continue;c=!1;break}if(p){if(!u(e,function(t,e){if(!y(p,e)&&(v===t||n(v,t,i,s,a)))return p.push(e)})){c=!1;break}}else if(v!==g&&!n(v,g,i,s,a)){c=!1;break}}return a.delete(t),a.delete(e),c}function ke(t,e,i,s,n,a,r){switch(i){case Fn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case jn:return!(t.byteLength!=e.byteLength||!a(new hr(t),new hr(e)));case yn:case Sn:case Rn:return qi(+t,+e);case Tn:return t.name==e.name&&t.message==e.message;case Ln:case kn:return t==e+"";case Cn:var o=C;case Nn:var d=s&Js;if(o||(o=M),t.size!=e.size&&!d)return!1;var l=r.get(t);if(l)return l==e;s|=Qs,r.set(t,e);var u=Ne(o(t),o(e),s,n,a,r);return r.delete(t),u;case Un:if(Kr)return Kr.call(t)==Kr.call(e)}return!1}function Ue(t,e,i,s,n,a){var r=i&Js,o=we(t),d=o.length;if(d!=we(e).length&&!r)return!1;for(var l=d;l--;){var u=o[l];if(!(r?u in e:sr.call(e,u)))return!1}var h=a.get(t);if(h&&a.get(e))return h==e;var c=!0;a.set(t,e),a.set(e,t);for(var p=r;++l<d;){u=o[l];var v=t[u],g=e[u];if(s)var f=r?s(g,v,u,e,t,a):s(v,g,u,t,e,a);if(!(f===xs?v===g||n(v,g,i,s,a):f)){c=!1;break}p||(p="constructor"==u)}if(c&&!p){var _=t.constructor,E=e.constructor;_!=E&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof E&&E instanceof E)&&(c=!1)}return a.delete(t),a.delete(e),c}function we(t){return Lt(t,ms,Zr)}function Be(t){return Lt(t,ys,$r)}function je(t){for(var e=t.name+"",i=Br[e],s=sr.call(Br,e)?i.length:0;s--;){var n=i[s],a=n.func;if(null==a||a==t)return n.name}return e}function Fe(t){return(sr.call(w,"placeholder")?w:t).placeholder}function Ge(){var t=w.iteratee||ks;return t=t===ks?zt:t,arguments.length?t(arguments[0],arguments[1]):t}function Ve(t,e){var i=t.__data__;return ii(e)?i["string"==typeof e?"string":"hash"]:i.map}function xe(t){for(var e=ms(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,ri(n)]}return e}function He(t,e){var i=T(t,e);return Kt(i)?i:xs}function Ke(t){var e=sr.call(t,Ar),i=t[Ar];try{t[Ar]=xs;var s=!0}catch(t){}var n=ar.call(t);return s&&(e?t[Ar]=i:delete t[Ar]),n}function Ye(t,e,i){for(var s=-1,n=i.length;++s<n;){var a=i[s],r=a.size;switch(a.type){case"drop":t+=r;break;case"dropRight":e-=r;break;case"take":e=Cr(e,t+r);break;case"takeRight":t=br(t,e-r)}}return{start:t,end:e}}function We(t){var e=t.match(la);return e?e[1].split(ua):[]}function ze(t,e,i){e=he(e,t);for(var s=-1,n=e.length,a=!1;++s<n;){var r=gi(e[s]);if(!(a=null!=t&&i(t,r)))break;t=t[r]}return a||++s!=n?a:!!(n=null==t?0:t.length)&&es(n)&&$e(r,n)&&(ho(t)||uo(t))}function qe(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&sr.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function Xe(t){return"function"!=typeof t.constructor||ai(t)?{}:Wr(pr(t))}function Je(t,e,i){var s=t.constructor;switch(e){case jn:return ve(t);case yn:case Sn:return new s(+t);case Fn:return ge(t,i);case Gn:case Vn:case xn:case Hn:case Kn:case Yn:case Wn:case zn:case qn:return Ee(t,i);case Cn:return new s;case Rn:case kn:return new s(t);case Ln:return fe(t);case Nn:return new s;case Un:return _e(t)}}function Qe(t,e){var i=e.length;if(!i)return t;var s=i-1;return e[s]=(i>1?"& ":"")+e[s],e=e.join(i>2?", ":" "),t.replace(da,"{\n/* [wrapped with "+e+"] */\n")}function Ze(t){return ho(t)||uo(t)||!!(_r&&t&&t[_r])}function $e(t,e){var i=typeof t;return!!(e=null==e?pn:e)&&("number"==i||"symbol"!=i&&Ea.test(t))&&t>-1&&t%1==0&&t<e}function ti(t,e,i){if(!is(i))return!1;var s=typeof e;return!!("number"==s?Xi(i)&&$e(e,i.length):"string"==s&&e in i)&&qi(i[e],t)}function ei(t,e){if(ho(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ls(t))||na.test(t)||!sa.test(t)||null!=e&&t in Object(e)}function ii(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function si(t){var e=je(t),i=w[e];if("function"!=typeof i||!(e in F.prototype))return!1;if(t===i)return!0;var s=Qr(i);return!!s&&t===s[0]}function ni(t){return!!nr&&nr in t}function ai(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||tr)}function ri(t){return t===t&&!is(t)}function oi(t,e){return function(i){return null!=i&&i[t]===e&&(e!==xs||t in Object(i))}}function di(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}function li(t){return ar.call(t)}function ui(t,i,s){return i=br(i===xs?t.length-1:i,0),function(){for(var n=arguments,a=-1,r=br(n.length-i,0),o=Array(r);++a<r;)o[a]=n[i+a];a=-1;for(var d=Array(i+1);++a<i;)d[a]=n[a];return d[i]=s(o),e(t,this,d)}}function hi(t,e){return e.length<2?t:Ot(t,oe(e,0,-1))}function ci(t,e){for(var i=t.length,s=Cr(e.length,i),n=De(t);s--;){var a=e[s];t[s]=$e(a,i)?n[a]:xs}return t}function pi(t,e,i){var s=e+"";return io(t,Qe(s,_i(We(s),i)))}function vi(t){var e=0,i=0;return function(){var s=Rr(),n=ln-(s-i);if(i=s,n>0){if(++e>=dn)return arguments[0]}else e=0;return t.apply(xs,arguments)}}function gi(t){if("string"==typeof t||ls(t))return t;var e=t+"";return"0"==e&&1/t==-cn?"-0":e}function fi(t){if(null!=t){try{return ir.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function _i(t,e){return i(_n,function(i){var s="_."+i[0];e&i[1]&&!a(t,s)&&t.push(s)}),t.sort()}function Ei(t){if(t instanceof F)return t.clone();var e=new j(t.__wrapped__,t.__chain__);return e.__actions__=De(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Ai(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var a=t[e];a&&(n[s++]=a)}return n}function mi(t,e,i){var s=null==t?0:t.length;return s?(e=i||e===xs?1:ps(e),oe(t,e<0?0:e,s)):[]}function yi(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:ps(i);return n<0&&(n=br(s+n,0)),c(t,Ge(e,3),n)}function Si(t){return(null==t?0:t.length)?Rt(t,1):[]}function Di(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=null==i?0:ps(i);return n<0&&(n=br(s+n,0)),p(t,e,n)}function Ti(t){var e=null==t?0:t.length;return e?t[e-1]:xs}function Ii(t,e){return t&&t.length&&e&&e.length?se(t,e):t}function bi(t){return null==t?t:Pr.call(t)}function Ci(t){var e=w(t);return e.__chain__=!0,e}function Ri(t,e){return e(t),t}function Pi(t,e){return e(t)}function Mi(){return Ci(this)}function Oi(){return new j(this.value(),this.__chain__)}function Li(){this.__values__===xs&&(this.__values__=hs(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?xs:this.__values__[this.__index__++]}}function Ni(){return this}function ki(t){for(var e,i=this;i instanceof B;){var s=Ei(i);s.__index__=0,s.__values__=xs,e?n.__wrapped__=s:e=s;var n=s;i=i.__wrapped__}return n.__wrapped__=t,e}function Ui(){var t=this.__wrapped__;if(t instanceof F){var e=t;return this.__actions__.length&&(e=new F(this)),e=e.reverse(),e.__actions__.push({func:Pi,args:[bi],thisArg:xs}),new j(e,this.__chain__)}return this.thru(bi)}function wi(){return ue(this.__wrapped__,this.__actions__)}function Bi(t,e,i){var n=ho(t)?s:bt;return i&&ti(t,e,i)&&(e=xs),n(t,Ge(e,3))}function ji(t,e){return(ho(t)?i:zr)(t,Ge(e,3))}function Fi(t,e,i,s){t=Xi(t)?t:Ts(t),i=i&&!s?ps(i):0;var n=t.length;return i<0&&(i=br(n+i,0)),ds(t)?i<=n&&t.indexOf(e,i)>-1:!!n&&p(t,e,i)>-1}function Gi(t,e){return(ho(t)?o:Qt)(t,Ge(e,3))}function Vi(t,e,i){var s=ho(t)?u:de;return i&&ti(t,e,i)&&(e=xs),s(t,Ge(e,3))}function xi(t,e,i){function s(e){var i=c,s=p;return c=p=xs,E=e,g=t.apply(s,i)}function n(t){return E=t,f=setTimeout(o,e),A?s(t):g}function a(t){var i=t-_,s=t-E,n=e-i;return m?Cr(n,v-s):n}function r(t){var i=t-_,s=t-E;return _===xs||i>=e||i<0||m&&s>=v}function o(){var t=lo();if(r(t))return d(t);f=setTimeout(o,a(t))}function d(t){return f=xs,y&&c?s(t):(c=p=xs,g)}function l(){f!==xs&&clearTimeout(f),E=0,c=_=p=f=xs}function u(){return f===xs?g:d(lo())}function h(){var t=lo(),i=r(t);if(c=arguments,p=this,_=t,i){if(f===xs)return n(_);if(m)return f=setTimeout(o,e),s(_)}return f===xs&&(f=setTimeout(o,e)),g}var c,p,v,g,f,_,E=0,A=!1,m=!1,y=!0;if("function"!=typeof t)throw new TypeError(Ks);return e=vs(e)||0,is(i)&&(A=!!i.leading,m="maxWait"in i,v=m?br(vs(i.maxWait)||0,e):v,y="trailing"in i?!!i.trailing:y),h.cancel=l,h.flush=u,h}function Hi(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Ks);var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],a=i.cache;if(a.has(n))return a.get(n);var r=t.apply(this,s);return i.cache=a.set(n,r)||a,r};return i.cache=new(Hi.Cache||et),i}function Ki(t){if("function"!=typeof t)throw new TypeError(Ks);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Yi(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new TypeError(Ks);return is(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),xi(t,e,{leading:s,maxWait:e,trailing:n})}function Wi(t){return Tt(t,Xs)}function zi(t){return Tt(t,zs|Xs)}function qi(t,e){return t===e||t!==t&&e!==e}function Xi(t){return null!=t&&es(t.length)&&!ts(t)}function Ji(t){return ss(t)&&Xi(t)}function Qi(t){return!0===t||!1===t||ss(t)&&Nt(t)==yn}function Zi(t){if(null==t)return!0;if(Xi(t)&&(ho(t)||"string"==typeof t||"function"==typeof t.splice||co(t)||fo(t)||uo(t)))return!t.length;var e=to(t);if(e==Cn||e==Nn)return!t.size;if(ai(t))return!qt(t).length;for(var i in t)if(sr.call(t,i))return!1;return!0}function $i(t){if(!ss(t))return!1;var e=Nt(t);return e==Tn||e==Dn||"string"==typeof t.message&&"string"==typeof t.name&&!os(t)}function ts(t){if(!is(t))return!1;var e=Nt(t);return e==In||e==bn||e==mn||e==On}function es(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=pn}function is(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ss(t){return null!=t&&"object"==typeof t}function ns(t){return rs(t)&&t!=+t}function as(t){return null===t}function rs(t){return"number"==typeof t||ss(t)&&Nt(t)==Rn}function os(t){if(!ss(t)||Nt(t)!=Mn)return!1;var e=pr(t);if(null===e)return!0;var i=sr.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&ir.call(i)==rr}function ds(t){return"string"==typeof t||!ho(t)&&ss(t)&&Nt(t)==kn}function ls(t){return"symbol"==typeof t||ss(t)&&Nt(t)==Un}function us(t){return t===xs}function hs(t){if(!t)return[];if(Xi(t))return ds(t)?N(t):De(t);if(Er&&t[Er])return b(t[Er]());var e=to(t);return(e==Cn?C:e==Nn?M:Ts)(t)}function cs(t){return t?(t=vs(t))===cn||t===-cn?(t<0?-1:1)*vn:t===t?t:0:0===t?t:0}function ps(t){var e=cs(t),i=e%1;return e===e?i?e-i:e:0}function vs(t){if("number"==typeof t)return t;if(ls(t))return gn;if(is(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=is(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(oa,"");var i=ga.test(t);return i||_a.test(t)?Ba(t.slice(2),i?2:8):va.test(t)?gn:+t}function gs(t){return null==t?"":le(t)}function fs(t,e){return t&&Pt(t,Ge(e,3))}function _s(t,e,i){var s=null==t?xs:Ot(t,e);return s===xs?i:s}function Es(t,e){return null!=t&&ze(t,e,kt)}function As(t,e){return null!=t&&ze(t,e,Ut)}function ms(t){return Xi(t)?ft(t):qt(t)}function ys(t){return Xi(t)?ft(t,!0):Xt(t)}function Ss(t,e){return Ds(t,Ki(Ge(e)))}function Ds(t,e){if(null==t)return{};var i=o(Be(t),function(t){return[t]});return e=Ge(e),ee(t,i,function(t,i){return e(t,i[0])})}function Ts(t){return null==t?[]:m(t,ms(t))}function Is(t,e,i){return e=cs(e),i===xs?(i=e,e=0):i=cs(i),t=vs(t),wt(t,e,i)}function bs(t){return mo(gs(t).toLowerCase())}function Cs(t,e,i){t=gs(t),e=le(e);var s=t.length;i=i===xs?s:Dt(ps(i),0,s);var n=i;return(i-=e.length)>=0&&t.slice(i,n)==e}function Rs(t){return t=gs(t),t&&$n.test(t)?t.replace(Zn,Qa):t}function Ps(t,e,i){t=gs(t),e=ps(e);var s=e?L(t):0;return e&&s<e?Me(e-s,i)+t:t}function Ms(t,e,i){return t=gs(t),i=null==i?0:Dt(ps(i),0,t.length),e=le(e),t.slice(i,i+e.length)==e}function Os(t,e,i){var s=w.templateSettings;i&&ti(t,e,i)&&(e=xs),t=gs(t),e=Ao({},e,s,Le);var n,a,r=Ao({},e.imports,s.imports,Le),o=ms(r),d=m(r,o),l=0,u=e.interpolate||Aa,h="__p += '",c=RegExp((e.escape||Aa).source+"|"+u.source+"|"+(u===ia?ca:Aa).source+"|"+(e.evaluate||Aa).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++La+"]")+"\n";t.replace(c,function(e,i,s,r,o,d){return s||(s=r),h+=t.slice(l,d).replace(ma,D),i&&(n=!0,h+="' +\n__e("+i+") +\n'"),o&&(a=!0,h+="';\n"+o+";\n__p += '"),s&&(h+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),l=d+e.length,e}),h+="';\n";var v=e.variable;v||(h="with (obj) {\n"+h+"\n}\n"),h=(a?h.replace(Xn,""):h).replace(Jn,"$1").replace(Qn,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=yo(function(){return Function(o,p+"return "+h).apply(xs,d)});if(g.source=h,$i(g))throw g;return g}function Ls(t){return function(){return t}}function Ns(t){return t}function ks(t){return zt("function"==typeof t?t:Tt(t,zs))}function Us(t,e,s){var n=ms(e),a=Mt(e,n);null!=s||is(e)&&(a.length||!n.length)||(s=e,e=t,t=this,a=Mt(e,ms(e)));var r=!(is(s)&&"chain"in s&&!s.chain),o=ts(t);return i(a,function(i){var s=e[i];t[i]=s,o&&(t.prototype[i]=function(){var e=this.__chain__;if(r||e){var i=t(this.__wrapped__);return(i.__actions__=De(this.__actions__)).push({func:s,args:arguments,thisArg:t}),i.__chain__=e,i}return s.apply(t,d([this.value()],arguments))})}),t}function ws(){return Ga._===this&&(Ga._=or),this}function Bs(){}function js(t){return ei(t)?f(gi(t)):ie(t)}function Fs(){return[]}function Gs(){return!1}function Vs(t){return t&&t.length?Ct(t,Ns,Jt):xs}var xs,Hs=200,Ks="Expected a function",Ys="__lodash_hash_undefined__",Ws="__lodash_placeholder__",zs=1,qs=2,Xs=4,Js=1,Qs=2,Zs=1,$s=2,tn=4,en=8,sn=16,nn=32,an=64,rn=128,on=512,dn=800,ln=16,un=1,hn=2,cn=1/0,pn=9007199254740991,vn=1.7976931348623157e308,gn=NaN,fn=4294967295,_n=[["ary",rn],["bind",Zs],["bindKey",$s],["curry",en],["curryRight",sn],["flip",on],["partial",nn],["partialRight",an],["rearg",256]],En="[object Arguments]",An="[object Array]",mn="[object AsyncFunction]",yn="[object Boolean]",Sn="[object Date]",Dn="[object DOMException]",Tn="[object Error]",In="[object Function]",bn="[object GeneratorFunction]",Cn="[object Map]",Rn="[object Number]",Pn="[object Null]",Mn="[object Object]",On="[object Proxy]",Ln="[object RegExp]",Nn="[object Set]",kn="[object String]",Un="[object Symbol]",wn="[object Undefined]",Bn="[object WeakMap]",jn="[object ArrayBuffer]",Fn="[object DataView]",Gn="[object Float32Array]",Vn="[object Float64Array]",xn="[object Int8Array]",Hn="[object Int16Array]",Kn="[object Int32Array]",Yn="[object Uint8Array]",Wn="[object Uint8ClampedArray]",zn="[object Uint16Array]",qn="[object Uint32Array]",Xn=/\b__p \+= '';/g,Jn=/\b(__p \+=) '' \+/g,Qn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Zn=/[&<>"']/g,$n=RegExp(Zn.source),ta=/<%-([\s\S]+?)%>/g,ea=/<%([\s\S]+?)%>/g,ia=/<%=([\s\S]+?)%>/g,sa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,na=/^\w*$/,aa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ra=/[\\^$.*+?()[\]{}|]/g,oa=/^\s+|\s+$/g,da=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,la=/\{\n\/\* \[wrapped with (.+)\] \*/,ua=/,? & /,ha=/\\(\\)?/g,ca=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pa=/\w*$/,va=/^[-+]0x[0-9a-f]+$/i,ga=/^0b[01]+$/i,fa=/^\[object .+?Constructor\]$/,_a=/^0o[0-7]+$/i,Ea=/^(?:0|[1-9]\d*)$/,Aa=/($^)/,ma=/['\n\r\u2028\u2029\\]/g,ya="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Sa="["+ya+"]",Da="\\ud83c[\\udffb-\\udfff]",Ta="(?:\\ud83c[\\udde6-\\uddff]){2}",Ia="[\\ud800-\\udbff][\\udc00-\\udfff]",ba="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Ca="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Ta,Ia].join("|")+")[\\ufe0e\\ufe0f]?"+ba+")*",Ra="[\\ufe0e\\ufe0f]?"+ba+Ca,Pa="(?:"+["[^\\ud800-\\udfff]"+Sa+"?",Sa,Ta,Ia,"[\\ud800-\\udfff]"].join("|")+")",Ma=RegExp(Da+"(?="+Da+")|"+Pa+Ra,"g"),Oa=RegExp("[\\u200d\\ud800-\\udfff"+ya+"\\ufe0e\\ufe0f]"),La=-1,Na={};Na[Gn]=Na[Vn]=Na[xn]=Na[Hn]=Na[Kn]=Na[Yn]=Na[Wn]=Na[zn]=Na[qn]=!0,Na[En]=Na[An]=Na[jn]=Na[yn]=Na[Fn]=Na[Sn]=Na[Tn]=Na[In]=Na[Cn]=Na[Rn]=Na[Mn]=Na[Ln]=Na[Nn]=Na[kn]=Na[Bn]=!1;var ka={};ka[En]=ka[An]=ka[jn]=ka[Fn]=ka[yn]=ka[Sn]=ka[Gn]=ka[Vn]=ka[xn]=ka[Hn]=ka[Kn]=ka[Cn]=ka[Rn]=ka[Mn]=ka[Ln]=ka[Nn]=ka[kn]=ka[Un]=ka[Yn]=ka[Wn]=ka[zn]=ka[qn]=!0,ka[Tn]=ka[In]=ka[Bn]=!1;var Ua={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},wa={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"
},Ba=parseInt,ja="object"==typeof global&&global&&global.Object===Object&&global,Fa="object"==typeof self&&self&&self.Object===Object&&self,Ga=ja||Fa||Function("return this")(),Va="object"==typeof exports&&exports&&!exports.nodeType&&exports,xa=Va&&"object"==typeof module&&module&&!module.nodeType&&module,Ha=xa&&xa.exports===Va,Ka=Ha&&ja.process,Ya=function(){try{return Ka&&Ka.binding&&Ka.binding("util")}catch(t){}}(),Wa=Ya&&Ya.isDate,za=Ya&&Ya.isMap,qa=Ya&&Ya.isSet,Xa=Ya&&Ya.isTypedArray,Ja=f("length"),Qa=function(t){return function(e){return null==t?xs:t[e]}}(Ua),Za=Array.prototype,$a=Function.prototype,tr=Object.prototype,er=Ga["__core-js_shared__"],ir=$a.toString,sr=tr.hasOwnProperty,nr=function(){var t=/[^.]+$/.exec(er&&er.keys&&er.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ar=tr.toString,rr=ir.call(Object),or=Ga._,dr=RegExp("^"+ir.call(sr).replace(ra,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lr=Ha?Ga.Buffer:xs,ur=Ga.Symbol,hr=Ga.Uint8Array,cr=lr?lr.allocUnsafe:xs,pr=R(Object.getPrototypeOf,Object),vr=Object.create,gr=tr.propertyIsEnumerable,fr=Za.splice,_r=ur?ur.isConcatSpreadable:xs,Er=ur?ur.iterator:xs,Ar=ur?ur.toStringTag:xs,mr=function(){try{var t=He(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),yr=Math.ceil,Sr=Math.floor,Dr=Object.getOwnPropertySymbols,Tr=lr?lr.isBuffer:xs,Ir=R(Object.keys,Object),br=Math.max,Cr=Math.min,Rr=Date.now,Pr=Za.reverse,Mr=He(Ga,"DataView"),Or=He(Ga,"Map"),Lr=He(Ga,"Promise"),Nr=He(Ga,"Set"),kr=He(Ga,"WeakMap"),Ur=He(Object,"create"),wr=kr&&new kr,Br={},jr=fi(Mr),Fr=fi(Or),Gr=fi(Lr),Vr=fi(Nr),xr=fi(kr),Hr=ur?ur.prototype:xs,Kr=Hr?Hr.valueOf:xs,Yr=Hr?Hr.toString:xs,Wr=function(){function t(){}return function(e){if(!is(e))return{};if(vr)return vr(e);t.prototype=e;var i=new t;return t.prototype=xs,i}}();w.templateSettings={escape:ta,evaluate:ea,interpolate:ia,variable:"",imports:{_:w}},w.prototype=B.prototype,w.prototype.constructor=w,j.prototype=Wr(B.prototype),j.prototype.constructor=j,F.prototype=Wr(B.prototype),F.prototype.constructor=F,H.prototype.clear=K,H.prototype.delete=Y,H.prototype.get=W,H.prototype.has=z,H.prototype.set=q,X.prototype.clear=J,X.prototype.delete=Q,X.prototype.get=Z,X.prototype.has=$,X.prototype.set=tt,et.prototype.clear=it,et.prototype.delete=st,et.prototype.get=nt,et.prototype.has=at,et.prototype.set=rt,ot.prototype.add=ot.prototype.push=dt,ot.prototype.has=lt,ut.prototype.clear=ht,ut.prototype.delete=ct,ut.prototype.get=pt,ut.prototype.has=vt,ut.prototype.set=gt;var zr=function(t,e){return function(e,i){if(null==e)return e;if(!Xi(e))return t(e,i);for(var s=e.length,n=-1,a=Object(e);++n<s&&!1!==i(a[n],n,a););return e}}(Pt),qr=function(t){return function(t,e,i){for(var s=-1,n=Object(t),a=i(t),r=a.length;r--;){var o=a[++s];if(!1===e(n[o],o,n))break}return t}}(),Xr=wr?function(t,e){return wr.set(t,e),t}:Ns,Jr=mr?function(t,e){return mr(t,"toString",{configurable:!0,enumerable:!1,value:Ls(e),writable:!0})}:Ns,Qr=wr?function(t){return wr.get(t)}:Bs,Zr=Dr?function(t){return null==t?[]:(t=Object(t),n(Dr(t),function(e){return gr.call(t,e)}))}:Fs,$r=Dr?function(t){for(var e=[];t;)d(e,Zr(t)),t=pr(t);return e}:Fs,to=Nt;(Mr&&to(new Mr(new ArrayBuffer(1)))!=Fn||Or&&to(new Or)!=Cn||Lr&&"[object Promise]"!=to(Lr.resolve())||Nr&&to(new Nr)!=Nn||kr&&to(new kr)!=Bn)&&(to=function(t){var e=Nt(t),i=e==Mn?t.constructor:xs,s=i?fi(i):"";if(s)switch(s){case jr:return Fn;case Fr:return Cn;case Gr:return"[object Promise]";case Vr:return Nn;case xr:return Bn}return e});var eo=vi(Xr),io=vi(Jr),so=function(t){var e=Hi(t,function(t){return 500===i.size&&i.clear(),t}),i=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(aa,function(t,i,s,n){e.push(s?n.replace(ha,"$1"):i||t)}),e}),no=ae(Ii),ao=ae(function(t,e){return Ji(t)?It(t,e):[]}),ro=(function(t){io(ui(t,xs,Si),t+"")}(function(t){var e=t.length,i=e?t[0]:0,s=this.__wrapped__,n=function(e){return St(e,t)};return!(e>1||this.__actions__.length)&&s instanceof F&&$e(i)?(s=s.slice(i,+i+(e?1:0)),s.__actions__.push({func:Pi,args:[n],thisArg:xs}),new j(s,this.__chain__).thru(function(t){return e&&!t.length&&t.push(xs),t})):this.thru(n)}),function(t){return function(e,i,s){var n=Object(e);if(!Xi(e)){var a=Ge(i,3);e=ms(e),i=function(t){return a(n[t],t,n)}}var r=t(e,i,s);return r>-1?n[a?e[r]:r]:xs}}(yi)),oo=ae(function(t,e){if(null==t)return[];var i=e.length;return i>1&&ti(t,e[0],e[1])?e=[]:i>2&&ti(e[0],e[1],e[2])&&(e=[e[0]]),te(t,Rt(e,1),[])}),lo=function(){return Ga.Date.now()};Hi.Cache=et;var uo=jt(function(){return arguments}())?jt:function(t){return ss(t)&&sr.call(t,"callee")&&!gr.call(t,"callee")},ho=Array.isArray,co=Tr||Gs,po=Wa?A(Wa):Ft,vo=za?A(za):xt,go=qa?A(qa):Yt,fo=Xa?A(Xa):Wt,_o=Ce(function(t,e){if(ai(e)||Xi(e))return void Te(e,ms(e),t);for(var i in e)sr.call(e,i)&&_t(t,i,e[i])}),Eo=Ce(function(t,e){Te(e,ys(e),t)}),Ao=Ce(function(t,e,i,s){Te(e,ys(e),t,s)}),mo=function(t){return function(t){t=gs(t);var e=I(t)?N(t):xs,i=e?e[0]:t.charAt(0),s=e?ce(e,1).join(""):t.slice(1);return i.toUpperCase()+s}}(),yo=ae(function(t,i){try{return e(t,xs,i)}catch(t){return $i(t)?t:new Error(t)}}),So=function(t){var e=Math.round;return function(t,i){if(t=vs(t),i=null==i?0:Cr(ps(i),292)){var s=(gs(t)+"e").split("e");return s=(gs(e(s[0]+"e"+(+s[1]+i)))+"e").split("e"),+(s[0]+"e"+(+s[1]-i))}return e(t)}}();w.assign=_o,w.assignIn=Eo,w.assignInWith=Ao,w.chain=Ci,w.compact=Ai,w.constant=Ls,w.debounce=xi,w.drop=mi,w.flatten=Si,w.iteratee=ks,w.keys=ms,w.keysIn=ys,w.map=Gi,w.memoize=Hi,w.mixin=Us,w.negate=Ki,w.omitBy=Ss,w.pickBy=Ds,w.property=js,w.pull=no,w.pullAll=Ii,w.reverse=bi,w.sortBy=oo,w.tap=Ri,w.throttle=Yi,w.thru=Pi,w.toArray=hs,w.values=Ts,w.without=ao,w.extend=Eo,w.extendWith=Ao,Us(w,w),w.attempt=yo,w.capitalize=bs,w.clone=Wi,w.cloneDeep=zi,w.endsWith=Cs,w.eq=qi,w.escape=Rs,w.every=Bi,w.find=ro,w.findIndex=yi,w.forEach=ji,w.forOwn=fs,w.get=_s,w.has=Es,w.hasIn=As,w.identity=Ns,w.includes=Fi,w.indexOf=Di,w.inRange=Is,w.isArguments=uo,w.isArray=ho,w.isArrayLike=Xi,w.isArrayLikeObject=Ji,w.isBoolean=Qi,w.isBuffer=co,w.isDate=po,w.isEmpty=Zi,w.isError=$i,w.isFunction=ts,w.isLength=es,w.isMap=vo,w.isNaN=ns,w.isNull=as,w.isNumber=rs,w.isObject=is,w.isObjectLike=ss,w.isPlainObject=os,w.isSet=go,w.isString=ds,w.isSymbol=ls,w.isTypedArray=fo,w.isUndefined=us,w.last=Ti,w.min=Vs,w.stubArray=Fs,w.stubFalse=Gs,w.noConflict=ws,w.noop=Bs,w.now=lo,w.padStart=Ps,w.round=So,w.some=Vi,w.startsWith=Ms,w.template=Os,w.toFinite=cs,w.toInteger=ps,w.toNumber=vs,w.toString=gs,w.upperFirst=mo,w.each=ji,Us(w,function(){var t={};return Pt(w,function(e,i){sr.call(w.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),w.VERSION="4.17.5",i(["drop","take"],function(t,e){F.prototype[t]=function(i){i=i===xs?1:br(ps(i),0);var s=this.__filtered__&&!e?new F(this):this.clone();return s.__filtered__?s.__takeCount__=Cr(i,s.__takeCount__):s.__views__.push({size:Cr(i,fn),type:t+(s.__dir__<0?"Right":"")}),s},F.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),i(["filter","map","takeWhile"],function(t,e){var i=e+1,s=i==un||3==i;F.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ge(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),i(["head","last"],function(t,e){var i="take"+(e?"Right":"");F.prototype[t]=function(){return this[i](1).value()[0]}}),i(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");F.prototype[t]=function(){return this.__filtered__?new F(this):this[i](1)}}),F.prototype.compact=function(){return this.filter(Ns)},F.prototype.find=function(t){return this.filter(t).head()},F.prototype.findLast=function(t){return this.reverse().find(t)},F.prototype.invokeMap=ae(function(t,e){return"function"==typeof t?new F(this):this.map(function(i){return Bt(i,t,e)})}),F.prototype.reject=function(t){return this.filter(Ki(Ge(t)))},F.prototype.slice=function(t,e){t=ps(t);var i=this;return i.__filtered__&&(t>0||e<0)?new F(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==xs&&(e=ps(e),i=e<0?i.dropRight(-e):i.take(e-t)),i)},F.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},F.prototype.toArray=function(){return this.take(fn)},Pt(F.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),n=w[s?"take"+("last"==e?"Right":""):e],a=s||/^find/.test(e);n&&(w.prototype[e]=function(){var e=this.__wrapped__,r=s?[1]:arguments,o=e instanceof F,l=r[0],u=o||ho(e),h=function(t){var e=n.apply(w,d([t],r));return s&&c?e[0]:e};u&&i&&"function"==typeof l&&1!=l.length&&(o=u=!1);var c=this.__chain__,p=!!this.__actions__.length,v=a&&!c,g=o&&!p;if(!a&&u){e=g?e:new F(this);var f=t.apply(e,r);return f.__actions__.push({func:Pi,args:[h],thisArg:xs}),new j(f,c)}return v&&g?t.apply(this,r):(f=this.thru(h),v?s?f.value()[0]:f.value():f)})}),i(["pop","push","shift","sort","splice","unshift"],function(t){var e=Za[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);w.prototype[t]=function(){var t=arguments;if(s&&!this.__chain__){var n=this.value();return e.apply(ho(n)?n:[],t)}return this[i](function(i){return e.apply(ho(i)?i:[],t)})}}),Pt(F.prototype,function(t,e){var i=w[e];if(i){var s=i.name+"";(Br[s]||(Br[s]=[])).push({name:e,func:i})}}),Br[Pe(xs,$s).name]=[{name:"wrapper",func:xs}],F.prototype.clone=G,F.prototype.reverse=V,F.prototype.value=x,w.prototype.chain=Mi,w.prototype.commit=Oi,w.prototype.next=Li,w.prototype.plant=ki,w.prototype.reverse=Ui,w.prototype.toJSON=w.prototype.valueOf=w.prototype.value=wi,w.prototype.first=w.prototype.head,Er&&(w.prototype[Er]=Ni),"function"==typeof t&&"object"==typeof t.amd&&t.amd?(Ga._=w,t(function(){return w})):xa?((xa.exports=w)._=w,Va._=w):Ga._=w}).call(this),"undefined"!=typeof window&&function(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof t&&t.amd?t([],i):"object"==typeof exports?exports.Hls=i():e.Hls=i()}(this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=11)}([function(t,e,i){"use strict";function s(){}function n(t,e){return e="["+t+"] > "+e}function a(t){var e=h.console[t];return e?function(){for(var i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];s[0]&&(s[0]=n(t,s[0])),e.apply(h.console,s)}:s}function r(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];i.forEach(function(e){u[e]=t[e]?t[e].bind(t):a(e)})}i.d(e,"a",function(){return c}),i.d(e,"b",function(){return p});var o=i(4),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l={trace:s,debug:s,log:s,warn:s,info:s,error:s},u=l,h=Object(o.a)(),c=function(t){if(!0===t||"object"===(void 0===t?"undefined":d(t))){r(t,"debug","log","info","warn","error");try{u.log()}catch(t){u=l}}else u=l},p=u},function(t,e,i){"use strict";var s={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};e.a=s},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return n});var s={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var s=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)}},function(t,e,i){"use strict";function s(){return"undefined"==typeof window?self:window}e.a=s},function(t,e,i){!function(e){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,r={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");return n.path=r.normalizePath(n.path),r.buildURLFromParts(n)}var a=this.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=r.normalizePath(a.path),r.buildURLFromParts(a)):e;var o=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var d=s.exec(o.path);o.netLoc=d[1],o.path=d[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+a.path;l.path=r.normalizePath(h)}else l.path=o.path,a.params||(l.params=o.params,a.query||(l.query=o.query));return null===l.path&&(l.path=i.alwaysNormalize?r.normalizePath(a.path):a.path),r.buildURLFromParts(l)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=r}()},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"b",function(){return a});var n=function(){function t(){s(this,t)}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,i){for(var s=i,n=0;t.isHeader(e,i);)n+=10,n+=t._readSize(e,i+6),t.isFooter(e,i+10)&&(n+=10),i+=n;if(n>0)return e.subarray(s,s+n)},t._readSize=function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,i|=(127&t[e+2])<<7,i|=127&t[e+3]},t.getTimeStamp=function(e){for(var i=t.getID3Frames(e),s=0;s<i.length;s++){var n=i[s];if(t.isTimeStampFrame(n))return t._readTimeStamp(n)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var i=String.fromCharCode(e[0],e[1],e[2],e[3]),s=t._readSize(e,4);return{type:i,size:s,data:e.subarray(10,10+s)}},t.getID3Frames=function(e){for(var i=0,s=[];t.isHeader(e,i);){var n=t._readSize(e,i+6);i+=10;for(var a=i+n;i+8<a;){var r=t._getFrameData(e.subarray(i)),o=t._decodeFrame(r);o&&s.push(o),i+=r.size+10}t.isFooter(e,i)&&(i+=10)}return s},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),i=1&e[3],s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,i&&(s+=47721858.84),Math.round(s)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var i=t._utf8ArrayToStr(e.data,!0),s=new Uint8Array(e.data.subarray(i.length+1));return{key:e.type,info:i,data:s.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var i=1,s=t._utf8ArrayToStr(e.data.subarray(i));i+=s.length+1;var n=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:s,data:n}}var a=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:a}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var i=1,s=t._utf8ArrayToStr(e.data.subarray(i));i+=s.length+1;var n=t._utf8ArrayToStr(e.data.subarray(i));return{key:e.type,info:s,data:n}}var a=t._utf8ArrayToStr(e.data);return{key:e.type,data:a}},t._utf8ArrayToStr=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.length,s=void 0,n=void 0,a=void 0,r="",o=0;o<i;){if(0===(s=t[o++])&&e)return r;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(s);break;case 12:case 13:n=t[o++],r+=String.fromCharCode((31&s)<<6|63&n);break;case 14:n=t[o++],a=t[o++],r+=String.fromCharCode((15&s)<<12|(63&n)<<6|(63&a)<<0)}}return r},t}(),a=n._utf8ArrayToStr;e.a=n},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function n(t){return"number"==typeof t}function a(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!n(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,n,o,d,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(i=this._events[t],r(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(a(i))for(o=Array.prototype.slice.call(arguments,1),l=i.slice(),n=l.length,d=0;d<n;d++)l[d].apply(this,o);return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(n=r(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,n,r,o;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],r=i.length,n=-1,i===e||s(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(i)){for(o=r;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){n=o;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],s(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=t.byteLength,i=e&&new DataView(t).getUint8(e-1);return i?t.slice(0,e-i):t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function(){function t(e,i){s(this,t),this.subtle=e,this.aesIV=i}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),l=d,u=function(){function t(e,i){n(this,t),this.subtle=e,this.key=i}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),h=u,c=function(){function t(){a(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),s=0;s<4;s++)i[s]=e.getUint32(4*s);return i},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],n=i[1],a=i[2],r=i[3],o=this.invSubMix,d=o[0],l=o[1],u=o[2],h=o[3],c=new Uint32Array(256),p=0,v=0,g=0;for(g=0;g<256;g++)c[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var f=v^v<<1^v<<2^v<<3^v<<4;f=f>>>8^255&f^99,t[p]=f,e[f]=p;var _=c[p],E=c[_],A=c[E],m=257*c[f]^16843008*f;s[p]=m<<24|m>>>8,n[p]=m<<16|m>>>16,a[p]=m<<8|m>>>24,r[p]=m,m=16843009*A^65537*E^257*_^16843008*p,d[f]=m<<24|m>>>8,l[f]=m<<16|m>>>16,u[f]=m<<8|m>>>24,h[f]=m,p?(p=_^c[c[c[A^_]]],v^=c[c[v]]):p=v=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,s=0;s<e.length&&i;)i=e[s]===this.key[s],s++;if(!i){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a=this.ksRows=4*(n+6+1),r=void 0,o=void 0,d=this.keySchedule=new Uint32Array(a),l=this.invKeySchedule=new Uint32Array(a),u=this.sBox,h=this.rcon,c=this.invSubMix,p=c[0],v=c[1],g=c[2],f=c[3],_=void 0,E=void 0;for(r=0;r<a;r++)r<n?_=d[r]=e[r]:(E=_,r%n==0?(E=E<<8|E>>>24,E=u[E>>>24]<<24|u[E>>>16&255]<<16|u[E>>>8&255]<<8|u[255&E],E^=h[r/n|0]<<24):n>6&&r%n==4&&(E=u[E>>>24]<<24|u[E>>>16&255]<<16|u[E>>>8&255]<<8|u[255&E]),d[r]=_=(d[r-n]^E)>>>0);for(o=0;o<a;o++)r=a-o,E=3&o?d[r]:d[r-4],l[o]=o<4||r<=4?E:p[u[E>>>24]]^v[u[E>>>16&255]]^g[u[E>>>8&255]]^f[u[255&E]],l[o]=l[o]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,i,s){for(var n=this.keySize+6,a=this.invKeySchedule,o=this.invSBox,d=this.invSubMix,l=d[0],u=d[1],h=d[2],c=d[3],p=this.uint8ArrayToUint32Array_(i),v=p[0],g=p[1],f=p[2],_=p[3],E=new Int32Array(t),A=new Int32Array(E.length),m=void 0,y=void 0,S=void 0,D=void 0,T=void 0,I=void 0,b=void 0,C=void 0,R=void 0,P=void 0,M=void 0,O=void 0,L=void 0,N=void 0,k=this.networkToHostOrderSwap;e<E.length;){for(R=k(E[e]),P=k(E[e+1]),M=k(E[e+2]),O=k(E[e+3]),T=R^a[0],I=O^a[1],b=M^a[2],C=P^a[3],L=4,N=1;N<n;N++)m=l[T>>>24]^u[I>>16&255]^h[b>>8&255]^c[255&C]^a[L],y=l[I>>>24]^u[b>>16&255]^h[C>>8&255]^c[255&T]^a[L+1],S=l[b>>>24]^u[C>>16&255]^h[T>>8&255]^c[255&I]^a[L+2],D=l[C>>>24]^u[T>>16&255]^h[I>>8&255]^c[255&b]^a[L+3],T=m,I=y,b=S,C=D,L+=4;m=o[T>>>24]<<24^o[I>>16&255]<<16^o[b>>8&255]<<8^o[255&C]^a[L],y=o[I>>>24]<<24^o[b>>16&255]<<16^o[C>>8&255]<<8^o[255&T]^a[L+1],S=o[b>>>24]<<24^o[C>>16&255]<<16^o[T>>8&255]<<8^o[255&I]^a[L+2],D=o[C>>>24]<<24^o[T>>16&255]<<16^o[I>>8&255]<<8^o[255&b]^a[L+3],L+=3,A[e]=k(m^v),A[e+1]=k(D^g),A[e+2]=k(S^f),A[e+3]=k(y^_),v=R,g=P,f=M,_=O,e+=4}return s?r(A.buffer):A.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),p=c,v=i(2),g=i(0),f=i(1),_=i(4),E=Object(_.a)(),A=function(){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=s.removePKCS7Padding,a=void 0===n||n;if(o(this,t),this.logEnabled=!0,this.observer=e,this.config=i,this.removePKCS7Padding=a,a)try{var r=E.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,i,s){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(g.b.log("JS AES decrypt"),this.logEnabled=!1);var a=this.decryptor;a||(this.decryptor=a=new p),a.expandKey(e),s(a.decrypt(t,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(g.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var r=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new h(r,e)),this.fastAesKey.expandKey().then(function(a){new l(r,i).decrypt(t,a).catch(function(a){n.onWebCryptoError(a,t,e,i,s)}).then(function(t){s(t)})}).catch(function(a){n.onWebCryptoError(a,t,e,i,s)})}},t.prototype.onWebCryptoError=function(t,e,i,s,n){this.config.enableSoftwareAES?(g.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,i,s,n)):(g.b.error("decrypting error : "+t.message),this.observer.trigger(f.a.ERROR,{type:v.b.MEDIA_ERROR,details:v.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.a=A},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=i(0),a=i(1),r=Math.pow(2,32)-1,o=function(){function t(e,i){s(this,t),this.observer=e,this.remuxer=i}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,i,s,n){if(e&&e.byteLength){var r=this.initData=t.parseInitSegment(e);null==i&&(i="mp4a.40.5"),null==s&&(s="avc1.42e01e");var o={};r.audio&&r.video?o.audiovideo={container:"video/mp4",codec:i+","+s,initSegment:n?e:null}:(r.audio&&(o.audio={container:"audio/mp4",codec:i,initSegment:n?e:null}),r.video&&(o.video={container:"video/mp4",codec:s,initSegment:n?e:null})),this.observer.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else i&&(this.audioCodec=i),s&&(this.videoCodec=s)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<8|t[e+1];return i<0?65536+i:i},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return i<0?4294967296+i:i},t.writeUint32=function(t,e,i){t.data&&(e+=t.start,t=t.data),t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i},t.findBox=function(e,i){var s=[],n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=void 0,u=void 0;if(e.data?(l=e.start,o=e.end,e=e.data):(l=0,o=e.byteLength),!i.length)return null;for(n=l;n<o;)a=t.readUint32(e,n),r=t.bin2str(e.subarray(n+4,n+8)),u=a>1?n+a:o,r===i[0]&&(1===i.length?s.push({data:e,start:n+8,end:u}):(d=t.findBox({data:e,start:n+8,end:u},i.slice(1)),d.length&&(s=s.concat(d)))),n=u;return s},t.parseSegmentIndex=function(e){var i=t.findBox(e,["moov"])[0],s=i?i.end:null,n=0,a=t.findBox(e,["sidx"]),r=void 0;if(!a||!a[0])return null;r=[],a=a[0];var o=a.data[0];n=0===o?8:16;var d=t.readUint32(a,n);n+=4,n+=0===o?8:16,n+=2;var l=a.end+0,u=t.readUint16(a,n);n+=2;for(var h=0;h<u;h++){var c=n,p=t.readUint32(a,c);c+=4;var v=2147483647&p;if(1==(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var g=t.readUint32(a,c);c+=4,r.push({referenceSize:v,subsegmentDuration:g,info:{duration:g/d,start:l,end:l+v-1}}),l+=v,c+=4,n=c}return{earliestPresentationTime:0,timescale:d,version:o,referencesCount:u,references:r,moovEndOffset:s}},t.parseInitSegment=function(e){var i=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var s=t.findBox(e,["tkhd"])[0];if(s){var a=s.data[s.start],r=0===a?12:20,o=t.readUint32(s,r),d=t.findBox(e,["mdia","mdhd"])[0];if(d){a=d.data[d.start],r=0===a?12:20;var l=t.readUint32(d,r),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var h=t.bin2str(u.data.subarray(u.start+8,u.start+12)),c={soun:"audio",vide:"video"}[h];if(c){var p=t.findBox(e,["mdia","minf","stbl","stsd"]);if(p.length){p=p[0];var v=t.bin2str(p.data.subarray(p.start+12,p.start+16));n.b.log("MP4Demuxer:"+c+":"+v+" found")}i[o]={timescale:l,type:c},i[c]={timescale:l,id:o}}}}}}),i},t.getStartDTS=function(e,i){var s=void 0,n=void 0,a=void 0
;return s=t.findBox(i,["moof","traf"]),n=[].concat.apply([],s.map(function(i){return t.findBox(i,["tfhd"]).map(function(s){var n=void 0,a=void 0;return n=t.readUint32(s,4),a=e[n].timescale||9e4,t.findBox(i,["tfdt"]).map(function(e){var i=void 0,s=void 0;return i=e.data[e.start],s=t.readUint32(e,4),1===i&&(s*=Math.pow(2,32),s+=t.readUint32(e,8)),s})[0]/a})})),a=Math.min.apply(null,n),isFinite(a)?a:0},t.offsetStartDTS=function(e,i,s){t.findBox(i,["moof","traf"]).map(function(i){return t.findBox(i,["tfhd"]).map(function(n){var a=t.readUint32(n,4),o=e[a].timescale||9e4;t.findBox(i,["tfdt"]).map(function(e){var i=e.data[e.start],n=t.readUint32(e,4);if(0===i)t.writeUint32(e,4,n-s*o);else{n*=Math.pow(2,32),n+=t.readUint32(e,8),n-=s*o,n=Math.max(n,0);var a=Math.floor(n/(r+1)),d=Math.floor(n%(r+1));t.writeUint32(e,4,a),t.writeUint32(e,8,d)}})})})},t.prototype.append=function(e,i,s,n){var r=this.initData;r||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),r=this.initData);var o=void 0,d=this.initPTS;if(void 0===d){var l=t.getStartDTS(r,e);this.initPTS=d=l-i,this.observer.trigger(a.a.INIT_PTS_FOUND,{initPTS:d})}t.offsetStartDTS(r,e,d),o=t.getStartDTS(r,e),this.remuxer.remux(r.audio,r.video,null,null,o,s,n,e)},t.prototype.destroy=function(){},t}();e.a=o},function(t,e,i){"use strict";function s(t,e,i,s){var n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=navigator.userAgent.toLowerCase(),u=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return n=1+((192&e[i+2])>>>6),(a=(60&e[i+2])>>>2)>h.length-1?void t.trigger(D.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a}):(o=(1&e[i+2])<<2,o|=(192&e[i+3])>>>6,C.b.log("manifest codec:"+s+",ADTS data:type:"+n+",sampleingIndex:"+a+"["+h[a]+"Hz],channelConfig:"+o),/firefox/i.test(l)?a>=6?(n=5,d=new Array(4),r=a-3):(n=2,d=new Array(2),r=a):-1!==l.indexOf("android")?(n=2,d=new Array(2),r=a):(n=5,d=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&a>=6?r=a-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(a>=6&&1===o||/vivaldi/i.test(l))||!s&&1===o)&&(n=2,d=new Array(2)),r=a)),d[0]=n<<3,d[0]|=(14&a)>>1,d[1]|=(1&a)<<7,d[1]|=o<<3,5===n&&(d[1]|=(14&r)>>1,d[2]=(1&r)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:h[a],channelCount:o,codec:"mp4a.40."+n,manifestCodec:u})}function n(t,e){return 255===t[e]&&240==(246&t[e+1])}function a(t,e){return 1&t[e+1]?7:9}function r(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function o(t,e){return!!(e+1<t.length&&n(t,e))}function d(t,e){if(e+1<t.length&&n(t,e)){var i=a(t,e),s=i;e+5<t.length&&(s=r(t,e));var o=e+s;if(o===t.length||o+1<t.length&&n(t,o))return!0}return!1}function l(t,e,i,n,a){if(!t.samplerate){var r=s(e,i,n,a);t.config=r.config,t.samplerate=r.samplerate,t.channelCount=r.channelCount,t.codec=r.codec,t.manifestCodec=r.manifestCodec,C.b.log("parsed codec:"+t.codec+",rate:"+r.samplerate+",nb channel:"+r.channelCount)}}function u(t){return 9216e4/t}function h(t,e,i,s,n){var o=void 0,d=void 0,l=void 0,u=t.length;if(o=a(t,e),d=r(t,e),(d-=o)>0&&e+o+d<=u)return l=i+s*n,{headerLength:o,frameLength:d,stamp:l}}function c(t,e,i,s,n){var a=u(t.samplerate),r=h(e,i,s,n,a);if(r){var o=r.stamp,d=r.headerLength,l=r.frameLength,c={unit:e.subarray(i+d,i+d+l),pts:o,dts:o};return t.samples.push(c),t.len+=l,{sample:c,length:l+d}}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var D=i(1),T=i(2),I=i(8),b=i(3),C=i(0),R=i(4),P=i(6),M=function(){function t(e,i,s){p(this,t),this.observer=e,this.config=s,this.remuxer=i}return t.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=P.a.getID3Data(t,0)||[],i=e.length,s=t.length;i<s;i++)if(d(t,i))return C.b.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,e,i,s){for(var n=this._audioTrack,a=P.a.getID3Data(t,0)||[],r=P.a.getTimeStamp(a),d=Object(b.a)(r)?90*r:9e4*e,u=0,h=d,p=t.length,v=a.length,g=[{pts:h,dts:h,data:a}];v<p-1;)if(o(t,v)&&v+5<p){l(n,this.observer,t,v,n.manifestCodec);var f=c(n,t,v,d,u);if(!f){C.b.log("Unable to parse AAC frame");break}v+=f.length,h=f.sample.pts,u++}else P.a.isHeader(t,v)?(a=P.a.getID3Data(t,v),g.push({pts:h,dts:h,data:a}),v+=a.length):v++;this.remuxer.remux(n,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},e,i,s)},t.prototype.destroy=function(){},t}(),O=M,L=i(9),N={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,i,s,n){if(!(i+24>e.length)){var a=this.parseHeader(e,i);if(a&&i+a.frameLength<=e.length){var r=9e4*a.samplesPerFrame/a.sampleRate,o=s+n*r,d={unit:e.subarray(i,i+a.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(d),t.len+=a.frameLength,{sample:d,length:a.frameLength}}}},parseHeader:function(t,e){var i=t[e+1]>>3&3,s=t[e+1]>>1&3,n=t[e+2]>>4&15,a=t[e+2]>>2&3,r=t[e+2]>>1&1;if(1!==i&&0!==n&&15!==n&&3!==a){var o=3===i?3-s:3===s?3:4,d=1e3*N.BitratesMap[14*o+n-1],l=3===i?0:2===i?1:2,u=N.SamplingRateMap[3*l+a],h=t[e+3]>>6==3?1:2,c=N.SamplesCoefficients[i][s],p=N.BytesInSlot[s],v=8*c*p;return{sampleRate:u,channelCount:h,frameLength:parseInt(c*d/u+r,10)*p,samplesPerFrame:v}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var i=this.parseHeader(t,e),s=4;i&&i.frameLength&&(s=i.frameLength);var n=e+s;if(n===t.length||n+1<t.length&&this.isHeaderPattern(t,n))return!0}return!1}},k=N,U=function(){function t(e){v(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");s.set(t.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.prototype.skipBits=function(t){var e=void 0;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&C.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i},t.prototype.skipLZ=function(){var t=void 0;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e=8,i=8,s=void 0,n=void 0;for(s=0;s<t;s++)0!==i&&(n=this.readEG(),i=(e+n+256)%256),e=0===i?e:i},t.prototype.readSPS=function(){var t=0,e=0,i=0,s=0,n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=void 0,u=void 0,h=this.readUByte.bind(this),c=this.readBits.bind(this),p=this.readUEG.bind(this),v=this.readBoolean.bind(this),g=this.skipBits.bind(this),f=this.skipEG.bind(this),_=this.skipUEG.bind(this),E=this.skipScalingList.bind(this);if(h(),n=h(),c(5),g(3),h(),_(),100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n){var A=p();if(3===A&&g(1),_(),_(),g(1),v())for(l=3!==A?8:12,u=0;u<l;u++)v()&&E(u<6?16:64)}_();var m=p();if(0===m)p();else if(1===m)for(g(1),f(),f(),a=p(),u=0;u<a;u++)f();_(),g(1),r=p(),o=p(),d=c(1),0===d&&g(1),g(1),v()&&(t=p(),e=p(),i=p(),s=p());var y=[1,1];if(v()&&v())switch(h()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(r+1)-2*t-2*e),height:(2-d)*(o+1)*16-(d?2:4)*(i+s),pixelRatio:y}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),w=U,B=function(){function t(e,i,s,n){g(this,t),this.decryptdata=s,this.discardEPB=n,this.decrypter=new I.a(e,i,{removePKCS7Padding:!1})}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,i,s){var n=t[e].unit,a=n.subarray(16,n.length-n.length%16),r=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(r,function(a){a=new Uint8Array(a),n.set(a,16),s||o.decryptAacSamples(t,e+1,i)})},t.prototype.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var s=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,s),!s)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),s=0,n=32;n<=t.length-16;n+=160,s+=16)i.set(t.subarray(n,n+16),s);return i},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var i=0,s=32;s<=t.length-16;s+=160,i+=16)t.set(e.subarray(i,i+16),s);return t},t.prototype.decryptAvcSample=function(t,e,i,s,n,a){var r=this.discardEPB(n.data),o=this.getAvcEncryptedData(r),d=this;this.decryptBuffer(o.buffer,function(o){n.data=d.getAvcDecryptedUnit(r,o),a||d.decryptAvcSamples(t,e,i+1,s)})},t.prototype.decryptAvcSamples=function(t,e,i,s){for(;;e++,i=0){if(e>=t.length)return void s();for(var n=t[e].units;!(i>=n.length);i++){var a=n[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var r=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,s,a,r),!r)return}}}},t}(),j=B,F={video:1,audio:2,id3:3,text:4},G=function(){function t(e,i,s,n){f(this,t),this.observer=e,this.config=s,this.typeSupported=n,this.remuxer=i,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new j(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var i=t._syncOffset(e);return!(i<0||(i&&C.b.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:F[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,i,s,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",n),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3",n),this._txtTrack=t.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=s,this._duration=n},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,i,s,n){var a=void 0,r=e.length,o=void 0,d=void 0,l=void 0,u=void 0,h=!1;this.contiguous=s;var c=this.pmtParsed,p=this._avcTrack,v=this._audioTrack,g=this._id3Track,f=p.pid,_=v.pid,E=g.pid,A=this._pmtId,m=p.pesData,y=v.pesData,S=g.pesData,I=this._parsePAT,b=this._parsePMT,R=this._parsePES,P=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),L=this._parseID3PES.bind(this),N=t._syncOffset(e);for(r-=(r+N)%188,a=N;a<r;a+=188)if(71===e[a]){if(o=!!(64&e[a+1]),d=((31&e[a+1])<<8)+e[a+2],(48&e[a+3])>>4>1){if((l=a+5+e[a+4])===a+188)continue}else l=a+4;switch(d){case f:o&&(m&&(u=R(m))&&void 0!==u.pts&&P(u,!1),m={data:[],size:0}),m&&(m.data.push(e.subarray(l,a+188)),m.size+=a+188-l);break;case _:o&&(y&&(u=R(y))&&void 0!==u.pts&&(v.isAAC?M(u):O(u)),y={data:[],size:0}),y&&(y.data.push(e.subarray(l,a+188)),y.size+=a+188-l);break;case E:o&&(S&&(u=R(S))&&void 0!==u.pts&&L(u),S={data:[],size:0}),S&&(S.data.push(e.subarray(l,a+188)),S.size+=a+188-l);break;case 0:o&&(l+=e[l]+1),A=this._pmtId=I(e,l);break;case A:o&&(l+=e[l]+1);var k=b(e,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);f=k.avc,f>0&&(p.pid=f),_=k.audio,_>0&&(v.pid=_,v.isAAC=k.isAAC),E=k.id3,E>0&&(g.pid=E),h&&!c&&(C.b.log("reparse from beginning"),h=!1,a=N-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(D.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});m&&(u=R(m))&&void 0!==u.pts?(P(u,!0),p.pesData=null):p.pesData=m,y&&(u=R(y))&&void 0!==u.pts?(v.isAAC?M(u):O(u),v.pesData=null):(y&&y.size&&C.b.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=y),S&&(u=R(S))&&void 0!==u.pts?(L(u),g.pesData=null):g.pesData=S,null==this.sampleAes?this.remuxer.remux(v,p,g,this._txtTrack,i,s,n):this.decryptAndRemux(v,p,g,this._txtTrack,i,s,n)},t.prototype.decryptAndRemux=function(t,e,i,s,n,a,r){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,i,s,n,a,r)})}else this.decryptAndRemuxAvc(t,e,i,s,n,a,r)},t.prototype.decryptAndRemuxAvc=function(t,e,i,s,n,a,r){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,i,s,n,a,r)})}else this.remuxer.remux(t,e,i,s,n,a,r)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,i,s){var n=void 0,a=void 0,r=void 0,o=void 0,d={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=(15&t[e+1])<<8|t[e+2],a=e+3+n-4,r=(15&t[e+10])<<8|t[e+11],e+=12+r;e<a;){switch(o=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!s){C.b.log("unkown stream type:"+t[e]);break}case 15:-1===d.audio&&(d.audio=o);break;case 21:-1===d.id3&&(d.id3=o);break;case 219:if(!s){C.b.log("unkown stream type:"+t[e]);break}case 27:-1===d.avc&&(d.avc=o);break;case 3:case 4:i?-1===d.audio&&(d.audio=o,d.isAAC=!1):C.b.log("MPEG audio found, not supported in this browser for now");break;case 36:C.b.warn("HEVC stream type found, not supported for now");break;default:C.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return d},t.prototype._parsePES=function(t){var e=0,i=void 0,s=void 0,n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=void 0,u=t.data;if(!t||0===t.size)return null;for(;u[0].length<19&&u.length>1;){var h=new Uint8Array(u[0].length+u[1].length);h.set(u[0]),h.set(u[1],u[0].length),u[0]=h,u.splice(1,1)}if(i=u[0],1===(i[0]<<16)+(i[1]<<8)+i[2]){if((n=(i[4]<<8)+i[5])&&n>t.size-6)return null;s=i[7],192&s&&(o=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,o>4294967295&&(o-=8589934592),64&s?(d=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2,d>4294967295&&(d-=8589934592),o-d>54e5&&(C.b.warn(Math.round((o-d)/9e4)+"s delta between PTS and DTS, align them"),o=d)):d=o),a=i[8],l=a+9,t.size-=l,r=new Uint8Array(t.size);for(var c=0,p=u.length;c<p;c++){i=u[c];var v=i.byteLength;if(l){if(l>v){l-=v;continue}i=i.subarray(l),v-=l,l=0}r.set(i,e),e+=v}return n&&(n-=a+3),{data:r,pts:o,dts:d,len:n}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var i=e.samples,s=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(s||this.contiguous)?(t.id=s,i.push(t)):e.dropped++}t.debug.length&&C.b.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var i=this,s=this._avcTrack,n=this._parseAVCNALu(t.data),a=void 0,r=this.avcSample,o=void 0,d=!1,l=void 0,u=this.pushAccesUnit.bind(this),h=function(t,e,i,s){return{key:t,pts:e,dts:i,units:[],debug:s}};t.data=null,r&&n.length&&!s.audFound&&(u(r,s),r=this.avcSample=h(!1,t.pts,t.dts,"")),n.forEach(function(e){switch(e.type){case 1:o=!0,r||(r=i.avcSample=h(!0,t.pts,t.dts,"")),r.frame=!0;var n=e.data;if(d&&n.length>4){var c=new w(n).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(r.key=!0)}break;case 5:o=!0,r||(r=i.avcSample=h(!0,t.pts,t.dts,"")),r.key=!0,r.frame=!0;break;case 6:o=!0,a=new w(i.discardEPB(e.data)),a.readUByte();for(var p=0,v=0,g=!1,f=0;!g&&a.bytesAvailable>1;){p=0;do{f=a.readUByte(),p+=f}while(255===f);v=0;do{f=a.readUByte(),v+=f}while(255===f);if(4===p&&0!==a.bytesAvailable){if(g=!0,181===a.readUByte()&&49===a.readUShort()&&1195456820===a.readUInt()&&3===a.readUByte()){var _=a.readUByte(),E=a.readUByte(),A=31&_,m=[_,E];for(l=0;l<A;l++)m.push(a.readUByte()),m.push(a.readUByte()),m.push(a.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:t.pts,bytes:m})}}else if(v<a.bytesAvailable)for(l=0;l<v;l++)a.readUByte()}break;case 7:if(o=!0,d=!0,!s.sps){a=new w(e.data);var y=a.readSPS();s.width=y.width,s.height=y.height,s.pixelRatio=y.pixelRatio,s.sps=[e.data],s.duration=i._duration;var S=e.data.subarray(1,4),D="avc1.";for(l=0;l<3;l++){var T=S[l].toString(16);T.length<2&&(T="0"+T),D+=T}s.codec=D}break;case 8:o=!0,s.pps||(s.pps=[e.data]);break;case 9:o=!1,s.audFound=!0,r&&u(r,s),r=i.avcSample=h(!1,t.pts,t.dts,"");break;case 12:o=!1;break;default:o=!1,r&&(r.debug+="unknown NAL "+e.type+" ")}r&&o&&r.units.push(e)}),e&&r&&(u(r,s),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var i=t.length;if(i>0){if(e.pts>=t[i-1].pts)t.push(e);else for(var s=i-1;s>=0;s--)if(e.pts<t[s].pts){t.splice(s,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var i=this._avcTrack,s=i.samples;t=s[s.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},t.prototype._parseAVCNALu=function(t){var e=0,i=t.byteLength,s=void 0,n=void 0,a=this._avcTrack,r=a.naluState||0,o=r,d=[],l=void 0,u=void 0,h=-1,c=void 0;for(-1===r&&(h=0,c=31&t[0],r=0,e=1);e<i;)if(s=t[e++],r)if(1!==r)if(s)if(1===s){if(h>=0)l={data:t.subarray(h,e-r-1),type:c},d.push(l);else{var p=this._getLastNalUnit();if(p&&(o&&e<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),(n=e-r-1)>0)){var v=new Uint8Array(p.data.byteLength+n);v.set(p.data,0),v.set(t.subarray(0,n),p.data.byteLength),p.data=v}}e<i?(u=31&t[e],h=e,c=u,r=0):r=-1}else r=0;else r=3;else r=s?0:2;else r=s?0:1;if(h>=0&&r>=0&&(l={data:t.subarray(h,i),type:c,state:r},d.push(l)),0===d.length){var g=this._getLastNalUnit();if(g){var f=new Uint8Array(g.data.byteLength+t.byteLength);f.set(g.data,0),f.set(t,g.data.byteLength),g.data=f}}return a.naluState=r,d},t.prototype.discardEPB=function(t){for(var e=t.byteLength,i=[],s=1,n=void 0,a=void 0;s<e-2;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(i.push(s+2),s+=2):s++;if(0===i.length)return t;n=e-i.length,a=new Uint8Array(n);var r=0;for(s=0;s<n;r++,s++)r===i[0]&&(r++,i.shift()),a[s]=t[r];return a},t.prototype._parseAACPES=function(t){var e=this._audioTrack,i=t.data,s=t.pts,n=this.aacOverFlow,a=this.aacLastPTS,r=void 0,d=void 0,h=void 0,p=void 0,v=void 0;if(n){var g=new Uint8Array(n.byteLength+i.byteLength);g.set(n,0),g.set(i,n.byteLength),i=g}for(h=0,v=i.length;h<v-1&&!o(i,h);h++);if(h){var f=void 0,_=void 0;if(h<v-1?(f="AAC PES did not start with ADTS header,offset:"+h,_=!1):(f="no ADTS header found in AAC PES",_=!0),C.b.warn("parsing error:"+f),this.observer.trigger(D.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:_,reason:f}),_)return}if(l(e,this.observer,i,h,this.audioCodec),d=0,r=u(e.samplerate),n&&a){var E=a+r;Math.abs(E-s)>1&&(C.b.log("AAC: align PTS for overlapping frames by "+Math.round((E-s)/90)),s=E)}for(;h<v;)if(o(i,h)&&h+5<v){var A=c(e,i,h,s,d);if(!A)break;h+=A.length,p=A.sample.pts,d++}else h++;n=h<v?i.subarray(h,v):null,this.aacOverFlow=n,this.aacLastPTS=p},t.prototype._parseMPEGPES=function(t){for(var e=t.data,i=e.length,s=0,n=0,a=t.pts;n<i;)if(k.isHeader(e,n)){var r=k.appendFrame(this._audioTrack,e,n,a,s);if(!r)break;n+=r.length,s++}else n++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}(),V=G,x=function(){function t(e,i,s){_(this,t),this.observer=e,this.config=s,this.remuxer=i}return t.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e=void 0,i=void 0,s=P.a.getID3Data(t,0);if(s&&void 0!==P.a.getTimeStamp(s))for(e=s.length,i=Math.min(t.length-1,e+100);e<i;e++)if(k.probe(t,e))return C.b.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,i,s){for(var n=P.a.getID3Data(t,0),a=P.a.getTimeStamp(n),r=a?90*a:9e4*e,o=n.length,d=t.length,l=0,u=0,h=this._audioTrack,c=[{pts:r,dts:r,data:n}];o<d;)if(k.isHeader(t,o)){var p=k.appendFrame(h,t,o,r,l);if(!p)break;o+=p.length,u=p.sample.pts,l++}else P.a.isHeader(t,o)?(n=P.a.getID3Data(t,o),c.push({pts:u,dts:u,data:n}),o+=n.length):o++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,i,s)},t.prototype.destroy=function(){},t}(),H=x,K=function(){function t(){E(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),Y=K,W=Math.pow(2,32)-1,z=function(){function t(){A(this,t)}return t.init=function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e=void 0;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:i,audio:s};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,r,d,r,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e=Array.prototype.slice.call(arguments,1),i=8,s=e.length,n=s,a=void 0;s--;)i+=e[s].byteLength;for(a=new Uint8Array(i),a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(t,4),s=0,i=8;s<n;s++)a.set(e[s],i),i+=e[s].byteLength;return a},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,i){i*=e;var s=Math.floor(i/(W+1)),n=Math.floor(i%(W+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,i,s){return t.box(t.types.moof,t.mfhd(e),t.traf(s,i))},t.moov=function(e){for(var i=e.length,s=[];i--;)s[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(s).concat(t.mvex(e)))},t.mvex=function(e){for(var i=e.length,s=[];i--;)s[i]=t.trex(e[i]);return t.box.apply(null,[t.types.mvex].concat(s))},t.mvhd=function(e,i){i*=e;var s=Math.floor(i/(W+1)),n=Math.floor(i%(W+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var i=e.samples||[],s=new Uint8Array(4+i.length),n=void 0,a=void 0;for(a=0;a<i.length;a++)n=i[a].flags,s[a+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var i=[],s=[],n=void 0,a=void 0,r=void 0;for(n=0;n<e.sps.length;n++)a=e.sps[n],r=a.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(a));for(n=0;n<e.pps.length;n++)a=e.pps[n],r=a.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(a));var o=t.box(t.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(s))),d=e.width,l=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var i=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var i=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var i=e.id,s=e.duration*e.timescale,n=e.width,a=e.height,r=Math.floor(s/(W+1)),o=Math.floor(s%(W+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,i){var s=t.sdtp(e),n=e.id,a=Math.floor(i/(W+1)),r=Math.floor(i%(W+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,r>>24,r>>16&255,r>>8&255,255&r])),t.trun(e,s.length+16+20+8+16+8+8),s)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var i=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,i){var s=e.samples||[],n=s.length,a=12+16*n,r=new Uint8Array(a),o=void 0,d=void 0,l=void 0,u=void 0,h=void 0,c=void 0;for(i+=8+a,r.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),o=0;o<n;o++)d=s[o],l=d.duration,u=d.size,h=d.flags,c=d.cts,r.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*o);return t.box(t.types.trun,r)},t.initSegment=function(e){t.types||t.init();var i=t.moov(e),s=void 0;return s=new Uint8Array(t.FTYP.byteLength+i.byteLength),s.set(t.FTYP),s.set(i,t.FTYP.byteLength),s},t}(),q=z,X=function(){function t(e,i,s,n){m(this,t),this.observer=e,this.config=i,this.typeSupported=s;var a=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,i,s,n,a,r){if(this.ISGenerated||this.generateIS(t,e,n),this.ISGenerated){var o=t.samples.length,d=e.samples.length,l=n,u=n;if(o&&d){var h=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;l+=Math.max(0,h),u+=Math.max(0,-h)}if(o){t.timescale||(C.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,n));var c=this.remuxAudio(t,l,a,r);if(d){var p=void 0;c&&(p=c.endPTS-c.startPTS),e.timescale||(C.b.warn("regenerate InitSegment as video detected"),
this.generateIS(t,e,n)),this.remuxVideo(e,u,a,p,r)}}else if(d){var v=this.remuxVideo(e,u,a,0,r);v&&t.codec&&this.remuxEmptyAudio(t,l,a,v)}}i.samples.length&&this.remuxID3(i,n),s.samples.length&&this.remuxText(s,n),this.observer.trigger(D.a.FRAG_PARSED)},t.prototype.generateIS=function(t,e,i){var s=this.observer,n=t.samples,a=e.samples,r=this.typeSupported,o="audio/mp4",d={},l={tracks:d},u=void 0===this._initPTS,h=void 0,c=void 0;if(u&&(h=c=1/0),t.config&&n.length&&(t.timescale=t.samplerate,C.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(r.mpeg?(o="audio/mpeg",t.codec=""):r.mp3&&(t.codec="mp3")),d.audio={container:o,codec:t.codec,initSegment:!t.isAAC&&r.mpeg?new Uint8Array:q.initSegment([t]),metadata:{channelCount:t.channelCount}},u&&(h=c=n[0].pts-t.inputTimeScale*i)),e.sps&&e.pps&&a.length){var p=e.inputTimeScale;e.timescale=p,d.video={container:"video/mp4",codec:e.codec,initSegment:q.initSegment([e]),metadata:{width:e.width,height:e.height}},u&&(h=Math.min(h,a[0].pts-p*i),c=Math.min(c,a[0].dts-p*i),this.observer.trigger(D.a.INIT_PTS_FOUND,{initPTS:h}))}Object.keys(d).length?(s.trigger(D.a.FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,u&&(this._initPTS=h,this._initDTS=c)):s.trigger(D.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,i,s,n){var a=8,r=t.timescale,o=void 0,d=void 0,l=void 0,u=void 0,h=void 0,c=void 0,p=void 0,v=t.samples,g=[],f=v.length,_=this._PTSNormalize,E=this._initDTS,A=this.nextAvcDts,m=this.isSafari;if(0!==f){m&&(i|=v.length&&A&&(n&&Math.abs(e-A/r)<.1||Math.abs(v[0].pts-A-E)<r/5)),i||(A=e*r),v.forEach(function(t){t.pts=_(t.pts-E,A),t.dts=_(t.dts-E,A)}),v.sort(function(t,e){var i=t.dts-e.dts,s=t.pts-e.pts;return i||s||t.id-e.id});var y=v.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(y<0){C.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(y/90)+" ms to overcome this issue");for(var S=0;S<v.length;S++)v[S].dts+=y}var I=v[0];h=Math.max(I.dts,0),u=Math.max(I.pts,0);var b=Math.round((h-A)/90);i&&b&&(b>1?C.b.log("AVC:"+b+" ms hole between fragments detected,filling it"):b<-1&&C.b.log("AVC:"+-b+" ms overlapping between fragments detected"),h=A,v[0].dts=h,u=Math.max(u-b,A),v[0].pts=u,C.b.log("Video/PTS/DTS adjusted: "+Math.round(u/90)+"/"+Math.round(h/90)+",delta:"+b+" ms")),I=v[v.length-1],p=Math.max(I.dts,0),c=Math.max(I.pts,0,p),m&&(o=Math.round((p-h)/(v.length-1)));for(var R=0,P=0,M=0;M<f;M++){for(var O=v[M],L=O.units,N=L.length,k=0,U=0;U<N;U++)k+=L[U].data.length;P+=k,R+=N,O.length=k,O.dts=m?h+M*o:Math.max(O.dts,h),O.pts=Math.max(O.pts,O.dts)}var w=P+4*R+8;try{d=new Uint8Array(w)}catch(t){return void this.observer.trigger(D.a.ERROR,{type:T.b.MUX_ERROR,details:T.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:w,reason:"fail allocating video mdat "+w})}var B=new DataView(d.buffer);B.setUint32(0,w),d.set(q.types.mdat,4);for(var j=0;j<f;j++){for(var F=v[j],G=F.units,V=0,x=void 0,H=0,K=G.length;H<K;H++){var Y=G[H],W=Y.data,z=Y.data.byteLength;B.setUint32(a,z),a+=4,d.set(W,a),a+=z,V+=4+z}if(m)x=Math.max(0,o*Math.round((F.pts-F.dts)/o));else{if(j<f-1)o=v[j+1].dts-F.dts;else{var X=this.config,J=F.dts-v[j>0?j-1:j].dts;if(X.stretchShortVideoTrack){var Q=X.maxBufferHole,Z=Math.floor(Q*r),$=(s?u+s*r:this.nextAudioPts)-F.pts;$>Z?(o=$-J,o<0&&(o=J),C.b.log("It is approximately "+$/90+" ms to the next segment; using duration "+o/90+" ms for the last video frame.")):o=J}else o=J}x=Math.round(F.pts-F.dts)}g.push({size:V,duration:o,cts:x,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:F.key?2:1,isNonSync:F.key?0:1}})}this.nextAvcDts=p+o;var tt=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var et=g[0].flags;et.dependsOn=2,et.isNonSync=0}t.samples=g,l=q.moof(t.sequenceNumber++,h,t),t.samples=[];var it={data1:l,data2:d,startPTS:u/r,endPTS:(c+o)/r,startDTS:h/r,endDTS:this.nextAvcDts/r,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:tt};return this.observer.trigger(D.a.FRAG_PARSING_DATA,it),it}},t.prototype.remuxAudio=function(t,e,i,s){var n=t.inputTimeScale,a=t.timescale,r=n/a,o=t.isAAC?1024:1152,d=o*r,l=this._PTSNormalize,u=this._initDTS,h=!t.isAAC&&this.typeSupported.mpeg,c=void 0,p=void 0,v=void 0,g=void 0,f=void 0,_=void 0,E=void 0,A=t.samples,m=[],y=this.nextAudioPts;if(i|=A.length&&y&&(s&&Math.abs(e-y/n)<.1||Math.abs(A[0].pts-y-u)<20*d),A.forEach(function(t){t.pts=t.dts=l(t.pts-u,e*n)}),A=A.filter(function(t){return t.pts>=0}),0!==A.length){if(i||(y=s?e*n:A[0].pts),t.isAAC)for(var S=this.config.maxAudioFramesDrift,I=0,b=y;I<A.length;){var R,P=A[I],M=P.pts;R=M-b;var O=Math.abs(1e3*R/n);if(R<=-S*d)C.b.warn("Dropping 1 audio frame @ "+(b/n).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),A.splice(I,1),t.len-=P.unit.length;else if(R>=S*d&&O<1e4&&b){var L=Math.round(R/d);C.b.warn("Injecting "+L+" audio frame @ "+(b/n).toFixed(3)+"s due to "+Math.round(1e3*R/n)+" ms gap.");for(var N=0;N<L;N++){var k=Math.max(b,0);v=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),v||(C.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),v=P.unit.subarray()),A.splice(I,0,{unit:v,pts:k,dts:k}),t.len+=v.length,b+=d,I++}P.pts=P.dts=b,b+=d,I++}else Math.abs(R),P.pts=P.dts=b,b+=d,I++}for(var U=0,w=A.length;U<w;U++){var B=A[U],j=B.unit,F=B.pts;if(void 0!==E)p.duration=Math.round((F-E)/r);else{var G=Math.round(1e3*(F-y)/n),V=0;if(i&&t.isAAC&&G){if(G>0&&G<1e4)V=Math.round((F-y)/d),C.b.log(G+" ms hole between AAC samples detected,filling it"),V>0&&(v=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),v||(v=j.subarray()),t.len+=V*v.length);else if(G<-12){C.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(y/n).toFixed(3)+"s/"+(F/n).toFixed(3)+"s/"+-G+"ms"),t.len-=j.byteLength;continue}F=y}if(_=F,!(t.len>0))return;var x=h?t.len:t.len+8;c=h?0:8;try{g=new Uint8Array(x)}catch(t){return void this.observer.trigger(D.a.ERROR,{type:T.b.MUX_ERROR,details:T.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:x,reason:"fail allocating audio mdat "+x})}h||(new DataView(g.buffer).setUint32(0,x),g.set(q.types.mdat,4));for(var H=0;H<V;H++)v=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),v||(C.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),v=j.subarray()),g.set(v,c),c+=v.byteLength,p={size:v.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},m.push(p)}g.set(j,c);var K=j.byteLength;c+=K,p={size:K,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},m.push(p),E=F}var W=0,z=m.length;if(z>=2&&(W=m[z-2].duration,p.duration=W),z){this.nextAudioPts=y=E+r*W,t.len=0,t.samples=m,f=h?new Uint8Array:q.moof(t.sequenceNumber++,_/r,t),t.samples=[];var X=_/n,J=y/n,Q={data1:f,data2:g,startPTS:X,endPTS:J,startDTS:X,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.observer.trigger(D.a.FRAG_PARSING_DATA,Q),Q}return null}},t.prototype.remuxEmptyAudio=function(t,e,i,s){var n=t.inputTimeScale,a=t.samplerate?t.samplerate:n,r=n/a,o=this.nextAudioPts,d=(void 0!==o?o:s.startDTS*n)+this._initDTS,l=s.endDTS*n+this._initDTS,u=1024*r,h=Math.ceil((l-d)/u),c=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(C.b.warn("remux empty Audio"),!c)return void C.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],v=0;v<h;v++){var g=d+v*u;p.push({unit:c,pts:g,dts:g}),t.len+=c.length}t.samples=p,this.remuxAudio(t,e,i)},t.prototype.remuxID3=function(t,e){var i=t.samples.length,s=void 0,n=t.inputTimeScale,a=this._initPTS,r=this._initDTS;if(i){for(var o=0;o<i;o++)s=t.samples[o],s.pts=(s.pts-a)/n,s.dts=(s.dts-r)/n;this.observer.trigger(D.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},t.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var i=t.samples.length,s=void 0,n=t.inputTimeScale,a=this._initPTS;if(i){for(var r=0;r<i;r++)s=t.samples[r],s.pts=(s.pts-a)/n;this.observer.trigger(D.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},t.prototype._PTSNormalize=function(t,e){var i=void 0;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t},t}(),J=X,Q=function(){function t(e){y(this,t),this.observer=e}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,i,s,n,a,r,o){var d=this.observer,l="";t&&(l+="audio"),e&&(l+="video"),d.trigger(D.a.FRAG_PARSING_DATA,{data1:o,startPTS:n,startDTS:n,type:l,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),d.trigger(D.a.FRAG_PARSED)},t}(),Z=Q,$=Object(R.a)(),tt=$.performance,et=function(){function t(e,i,s,n){S(this,t),this.observer=e,this.typeSupported=i,this.config=s,this.vendor=n}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,i,s,n,a,r,o,d,l,u,h){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var c=this.decrypter;null==c&&(c=this.decrypter=new I.a(this.observer,this.config));var p=this,v=void 0;try{v=tt.now()}catch(t){v=Date.now()}c.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var c=void 0;try{c=tt.now()}catch(t){c=Date.now()}p.observer.trigger(D.a.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:c}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),s,n,a,r,o,d,l,u,h)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(i),s,n,a,r,o,d,l,u,h)},t.prototype.pushDecrypted=function(t,e,i,s,n,a,r,o,d,l,u,h){var c=this.demuxer;if(!c||(r||o)&&!this.probe(t)){for(var p=this.observer,v=this.typeSupported,g=this.config,f=[{demux:V,remux:J},{demux:L.a,remux:Z},{demux:O,remux:J},{demux:H,remux:J}],_=0,E=f.length;_<E;_++){var A=f[_],m=A.demux.probe;if(m(t)){var y=this.remuxer=new A.remux(p,g,v,this.vendor);c=new A.demux(p,y,g,v),this.probe=m;break}}if(!c)return void p.trigger(D.a.ERROR,{type:T.b.MEDIA_ERROR,details:T.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=c}var S=this.remuxer;(r||o)&&(c.resetInitSegment(i,s,n,l),S.resetInitSegment()),r&&(c.resetTimeStamp(h),S.resetTimeStamp(h)),"function"==typeof c.setDecryptData&&c.setDecryptData(e),c.append(t,a,d,u)},t}();e.a=et},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){var i=De[e];return!!i&&!0===i[t.slice(0,4)]}function l(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var i=t[e],s=e-1;s>=0;s--){var n=t[s];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}function c(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(ie.a)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}}function P(t,e,i){var s=t[e],n=t[i],a=n.startPTS;Object(ie.a)(a)?i>e?(s.duration=a-s.start,s.duration<0&&ne.b.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")):(n.duration=s.start-a,n.duration<0&&ne.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=i>e?s.start+s.duration:Math.max(s.start-n.duration,0)}function M(t,e,i,s,n,a){var r=i;if(Object(ie.a)(e.startPTS)){var o=Math.abs(e.startPTS-i);Object(ie.a)(e.deltaPTS)?e.deltaPTS=Math.max(o,e.deltaPTS):e.deltaPTS=o,r=Math.max(i,e.startPTS),i=Math.min(i,e.startPTS),s=Math.max(s,e.endPTS),n=Math.min(n,e.startDTS),a=Math.max(a,e.endDTS)}var d=i-e.start;e.start=e.startPTS=i,e.maxStartPTS=r,e.endPTS=s,e.startDTS=n,e.endDTS=a,e.duration=s-i;var l=e.sn;if(!t||l<t.startSN||l>t.endSN)return 0;var u=void 0,h=void 0,c=void 0;for(u=l-t.startSN,h=t.fragments,h[u]=e,c=u;c>0;c--)P(h,c,c-1);for(c=u;c<h.length-1;c++)P(h,c,c+1);return t.PTSKnown=!0,d}function O(t,e){var i=Math.max(t.startSN,e.startSN)-e.startSN,s=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,a=t.fragments,r=e.fragments,o=0,d=void 0;if(e.initSegment&&t.initSegment&&(e.initSegment=t.initSegment),s<i)return void(e.PTSKnown=!1);for(var l=i;l<=s;l++){var u=a[n+l],h=r[l];h&&u&&(o=u.cc-h.cc,Object(ie.a)(u.startPTS)&&(h.start=h.startPTS=u.startPTS,h.endPTS=u.endPTS,h.duration=u.duration,h.backtracked=u.backtracked,h.dropped=u.dropped,d=h))}if(o)for(ne.b.log("discontinuity sliding from playlist, take drift into account"),l=0;l<r.length;l++)r[l].cc+=o;if(d)M(e,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS);else if(n>=0&&n<a.length){var c=a[n].start;for(l=0;l<r.length;l++)r[l].start+=c}e.PTSKnown=t.PTSKnown}function L(t,e){for(var i=null,s=0;s<t.length;s+=1){var n=t[s];if(n&&n.cc===e){i=n;break}}return i}function N(t,e){return Ye.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}function k(t,e,i){var s=!1;return e&&e.details&&i&&(i.endCC>i.startCC||t&&t.cc<i.startCC)&&(s=!0),s}function U(t,e){var i=t.fragments,s=e.fragments;if(!s.length||!i.length)return void ne.b.log("No fragments to align");var n=L(i,s[0].cc);return!n||n&&!n.startPTS?void ne.b.log("No frag in previous level to align on"):n}function w(t,e){e.fragments.forEach(function(e){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}),e.PTSKnown=!0}function B(t,e,i){j(t,i,e),!i.PTSKnown&&e&&F(i,e.details)}function j(t,e,i){if(k(t,i,e)){var s=U(i.details,e);s&&(ne.b.log("Adjusting PTS using last level due to CC increase within current level"),w(s.start,e))}}function F(t,e){if(e&&e.fragments.length){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;var i=e.fragments[0].programDateTime,s=t.fragments[0].programDateTime,n=(s-i)/1e3+e.fragments[0].start;Object(ie.a)(n)&&(ne.b.log("adjusting PTS using programDateTime delta, sliding:"+n.toFixed(3)),w(n,t))}}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function H(t,e,i){if(!Array.isArray(t)||!t.length||!Object(ie.a)(e))return null;if(e<t[0].programDateTime)return null;if(e>=t[t.length-1].endProgramDateTime)return null;i=i||0;for(var s=0;s<t.length;++s){var n=t[s];if(W(e,i,n))return n}return null}function K(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=t?e[t.sn-e[0].sn+1]:null;return n&&!Y(i,s,n)?n:Ye.search(e,Y.bind(null,i,s))}function Y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2],s=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=t?1:i.start-s>t&&i.start?-1:0}function W(t,e,i){var s=1e3*Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.endProgramDateTime-s>t}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function X(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function $(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function tt(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function et(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function nt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function at(){var t=b(),e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!i&&!!s}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ut(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function pt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ft(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function At(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Dt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function bt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Ct(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new is,this.regionList=[]}function Rt(t){function e(t,e,i,s){return 3600*(0|t)+60*(0|e)+(0|i)+(0|s)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}function Pt(){this.values=Object.create(null)}function Mt(t,e,i,s){var n=s?t.split(s):[t];for(var a in n)if("string"==typeof n[a]){var r=n[a].split(i);if(2===r.length){var o=r[0],d=r[1];e(o,d)}}}function Ot(t,e,i){function s(){var e=Rt(t);if(null===e)throw new Error("Malformed timestamp: "+a);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function n(){t=t.replace(/^\s+/,"")}var a=t;if(n(),e.startTime=s(),n(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);t=t.substr(3),n(),e.endTime=s(),n(),function(t,e){var s=new Pt;Mt(t,function(t,e){switch(t){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===e){s.set(t,i[n].region);break}break;case"vertical":s.alt(t,e,["rl","lr"]);break;case"line":var a=e.split(","),r=a[0];s.integer(t,r),s.percent(t,r)&&s.set("snapToLines",!1),s.alt(t,r,["auto"]),2===a.length&&s.alt("lineAlign",a[1],["start",ns,"end"]);break;case"position":a=e.split(","),s.percent(t,a[0]),2===a.length&&s.alt("positionAlign",a[1],["start",ns,"end","line-left","line-right","auto"]);break;case"size":s.percent(t,e);break;case"align":s.alt(t,e,["start",ns,"end","left","right"])}},/:/,/\s/),e.region=s.get("region",null),e.vertical=s.get("vertical","");var n=s.get("line","auto");"auto"===n&&-1===ss.line&&(n=-1),e.line=n,e.lineAlign=s.get("lineAlign","start"),e.snapToLines=s.get("snapToLines",!0),e.size=s.get("size",100),e.align=s.get("align",ns);var a=s.get("position","auto");"auto"===a&&50===ss.position&&(a="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=a}(t,e)}function Lt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function Nt(t,e,i,s){for(var n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=window.VTTCue||window.TextTrackCue,u=0;u<s.rows.length;u++)if(n=s.rows[u],r=!0,o=0,d="",!n.isEmpty()){for(var h=0;h<n.chars.length;h++)n.chars[h].uchar.match(/\s/)&&r?o++:(d+=n.chars[h].uchar,r=!1);n.cueStartTime=e,e===i&&(i+=1e-4),a=new l(e,i,Lt(d.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=u+1:a.line=u>7?u-2:u+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(a)}}function kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function jt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Ft(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function Gt(t,e,i,s){return Math.min(e,s)-Math.max(t,i)}function Vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Kt(t){for(var e=[],i=0;i<t.length;i++)"subtitles"===t[i].kind&&e.push(t[i]);return e}function Yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function zt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Jt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Zt={};i.d(Zt,"newCue",function(){return Nt});var $t=i(5),te=i.n($t),ee=i(2),ie=i(3),se=i(1),ne=i(0),ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),oe=function(){function t(e){s(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.prototype.onHandlerDestroying=function(){},t.prototype.onHandlerDestroyed=function(){},t.prototype.isEventHandler=function(){return"object"===ae(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(re.has(t))throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){var i=function(t,e){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,e)};try{i.call(this,t,e).call()}catch(e){ne.b.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}(),de=oe,le=i(9),ue=function(){function t(t,e){for(var i=0;i<e.length;i++){
var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),he=function(){function t(){n(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return ue(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=te.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),ce=he,pe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),ve=function(){function t(){var e;a(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(e={},e[t.ElementaryStreamTypes.AUDIO]=!1,e[t.ElementaryStreamTypes.VIDEO]=!1,e)}return t.prototype.addElementaryStream=function(t){this._elementaryStreams[t]=!0},t.prototype.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},t.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},t.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var i=t;return t&&t.method&&t.uri&&!t.iv&&(i=new ce,i.method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(e)),i},pe(t,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=te.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var i=this.lastByteRangeEndOffset;t[0]=i||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0],this._byteRange=t}return t}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function(){if(!Object(ie.a)(this.programDateTime))return null;var t=Object(ie.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),t}(),ge=ve,fe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),_e=function(){function t(e){r(this,t),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return fe(t,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(ie.a)(this.fragments[0].programDateTime))}}]),t}(),Ee=_e,Ae=/^(\d+)x(\d+)$/,me=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ye=function(){function t(e){o(this,t),"string"==typeof e&&(e=t.parseAttrList(e));for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])}return t.prototype.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(2*s,2*s+2),16);return i}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.prototype.enumeratedString=function(t){return this[t]},t.prototype.decimalResolution=function(t){var e=Ae.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e=void 0,i={};for(me.lastIndex=0;null!==(e=me.exec(t));){var s=e[2];0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1&&(s=s.slice(1,-1)),i[e[1]]=s}return i},t}(),Se=ye,De={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Te=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Ie=/#EXT-X-MEDIA:(.*)/g,be=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ce=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,Re=/\.(mp4|m4s|m4v|m4a)$/i,Pe=function(){function t(){u(this,t)}return t.findGroup=function(t,e){if(!t)return null;for(var i=null,s=0;s<t.length;s++){var n=t[s];n.id===e&&(i=n)}return i},t.convertAVC1ToAVCOTI=function(t){var e=void 0,i=t.split(".");return i.length>2?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e},t.resolve=function(t,e){return te.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,i){var s=[],n=void 0;for(Te.lastIndex=0;null!=(n=Te.exec(e));){var a={},r=a.attrs=new Se(n[1]);a.url=t.resolve(n[2],i);var o=r.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),a.name=r.NAME,function(t,e){["video","audio"].forEach(function(i){var s=t.filter(function(t){return d(t,i)});if(s.length){var n=s.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[i+"Codec"]=n.length>0?n[0]:s[0],t=t.filter(function(t){return-1===s.indexOf(t)})}}),e.unknownCodecs=t}([].concat((r.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=t.convertAVC1ToAVCOTI(a.videoCodec)),s.push(a)}return s},t.parseMasterPlaylistMedia=function(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=void 0,r=[],o=0;for(Ie.lastIndex=0;null!==(a=Ie.exec(e));){var d={},l=new Se(a[1]);if(l.TYPE===s){if(d.groupId=l["GROUP-ID"],d.name=l.NAME,d.type=s,d.default="YES"===l.DEFAULT,d.autoselect="YES"===l.AUTOSELECT,d.forced="YES"===l.FORCED,l.URI&&(d.url=t.resolve(l.URI,i)),d.lang=l.LANGUAGE,d.name||(d.name=d.lang),n.length){var u=t.findGroup(n,d.groupId);d.audioCodec=u?u.codec:n[0].codec}d.id=o++,r.push(d)}}return r},t.parseLevelPlaylist=function(t,e,i,s,n){var a=0,r=0,o=new Ee(e),d=new ce,l=0,u=null,p=new ge,v=void 0,g=void 0,f=null;for(be.lastIndex=0;null!==(v=be.exec(t));){var _=v[1];if(_){p.duration=parseFloat(_);var E=(" "+v[2]).slice(1);p.title=E||null,p.tagList.push(E?["INF",_,E]:["INF",_])}else if(v[3]){if(Object(ie.a)(p.duration)){var A=a++;p.type=s,p.start=r,p.levelkey=d,p.sn=A,p.level=i,p.cc=l,p.urlId=n,p.baseurl=e,p.relurl=(" "+v[3]).slice(1),c(p,u),o.fragments.push(p),u=p,r+=p.duration,p=new ge}}else if(v[4]){if(p.rawByteRange=(" "+v[4]).slice(1),u){var m=u.byteRangeEndOffset;m&&(p.lastByteRangeEndOffset=m)}}else if(v[5])p.rawProgramDateTime=(" "+v[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===f&&(f=o.fragments.length);else{for(v=v[0].match(Ce),g=1;g<v.length&&void 0===v[g];g++);var y=(" "+v[g+1]).slice(1),S=(" "+v[g+2]).slice(1);switch(v[g]){case"#":p.tagList.push(S?[y,S]:[y]);break;case"PLAYLIST-TYPE":o.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":a=o.startSN=parseInt(y);break;case"TARGETDURATION":o.targetduration=parseFloat(y);break;case"VERSION":o.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"DIS":l++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":l=parseInt(y);break;case"KEY":var D=y,T=new Se(D),I=T.enumeratedString("METHOD"),b=T.URI,C=T.hexadecimalInteger("IV");I&&(d=new ce,b&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(d.method=I,d.baseuri=e,d.reluri=b,d.key=null,d.iv=C));break;case"START":var R=y,P=new Se(R),M=P.decimalFloatingPoint("TIME-OFFSET");Object(ie.a)(M)&&(o.startTimeOffset=M);break;case"MAP":var O=new Se(y);p.relurl=O.URI,p.rawByteRange=O.BYTERANGE,p.baseurl=e,p.level=i,p.type=s,p.sn="initSegment",o.initSegment=p,p=new ge,p.rawProgramDateTime=o.initSegment.rawProgramDateTime;break;default:ne.b.warn("line parsed but not handled: "+v)}}}return p=u,p&&!p.relurl&&(o.fragments.pop(),r-=p.duration),o.totalduration=r,o.averagetargetduration=r/o.fragments.length,o.endSN=a-1,o.startCC=o.fragments[0]?o.fragments[0].cc:0,o.endCC=l,!o.initSegment&&o.fragments.length&&o.fragments.every(function(t){return Re.test(t.relurl)})&&(ne.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),p=new ge,p.relurl=o.fragments[0].relurl,p.baseurl=e,p.level=i,p.type=s,p.sn="initSegment",o.initSegment=p,o.needSidxRanges=!0),f&&h(o.fragments,f),o},t}(),Me=Pe,Oe=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Le=window,Ne=Le.performance,ke={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ue={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},we=function(t){function e(i){p(this,e);var s=v(this,t.call(this,i,se.a.MANIFEST_LOADING,se.a.LEVEL_LOADING,se.a.AUDIO_TRACK_LOADING,se.a.SUBTITLE_TRACK_LOADING));return s.loaders={},s}return g(e,t),e.canHaveQualityLevels=function(t){return t!==ke.AUDIO_TRACK&&t!==ke.SUBTITLE_TRACK},e.mapContextToLevelType=function(t){switch(t.type){case ke.AUDIO_TRACK:return Ue.AUDIO;case ke.SUBTITLE_TRACK:return Ue.SUBTITLE;default:return Ue.MAIN}},e.getResponseUrl=function(t,e){var i=t.url;return void 0!==i&&0!==i.indexOf("data:")||(i=e.url),i},e.prototype.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,s=e.loader,n=i||s,a=new n(e);return t.loader=a,this.loaders[t.type]=a,a},e.prototype.getInternalLoader=function(t){return this.loaders[t.type]},e.prototype.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.prototype.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.prototype.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},e.prototype.onManifestLoading=function(t){this.load(t.url,{type:ke.MANIFEST,level:0,id:null})},e.prototype.onLevelLoading=function(t){this.load(t.url,{type:ke.LEVEL,level:t.level,id:t.id})},e.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:ke.AUDIO_TRACK,level:null,id:t.id})},e.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:ke.SUBTITLE_TRACK,level:null,id:t.id})},e.prototype.load=function(t,e){var i=this.hls.config;ne.b.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var s=this.getInternalLoader(e);if(s){var n=s.context;if(n&&n.url===t)return ne.b.trace("playlist request ongoing"),!1;ne.b.warn("aborting previous loader for type: "+e.type),s.abort()}var a=void 0,r=void 0,o=void 0,d=void 0;switch(e.type){case ke.MANIFEST:a=i.manifestLoadingMaxRetry,r=i.manifestLoadingTimeOut,o=i.manifestLoadingRetryDelay,d=i.manifestLoadingMaxRetryTimeout;break;case ke.LEVEL:a=0,r=i.levelLoadingTimeOut;break;default:a=i.levelLoadingMaxRetry,r=i.levelLoadingTimeOut,o=i.levelLoadingRetryDelay,d=i.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(e),e.url=t,e.responseType=e.responseType||"";var l={timeout:r,maxRetry:a,retryDelay:o,maxRetryDelay:d},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return ne.b.debug("Calling internal loader delegate for URL: "+t),s.load(e,l,u),!0},e.prototype.loadsuccess=function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i.isSidxRequest)return this._handleSidxRequest(t,i),void this._handlePlaylistLoaded(t,e,i,s);this.resetInternalLoader(i.type);var n=t.data;if(e.tload=Ne.now(),0!==n.indexOf("#EXTM3U"))return void this._handleManifestParsingError(t,i,"no EXTM3U delimiter",s);n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,i,s):this._handleMasterPlaylist(t,e,i,s)},e.prototype.loaderror=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(e,i)},e.prototype.loadtimeout=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(e,i,!0)},e.prototype._handleMasterPlaylist=function(t,i,s,n){var a=this.hls,r=t.data,o=e.getResponseUrl(t,s),d=Me.parseMasterPlaylist(r,o);if(!d.length)return void this._handleManifestParsingError(t,s,"no level found in manifest",n);var l=d.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),u=Me.parseMasterPlaylistMedia(r,o,"AUDIO",l),h=Me.parseMasterPlaylistMedia(r,o,"SUBTITLES");if(u.length){var c=!1;u.forEach(function(t){t.url||(c=!0)}),!1===c&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(ne.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))}a.trigger(se.a.MANIFEST_LOADED,{levels:d,audioTracks:u,subtitles:h,url:o,stats:i,networkDetails:n})},e.prototype._handleTrackOrLevelPlaylist=function(t,i,s,n){var a=this.hls,r=s.id,o=s.level,d=s.type,l=e.getResponseUrl(t,s),u=Object(ie.a)(r)?r:0,h=Object(ie.a)(o)?o:u,c=e.mapContextToLevelType(s),p=Me.parseLevelPlaylist(t.data,l,h,c,u);if(p.tload=i.tload,d===ke.MANIFEST){var v={url:l,details:p};a.trigger(se.a.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:l,stats:i,networkDetails:n})}if(i.tparsed=Ne.now(),p.needSidxRanges){var g=p.initSegment.url;return void this.load(g,{isSidxRequest:!0,type:d,level:o,levelDetails:p,id:r,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}s.levelDetails=p,this._handlePlaylistLoaded(t,i,s,n)},e.prototype._handleSidxRequest=function(t,e){var i=le.a.parseSegmentIndex(new Uint8Array(t.data));i.references.forEach(function(t,i){var s=t.info,n=e.levelDetails.fragments[i];0===n.byteRange.length&&(n.rawByteRange=String(1+s.end-s.start)+"@"+String(s.start))}),e.levelDetails.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"},e.prototype._handleManifestParsingError=function(t,e,i,s){this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:i,networkDetails:s})},e.prototype._handleNetworkError=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ne.b.info("A network error occured while loading a "+t.type+"-type playlist");var s=void 0,n=void 0,a=this.getInternalLoader(t);switch(t.type){case ke.MANIFEST:s=i?ee.a.MANIFEST_LOAD_TIMEOUT:ee.a.MANIFEST_LOAD_ERROR,n=!0;break;case ke.LEVEL:s=i?ee.a.LEVEL_LOAD_TIMEOUT:ee.a.LEVEL_LOAD_ERROR,n=!1;break;case ke.AUDIO_TRACK:s=i?ee.a.AUDIO_TRACK_LOAD_TIMEOUT:ee.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;default:n=!1}a&&(a.abort(),this.resetInternalLoader(t.type)),this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:s,fatal:n,url:a.url,loader:a,context:t,networkDetails:e})},e.prototype._handlePlaylistLoaded=function(t,i,s,n){var a=s.type,r=s.level,o=s.id,d=s.levelDetails;if(!d.targetduration)return void this._handleManifestParsingError(t,s,"invalid target duration",n);if(e.canHaveQualityLevels(s.type))this.hls.trigger(se.a.LEVEL_LOADED,{details:d,level:r||0,id:o||0,stats:i,networkDetails:n});else switch(a){case ke.AUDIO_TRACK:this.hls.trigger(se.a.AUDIO_TRACK_LOADED,{details:d,id:o,stats:i,networkDetails:n});break;case ke.SUBTITLE_TRACK:this.hls.trigger(se.a.SUBTITLE_TRACK_LOADED,{details:d,id:o,stats:i,networkDetails:n})}},Oe(e,null,[{key:"ContextType",get:function(){return ke}},{key:"LevelType",get:function(){return Ue}}]),e}(de),Be=we,je=function(t){function e(i){f(this,e);var s=_(this,t.call(this,i,se.a.FRAG_LOADING));return s.loaders={},s}return E(e,t),e.prototype.destroy=function(){var e=this.loaders;for(var i in e){var s=e[i];s&&s.destroy()}this.loaders={},t.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag,i=e.type,s=this.loaders,n=this.hls.config,a=n.fLoader,r=n.loader;e.loaded=0;var o=s[i];o&&(ne.b.warn("abort previous fragment loader for type: "+i),o.abort()),o=s[i]=e.loader=n.fLoader?new a(n):new r(n);var d=void 0,l=void 0,u=void 0;d={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var h=e.byteRangeStartOffset,c=e.byteRangeEndOffset;Object(ie.a)(h)&&Object(ie.a)(c)&&(d.rangeStart=h,d.rangeEnd=c),l={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},o.load(d,l,u)},e.prototype.loadsuccess=function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=t.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(se.a.FRAG_LOADED,{payload:n,frag:a,stats:e,networkDetails:s})},e.prototype.loaderror=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=e.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:i})},e.prototype.loadtimeout=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=e.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:i})},e.prototype.loadprogress=function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=e.frag;n.loaded=t.loaded,this.hls.trigger(se.a.FRAG_LOAD_PROGRESS,{frag:n,stats:t,networkDetails:s})},e}(de),Fe=je,Ge=function(t){function e(i){A(this,e);var s=m(this,t.call(this,i,se.a.KEY_LOADING));return s.loaders={},s.decryptkey=null,s.decrypturl=null,s}return y(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},de.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,i=e.type,s=this.loaders[i],n=e.decryptdata,a=n.uri;if(a!==this.decrypturl||null===this.decryptkey){var r=this.hls.config;s&&(ne.b.warn("abort previous key loader for type:"+i),s.abort()),e.loader=this.loaders[i]=new r.loader(r),this.decrypturl=a,this.decryptkey=null;var o=void 0,d=void 0,l=void 0;o={url:a,frag:e,responseType:"arraybuffer"},d={timeout:r.fragLoadingTimeOut,maxRetry:r.fragLoadingMaxRetry,retryDelay:r.fragLoadingRetryDelay,maxRetryDelay:r.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(o,d,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(se.a.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,i){var s=i.frag;this.decryptkey=s.decryptdata.key=new Uint8Array(t.data),s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(se.a.KEY_LOADED,{frag:s})},e.prototype.loaderror=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},e.prototype.loadtimeout=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(se.a.ERROR,{type:ee.b.NETWORK_ERROR,details:ee.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},e}(de),Ve=Ge,xe={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},He=function(t){function e(i){S(this,e);var s=D(this,t.call(this,i,se.a.BUFFER_APPENDED,se.a.FRAG_BUFFERED,se.a.FRAG_LOADED));return s.bufferPadding=.2,s.fragments=Object.create(null),s.timeRanges=Object.create(null),s.config=i.config,s}return T(e,t),e.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,de.prototype.destroy.call(this),t.prototype.destroy.call(this)},e.prototype.getBufferedFrag=function(t,e){var i=this.fragments,s=Object.keys(i).filter(function(s){var n=i[s];if(n.body.type!==e)return!1;if(!n.buffered)return!1;var a=n.body;return a.startPTS<=t&&t<=a.endPTS});if(0===s.length)return null;var n=s.pop();return i[n].body},e.prototype.detectEvictedFragments=function(t,e){var i=this,s=void 0,n=void 0;Object.keys(this.fragments).forEach(function(a){var r=i.fragments[a];if(!0===r.buffered){var o=r.range[t];if(o){s=o.time;for(var d=0;d<s.length;d++)if(n=s[d],!1===i.isTimeBuffered(n.startPTS,n.endPTS,e)){i.removeFragment(r.body);break}}}})},e.prototype.detectPartialFragments=function(t){var e=this,i=this.getFragmentKey(t),s=this.fragments[i];s&&(s.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(t.hasElementaryStream(i)){var n=e.timeRanges[i];s.range[i]=e.getBufferedTimes(t.startPTS,t.endPTS,n)}}))},e.prototype.getBufferedTimes=function(t,e,i){for(var s=[],n=void 0,a=void 0,r=!1,o=0;o<i.length;o++){if(n=i.start(o)-this.bufferPadding,a=i.end(o)+this.bufferPadding,t>=n&&e<=a){s.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))});break}if(t<a&&e>n)s.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))}),r=!0;else if(e<=n)break}return{time:s,partial:r}},e.prototype.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},e.prototype.getPartialFragment=function(t){var e=this,i=void 0,s=void 0,n=void 0,a=null,r=0;return Object.keys(this.fragments).forEach(function(o){var d=e.fragments[o];e.isPartial(d)&&(s=d.body.startPTS-e.bufferPadding,n=d.body.endPTS+e.bufferPadding,t>=s&&t<=n&&(i=Math.min(t-s,n-t),r<=i&&(a=d.body,r=i)))}),a},e.prototype.getState=function(t){var e=this.getFragmentKey(t),i=this.fragments[e],s=xe.NOT_LOADED;return void 0!==i&&(s=i.buffered?!0===this.isPartial(i)?xe.PARTIAL:xe.OK:xe.APPENDING),s},e.prototype.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},e.prototype.isTimeBuffered=function(t,e,i){for(var s=void 0,n=void 0,a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,t>=s&&e<=n)return!0;if(e<=s)return!1}return!1},e.prototype.onFragLoaded=function(t){var e=t.frag;Object(ie.a)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},e.prototype.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var i=e.timeRanges[t];e.detectEvictedFragments(t,i)})},e.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},e.prototype.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},e.prototype.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},e.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},e}(de),Ke={search:function(t,e){for(var i=0,s=t.length-1,n=null,a=null;i<=s;){n=(i+s)/2|0,a=t[n];var r=e(a);if(r>0)i=n+1;else{if(!(r<0))return a;s=n-1}}return null}},Ye=Ke,We=function(){function t(){I(this,t)}return t.isBuffered=function(t,e){try{if(t)for(var i=t.buffered,s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}catch(t){}return!1},t.bufferInfo=function(t,e,i){try{if(t){var s=t.buffered,n=[],a=void 0;for(a=0;a<s.length;a++)n.push({start:s.start(a),end:s.end(a)});return this.bufferedInfo(n,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,i){var s=[],n=void 0,a=void 0,r=void 0,o=void 0,d=void 0;for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),d=0;d<t.length;d++){var l=s.length;if(l){var u=s[l-1].end;t[d].start-u<i?t[d].end>u&&(s[l-1].end=t[d].end):s.push(t[d])}else s.push(t[d])}for(d=0,n=0,a=r=e;d<s.length;d++){var h=s[d].start,c=s[d].end;if(e+i>=h&&e<c)a=h,r=c,n=r-e;else if(e+i<h){o=h;break}}return{len:n,start:a,end:r,nextStart:o}},t}(),ze=i(7),qe=i.n(ze),Xe=i(12),Je=i.n(Xe),Qe=i(10),Ze=i(4),$e=Object(Ze.a)(),ti=b(),ei=function(){function t(e,i){C(this,t),this.hls=e,this.id=i;var s=this.observer=new qe.a,n=e.config;s.trigger=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];s.emit.apply(s,[t,t].concat(i))},s.off=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];s.removeListener.apply(s,[t].concat(i))};var a=function(t,i){i=i||{},i.frag=this.frag,i.id=this.id,e.trigger(t,i)}.bind(this);s.on(se.a.FRAG_DECRYPTED,a),s.on(se.a.FRAG_PARSING_INIT_SEGMENT,a),s.on(se.a.FRAG_PARSING_DATA,a),s.on(se.a.FRAG_PARSED,a),s.on(se.a.ERROR,a),s.on(se.a.FRAG_PARSING_METADATA,a),s.on(se.a.FRAG_PARSING_USERDATA,a),s.on(se.a.INIT_PTS_FOUND,a);var r={mp4:ti.isTypeSupported("video/mp4"),mpeg:ti.isTypeSupported("audio/mpeg"),mp3:ti.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(n.enableWorker&&"undefined"!=typeof Worker){ne.b.log("demuxing in webworker");var d=void 0;try{d=this.w=Je()(13),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(t){e.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:r,vendor:o,id:i,config:JSON.stringify(n)})}catch(t){ne.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&$e.URL.revokeObjectURL(d.objectURL),this.demuxer=new Qe.a(s,r,n,o),this.w=void 0}}else this.demuxer=new Qe.a(s,r,n,o)}return t.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,e,i,s,n,a,r,o){var d=this.w,l=Object(ie.a)(n.startDTS)?n.startDTS:n.start,u=n.decryptdata,h=this.frag,c=!(h&&n.cc===h.cc),p=!(h&&n.level===h.level),v=h&&n.sn===h.sn+1,g=!p&&v;if(c&&ne.b.log(this.id+":discontinuity detected"),p&&ne.b.log(this.id+":switch detected"),this.frag=n,d)d.postMessage({cmd:"demux",data:t,decryptdata:u,initSegment:e,audioCodec:i,videoCodec:s,timeOffset:l,discontinuity:c,trackSwitch:p,contiguous:g,duration:a,accurateTimeOffset:r,defaultInitPTS:o},t instanceof ArrayBuffer?[t]:[]);else{var f=this.demuxer;f&&f.push(t,u,e,i,s,l,c,p,g,a,r,o)}},t.prototype.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":$e.URL.revokeObjectURL(this.w.objectURL);break;case se.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},t}(),ii=ei,si={toString:function(t){for(var e="",i=t.length,s=0;s<i;s++)e+="["+t.start(s).toFixed(3)+","+t.end(s).toFixed(3)+"]";return e}},ni=si,ai=function(t){function e(i){G(this,e);for(var s=arguments.length,n=Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];var r=V(this,t.call.apply(t,[this,i].concat(n)));return r._tickInterval=null,r._tickTimer=null,r._tickCallCount=0,r._boundTick=r.tick.bind(r),r}return x(e,t),e.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.prototype.hasInterval=function(){return!!this._tickInterval},e.prototype.hasNextTick=function(){return!!this._tickTimer},e.prototype.setInterval=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,t),!0)}),e.prototype.clearInterval=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),e.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.prototype.tick=function(){1==++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},e.prototype.doTick=function(){},e}(de),ri=ai,oi=function(){function t(e,i,s,n){z(this,t),this.config=e,this.media=i,this.fragmentTracker=s,this.hls=n,this.stallReported=!1}return t.prototype.poll=function(t,e){var i=this.config,s=this.media,n=s.currentTime,a=window.performance.now();if(n!==t)return this.stallReported&&(ne.b.warn("playback not stuck anymore @"+n+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(s.ended||!s.buffered.length||s.readyState>2||s.seeking&&We.isBuffered(s,n))){var r=a-this.stalled,o=We.bufferInfo(s,n,i.maxBufferHole);if(!this.stalled)return void(this.stalled=a);r>=1e3&&this._reportStall(o.len),this._tryFixBufferStall(o,r)}},t.prototype._tryFixBufferStall=function(t,e){var i=this.config,s=this.fragmentTracker,n=this.media,a=n.currentTime,r=s.getPartialFragment(a);r&&this._trySkipBufferHole(r),t.len>.5&&e>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function(t){var e=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,ne.b.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),e.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},t.prototype._trySkipBufferHole=function(t){for(var e=this.hls,i=this.media,s=i.currentTime,n=0,a=0;a<i.buffered.length;a++){var r=i.buffered.start(a);if(s>=n&&s<r)return i.currentTime=Math.max(r,i.currentTime+.1),ne.b.warn("skipping hole, adjusting currentTime from "+s+" to "+i.currentTime),this.stalled=null,void e.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+i.currentTime,frag:t});n=i.buffered.end(a)}},t.prototype._tryNudgeBuffer=function(){var t=this.config,e=this.hls,i=this.media,s=i.currentTime,n=(this.nudgeRetry||0)+1;if(this.nudgeRetry=n,n<t.nudgeMaxRetry){var a=s+n*t.nudgeOffset;ne.b.log("adjust currentTime from "+s+" to "+a),i.currentTime=a,e.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else ne.b.error("still stuck in high buffer @"+s+" after "+t.nudgeMaxRetry+", raise fatal error"),e.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_STALLED_ERROR,fatal:!0})},t}(),di=oi,li=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),ui={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},hi=function(t){function e(i,s){q(this,e)
;var n=X(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.MANIFEST_LOADING,se.a.MANIFEST_PARSED,se.a.LEVEL_LOADED,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.FRAG_LOAD_EMERGENCY_ABORTED,se.a.FRAG_PARSING_INIT_SEGMENT,se.a.FRAG_PARSING_DATA,se.a.FRAG_PARSED,se.a.ERROR,se.a.AUDIO_TRACK_SWITCHING,se.a.AUDIO_TRACK_SWITCHED,se.a.BUFFER_CREATED,se.a.BUFFER_APPENDED,se.a.BUFFER_FLUSHED));return n.fragmentTracker=s,n.config=i.config,n.audioCodecSwap=!1,n._state=ui.STOPPED,n.stallReported=!1,n.gapController=null,n}return J(e,t),e.prototype.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=ui.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=i.startLevel;-1===s&&(s=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}e>0&&-1===t&&(ne.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=ui.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=ui.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=ui.STOPPED,this.forceStartLoad=!1},e.prototype.doTick=function(){switch(this.state){case ui.BUFFER_FLUSHING:this.fragLoadError=0;break;case ui.IDLE:this._doTickIdle();break;case ui.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=ui.IDLE);break;case ui.FRAG_LOADING_WAITING_RETRY:var e=window.performance.now(),i=this.retryDate;(!i||e>=i||this.media&&this.media.seeking)&&(ne.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ui.IDLE);break;case ui.ERROR:case ui.STOPPED:case ui.FRAG_LOADING:case ui.PARSING:case ui.PARSED:case ui.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},e.prototype._doTickIdle=function(){var t=this.hls,e=t.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&e.startFragPrefetch)){var s=void 0;s=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=t.nextLoadLevel,a=this.levels[n];if(a){var r=a.bitrate,o=void 0;o=r?Math.max(8*e.maxBufferSize/r,e.maxBufferLength):e.maxBufferLength,o=Math.min(o,e.maxMaxBufferLength);var d=We.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,s,e.maxBufferHole),l=d.len;if(!(l>=o)){ne.b.trace("buffer length of "+l.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;var u=a.details;if(!u||u.live&&this.levelLastLoaded!==n)return void(this.state=ui.WAITING_LEVEL);var h=this.fragPrevious;if(!u.live&&h&&!h.backtracked&&h.sn===u.endSN&&!d.nextStart&&Math.min(i.duration,h.start+h.duration)-Math.max(d.end,h.start)<=Math.max(.2,h.duration)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(se.a.BUFFER_EOS,c),void(this.state=ui.ENDED)}this._fetchPayloadOrEos(s,d,u)}}}},e.prototype._fetchPayloadOrEos=function(t,e,i){var s=this.fragPrevious,n=this.level,a=i.fragments,r=a.length;if(0!==r){var o=a[0].start,d=a[r-1].start+a[r-1].duration,l=e.end,u=void 0;if(i.initSegment&&!i.initSegment.data)u=i.initSegment;else if(i.live){var h=this.config.initialLiveManifestSize;if(r<h)return void ne.b.warn("Can not start playback of a level, reason: not enough fragments "+r+" < "+h);if(null===(u=this._ensureFragmentAtLivePoint(i,l,o,d,s,a,r)))return}else l<o&&(u=a[0]);u||(u=this._findFragment(o,s,r,a,l,d,i)),u&&(u.encrypted?(ne.b.log("Loading key for "+u.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(u)):(ne.b.log("Loading "+u.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+t.toFixed(3)+",bufferEnd:"+l.toFixed(3)),this._loadFragment(u)))}},e.prototype._ensureFragmentAtLivePoint=function(t,e,i,s,n,a,r){var o=this.hls.config,d=this.media,l=void 0,u=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(i-o.maxFragLookUpTolerance,s-u)){var h=this.liveSyncPosition=this.computeLivePosition(i,t);ne.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),e=h,d&&d.readyState&&d.duration>h&&(d.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>s&&d&&d.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(n)if(t.hasProgramDateTime)ne.b.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),l=H(a,n.endProgramDateTime,o.maxFragLookUpTolerance);else{var c=n.sn+1;if(c>=t.startSN&&c<=t.endSN){var p=a[c-t.startSN];n.cc===p.cc&&(l=p,ne.b.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=Ye.search(a,function(t){return n.cc-t.cc}))&&ne.b.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}l||(l=a[Math.min(r-1,Math.round(r/2))],ne.b.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l},e.prototype._findFragment=function(t,e,i,s,n,a,r){var o=this.hls.config,d=void 0;if(d=n<a?K(e,s,n,n>a-o.maxFragLookUpTolerance?0:o.maxFragLookUpTolerance):s[i-1]){var l=d.sn-r.startSN,u=e&&d.level===e.level,h=s[l-1],c=s[l+1];if(e&&d.sn===e.sn)if(u&&!d.backtracked)if(d.sn<r.endSN){var p=e.deltaPTS;p&&p>o.maxBufferHole&&e.dropped&&l?(d=h,ne.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(d=c,ne.b.log("SN just loaded, load next one: "+d.sn,d))}else d=null;else d.backtracked&&(c&&c.backtracked?(ne.b.warn("Already backtracked from fragment "+c.sn+", will not backtrack to fragment "+d.sn+". Loading fragment "+c.sn),d=c):(ne.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),d.dropped=0,h?(d=h,d.backtracked=!0):l&&(d=null)))}return d},e.prototype._loadKey=function(t){this.state=ui.KEY_LOADING,this.hls.trigger(se.a.KEY_LOADING,{frag:t})},e.prototype._loadFragment=function(t){var e=this.fragmentTracker.getState(t);this.fragCurrent=t,this.startFragRequested=!0,Object(ie.a)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||e===xe.NOT_LOADED||e===xe.PARTIAL?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(se.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new ii(this.hls,"main")),this.state=ui.FRAG_LOADING):e===xe.APPENDING&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},e.prototype.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,Be.LevelType.MAIN)},e.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},e.prototype._checkFragmentChanged=function(){var t=void 0,e=void 0,i=this.media;if(i&&i.readyState&&!1===i.seeking&&(e=i.currentTime,e>this.lastCurrentTime&&(this.lastCurrentTime=e),We.isBuffered(i,e)?t=this.getBufferedFrag(e):We.isBuffered(i,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var s=t;if(s!==this.fragPlaying){this.hls.trigger(se.a.FRAG_CHANGED,{frag:s});var n=s.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(se.a.LEVEL_SWITCHED,{level:n}),this.fragPlaying=s}}},e.prototype.immediateLevelSwitch=function(){if(ne.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,We.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},e.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e=void 0,i=void 0,s=void 0;if(i=this.getBufferedFrag(t.currentTime),i&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),t.paused)e=0;else{var n=this.hls.nextLoadLevel,a=this.levels[n],r=this.fragLastKbps;e=r&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*r)+1:0}if((s=this.getBufferedFrag(t.currentTime+e))&&(s=this.followingBufferedFrag(s))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(s.maxStartPTS,Number.POSITIVE_INFINITY)}}},e.prototype.flushMainBuffer=function(t,e){this.state=ui.BUFFER_FLUSHING;var i={startOffset:t,endOffset:e};this.altAudio&&(i.type="video"),this.hls.trigger(se.a.BUFFER_FLUSHING,i)},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new di(i,e,this.fragmentTracker,this.hls)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(ne.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,i=this.config;Object(ie.a)(e)&&ne.b.log("media seeking to "+e.toFixed(3));var s=this.mediaBuffer?this.mediaBuffer:t,n=We.bufferInfo(s,e,this.config.maxBufferHole);if(this.state===ui.FRAG_LOADING){var a=this.fragCurrent;if(0===n.len&&a){var r=i.maxFragLookUpTolerance,o=a.start-r,d=a.start+a.duration+r;e<o||e>d?(a.loader&&(ne.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ui.IDLE):ne.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===ui.ENDED&&(0===n.len&&(this.fragPrevious=0),this.state=ui.IDLE);t&&(this.lastCurrentTime=e),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},e.prototype.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(ie.a)(e)&&ne.b.log("media seeked to "+e.toFixed(3)),this.tick()},e.prototype.onMediaEnded=function(){ne.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestLoading=function(){ne.b.log("trigger BUFFER_RESET"),this.hls.trigger(se.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestParsed=function(t){var e=!1,i=!1,s=void 0;t.levels.forEach(function(t){(s=t.audioCodec)&&(-1!==s.indexOf("mp4a.40.2")&&(e=!0),-1!==s.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=e&&i,this.audioCodecSwitch&&ne.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},e.prototype.onLevelLoaded=function(t){var e=t.details,i=t.level,s=this.levels[this.levelLastLoaded],n=this.levels[i],a=e.totalduration,r=0;if(ne.b.log("level "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live){var o=n.details;o&&e.fragments.length>0?(O(o,e),r=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(r,o),e.PTSKnown&&Object(ie.a)(r)?ne.b.log("live playlist sliding:"+r.toFixed(3)):(ne.b.log("live playlist - outdated PTS, unknown sliding"),B(this.fragPrevious,s,e))):(ne.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,B(this.fragPrevious,s,e))}else e.PTSKnown=!1;if(n.details=e,this.levelLastLoaded=i,this.hls.trigger(se.a.LEVEL_UPDATED,{details:e,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=e.startTimeOffset;Object(ie.a)(d)?(d<0&&(ne.b.log("negative start time offset "+d+", count from end of last fragment"),d=r+a+d),ne.b.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):e.live?(this.startPosition=this.computeLivePosition(r,e),ne.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ui.WAITING_LEVEL&&(this.state=ui.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===ui.KEY_LOADING&&(this.state=ui.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=this.hls,s=this.levels,n=this.media,a=t.frag;if(this.state===ui.FRAG_LOADING&&e&&"main"===a.type&&a.level===e.level&&a.sn===e.sn){var r=t.stats,o=s[e.level],d=o.details;if(this.bitrateTest=!1,this.stats=r,ne.b.log("Loaded "+e.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+e.level),a.bitrateTest&&i.nextLoadLevel)this.state=ui.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=window.performance.now(),i.trigger(se.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=ui.IDLE,r.tparsed=r.tbuffered=window.performance.now(),d.initSegment.data=t.payload,i.trigger(se.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.tick();else{ne.b.log("Parsing "+e.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+e.level+", cc "+e.cc),this.state=ui.PARSING,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var l=!(n&&n.seeking)&&(d.PTSKnown||!d.live),u=d.initSegment?d.initSegment.data:[],h=this._getAudioCodec(o),c=this.demuxer=this.demuxer||new ii(this.hls,"main");c.push(t.payload,u,h,o.videoCodec,e,d.totalduration,l)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===ui.PARSING){var s=t.tracks,n=void 0,a=void 0;if(s.audio&&this.altAudio&&delete s.audio,a=s.audio){var r=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();r&&this.audioCodecSwap&&(ne.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===o.indexOf("firefox")&&(r="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",ne.b.log("Android: force audio codec to "+r)),a.levelCodec=r,a.id=t.id}a=s.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(se.a.BUFFER_CODECS,s);for(n in s){a=s[n],ne.b.log("main track:"+n+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var d=a.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(se.a.BUFFER_APPENDING,{type:n,data:d,parent:"main",content:"initSegment"}))}this.tick()}},e.prototype.onFragParsingData=function(t){var e=this,i=this.fragCurrent,s=t.frag;if(i&&"main"===t.id&&s.sn===i.sn&&s.level===i.level&&("audio"!==t.type||!this.altAudio)&&this.state===ui.PARSING){var n=this.levels[this.level],a=i;if(Object(ie.a)(t.endPTS)||(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),!0===t.hasAudio&&a.addElementaryStream(ge.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&a.addElementaryStream(ge.ElementaryStreamTypes.VIDEO),ne.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped)if(a.backtracked)ne.b.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var r=n.details;if(!r||a.sn!==r.startSN)return ne.b.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=ui.IDLE,this.fragPrevious=a,void this.tick();ne.b.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var o=M(n.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),d=this.hls;d.trigger(se.a.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:o,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(i){i&&i.length&&e.state===ui.PARSING&&(e.appended=!0,e.pendingBuffering=!0,d.trigger(se.a.BUFFER_APPENDING,{type:t.type,data:i,parent:"main",content:"data"}))}),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===ui.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=ui.PARSED,this._checkAppendedParsed())},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url,i=t.id;if(!e){if(this.mediaBuffer!==this.media){ne.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;s.loader&&(ne.b.log("switching to main audio track, cancel main fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ui.IDLE}var n=this.hls;n.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},e.prototype.onAudioTrackSwitched=function(t){var e=t.id,i=!!this.hls.audioTracks[e].url;if(i){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(ne.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()},e.prototype.onBufferCreated=function(t){var e=t.tracks,i=void 0,s=void 0,n=!1;for(var a in e){var r=e[a];"main"===r.id?(s=a,i=r,"video"===a&&(this.videoBuffer=e[a].buffer)):n=!0}n&&i?(ne.b.log("alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==ui.PARSING&&e!==ui.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==ui.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;ne.b.log("main buffered : "+ni.toString(e.buffered)),this.fragPrevious=t;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(se.a.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=ui.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var i=!!this.media&&We.isBuffered(this.media,this.media.currentTime)&&We.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var s=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);ne.b.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=window.performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ui.FRAG_LOADING_WAITING_RETRY}else ne.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=ui.ERROR;break;case ee.a.LEVEL_LOAD_ERROR:case ee.a.LEVEL_LOAD_TIMEOUT:this.state!==ui.ERROR&&(t.fatal?(this.state=ui.ERROR,ne.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==ui.WAITING_LEVEL||(this.state=ui.IDLE));break;case ee.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==ui.PARSING&&this.state!==ui.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ui.IDLE):(ne.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},e.prototype._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,ne.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},e.prototype._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=this.mediaBuffer?this.mediaBuffer:t,i=e.buffered;!this.loadedmetadata&&i.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,i)}},e.prototype.onFragLoadEmergencyAborted=function(){this.state=ui.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},e.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;t&&this.fragmentTracker.detectEvictedFragments(ge.ElementaryStreamTypes.VIDEO,t.buffered),this.state=ui.IDLE,this.fragPrevious=null},e.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.prototype.computeLivePosition=function(t,e){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-i)},e.prototype._seekToStartPos=function(){var t=this.media,e=t.currentTime,i=t.seeking?e:this.startPosition;e!==i&&(ne.b.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+e+" "),t.currentTime=i)},e.prototype._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(ne.b.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},li(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,ne.b.log("main stream:"+e+"->"+t),this.hls.trigger(se.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),e}(ri),ci=hi,pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),gi=window,fi=gi.performance,_i=function(t){function e(i){Q(this,e);var s=Z(this,t.call(this,i,se.a.MANIFEST_LOADED,se.a.LEVEL_LOADED,se.a.AUDIO_TRACK_SWITCHED,se.a.FRAG_LOADED,se.a.ERROR));return s.canload=!1,s.currentLevelIndex=null,s.manualLevelIndex=-1,s.timer=null,s}return $(e,t),e.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},e.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e=[],i=void 0,s={},n=null,a=!1,r=!1,o=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,a=a||!!t.videoCodec,r=r||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),o&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),n=s[t.bitrate],n?n.url.push(t.url):(t.url=[t.url],t.urlId=0,s[t.bitrate]=t,e.push(t)),t.attrs&&t.attrs.AUDIO&&R(n||t,"audio",t.attrs.AUDIO),t.attrs&&t.attrs.SUBTITLES&&R(n||t,"text",t.attrs.SUBTITLES)}),a&&r&&(e=e.filter(function(t){return!!t.videoCodec})),e=e.filter(function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||l(e))&&(!i||l(i))}),t.audioTracks&&(d=t.audioTracks.filter(function(t){return!t.audioCodec||l(t.audioCodec,"audio")}),d.forEach(function(t,e){t.id=e})),e.length>0){i=e[0].bitrate,e.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=e;for(var u=0;u<e.length;u++)if(e[u].bitrate===i){this._firstLevel=u,ne.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+i);break}this.hls.trigger(se.a.MANIFEST_PARSED,{levels:e,audioTracks:d,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:a,altAudio:d.length>0&&a})}else this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},e.prototype.setLevelInternal=function(t){var e=this._levels,i=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){ne.b.log("switching to level "+t),this.currentLevelIndex=t;var s=e[t];s.level=t,i.trigger(se.a.LEVEL_SWITCHING,s)}var n=e[t],a=n.details;if(!a||a.live){var r=n.urlId;i.trigger(se.a.LEVEL_LOADING,{url:n.url[r],level:t,id:r})}}else i.trigger(se.a.ERROR,{type:ee.b.OTHER_ERROR,details:ee.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},e.prototype.onError=function(t){if(t.fatal)return void(t.type===ee.b.NETWORK_ERROR&&this.clearTimer());var e=!1,i=!1,s=void 0;switch(t.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:s=t.frag.level,i=!0;break;case ee.a.LEVEL_LOAD_ERROR:case ee.a.LEVEL_LOAD_TIMEOUT:s=t.context.level,e=!0;break;case ee.a.REMUX_ALLOC_ERROR:s=t.level,e=!0}void 0!==s&&this.recoverLevel(t,s,e,i)},e.prototype.recoverLevel=function(t,e,i,s){var n=this,a=this.hls.config,r=t.details,o=this._levels[e],d=void 0,l=void 0,u=void 0;if(o.loadError++,o.fragmentError=s,i){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return ne.b.error("level controller, cannot recover from "+r+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);l=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return n.loadLevel()},l),t.levelRetry=!0,this.levelRetryCount++,ne.b.warn("level controller, "+r+", retry in "+l+" ms, current retry count is "+this.levelRetryCount)}(i||s)&&(d=o.url.length,d>1&&o.loadError<d?(o.urlId=(o.urlId+1)%d,o.details=void 0,ne.b.warn("level controller, "+r+" for level "+e+": switching to redundant URL-id "+o.urlId)):-1===this.manualLevelIndex?(u=0===e?this._levels.length-1:e-1,ne.b.warn("level controller, "+r+": switch to "+u),this.hls.nextAutoLevel=this.currentLevelIndex=u):s&&(ne.b.warn("level controller, "+r+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var i=this._levels[e.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,i=t.level;if(i===this.currentLevelIndex){var s=this._levels[i];s.fragmentError||(s.loadError=0,this.levelRetryCount=0);var n=t.details;if(n.live){var a=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),r=a,o=s.details;o&&n.endSN===o.endSN&&(r/=2,ne.b.log("same live playlist, reload twice faster")),r-=fi.now()-t.stats.trequest,r=Math.max(a/2,Math.round(r)),ne.b.log("live playlist, reload in "+Math.round(r)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},r)}else this.clearTimer()}},e.prototype.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){var s=i.audioGroupIds.findIndex(function(t){return t===e});s!==i.urlId&&(i.urlId=s,this.startLoad())}},e.prototype.loadLevel=function(){if(ne.b.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"===(void 0===t?"undefined":pi(t))&&t.url.length>0){var e=this.currentLevelIndex,i=t.urlId,s=t.url[i];ne.b.log("Attempt loading level index "+e+" with URL-id "+i),this.hls.trigger(se.a.LEVEL_LOADING,{url:s,level:e,id:i})}}},vi(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(de),Ei=_i,Ai=i(6),mi=function(t){function e(i){it(this,e);var s=st(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.FRAG_PARSING_METADATA));return s.id3Track=void 0,s.media=void 0,s}return nt(e,t),e.prototype.destroy=function(){de.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){et(this.id3Track),this.id3Track=void 0,this.media=void 0},e.prototype.getID3Track=function(t){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return tt(i,this.media),i}return this.media.addTextTrack("metadata","id3")},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var a=Ai.a.getID3Frames(i[n].data);if(a){var r=i[n].pts,o=n<i.length-1?i[n+1].pts:e.endPTS;r===o&&(o+=1e-4);for(var d=0;d<a.length;d++){var l=a[d];if(!Ai.a.isTimeStampFrame(l)){var u=new s(r,o,"");u.value=l,this.id3Track.addCue(u)}}}}},e}(de),yi=mi,Si=function(){function t(e){rt(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}(),Di=Si,Ti=function(){function t(e,i,s,n){ot(this,t),this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Di(i),this.fast_=new Di(s)}return t.prototype.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var i=8e3*e/t,s=t/1e3;this.fast_.sample(s,i),this.slow_.sample(s,i)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){
return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}(),Ii=Ti,bi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ci=window,Ri=Ci.performance,Pi=function(t){function e(i){dt(this,e);var s=lt(this,t.call(this,i,se.a.FRAG_LOADING,se.a.FRAG_LOADED,se.a.FRAG_BUFFERED,se.a.ERROR));return s.lastLoadedFragLevel=0,s._nextAutoLevel=-1,s.hls=i,s.timer=null,s._bwEstimator=null,s.onCheck=s._abandonRulesCheck.bind(s),s}return ut(e,t),e.prototype.destroy=function(){this.clearTimer(),de.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,s=i.config,n=e.level,a=i.levels[n].details.live,r=void 0,o=void 0;a?(r=s.abrEwmaFastLive,o=s.abrEwmaSlowLive):(r=s.abrEwmaFastVoD,o=s.abrEwmaSlowVoD),this._bwEstimator=new Ii(i,o,r,s.abrEwmaDefaultEstimate)}},e.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,i=this.fragCurrent;if(i){var s=i.loader,n=t.minAutoLevel;if(!s||s.stats&&s.stats.aborted)return ne.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=s.stats;if(e&&a&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&i.autoLevel&&i.level){var r=Ri.now()-a.trequest,o=Math.abs(e.playbackRate);if(r>500*i.duration/o){var d=t.levels,l=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/r),u=d[i.level],h=u.realBitrate?Math.max(u.realBitrate,u.bitrate):u.bitrate,c=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*h/8)),p=e.currentTime,v=(c-a.loaded)/l,g=(We.bufferInfo(e,p,t.config.maxBufferHole).end-p)/o;if(g<2*i.duration/o&&v>g){var f=void 0,_=void 0;for(_=i.level-1;_>n;_--){var E=d[_].realBitrate?Math.max(d[_].realBitrate,d[_].bitrate):d[_].bitrate;if((f=i.duration*E/(6.4*l))<g)break}f<v&&(ne.b.warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+f.toFixed(1)+"<"+v.toFixed(1)+":"+g.toFixed(1)),t.nextLoadLevel=_,this._bwEstimator.sample(r,a.loaded),s.abort(),this.clearTimer(),t.trigger(se.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}}},e.prototype.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&Object(ie.a)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],s=(i.loaded?i.loaded.bytes:0)+t.stats.loaded,n=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:s,duration:n},i.realBitrate=Math.round(8*s/n)}if(t.frag.bitrateTest){var a=t.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(t)}}},e.prototype.onFragBuffered=function(t){var e=t.stats,i=t.frag;if(!0!==e.aborted&&"main"===i.type&&Object(ie.a)(i.sn)&&(!i.bitrateTest||e.tload===e.tbuffered)){var s=e.tparsed-e.trequest;ne.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(s,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},e.prototype.onError=function(t){switch(t.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},e.prototype._findBestLevel=function(t,e,i,s,n,a,r,o,d){for(var l=n;l>=s;l--){var u=d[l];if(u){var h=u.details,c=h?h.totalduration/h.fragments.length:e,p=!!h&&h.live,v=void 0;v=l<=t?r*i:o*i;var g=d[l].realBitrate?Math.max(d[l].realBitrate,d[l].bitrate):d[l].bitrate,f=g*c/v;if(ne.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(v)+"/"+g+"/"+c+"/"+a+"/"+f),v>g&&(!f||p&&!this.bitrateTestDelay||f<a))return l}}return-1},bi(e,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var i=this._nextABRAutoLevel;return-1!==t&&(i=Math.min(t,i)),i},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.levels,s=t.config,n=t.minAutoLevel,a=t.media,r=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,d=a?a.currentTime:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,u=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,h=(We.bufferInfo(a,d,s.maxBufferHole).end-d)/l,c=this._findBestLevel(r,o,u,n,e,h,s.abrBandWidthFactor,s.abrBandWidthUpFactor,i);if(c>=0)return c;ne.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay,v=s.abrBandWidthFactor,g=s.abrBandWidthUpFactor;if(0===h){var f=this.bitrateTestDelay;f&&(p=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-f,ne.b.trace("bitrate test took "+Math.round(1e3*f)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),v=g=1)}return c=this._findBestLevel(r,o,u,n,e,h+p,v,g,i),Math.max(c,0)}}]),e}(de),Mi=Pi,Oi=b(),Li=function(t){function e(i){ht(this,e);var s=ct(this,t.call(this,i,se.a.MEDIA_ATTACHING,se.a.MEDIA_DETACHING,se.a.MANIFEST_PARSED,se.a.BUFFER_RESET,se.a.BUFFER_APPENDING,se.a.BUFFER_CODECS,se.a.BUFFER_EOS,se.a.BUFFER_FLUSHING,se.a.LEVEL_PTS_UPDATED,se.a.LEVEL_UPDATED));return s._msDuration=null,s._levelDuration=null,s._live=null,s._objectUrl=null,s.onsbue=s.onSBUpdateEnd.bind(s),s.onsbe=s.onSBUpdateError.bind(s),s.pendingTracks={},s.tracks={},s}return pt(e,t),e.prototype.destroy=function(){de.prototype.destroy.call(this)},e.prototype.onLevelPtsUpdated=function(t){var e=t.type,i=this.tracks.audio;if("audio"===e&&i&&"audio/mpeg"===i.container){var s=this.sourceBuffer.audio;if(Math.abs(s.timestampOffset-t.start)>.1){var n=s.updating;try{s.abort()}catch(t){n=!0,ne.b.warn("can not abort audio buffer: "+t)}n?this.audioTimestampOffset=t.start:(ne.b.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+t.start),s.timestampOffset=t.start)}}},e.prototype.onManifestParsed=function(t){var e=t.audio,i=t.video||t.levels.length&&t.altAudio,s=0;t.altAudio&&(e||i)&&(s=(e?1:0)+(i?1:0),ne.b.log(s+" sourceBuffer(s) expected")),this.sourceBufferNb=s},e.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var i=this.mediaSource=new Oi;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),e.src=window.URL.createObjectURL(i),this._objectUrl=e.src}},e.prototype.onMediaDetaching=function(){ne.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){ne.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):ne.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(se.a.MEDIA_DETACHED)},e.prototype.onMediaSourceOpen=function(){ne.b.log("media source opened"),this.hls.trigger(se.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},e.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},e.prototype.onMediaSourceClose=function(){ne.b.log("media source closed")},e.prototype.onMediaSourceEnded=function(){ne.b.log("media source ended")},e.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;ne.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,i=this.segments.reduce(function(t,i){return i.parent===e?t+1:t},0),s={},n=this.sourceBuffer;for(var a in n)s[a]=n[a].buffered;this.hls.trigger(se.a.BUFFER_APPENDED,{parent:e,pending:i,timeRanges:s}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},e.prototype.onSBUpdateError=function(t){ne.b.error("sourceBuffer error:",t),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var i=t[e];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},e.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}},e.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;for(var s in t)if(!e[s]){var n=t[s],a=n.levelCodec||n.codec,r=n.container+";codecs="+a;ne.b.log("creating sourceBuffer("+r+")");try{var o=e[s]=i.addSourceBuffer(r);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[s]={codec:a,container:n.container},n.buffer=o}catch(t){ne.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:r})}}this.hls.trigger(se.a.BUFFER_CREATED,{tracks:t})},e.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},e.prototype.onBufferAppendFail=function(t){ne.b.error("sourceBuffer error:",t.event),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferEos=function(t){var e=this.sourceBuffer,i=t.type;for(var s in e)i&&s!==i||e[s].ended||(e[s].ended=!0,ne.b.log(s+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(var i in t){var s=t[i];if(!s.ended)return;if(s.updating)return void(this._needsEos=!0)}ne.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){ne.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},e.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},e.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},e.prototype.updateMediaElementDuration=function(){var t=this.hls.config,e=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(ne.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(ie.a)(e))&&(ne.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},e.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,i=this.sourceBuffer;try{for(var s in i)e+=i[s].buffered.length}catch(t){ne.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(se.a.BUFFER_FLUSHED)}},e.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,i=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void ne.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var s=i.shift();try{var n=s.type,a=e[n];a?a.updating?i.unshift(s):(a.ended=!1,this.parent=s.parent,a.appendBuffer(s.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){ne.b.error("error while trying to append buffer:"+e.message),i.unshift(s);var r={type:ee.b.MEDIA_ERROR,parent:s.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,r.details=ee.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(ne.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],r.fatal=!0,t.trigger(se.a.ERROR,r)):(r.fatal=!1,t.trigger(se.a.ERROR,r))):(this.segments=[],r.details=ee.a.BUFFER_FULL_ERROR,r.fatal=!1,t.trigger(se.a.ERROR,r))}}}},e.prototype.flushBuffer=function(t,e,i){var s=void 0,n=void 0,a=void 0,r=void 0,o=void 0,d=void 0,l=this.sourceBuffer;if(Object.keys(l).length){if(ne.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var u in l)if(!i||u===i){if(s=l[u],s.ended=!1,s.updating)return ne.b.warn("cannot flush, sb updating in progress"),!1;try{for(n=0;n<s.buffered.length;n++)if(a=s.buffered.start(n),r=s.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(o=t,d=e):(o=Math.max(a,t),d=Math.min(r,e)),Math.min(d,r)-o>.5)return this.flushBufferCounter++,ne.b.log("flush "+u+" ["+o+","+d+"], of ["+a+","+r+"], pos:"+this.media.currentTime),s.remove(o,d),!1}catch(t){ne.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else ne.b.warn("abort flushing too many retries");ne.b.log("buffer flushed")}return!0},e}(de),Ni=Li,ki=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ui=function(t){function e(i){vt(this,e);var s=gt(this,t.call(this,i,se.a.FPS_DROP_LEVEL_CAPPING,se.a.MEDIA_ATTACHING,se.a.MANIFEST_PARSED,se.a.BUFFER_CODECS,se.a.MEDIA_DETACHING));return s.autoLevelCapping=Number.POSITIVE_INFINITY,s.firstLevel=null,s.levels=[],s.media=null,s.restrictedLevels=[],s.timer=null,s}return ft(e,t),e.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},e.prototype.onFpsDropLevelCapping=function(t){e.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},e.prototype.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},e.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&(t.video||t.levels.length&&t.altAudio)&&this._startCapping()},e.prototype.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this._startCapping()},e.prototype.onLevelsUpdated=function(t){this.levels=t.levels},e.prototype.onMediaDetaching=function(){this._stopCapping()},e.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.prototype.getMaxLevel=function(t){var i=this;if(!this.levels)return-1;var s=this.levels.filter(function(s,n){return e.isLevelAllowed(n,i.restrictedLevels)&&n<=t});return e.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},e.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},e.isLevelAllowed=function(t){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},e.getMaxLevelByMediaSize=function(t,e,i){if(!t||t&&!t.length)return-1;for(var s=t.length-1,n=0;n<t.length;n+=1){var a=t[n];if((a.width>=e||a.height>=i)&&function(t,e){return!e||t.width!==e.width||t.height!==e.height}(a,t[n+1])){s=n;break}}return s},ki(e,[{key:"mediaWidth",get:function(){var t=void 0,i=this.media;return i&&(t=i.width||i.clientWidth||i.offsetWidth,t*=e.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,i=this.media;return i&&(t=i.height||i.clientHeight||i.offsetHeight,t*=e.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),e}(de),wi=Ui,Bi=window,ji=Bi.performance,Fi=function(t){function e(i){return _t(this,e),Et(this,t.call(this,i,se.a.MEDIA_ATTACHING))}return At(e,t),e.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},e.prototype.checkFPS=function(t,e,i){var s=ji.now();if(e){if(this.lastTime){var n=s-this.lastTime,a=i-this.lastDroppedFrames,r=e-this.lastDecodedFrames,o=1e3*a/n,d=this.hls;if(d.trigger(se.a.FPS_DROP,{currentDropped:a,currentDecoded:r,totalDroppedFrames:i}),o>0&&a>d.config.fpsDroppedMonitoringThreshold*r){var l=d.currentLevel;ne.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=l)&&(l-=1,d.trigger(se.a.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:d.currentLevel}),d.autoLevelCapping=l,d.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(de),Gi=Fi,Vi=window,xi=Vi.performance,Hi=Vi.XMLHttpRequest,Ki=function(){function t(e){mt(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,i){this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:xi.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t=void 0,e=this.context;t=this.loader=new Hi;var i=this.stats;i.tfirst=0,i.loaded=0;var s=this.xhrSetup;try{if(s)try{s(t,e.url)}catch(i){t.open("GET",e.url,!0),s(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,i=e.readyState,s=this.stats,n=this.context,a=this.config;if(!s.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===s.tfirst&&(s.tfirst=Math.max(xi.now(),s.trequest)),4===i){var r=e.status;if(r>=200&&r<300){s.tload=Math.max(s.tfirst,xi.now());var o=void 0,d=void 0;"arraybuffer"===n.responseType?(o=e.response,d=o.byteLength):(o=e.responseText,d=o.length),s.loaded=s.total=d;var l={url:e.responseURL,data:o};this.callbacks.onSuccess(l,s,n,e)}else s.retry>=a.maxRetry||r>=400&&r<499?(ne.b.error(r+" while loading "+n.url),this.callbacks.onError({code:r,text:e.statusText},n,e)):(ne.b.warn(r+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),s.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},t.prototype.loadtimeout=function(){ne.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);var s=this.callbacks.onProgress;s&&s(i,this.context,null,e)},t}(),Yi=Ki,Wi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),zi=function(t){function e(i){yt(this,e);var s=St(this,t.call(this,i,se.a.MANIFEST_LOADING,se.a.MANIFEST_PARSED,se.a.AUDIO_TRACK_LOADED,se.a.AUDIO_TRACK_SWITCHED,se.a.LEVEL_LOADED,se.a.ERROR));return s._trackId=-1,s._selectDefaultTrack=!0,s.tracks=[],s.trackIdBlacklist=Object.create(null),s.audioGroupId=null,s}return Dt(e,t),e.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},e.prototype.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(se.a.AUDIO_TRACKS_UPDATED,{audioTracks:e})},e.prototype.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)return void ne.b.warn("Invalid audio track id:",t.id);if(ne.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()},e.prototype.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},e.prototype.onLevelLoaded=function(t){var e=this.hls.levels[t.level];if(e.audioGroupIds){var i=e.audioGroupIds[e.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},e.prototype.onError=function(t){t.type===ee.b.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===ee.a.AUDIO_TRACK_LOAD_ERROR&&(ne.b.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},e.prototype._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)return void ne.b.debug("Same id as current audio-track passed, and track details available -> no-op");if(t<0||t>=this.tracks.length)return void ne.b.warn("Invalid id passed to audio-track controller");var e=this.tracks[t];ne.b.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var i=e.url,s=e.type,n=e.id;this.hls.trigger(se.a.AUDIO_TRACK_SWITCHING,{id:n,type:s,url:i}),this._loadTrackDetailsIfNeeded(e)},e.prototype.doTick=function(){this._updateTrack(this._trackId)},e.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var i=this.tracks[this._trackId],s=null;if(i&&(s=i.name),this._selectDefaultTrack){var n=e.filter(function(t){return t.default});n.length?e=n:ne.b.warn("No default audio tracks defined")}var a=!1,r=function(){e.forEach(function(e){a||t.audioGroupId&&e.groupId!==t.audioGroupId||s&&s!==e.name||(t._setAudioTrack(e.id),a=!0)})};r(),a||(s=null,r()),a||(ne.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:ee.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},e.prototype._needsTrackLoading=function(t){var e=t.details;return!e||!!e.live||void 0},e.prototype._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,i=t.id;ne.b.log("loading audio-track playlist for id: "+i),this.hls.trigger(se.a.AUDIO_TRACK_LOADING,{url:e,id:i})}},e.prototype._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,ne.b.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},e.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],i=e.name,s=e.language,n=e.groupId;ne.b.warn("Loading failed on audio track id: "+t+", group-id: "+n+', name/language: "'+i+'" / "'+s+'"');for(var a=t,r=0;r<this.tracks.length;r++)if(!this.trackIdBlacklist[r]){var o=this.tracks[r];if(o.name===i){a=r;break}}if(a===t)return void ne.b.warn('No fallback audio-track found for name/language: "'+i+'" / "'+s+'"');ne.b.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)},Wi(e,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}]),e}(ri),qi=zi,Xi=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ji=window,Qi=Ji.performance,Zi={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},$i=function(t){function e(i,s){Tt(this,e);var n=It(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.AUDIO_TRACKS_UPDATED,se.a.AUDIO_TRACK_SWITCHING,se.a.AUDIO_TRACK_LOADED,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.FRAG_PARSING_INIT_SEGMENT,se.a.FRAG_PARSING_DATA,se.a.FRAG_PARSED,se.a.ERROR,se.a.BUFFER_RESET,se.a.BUFFER_CREATED,se.a.BUFFER_APPENDED,se.a.BUFFER_FLUSHED,se.a.INIT_PTS_FOUND));return n.fragmentTracker=s,n.config=i.config,n.audioCodecSwap=!1,n._state=Zi.STOPPED,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n}return bt(e,t),e.prototype.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=Zi.STOPPED,this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},e.prototype.onInitPtsFound=function(t){var e=t.id,i=t.frag.cc,s=t.initPTS;"main"===e&&(this.initPTS[i]=s,this.videoTrackCC=i,ne.b.log("InitPTS for cc: "+i+" found from video track: "+s),this.state===Zi.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(ne.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=Zi.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Zi.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=Zi.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Zi.STOPPED},e.prototype.doTick=function(){var t=void 0,e=void 0,i=void 0,s=this.hls,n=s.config;switch(this.state){case Zi.ERROR:case Zi.PAUSED:case Zi.BUFFER_FLUSHING:break;case Zi.STARTING:this.state=Zi.WAITING_TRACK,this.loadedmetadata=!1;break;case Zi.IDLE:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!n.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var r=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,d=We.bufferInfo(r,t,n.maxBufferHole),l=We.bufferInfo(o,t,n.maxBufferHole),u=d.len,h=d.end,c=this.fragPrevious,p=Math.min(n.maxBufferLength,n.maxMaxBufferLength),v=Math.max(p,l.len),g=this.audioSwitch,f=this.trackId;if((u<v||g)&&f<a.length){if(void 0===(i=a[f].details)){this.state=Zi.WAITING_TRACK;break}if(!g&&!i.live&&c&&c.sn===i.endSN&&!d.nextStart&&(!this.media.seeking||this.media.duration-h<c.duration/2)){this.hls.trigger(se.a.BUFFER_EOS,{type:"audio"}),this.state=Zi.ENDED;break}var _=i.fragments,E=_.length,A=_[0].start,m=_[E-1].start+_[E-1].duration,y=void 0;if(g)if(i.live&&!i.PTSKnown)ne.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),h=0;else if(h=t,i.PTSKnown&&t<A){if(!(d.end>A||d.nextStart))return;ne.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=A+.05}if(i.initSegment&&!i.initSegment.data)y=i.initSegment;else if(h<=A){if(y=_[0],null!==this.videoTrackCC&&y.cc!==this.videoTrackCC&&(y=N(_,this.videoTrackCC)),i.live&&y.loadIdx&&y.loadIdx===this.fragLoadIdx){var S=d.nextStart?d.nextStart:A;return ne.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(S+.05)),void(this.media.currentTime=S+.05)}}else{var D=void 0,T=n.maxFragLookUpTolerance,I=c?_[c.sn-_[0].sn+1]:void 0,b=function(t){var e=Math.min(T,t.duration);return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0};h<m?(h>m-T&&(T=0),D=I&&!b(I)?I:Ye.search(_,b)):D=_[E-1],D&&(y=D,A=D.start,c&&y.level===c.level&&y.sn===c.sn&&(y.sn<i.endSN?(y=_[y.sn+1-i.startSN],ne.b.log("SN just loaded, load next one: "+y.sn)):y=null))}y&&(y.encrypted?(ne.b.log("Loading key for "+y.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+f),this.state=Zi.KEY_LOADING,s.trigger(se.a.KEY_LOADING,{frag:y})):(ne.b.log("Loading "+y.sn+", cc: "+y.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+f+", currentTime:"+t+",bufferEnd:"+h.toFixed(3)),(g||this.fragmentTracker.getState(y)===xe.NOT_LOADED)&&(this.fragCurrent=y,this.startFragRequested=!0,Object(ie.a)(y.sn)&&(this.nextLoadPosition=y.start+y.duration),s.trigger(se.a.FRAG_LOADING,{frag:y}),this.state=Zi.FRAG_LOADING)))}break;case Zi.WAITING_TRACK:(e=this.tracks[this.trackId])&&e.details&&(this.state=Zi.IDLE);break;case Zi.FRAG_LOADING_WAITING_RETRY:var C=Qi.now(),R=this.retryDate;r=this.media;var P=r&&r.seeking;(!R||C>=R||P)&&(ne.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Zi.IDLE);break;case Zi.WAITING_INIT_PTS:var M=this.videoTrackCC;if(void 0===this.initPTS[M])break;var O=this.waitingFragment;if(O){var L=O.frag.cc;M!==L?(e=this.tracks[this.trackId],e.details&&e.details.live&&(ne.b.warn("Waiting fragment CC ("+L+") does not match video track CC ("+M+")"),
this.waitingFragment=null,this.state=Zi.IDLE)):(this.state=Zi.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Zi.IDLE;break;case Zi.STOPPED:case Zi.FRAG_LOADING:case Zi.PARSING:case Zi.PARSED:case Zi.ENDED:}},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(ne.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){this.state===Zi.ENDED&&(this.state=Zi.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onAudioTracksUpdated=function(t){ne.b.log("audio tracks updated"),this.tracks=t.audioTracks},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=Zi.PAUSED,this.waitingFragment=null,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=Zi.IDLE),this.tick()},e.prototype.onAudioTrackLoaded=function(t){var e=t.details,i=t.id,s=this.tracks[i],n=e.totalduration,a=0;if(ne.b.log("track "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live){var r=s.details;r&&e.fragments.length>0?(O(r,e),a=e.fragments[0].start,e.PTSKnown?ne.b.log("live audio playlist sliding:"+a.toFixed(3)):ne.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,ne.b.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(s.details=e,!this.startFragRequested){if(-1===this.startPosition){var o=e.startTimeOffset;Object(ie.a)(o)?(ne.b.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===Zi.WAITING_TRACK&&(this.state=Zi.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===Zi.KEY_LOADING&&(this.state=Zi.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag;if(this.state===Zi.FRAG_LOADING&&e&&"audio"===i.type&&i.level===e.level&&i.sn===e.sn){var s=this.tracks[this.trackId],n=s.details,a=n.totalduration,r=e.level,o=e.sn,d=e.cc,l=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",u=this.stats=t.stats;if("initSegment"===o)this.state=Zi.IDLE,u.tparsed=u.tbuffered=Qi.now(),n.initSegment.data=t.payload,this.hls.trigger(se.a.FRAG_BUFFERED,{stats:u,frag:e,id:"audio"}),this.tick();else{this.state=Zi.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new ii(this.hls,"audio"));var h=this.initPTS[d],c=n.initSegment?n.initSegment.data:[];n.initSegment||void 0!==h?(this.pendingBuffering=!0,ne.b.log("Demuxing "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+r),this.demuxer.push(t.payload,c,l,null,e,a,!1,h)):(ne.b.log("unknown video PTS for continuity counter "+d+", waiting for video PTS before demuxing audio frag "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+r),this.waitingFragment=t,this.state=Zi.WAITING_INIT_PTS)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Zi.PARSING){var s=t.tracks,n=void 0;if(s.video&&delete s.video,n=s.audio){n.levelCodec=n.codec,n.id=t.id,this.hls.trigger(se.a.BUFFER_CODECS,s),ne.b.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var a=n.initSegment;if(a){var r={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[r]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(se.a.BUFFER_APPENDING,r))}this.tick()}}},e.prototype.onFragParsingData=function(t){var e=this,i=this.fragCurrent,s=t.frag;if(i&&"audio"===t.id&&"audio"===t.type&&s.sn===i.sn&&s.level===i.level&&this.state===Zi.PARSING){var n=this.trackId,a=this.tracks[n],r=this.hls;Object(ie.a)(t.endPTS)||(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),i.addElementaryStream(ge.ElementaryStreamTypes.AUDIO),ne.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),M(a.details,i,t.startPTS,t.endPTS);var o=this.audioSwitch,d=this.media,l=!1;if(o&&d)if(d.readyState){var u=d.currentTime;ne.b.log("switching audio track : currentTime:"+u),u>=t.startPTS&&(ne.b.log("switching audio track : flushing all audio"),this.state=Zi.BUFFER_FLUSHING,r.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,this.audioSwitch=!1,r.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,r.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:n});var h=this.pendingData;if(!h)return ne.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void r.trigger(se.a.ERROR,{type:ee.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&h.push({type:t.type,data:e,parent:"audio",content:"data"})}),!l&&h.length&&(h.forEach(function(t){e.state===Zi.PARSING&&(e.pendingBuffering=!0,e.hls.trigger(se.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Zi.PARSING&&(this.stats.tparsed=Qi.now(),this.state=Zi.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},e.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==Zi.PARSING&&e!==Zi.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==Zi.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,i=this.hls;if(t){this.fragPrevious=t,e.tbuffered=Qi.now(),i.trigger(se.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var s=this.mediaBuffer?this.mediaBuffer:this.media;ne.b.log("audio buffered : "+ni.toString(s.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(se.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Zi.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case ee.a.FRAG_LOAD_ERROR:case ee.a.FRAG_LOAD_TIMEOUT:var i=t.frag;if(i&&"audio"!==i.type)break;if(!t.fatal){var s=this.fragLoadError;s?s++:s=1;var n=this.config;if(s<=n.fragLoadingMaxRetry){this.fragLoadError=s;var a=Math.min(Math.pow(2,s-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);ne.b.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=Qi.now()+a,this.state=Zi.FRAG_LOADING_WAITING_RETRY}else ne.b.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Zi.ERROR}break;case ee.a.AUDIO_TRACK_LOAD_ERROR:case ee.a.AUDIO_TRACK_LOAD_TIMEOUT:case ee.a.KEY_LOAD_ERROR:case ee.a.KEY_LOAD_TIMEOUT:this.state!==Zi.ERROR&&(this.state=t.fatal?Zi.ERROR:Zi.IDLE,ne.b.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case ee.a.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===Zi.PARSING||this.state===Zi.PARSED)){var r=this.mediaBuffer,o=this.media.currentTime;if(r&&We.isBuffered(r,o)&&We.isBuffered(r,o+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,ne.b.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=Zi.IDLE}else ne.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Zi.BUFFER_FLUSHING,this.hls.trigger(se.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},e.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(ne.b.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(se.a.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=Zi.PARSED):(this.state=Zi.IDLE,this.fragPrevious=null,this.tick())},Xi(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,ne.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),e}(ri),ts=$i,es=function(){function t(t){return"string"==typeof t&&!!a[t.toLowerCase()]&&t.toLowerCase()}function e(t){return"string"==typeof t&&!!r[t.toLowerCase()]&&t.toLowerCase()}function i(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)t[s]=i[s]}return t}function s(s,a,r){var o=this,d=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};d?o=document.createElement("custom"):l.enumerable=!0,o.hasBeenReset=!1;var u="",h=!1,c=s,p=a,v=r,g=null,f="",_=!0,E="auto",A="start",m=50,y="middle",S=50,D="middle";if(Object.defineProperty(o,"id",i({},l,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return p},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return v},set:function(t){v=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return g},set:function(t){g=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return f},set:function(e){var i=t(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");f=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return _},set:function(t){_=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return E},set:function(t){if("number"!=typeof t&&t!==n)throw new SyntaxError("An invalid number or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return A},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");A=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return m},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return y},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");y=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return S},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return D},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");D=i,this.hasBeenReset=!0}})),o.displayState=void 0,d)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var n="auto",a={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};return s.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},s}(),is=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};Pt.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var ss=new es(0,0,0),ns="middle"===ss.align?"middle":"center";Ct.prototype={parse:function(t){function e(){var t=i.buffer,e=0;for(t=Lt(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var s=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,i.buffer=t.substr(e),s}var i=this;t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{var s=void 0;if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;s=e();var n=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var a=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:s=e(),i.state){case"HEADER":/:/.test(s)?function(t){Mt(t,function(t,e){},/:/)}(s):s||(i.state="ID");continue;case"NOTE":s||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){i.state="NOTE";break}if(!s)continue;if(i.cue=new es(0,0,""),i.state="CUE",-1===s.indexOf("--\x3e")){i.cue.id=s;continue}case"CUE":try{Ot(s,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var r=-1!==s.indexOf("--\x3e");if(!s||r&&(a=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=s;continue;case"BADCUE":s||(i.state="ID");continue}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var as=Ct,rs={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},os=function(t){var e=t;return rs.hasOwnProperty(t)&&(e=rs[t]),String.fromCharCode(e)},ds=15,ls=100,us={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},hs={17:2,18:4,21:6,22:8,23:10,19:13,20:15},cs={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ps={25:2,26:4,29:6,30:8,31:10,27:13,28:15},vs=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],gs={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t],this.verboseLevel}},fs=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},_s=function(){function t(e,i,s,n,a){kt(this,t),this.foreground=e||"white",this.underline=i||!1,this.italics=s||!1,this.background=n||"black",this.flash=a||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),Es=function(){function t(e,i,s,n,a,r){kt(this,t),this.uchar=e||" ",this.penState=new _s(i,s,n,a,r)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),As=function(){function t(){kt(this,t),this.chars=[];for(var e=0;e<ls;e++)this.chars.push(new Es);this.pos=0,this.currPenState=new _s}return t.prototype.equals=function(t){for(var e=!0,i=0;i<ls;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<ls;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<ls;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(gs.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>ls&&(gs.log("ERROR","Too large cursor position "+this.pos),this.pos=ls)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=os(t);if(this.pos>=ls)return void gs.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},t.prototype.clearFromPos=function(t){var e=void 0;for(e=t;e<ls;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,i=0;i<ls;i++){var s=this.chars[i].uchar;" "!==s&&(e=!1),t.push(s)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),ms=function(){function t(){kt(this,t),this.rows=[];for(var e=0;e<ds;e++)this.rows.push(new As);this.currRow=ds-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<ds;t++)this.rows[t].clear();this.currRow=ds-1},t.prototype.equals=function(t){for(var e=!0,i=0;i<ds;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<ds;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<ds;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){gs.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){gs.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<ds;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[s].cueStartTime;if(a&&a<gs.time)for(var r=0;r<this.nrRollUpRows;r++)this.rows[e-this.nrRollUpRows+r+1].copy(n.rows[s+r])}}this.currRow=e;var o=this.rows[this.currRow];if(null!==t.indent){var d=t.indent,l=Math.max(d-1,0);o.setCursor(t.indent),t.color=o.chars[l].penState.foreground}var u={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(u)},t.prototype.setBkgData=function(t){gs.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void gs.log("DEBUG","roll_up but nrRollUpRows not set yet");gs.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),gs.log("INFO","Rolling up")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],i="",s=-1,n=0;n<ds;n++){var a=this.rows[n].getTextString();a&&(s=n+1,t?e.push("Row "+s+": '"+a+"'"):e.push(a.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},t.prototype.getTextAndFormat=function(){return this.rows},t}(),ys=function(){function t(e,i){kt(this,t),this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new ms,this.nonDisplayedMemory=new ms,this.lastOutputScreen=new ms,this.currRollUpRow=this.displayedMemory.rows[ds-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[ds-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,gs.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";gs.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(gs.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){gs.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){gs.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){gs.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){gs.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){gs.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){gs.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){gs.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){gs.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){gs.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){gs.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){gs.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(gs.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,gs.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){gs.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[i]}gs.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=gs.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),Ss=function(){function t(e,i,s){kt(this,t),this.field=e||1,this.outputs=[i,s],this.channels=[new ys(1,i),new ys(2,s)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var i=void 0,s=void 0,n=void 0,a=!1;this.lastTime=t,gs.setTime(t);for(var r=0;r<e.length;r+=2)if(s=127&e[r],n=127&e[r+1],0!==s||0!==n){if(gs.log("DATA","["+fs([e[r],e[r+1]])+"] -> ("+fs([s,n])+")"),i=this.parseCmd(s,n),i||(i=this.parseMidrow(s,n)),i||(i=this.parsePAC(s,n)),i||(i=this.parseBackgroundAttributes(s,n)),!i&&(a=this.parseChars(s,n)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(a)}else gs.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,gs.log("WARNING","Couldn't parse cleaned data "+fs([s,n])+" orig: "+fs([e[r],e[r+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var i=null,s=(20===t||28===t)&&e>=32&&e<=47,n=(23===t||31===t)&&e>=33&&e<=35;if(!s&&!n)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,gs.log("DEBUG","Repeated command ("+fs([t,e])+") is dropped"),!0;i=20===t||23===t?1:2;var a=this.channels[i-1];return 20===t||28===t?32===e?a.ccRCL():33===e?a.ccBS():34===e?a.ccAOF():35===e?a.ccAON():36===e?a.ccDER():37===e?a.ccRU(2):38===e?a.ccRU(3):39===e?a.ccRU(4):40===e?a.ccFON():41===e?a.ccRDC():42===e?a.ccTR():43===e?a.ccRTD():44===e?a.ccEDM():45===e?a.ccCR():46===e?a.ccENM():47===e&&a.ccEOC():a.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.parseMidrow=function(t,e){var i=null;return(17===t||25===t)&&e>=32&&e<=47&&((i=17===t?1:2)!==this.currChNr?(gs.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(e),gs.log("DEBUG","MIDROW ("+fs([t,e])+")"),!0))},t.prototype.parsePAC=function(t,e){var i=null,s=null,n=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,a=(16===t||24===t)&&e>=64&&e<=95;if(!n&&!a)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=t<=23?1:2,s=e>=64&&e<=95?1===i?us[t]:cs[t]:1===i?hs[t]:ps[t];var r=this.interpretPAC(s,e);return this.channels[i-1].setPAC(r),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},t.prototype.interpretPAC=function(t,e){var i=e,s={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s},t.prototype.parseChars=function(t,e){var i=null,s=null,n=null;if(t>=25?(i=2,n=t-8):(i=1,n=t),n>=17&&n<=19){var a=e;a=17===n?e+80:18===n?e+112:e+144,gs.log("INFO","Special char '"+os(a)+"' in channel "+i),s=[a]}else t>=32&&t<=127&&(s=0===e?[t]:[t,e]);if(s){var r=fs(s);gs.log("DEBUG","Char codes =  "+r.join(",")),this.lastCmdA=null,this.lastCmdB=null}return s},t.prototype.parseBackgroundAttributes=function(t,e){var i=void 0,s=void 0,n=void 0,a=void 0,r=(16===t||24===t)&&e>=32&&e<=47,o=(23===t||31===t)&&e>=45&&e<=47;return!(!r&&!o||(i={},16===t||24===t?(s=Math.floor((e-32)/2),i.background=vs[s],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0)),n=t<24?1:2,a=this.channels[n-1],a.setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,0))},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}(),Ds=Ss,Ts=function(){function t(e,i){Ut(this,t),this.timelineController=e,this.trackName=i,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},t}(),Is=Ts,bs=function(t,e,i){return t.substr(i||0,e.length)===e},Cs=function(t){var e=parseInt(t.substr(-3)),i=parseInt(t.substr(-6,2)),s=parseInt(t.substr(-9,2)),n=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return Object(ie.a)(e)&&Object(ie.a)(i)&&Object(ie.a)(s)&&Object(ie.a)(n)?(e+=1e3*i,e+=6e4*s,e+=36e5*n):-1},Rs=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()},Ps=function(t,e,i){var s=t[e],n=t[s.prevCC];if(!n||!n.new&&s.new)return t.ccOffset=t.presentationOffset=s.start,void(s.new=!1);for(;n&&n.new;)t.ccOffset+=s.start-n.start,s.new=!1,s=n,n=t[s.prevCC];t.presentationOffset=i},Ms={parse:function(t,e,i,s,n,a){var r=/\r\n|\n\r|\n|\r/g,o=Object(Ai.b)(new Uint8Array(t)).trim().replace(r,"\n").split("\n"),d="00:00.000",l=0,u=0,h=0,c=[],p=void 0,v=!0,g=new as;g.oncue=function(t){var e=i[s],n=i.ccOffset;e&&e.new&&(void 0!==u?n=i.ccOffset=e.start:Ps(i,s,h)),h&&(n=h+i.ccOffset-i.presentationOffset),t.startTime+=n-u,t.endTime+=n-u,t.id=Rs(t.startTime.toString())+Rs(t.endTime.toString())+Rs(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&c.push(t)},g.onparsingerror=function(t){p=t},g.onflush=function(){if(p&&a)return void a(p);n(c)},o.forEach(function(t){if(v){if(bs(t,"X-TIMESTAMP-MAP=")){v=!1,
t.substr(16).split(",").forEach(function(t){bs(t,"LOCAL:")?d=t.substr(6):bs(t,"MPEGTS:")&&(l=parseInt(t.substr(7)))});try{e=e<0?e+8589934592:e,l-=e,u=Cs(d)/1e3,h=l/9e4,-1===u&&(p=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){p=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(v=!1)}g.parse(t+"\n")}),g.flush()}},Os=Ms,Ls=function(t){function e(i){wt(this,e);var s=Bt(this,t.call(this,i,se.a.MEDIA_ATTACHING,se.a.MEDIA_DETACHING,se.a.FRAG_PARSING_USERDATA,se.a.FRAG_DECRYPTED,se.a.MANIFEST_LOADING,se.a.MANIFEST_LOADED,se.a.FRAG_LOADED,se.a.LEVEL_SWITCHING,se.a.INIT_PTS_FOUND));if(s.hls=i,s.config=i.config,s.enabled=!0,s.Cues=i.config.cueHandler,s.textTracks=[],s.tracks=[],s.unparsedVttFrags=[],s.initPTS=void 0,s.cueRanges=[],s.captionsTracks={},s.captionsProperties={textTrack1:{label:s.config.captionsTextTrack1Label,languageCode:s.config.captionsTextTrack1LanguageCode},textTrack2:{label:s.config.captionsTextTrack2Label,languageCode:s.config.captionsTextTrack2LanguageCode}},s.config.enableCEA708Captions){var n=new Is(s,"textTrack1"),a=new Is(s,"textTrack2");s.cea608Parser=new Ds(0,n,a)}return s}return jt(e,t),e.prototype.addCues=function(t,e,i,s){for(var n=this.cueRanges,a=!1,r=n.length;r--;){var o=n[r],d=Gt(o[0],o[1],e,i);if(d>=0&&(o[0]=Math.min(o[0],e),o[1]=Math.max(o[1],i),a=!0,d/(i-e)>.5))return}a||n.push([e,i]),this.Cues.newCue(this.captionsTracks[t],e,i,s)},e.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},e.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var s=e.textTracks[i];if(s[t])return s}return null},e.prototype.createCaptionsTrack=function(t){var e=this.captionsProperties[t],i=e.label,s=e.languageCode,n=this.captionsTracks;if(!n[t]){var a=this.getExistingTrack(t);if(a)n[t]=a,et(n[t]),tt(n[t],this.media);else{var r=this.createTextTrack("captions",i,s);r&&(r[t]=!0,n[t]=r)}}},e.prototype.createTextTrack=function(t,e,i){var s=this.media;if(s)return s.addTextTrack(t,e,i)},e.prototype.destroy=function(){de.prototype.destroy.call(this)},e.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},e.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){et(t[e]),delete t[e]})},e.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},e.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)et(e[i])}},e.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,s){var n=void 0;if(s<i.length){var a=i[s];Ft(a,t)&&(n=a)}n||(n=e.createTextTrack("subtitles",t.name,t.lang)),t.default?n.mode=e.hls.subtitleDisplay?"showing":"hidden":n.mode="disabled",e.textTracks.push(n)})}},e.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},e.prototype.onFragLoaded=function(t){var e=t.frag,i=t.payload;if("main"===e.type){var s=e.sn;if(s!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=s}else if("subtitle"===e.type)if(i.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var a=e.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(e,i)}else this.hls.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},e.prototype._parseVTTs=function(t,e){var i=this.vttCCs;i[t.cc]||(i[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var s=this.textTracks,n=this.hls;Os.parse(e,this.initPTS,i,t.cc,function(e){var i=s[t.trackId];if("disabled"===i.mode)return void n.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});e.forEach(function(t){if(!i.cues.getCueById(t.id))try{i.addCue(t)}catch(s){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,i.addCue(e)}}),n.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(e){ne.b.log("Failed to parse VTT cue: "+e),n.trigger(se.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},e.prototype.onFragDecrypted=function(t){var e=t.payload,i=t.frag;if("subtitle"===i.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);this._parseVTTs(i,e)}},e.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var i=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,i)}},e.prototype.extractCea608Data=function(t){for(var e=31&t[0],i=2,s=void 0,n=void 0,a=void 0,r=void 0,o=void 0,d=[],l=0;l<e;l++)s=t[i++],n=127&t[i++],a=127&t[i++],r=0!=(4&s),o=3&s,0===n&&0===a||r&&0===o&&(d.push(n),d.push(a));return d},e}(de),Ns=Ls,ks=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Us=function(t){function e(i){Vt(this,e);var s=xt(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MEDIA_DETACHING,se.a.MANIFEST_LOADING,se.a.MANIFEST_LOADED,se.a.SUBTITLE_TRACK_LOADED));return s.tracks=[],s.trackId=-1,s.media=null,s.subtitleDisplay=!0,s}return Ht(e,t),e.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=Kt(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack=t}},e.prototype.destroy=function(){de.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function(t){var e=this,i=t.subtitles||[];this.tracks=i,this.trackId=-1,this.hls.trigger(se.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},e.prototype.onTick=function(){var t=this.trackId,e=this.tracks[t];if(e){var i=e.details;i&&!i.live||(ne.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(se.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}},e.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(ne.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&this._stopTimer())},e.prototype.setSubtitleTrackInternal=function(t){var e=this.hls,i=this.tracks;if(!("number"!=typeof t||t<-1||t>=i.length)&&(this._stopTimer(),this.trackId=t,ne.b.log("switching to subtitle track "+t),e.trigger(se.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t)){var s=i[t],n=s.details;n&&!n.live||(ne.b.log("(re)loading playlist for subtitle track "+t),e.trigger(se.a.SUBTITLE_TRACK_LOADING,{url:s.url,id:t}))}},e.prototype._stopTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},e.prototype._toggleTrackModes=function(t){var e=this.media,i=this.subtitleDisplay,s=this.trackId;if(e){var n=Kt(e.textTracks);if(-1===t)[].slice.call(n).forEach(function(t){t.mode="disabled"});else{var a=n[s];a&&(a.mode="disabled")}var r=n[t];r&&(r.mode=i?"showing":"hidden")}},ks(e,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this.setSubtitleTrackInternal(t))}}]),e}(de),ws=Us,Bs=i(8),js=window,Fs=js.performance,Gs={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Vs=function(t){function e(i){Yt(this,e);var s=Wt(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.ERROR,se.a.KEY_LOADED,se.a.FRAG_LOADED,se.a.SUBTITLE_TRACKS_UPDATED,se.a.SUBTITLE_TRACK_SWITCH,se.a.SUBTITLE_TRACK_LOADED,se.a.SUBTITLE_FRAG_PROCESSED));return s.config=i.config,s.vttFragSNsProcessed={},s.vttFragQueues=void 0,s.currentlyProcessing=null,s.state=Gs.STOPPED,s.currentTrackId=-1,s.decrypter=new Bs.a(i.observer,i.config),s}return zt(e,t),e.prototype.onHandlerDestroyed=function(){this.state=Gs.STOPPED},e.prototype.clearVttFragQueues=function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})},e.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t,this.hls.trigger(se.a.FRAG_LOADING,{frag:t}),this.state=Gs.FRAG_LOADING}},e.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=Gs.IDLE,this.nextFrag()},e.prototype.onMediaAttached=function(){this.state=Gs.IDLE},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},e.prototype.doTick=function(){var t=this;switch(this.state){case Gs.IDLE:var e=this.tracks,i=this.currentTrackId,s=this.vttFragSNsProcessed[i],n=this.vttFragQueues[i],a=this.currentlyProcessing?this.currentlyProcessing.sn:-1,r=function(t){return s.indexOf(t.sn)>-1},o=function(t){return n.some(function(e){return e.sn===t.sn})};if(!e)break;var d;if(i<e.length&&(d=e[i].details),void 0===d)break;d.fragments.forEach(function(e){r(e)||e.sn===a||o(e)||(e.encrypted?(ne.b.log("Loading key for "+e.sn),t.state=Gs.KEY_LOADING,t.hls.trigger(se.a.KEY_LOADING,{frag:e})):(e.trackId=i,n.push(e),t.nextFrag()))})}},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;ne.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&-1!==this.currentTrackId){var e=this.tracks[this.currentTrackId];e&&e.details&&this.tick()}},e.prototype.onSubtitleTrackLoaded=function(){this.tick()},e.prototype.onKeyLoaded=function(){this.state===Gs.KEY_LOADING&&(this.state=Gs.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag.decryptdata,s=t.frag,n=this.hls;if(this.state===Gs.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){var a=void 0;try{a=Fs.now()}catch(t){a=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e=void 0;try{e=Fs.now()}catch(t){e=Date.now()}n.trigger(se.a.FRAG_DECRYPTED,{frag:s,payload:t,stats:{tstart:a,tdecrypt:e}})})}},e}(ri),xs=Vs,Hs=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Ks=window,Ys=Ks.XMLHttpRequest,Ws={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},zs=function(t,e,i){var s={videoCapabilities:[]};return e.forEach(function(t){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[s]},qs=function(t,e,i){switch(t){case Ws.WIDEVINE:return zs(0,i);default:throw Error("Unknown key-system: "+t)}},Xs=function(t){function e(i){qt(this,e);var s=Xt(this,t.call(this,i,se.a.MEDIA_ATTACHED,se.a.MANIFEST_PARSED));return s._widevineLicenseUrl=i.config.widevineLicenseUrl,s._licenseXhrSetup=i.config.licenseXhrSetup,s._emeEnabled=i.config.emeEnabled,s._requestMediaKeySystemAccess=i.config.requestMediaKeySystemAccessFunc,s._mediaKeysList=[],s._media=null,s._hasSetMediaKeys=!1,s._isMediaEncrypted=!1,s._requestLicenseFailureCount=0,s}return Jt(e,t),e.prototype.getLicenseServerUrl=function(t){var e=void 0;switch(t){case Ws.WIDEVINE:e=this._widevineLicenseUrl;break;default:e=null}return e||(ne.b.error('No license server URL configured for key-system "'+t+'"'),this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),e},e.prototype._attemptKeySystemAccess=function(t,e,i){var s=this,n=qs(t,0,i);if(!n)return void ne.b.warn("Can not create config for key-system (maybe because platform is not supported):",t);ne.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,n).then(function(e){s._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){ne.b.error('Failed to obtain key-system "'+t+'" access:',e)})},e.prototype._onMediaKeySystemAccessObtained=function(t,e){var i=this;ne.b.log('Access for key-system "'+t+'" obtained');var s={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(s),e.createMediaKeys().then(function(e){s.mediaKeys=e,ne.b.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated()}).catch(function(t){ne.b.error("Failed to create media-keys:",t)})},e.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},e.prototype._onNewMediaKeySession=function(t){var e=this;ne.b.log("New key-system session "+t.sessionId),t.addEventListener("message",function(i){e._onKeySessionMessage(t,i.message)},!1)},e.prototype._onKeySessionMessage=function(t,e){ne.b.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){ne.b.log("Received license data, updating key-session"),t.update(e)})},e.prototype._onMediaEncrypted=function(t,e){ne.b.log('Media is encrypted using "'+t+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=t,this._mediaEncryptionInitData=e,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},e.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return ne.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_KEYS,fatal:!0});ne.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},e.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return ne.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)return void ne.b.warn("Key-Session already initialized but requested again");var i=e.mediaKeysSession;i||(ne.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var s=this._mediaEncryptionInitDataType,n=this._mediaEncryptionInitData;ne.b.log('Generating key-session request for "'+s+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(s,n).then(function(){ne.b.debug("Key-session generation succeeded")}).catch(function(e){ne.b.error("Error generating key-session request:",e),t.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})},e.prototype._createLicenseXhr=function(t,e,i){var s=new Ys,n=this._licenseXhrSetup;try{if(n)try{n(s,t)}catch(e){s.open("POST",t,!0),n(s,t)}s.readyState||s.open("POST",t,!0)}catch(t){return ne.b.error("Error setting up key-system license XHR",t),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,t,e,i),s},e.prototype._onLicenseRequestReadyStageChange=function(t,e,i,s){switch(t.readyState){case 4:if(200===t.status)this._requestLicenseFailureCount=0,ne.b.log("License request succeeded"),s(t.response);else{if(ne.b.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),++this._requestLicenseFailureCount<=3){var n=3-this._requestLicenseFailureCount+1;return ne.b.warn("Retrying license request, "+n+" attempts left"),void this._requestLicense(i,s)}this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},e.prototype._generateLicenseRequestChallenge=function(t,e){var i=void 0;return t.mediaKeySystemDomain===Ws.PLAYREADY?ne.b.error("PlayReady is not supported (yet)"):t.mediaKeySystemDomain===Ws.WIDEVINE?i=e:ne.b.error("Unsupported key-system:",t.mediaKeySystemDomain),i},e.prototype._requestLicense=function(t,e){ne.b.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return ne.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(se.a.ERROR,{type:ee.b.KEY_SYSTEM_ERROR,details:ee.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var s=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(s,t,e);ne.b.log("Sending license request to URL: "+s),n.send(this._generateLicenseRequestChallenge(i,t))},e.prototype.onMediaAttached=function(t){var e=this;if(this._emeEnabled){var i=t.media;this._media=i,i.addEventListener("encrypted",function(t){e._onMediaEncrypted(t.initDataType,t.initData)})}},e.prototype.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(t){return t.audioCodec}),i=t.levels.map(function(t){return t.videoCodec});this._attemptKeySystemAccess(Ws.WIDEVINE,e,i)}},Hs(e,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}(de),Js=Xs,Qs=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}(),Zs={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Yi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Mi,bufferController:Ni,capLevelController:wi,fpsController:Gi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:Qs};Zs.subtitleStreamController=xs,Zs.subtitleTrackController=ws,Zs.timelineController=Ns,Zs.cueHandler=Zt,Zs.enableCEA708Captions=!0,Zs.enableWebVTT=!0,Zs.captionsTextTrack1Label="English",Zs.captionsTextTrack1LanguageCode="en",Zs.captionsTextTrack2Label="Spanish",Zs.captionsTextTrack2LanguageCode="es",Zs.audioStreamController=ts,Zs.audioTrackController=qi,Zs.emeController=Js;var $s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();i(14);var tn=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Qt(this,t);var s=t.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in s)n in i||(i[n]=s[n]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(ne.a)(i.debug),this.config=i,this._autoLevelCapping=-1;var a=this.observer=new qe.a;a.trigger=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];a.emit.apply(a,[t,t].concat(i))},a.off=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];a.removeListener.apply(a,[t].concat(i))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.once=a.once.bind(a),this.trigger=a.trigger.bind(a);var r=this.abrController=new i.abrController(this),o=new i.bufferController(this),d=new i.capLevelController(this),l=new i.fpsController(this),u=new Be(this),h=new Fe(this),c=new Ve(this),p=new yi(this),v=this.levelController=new Ei(this),g=new He(this),f=this.streamController=new ci(this,g),_=[v,f],E=i.audioStreamController;E&&_.push(new E(this,g)),this.networkControllers=_;var A=[u,h,c,r,o,d,l,p,g];if(E=i.audioTrackController){var m=new E(this);this.audioTrackController=m,A.push(m)}if(E=i.subtitleTrackController){var y=new E(this);this.subtitleTrackController=y,A.push(y)}if(E=i.emeController){var S=new E(this);this.emeController=S,A.push(S)}[i.subtitleStreamController,i.timelineController].forEach(function(t){t&&A.push(new t(e))}),this.coreComponents=A}return t.isSupported=function(){return at()},$s(t,null,[{key:"version",get:function(){return"0.11.0"}},{key:"Events",get:function(){return se.a}},{key:"ErrorTypes",get:function(){return ee.b}},{key:"ErrorDetails",get:function(){return ee.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:Zs},set:function(e){t.defaultConfig=e}}]),t.prototype.destroy=function(){ne.b.log("destroy"),this.trigger(se.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(t){ne.b.log("attachMedia"),this.media=t,this.trigger(se.a.MEDIA_ATTACHING,{media:t})},t.prototype.detachMedia=function(){ne.b.log("detachMedia"),this.trigger(se.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(t){t=te.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),ne.b.log("loadSource:"+t),this.url=t,this.trigger(se.a.MANIFEST_LOADING,{url:t})},t.prototype.startLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;ne.b.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},t.prototype.stopLoad=function(){ne.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.prototype.swapAudioCodec=function(){ne.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){ne.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},$s(t,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){ne.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){ne.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){ne.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){ne.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){ne.b.log("set startLevel:"+t);var e=this;-1!==t&&(t=Math.max(t,e.minAutoLevel)),e.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){ne.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this,e=t.levels,i=t.config.minAutoBitrate,s=e?e.length:0,n=0;n<s;n++)if((e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate)>i)return n;return 0}},{key:"maxAutoLevel",get:function(){var t=this,e=t.levels,i=t.autoLevelCapping;return-1===i&&e&&e.length?e.length-1:i}},{key:"nextAutoLevel",get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var e=this;e.abrController.nextAutoLevel=Math.max(e.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),t}();e.default=tn},function(t,e,i){function s(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var s=e(e.s=ENTRY_MODULE);return s.default||s}function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t,e,s){var a={};a[s]=[];var r=e.toString(),o=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var u,h=o[1],c=new RegExp("(\\\\n|\\W)"+n(h)+l,"g");u=c.exec(r);)"dll-reference"!==u[3]&&a[s].push(u[3]);for(c=new RegExp("\\("+n(h)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+l,"g");u=c.exec(r);)t[u[2]]||(a[s].push(u[1]),t[u[2]]=i(u[1]).m),a[u[2]]=a[u[2]]||[],a[u[2]].push(u[4]);return a}function r(t){return Object.keys(t).reduce(function(e,i){return e||t[i].length>0},!1)}function o(t,e){for(var i={main:[e]},s={main:[]},n={main:{}};r(i);)for(var o=Object.keys(i),d=0;d<o.length;d++){var l=o[d],u=i[l],h=u.pop();if(n[l]=n[l]||{},!n[l][h]&&t[l][h]){n[l][h]=!0,s[l]=s[l]||[],s[l].push(h);for(var c=a(t,t[l][h],l),p=Object.keys(c),v=0;v<p.length;v++)i[p[v]]=i[p[v]]||[],i[p[v]]=i[p[v]].concat(c[p[v]])}}return s}var d="[\\.|\\-|\\+|\\w|/|@]+",l="\\((/\\*.*?\\*/)?s?.*?("+d+").*?\\)";t.exports=function(t,e){e=e||{};var n={main:i.m},a=e.all?{main:Object.keys(n)}:o(n,t),r="";Object.keys(a).filter(function(t){return"main"!==t}).forEach(function(t){for(var e=0;a[t][e];)e++;a[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map(function(e){return JSON.stringify(e)+": "+n[t][e].toString()}).join(",")+"});\n"}),r=r+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map(function(t){return JSON.stringify(t)+": "+n.main[t].toString()}).join(",")+"})(self);";var d=new window.Blob([r],{type:"text/javascript"});if(e.bare)return d;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,u=l.createObjectURL(d),h=new window.Worker(u);return h.objectURL=u,h}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(10),n=i(1),a=i(0),r=i(7),o=i.n(r),d=function(t){var e=new o.a;e.trigger=function(t){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];e.emit.apply(e,[t,t].concat(s))},e.off=function(t){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];e.removeListener.apply(e,[t].concat(s))};var i=function(e,i){t.postMessage({event:e,data:i})};t.addEventListener("message",function(n){var r=n.data;switch(r.cmd){case"init":var o=JSON.parse(r.config);t.demuxer=new s.a(e,r.typeSupported,o,r.vendor);try{Object(a.a)(!0===o.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":t.demuxer.push(r.data,r.decryptdata,r.initSegment,r.audioCodec,r.videoCodec,r.timeOffset,r.discontinuity,r.trackSwitch,r.contiguous,r.duration,r.accurateTimeOffset,r.defaultInitPTS)}}),e.on(n.a.FRAG_DECRYPTED,i),e.on(n.a.FRAG_PARSING_INIT_SEGMENT,i),e.on(n.a.FRAG_PARSED,i),e.on(n.a.ERROR,i),e.on(n.a.FRAG_PARSING_METADATA,i),e.on(n.a.FRAG_PARSING_USERDATA,i),e.on(n.a.INIT_PTS_FOUND,i),e.on(n.a.FRAG_PARSING_DATA,function(e,i){var s=[],n={event:e,data:i};i.data1&&(n.data1=i.data1.buffer,s.push(i.data1.buffer),delete i.data1),i.data2&&(n.data2=i.data2.buffer,s.push(i.data2.buffer),delete i.data2),t.postMessage(n,s)})};e.default=d},function(t,e){String.prototype.endsWith||function(){"use strict";var t=function(){try{var t={},e=Object.defineProperty,i=e(t,t,t)&&e}catch(t){}return i}(),e={}.toString,i=function(t){if(null==this)throw TypeError();var i=String(this);if(t&&"[object RegExp]"==e.call(t))throw TypeError();var s=i.length,n=String(t),a=n.length,r=s;if(arguments.length>1){var o=arguments[1];void 0!==o&&(r=o?Number(o):0)!=r&&(r=0)}var d=Math.min(Math.max(r,0),s),l=d-a;if(l<0)return!1;for(var u=-1;++u<a;)if(i.charCodeAt(l+u)!=n.charCodeAt(u))return!1;return!0};t?t(String.prototype,"endsWith",{value:i,configurable:!0,writable:!0}):String.prototype.endsWith=i}()}]).default}),function(i){"use strict";function s(t,e,i){var s=e&&i||0,n=0;for(e=e||[],
t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[s+n++]=v[t])});n<16;)e[s+n++]=0;return e}function n(t,e){var i=e||0,s=p;return s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+"-"+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]+s[t[i++]]}function a(t,e,i){var s=e&&i||0,a=e||[];t=t||{};var r=null!=t.clockseq?t.clockseq:E,o=null!=t.msecs?t.msecs:(new Date).getTime(),d=null!=t.nsecs?t.nsecs:m+1,l=o-A+(d-m)/1e4;if(l<0&&null==t.clockseq&&(r=r+1&16383),(l<0||o>A)&&null==t.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");A=o,m=d,E=r,o+=122192928e5;var u=(1e4*(268435455&o)+d)%4294967296;a[s++]=u>>>24&255,a[s++]=u>>>16&255,a[s++]=u>>>8&255,a[s++]=255&u;var h=o/4294967296*1e4&268435455;a[s++]=h>>>8&255,a[s++]=255&h,a[s++]=h>>>24&15|16,a[s++]=h>>>16&255,a[s++]=r>>>8|128,a[s++]=255&r;for(var c=t.node||_,p=0;p<6;p++)a[s+p]=c[p];return e||n(a)}function r(t,e,i){var s=e&&i||0;"string"==typeof t&&(e="binary"===t?new c(16):null,t=null),t=t||{};var a=t.random||(t.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var r=0;r<16;r++)e[s+r]=a[r];return e||n(a)}var o,d,l,u,h;i?function(){var t=i.crypto||i.msCrypto;if(!o&&t&&t.getRandomValues)try{var e=new Uint8Array(16);u=o=function(){return t.getRandomValues(e),e},o()}catch(t){}if(!o){var s=new Array(16);d=o=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof e)try{var t=e("crypto").randomBytes;l=o=t&&function(){return t(16)},o()}catch(t){}}();for(var c="function"==typeof Buffer?Buffer:Array,p=[],v={},g=0;g<256;g++)p[g]=(g+256).toString(16).substr(1),v[p[g]]=g;var f=o(),_=[1|f[0],f[1],f[2],f[3],f[4],f[5]],E=16383&(f[6]<<8|f[7]),A=0,m=0,y=r;y.v1=a,y.v4=r,y.parse=s,y.unparse=n,y.BufferClass=c,y._rng=o,y._mathRNG=d,y._nodeRNG=l,y._whatwgRNG=u,"undefined"!=typeof module&&module.exports?module.exports=y:"function"==typeof t&&t.amd?t(function(){return y}):(h=i.uuid,y.noConflict=function(){return i.uuid=h,y},i.uuid=y)}("undefined"!=typeof window?window:null),function(){function t(t){var e=t.__resizeTriggers__,i=e.firstElementChild,s=e.lastElementChild,n=i.firstElementChild;s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,n.style.width=i.offsetWidth+1+"px",n.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function e(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height}function i(i){var s=this;t(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=r(function(){e(s)&&(s.__resizeLast__.width=s.offsetWidth,s.__resizeLast__.height=s.offsetHeight,s.__resizeListeners__.forEach(function(t){t.call(s,i)}))})}function s(){if(!a){var t=(_||"")+".resize-triggers { "+(E||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i),a=!0}}var n=document.attachEvent,a=!1;if(!n){var r=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),o=function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),d=!1,l="",u="animationstart",h="Webkit Moz O ms".split(" "),c="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p="",v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(d=!0),!1===d)for(var g=0;g<h.length;g++)if(void 0!==v.style[h[g]+"AnimationName"]){p=h[g],l="-"+p.toLowerCase()+"-",u=c[g],d=!0;break}var f="resizeanim",_="@"+l+"keyframes "+f+" { from { opacity: 0; } to { opacity: 0; } } ",E=l+"animation: 1ms "+f+"; "}window.addResizeListener=function(e,a){n?e.attachEvent("onresize",a):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),s(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),t(e),e.addEventListener("scroll",i,!0),u&&e.__resizeTriggers__.addEventListener(u,function(i){i.animationName==f&&t(e)})),e.__resizeListeners__.push(a))},window.removeResizeListener=function(t,e){n?t.detachEvent("onresize",e):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",i),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(),function(e,i){"object"==typeof module&&module.exports?module.exports=i():"function"==typeof t&&t.amd?t(i):e.Spinner=i()}(this,function(){"use strict";function t(t,e){var i,s=document.createElement(t||"div");for(i in e)s[i]=e[i];return s}function e(t){for(var e=1,i=arguments.length;i>e;e++)t.appendChild(arguments[e]);return t}function i(t,e,i,s){var n=["opacity",e,~~(100*t),i,s].join("-"),a=.01+i/s*100,r=Math.max(1-(1-t)/e*(100-a),t),o=d.substring(0,d.indexOf("Animation")).toLowerCase(),u=o&&"-"+o+"-"||"";return h[n]||(l.insertRule("@"+u+"keyframes "+n+"{0%{opacity:"+r+"}"+a+"%{opacity:"+t+"}"+(a+.01)+"%{opacity:1}"+(a+e)%100+"%{opacity:"+t+"}100%{opacity:"+r+"}}",l.cssRules.length),h[n]=1),n}function s(t,e){var i,s,n=t.style;if(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==n[e])return e;for(s=0;s<u.length;s++)if(i=u[s]+e,void 0!==n[i])return i}function n(t,e){for(var i in e)t.style[s(t,i)||i]=e[i];return t}function a(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)void 0===t[s]&&(t[s]=i[s])}return t}function r(t,e){return"string"==typeof t?t:t[e%t.length]}function o(t){this.opts=a(t||{},o.defaults,c)}var d,l,u=["webkit","Moz","ms","O"],h={},c={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},a(o.prototype,{spin:function(e){this.stop();var i=this,s=i.opts,a=i.el=t(null,{className:s.className});if(n(a,{position:s.position,width:0,zIndex:s.zIndex,left:s.left,top:s.top}),e&&e.insertBefore(a,e.firstChild||null),a.setAttribute("role","progressbar"),i.lines(a,i.opts),!d){var r,o=0,l=(s.lines-1)*(1-s.direction)/2,u=s.fps,h=u/s.speed,c=(1-s.opacity)/(h*s.trail/100),p=h/s.lines;!function t(){o++;for(var e=0;e<s.lines;e++)r=Math.max(1-(o+(s.lines-e)*p)%h*c,s.opacity),i.opacity(a,e*s.direction+l,r,s);i.timeout=i.el&&setTimeout(t,~~(1e3/u))}()}return i},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(s,a){function o(e,i){return n(t(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:e,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*u+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var l,u=0,h=(a.lines-1)*(1-a.direction)/2;u<a.lines;u++)l=n(t(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:d&&i(a.opacity,a.trail,h+u*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&e(l,n(o("#000","0 0 4px #000"),{top:"2px"})),e(s,e(l,o(r(a.color,u),"0 0 1px rgba(0,0,0,.1)")));return s},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof document){l=function(){var i=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var p=n(t("group"),{behavior:"url(#default#VML)"});!s(p,"transform")&&p.adj?function(){function i(e,i){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}l.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(t,s){function a(){return n(i("group",{coordsize:u+" "+u,coordorigin:-l+" "+-l}),{width:u,height:u})}function o(t,o,d){e(c,e(n(a(),{rotation:360/s.lines*t+"deg",left:~~o}),e(n(i("roundrect",{arcsize:s.corners}),{width:l,height:s.scale*s.width,left:s.scale*s.radius,top:-s.scale*s.width>>1,filter:d}),i("fill",{color:r(s.color,t),opacity:s.opacity}),i("stroke",{opacity:0}))))}var d,l=s.scale*(s.length+s.width),u=2*s.scale*l,h=-(s.width+s.length)*s.scale*2+"px",c=n(a(),{position:"absolute",top:h,left:h});if(s.shadow)for(d=1;d<=s.lines;d++)o(d,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(d=1;d<=s.lines;d++)o(d);return e(t,c)},o.prototype.opacity=function(t,e,i,s){var n=t.firstChild;s=s.shadow&&s.lines||0,n&&e+s<n.childNodes.length&&(n=n.childNodes[e+s],n=n&&n.firstChild,(n=n&&n.firstChild)&&(n.opacity=i))}}():d=s(p,"animation")}return o}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam",SEGMENT:"Segment"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(t){var e,i,s=t.split("."),n=window,a=s.length;for(e=0;e<a;e++)i=s[e],void 0===n[i]&&(n[i]={}),n=n[i];return n},getClass:function(t){var e,i,s,n,a,r;if("string"!=typeof t)return t;for(e=t.split("."),i=window,s=e.length,n="",a=0;a<s;a++){if(r=e[a],n+=r,void 0===i[r])throw new Error("uvpjs.getClass(): "+n+" is undefined.");a<s-1&&(n+="."),i=i[r]}return i},getObject:function(t){return uvpjs.getClass(t)}},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){function s(){!t&&this.init&&this.init.apply(this,arguments)}var n,a,r,o,d=this.prototype;t=!0,a=new this,t=!1,n=function(t,e){return function(){var i,s=this._super;return this._super=d[t],i=e.apply(this,arguments),this._super=s,i}};for(o in i)i.hasOwnProperty(o)&&(r=i[o],a[o]="function"==typeof r&&"function"==typeof d[o]&&e.test(r)?n(o,r):r);return s.prototype=a,s.prototype.constructor=s,s.subClass=arguments.callee,s}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(t){t.b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA=="}(uvpjs.register("uvpjs")),function(t){"use strict";t.util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){var e,i,s,n="string"==typeof t?t:"",a=n.indexOf("?")>-1?n.split("?")[1]:n,r=a.split("&"),o={};for(i=0,s=r.length;i<s;i++)e=r[i].split("="),o[e[0]]=e[1];return o},queryStrFromObj:function(t,e){var i,s="",n=!1;for(i in t)s+=(n?"&":"")+i+"="+(e?encodeURIComponent(t[i]):t[i]),n=!0;return s},uid8:function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(t.indexOf("|")>-1){var i,s,n,a,r,o="",d=t.split(","),l=d.length;for(d.sort(),r=0;r<l;r++)i=d[r],s=i.split("|"),2==s.length&&(n=s[0],a=s[1],o!=n?(e.length>0&&(e+="&"),e+=n+"="+a):e+=","+a,o=n)}}return""==e&&(e="sb=0"),e},firstInt:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],parseInt(t)===t)return t},inRange:function(t,e,i){return"number"==typeof t&&t>=e&&t<=i},isEmpty:function(t){return null===t||void 0===t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObject:function(t){return t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},isDefinedString:function(t){return!!(t&&"string"==typeof t&&t.length>0)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isDefined:function(t){return void 0!==t},isFlagTrue:function(t){return!0===t||"true"===t||1===t||"1"===t},getDefinedString:function(){var t,e,i=arguments.length;for(e=0;e<i;e++)if(t=arguments[e],this.isDefinedString(t))return t;return""},supportsLocalStorage:function(){var t;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),t=localStorage.getItem("test"),this.isLocalStorageSupported="1"===t,localStorage.removeItem("test")}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},createStyleSheet:function(t,e){var i,s,n,a,r,o,d,l,u,h,c=document.styleSheets,p=c.length;for(u=function(){h||(t(r),h=!0)},i=0;i<p;i++){r=c[i];try{if((r.href&&r.href.replace(/http(s)?:/,""))===e)return void u()}catch(t){}}s="string"==typeof e&&""!==e,n=uvpjs.mediaCapabilities.isFirefox(),a=!s||n?"style":"link",r=document.createElement(a),r.setAttribute("type","text/css"),r.appendChild(document.createTextNode("")),s&&(r.setAttribute("rel","stylesheet"),r.setAttribute("href",e),r.textContent='@import "'+e+'"'),"function"==typeof t&&(r.onload=u,r.addEventListener&&r.addEventListener("load",u,!1),r.onreadystatechange=function(){"loaded"!==(o=r.readyState)&&"complete"!==o||(link.onreadystatechange=null,u())},d=setInterval(function(){document.styleSheets.length>p&&(u(),clearInterval(d))},10),n&&(l=setInterval(function(){try{r.sheet.cssRules,clearInterval(l),u()}catch(t){}},10)),document.getElementsByTagName("head")[0].appendChild(r))},addCSSObject:function(t,e,i,s){var n,a=uvpjs.util,r="#"+e.id+" "+(s||"");for(n in i)a.addCSSRule(t,r,n,i[n])},addCSSRule:function(t,e,i,s){var n,a,r,o,d=uvpjs.mediaCapabilities,l="string"==typeof s&&s.match(/NaN(%|px)/);if(t&&t.sheet)if(!l||d.isAndroid()&&d.isChrome()||(s="0"),n=t.sheet,a=n.rules||n.cssRules,r=a.length,o=i+":"+s+";",n.insertRule)try{n.insertRule(e+"{"+o+"}",r)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else n.addRule&&n.addRule(e,o,r)},addCSSRules:function(t,e,i){for(var s,n=i.length;n--;)s=i[n],uvpjs.util.addCSSRule(t,e,s.name,s.value)},copyObjectWithKeyMap:function(t){var e=t,i=null;return this.from=function(t){return i=t,this},this.to=function(t){if(!(e&&i&&t))return t;for(var s in e)e.hasOwnProperty(s)&&i.hasOwnProperty(s)&&null!==i[s]&&(t[e[s]]=i[s]);return t},this}}}(uvpjs.register("uvpjs")),function(t){var e=uvpjs._,i={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};t.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,s,n,a){var r,o,d,l,u,h,c,p,v=uvpjs.util,g="cust_params",f=t.split("?"),_=f[1],E=t.indexOf("{ptype}")>-1,A=this.getAdParams(s,n,a);return _=_.replace(i.mediaRefId,A.vid).replace(i.partner,A.partner),_.indexOf("VGUID")>-1&&(_=_.replace(E?i.vguidAlt:i.vguid,A.vguid)),_=_.replace(E?i.ptypeAlt:i.ptype,A.ptype),o=v.objFromQueryStr(_),this.isExcludedFromVpaid(s)&&delete o.pp,d=o[g],d&&(r=v.objFromQueryStr(decodeURIComponent(d)),delete o[g]),l=A[g],delete A[g],delete A.partner,delete A.vguid,delete A.ptype,u=e.assign(A,o),h=e.assign(l,r||{}),decodeURIComponent(u.iu).indexOf("/8264/")>=0&&s.isMuteAtPlayStart&&!s.userHasUnmuted&&(u.sz="640x483"),this.removeEmpty(u),this.removeEmpty(h),c=v.queryStrFromObj(u,!1),p=v.queryStrFromObj(h,!1),c+="&"+g+"="+encodeURIComponent(p),f[0]+"?"+c},getAdParams:function(t,i,s){var n,a,r=t.dwPageParams,o=this.getDwViewGuid(t),d=this.getPpidValue(t),l=t.contentVideoState,u=encodeURIComponent(t.sessionOptions.partner),h=r.pagetype||"",c=this.getUserStatusKey(t.getSessionOption("userStatus")),p=""!==l.contPlayState,v=p&&!uvpjs.util.isFlagTrue(s)?"1":"0",g=t.getSessionOption("isEmbedded")?"1":"0",f=this.getHost("1"===g,t),_=l.pid,E={cust_params:{}},A=uvpjs.Configuration.env,m=t.getAdCallParams();n=i?this.getVideoDfpId(t):"",E.vid=n,E.partner=u,E.ptype=h,E.vguid=o,E.cust_params.vguid=o,E.cust_params.embed=g,f&&(E.cust_params.host=f),this.populateCustParamsWithAdSessionValues(E.cust_params,_),l.podsToSkip.length>0&&(E.cust_params.resume=1,E.cust_params.skippod=l.podsToSkip);for(a in c)E.cust_params[a]=c[a];if(d&&(E.ppid=d,E.cust_params.ppid=d),"cbs"===u&&(E.cust_params.cpSession=v,E.cust_params.cpPre=v,E.cust_params.sub=e.isEmpty(t.sessionOptions.userId)?"":t.sessionOptions.userId),m&&!uvpjs.util.isEmpty(m.standardParams))for(a in m.standardParams)E[a]=m.standardParams[a];if(m&&!uvpjs.util.isEmpty(m.customParams))for(a in m.customParams)E.cust_params[a]=m.customParams[a];return this.isExcludedFromVpaid(t)?E.pp="ssai":("local"===A||"dev"===A)&&(E.pp="vpaid_js"),E},getVideoDfpId:function(t){return uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(t){return"AA Original"===t.contentVideoState.contentType},getDwViewGuid:function(t){var e=t.dwPageParams;return e&&e.viewguid||e.pguid||""},extractAdInfo:function(t,i){var s,n,a=i===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(t)||!i?(!i&&console.error("No 'context' arg supplied"),null):(s={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()},s.adPodInfo=this.extractPodInfo(t.getAdPodInfo()),n=this[a](t),e.assign(s,n))},extractAdStateData:function(t,e){var i=t.getAdPodInfo(),s=i.getPodIndex(),n=i.getAdPosition(),a=t.getDuration(),r=0===s?"pre":s>=1?"mid":-1===s?"post":"",o=("mid"!==r?r+"_0":"mid_"+s)+"_"+n,d=e===this.context.IMA,l=d?this.extractIdInfo(t):null,u=this.getAdStateBlank();return u.adPosition=n,u.adBitrate=t.getVastMediaBitrate(),u.adServerName=d?this.context.IMA:this.context.DAI,u.adVideoTitle=t.getTitle(),u.duration=a,u.adType=r,u.adClipID=o,u.wrapperAdId=d?l.wrapperAdId||"":"",u.adVideoId=d?l.wrapperAdId||l.adId:t.getAdId(),u.creativeId=d?l.wrapperCreativeId||l.creativeId:t.getCreativeId(),e===this.context.DAI&&(u.sourceWidth=t.getVastMediaWidth(),u.sourceHeight=t.getVastMediaHeight()),u},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),s=Array.isArray(e)&&e.length||0,n=Array.isArray(i)&&i.length||0,a=null,r=null,o=t.getAdId()||"",d=t.getCreativeId()||"";return s&&(s>1&&(a=e[1]),o=e[0]),n&&(n>1&&(r=i[1]),d=i[0]),{adId:o,wrapperAdId:a,creativeId:d,wrapperCreativeId:r}},getHost:function(t,e){var i,s,n;return t?(i=e.getSessionOption("referrer"))&&(s=uvpjs.util.parseUrl(i),n=s.host):n=window.location.hostname,n&&""!==n?n:null},getUserStatusKey:function(t){for(var e,i=uvpjs.util.getUserStatusForQuery(t),s=i.split("&"),n=s.length,a={};n--;)e=s[n].split("="),a[e[0]]=e[1];return a},trackAd:function(t){var e,i,s,n=t.model,a=t.context,r=n.getAdVideoState(),o=a===this.context.IMA,d=a===this.context.DAI;return o||d?(i=n.dwPageParams.pagetype||"",e={level1:"",level2:"",level3:r.adVideoId,level4:r.creativeId,slicer1:"vaw-can",slicer2:n.sessionOptions.partner,slicer3:i,moatVASTSystem:r.adServerName,moatVASTAdID:r.wrapperAdId},s=this.getDwViewGuid(n),""!==s&&(e.zMoatVGUID=s),""!==i&&(e.zMoatPT=i),this.initMoatTracking(t.adVideoContainer,e,r.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){var e=t.getSessionOption("adBlockerCallback");return e&&e()},populateCustParamsWithAdSessionValues:function(t,e){var s,n,a;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(s=window.getVideoAdSessionValues(e))&&""!==s){s=s.replace(i.session,"&"),n=uvpjs.util.objFromQueryStr(s);for(a in n)t[a]=n[a]}},removeEmpty:function(t){for(var e in t)(null===t[e]||""===t[e])&&delete t[e]},extractAdInfoIma:function(t){return{contentType:t.getContentType(),isLinear:t.isLinear()}},extractAdInfoDai:function(t){return{advertiserName:t.getAdvertiserName(),description:t.getDescription(),duration:t.getDuration(),title:t.getTitle()}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){var e=t.getSessionOption("userPPID");return uvpjs.util.isDefinedString(e)?e:null},initMoatTracking:function(t,e,i,s,n){var a,r,o,d=document.createElement("script"),l=[];e={adData:{ids:e,duration:i,url:n},dispatchEvent:function(t){this.sendEvent?(l&&(l.push(t),t=l,l=!1),this.sendEvent(t)):l.push(t)}},o="_moatApi"+Math.floor(1e8*Math.random());try{a=t.ownerDocument,r=a.defaultView||a.parentWindow}catch(t){r=window}return r[o]=e,d.type="text/javascript",t&&t.insertBefore(d,t.childNodes[0]||null),d.src="https://z.moatads.com/"+s+"/moatvideo.js#"+o,e},getVpaidEventForEvent:function(t,e){var i=this.moatEventMapping[e][t];return uvpjs.util.isEmpty(i)?null:this.vpaidEvents[i]}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.Configuration={env:"production",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"2.9.52",date:"11/13/18 1:00:28 PM (PST)",path:"//vidtech.cbsinteractive.com/uvpjs/2.9.52/",playerName:"CBSI-PLAYER"}}(uvpjs),function(t){t.AutoplayDetectionService=uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(t,e){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:t,supportsMutedAutoplay:e})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t,e;this.vidEl=e=this.createVideoElement(!1),e.load(),t=e.play(),void 0===t?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t,e;if(this.killVid(),this.checkForEarlySafari())return void this.finishCheck(!1,!1);this.vidEl=e=this.createVideoElement(!0),e.load(),t=e.play(),t.then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),i=t&&e?this.mc.getBrowserVersion():null,s=i&&i.split("."),n=s?11===parseInt(s[0])&&0===parseInt(s[1]):null;return null!==i&&n&&(!s[2]||parseInt(s[2])<3)},detectMobileCapabilities:function(){var t=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,t)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),i=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||i},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(t){var e=document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=document.createElement("div"),e=t.style,i="-1000px";return e.position="absolute",e.top=i,e.left=i,e.width="320px",e.height="180px",document.body.appendChild(t),t}})}(uvpjs.register("uvpjs")),uvpjs.MediaCapabilities=function(){var t,e,i,s,n,a,r,o,d,l,u,h,c,p,v=uvpjs._,g=uuid.noConflict(),f=!1,_=!1,E={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",
ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(i,s){var r=this.systemInfo;return typeof i===this.STRING?(t=i,e=!0):(t=navigator.userAgent||null,e=!1),n=document.createElement(this.VIDEO),a=document.createElement(this.AUDIO),typeof s===this.BOOLEAN&&(f=s),A(),D(),U(),_="https:"===location.protocol,r.browser=this.getBrowserName(),r.version=parseInt(this.getBrowserMajorVersion()),r.isMobile=this.isMobile(),r.isDesktop=this.isDesktop(),r.os=this.getOS()+"; ver. "+this.getOSVersion(),r.supportsMse=this.hasMediaSourceSupport(),r.isHlsjsEligible=this.canPlayHLSJS(),r.supportsNativeHls=this.canPlayNativeHLS(),r.supportsMp4=this.canPlayH264(),r.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(t){var e;if(null!==this.systemInfo.supportsUnmutedAutoplay)return void t();e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.PLACEHOLDER_MP4_URL})},setTrackingInfo:function(t){var e,i,s=uvpjs.tracking,n={};for(i in s)e=s[i],n[i]=!!t[e];this.systemInfo.trackingAvailability=n},setAutoplayInfo:function(t){this.systemInfo.supportsUnmutedAutoplay=t.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=t.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return g.v1().replace(/-/g,"")},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return h},getBrowserVersion:function(){return c},getBrowserMajorVersion:function(){return p},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var i=new RegExp(e),s=i.exec(this.getUserAgent()),n="",a="";if(typeof s===this.OBJECT&&s.length&&s.length>1){if(n=s[1]||"",n.indexOf(".")){var r=n.split(".");"object"==typeof r&&r.length&&r.length>0&&(a=r[0])}else a=n;return h=t,c=n,p=a,!0}}return!1},hasTealium:function(){return v.has(window,"utag")||v.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return t},getMimeTypesObj:function(){return i||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(i=navigator.mimeTypes),i)},getMimeTypes:function(){if(typeof s===this.OBJECT)return s;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var i=0;i<this.length;i++){var n=e[i].enabledPlugin&&e[i].enabledPlugin.name?e[i].enabledPlugin.name:"";t[e[i].type]={type:e[i].type,description:e[i].description,suffixes:e[i].suffixes,enabledPlugin:e[i].enabledPlugin,enabledPluginName:n},t.length++}return s=t}},getPlatform:function(){return typeof o===this.STRING?o:null},getOS:function(){return typeof d===this.STRING?d:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof u===this.BOOLEAN?u:u=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return T()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var t=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;this.hasMse=!(!i||!s)}return this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!T(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),a=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),r=this.isOpera()&&this.getBrowserMajorVersion()>=30,o=this.isPlaystation();return!(!s||!i||e||o)&&(!!t||n||a||r)},canPlayNativeHLSAudio:function(){return I()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return T()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return T()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return T()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return T()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return T()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){var s=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(i&&s.canPlayType(e)===this.PROBABLY||!i&&""!==s.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//,s=i.test(t)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof s!==this.OBJECT||typeof s.canPlayType!==this.FUNCTION||!(e&&s.canPlayType(t)===this.PROBABLY||!e&&""!==s.canPlayType(t)))},nativeCanPlayType:function(t,e){var i=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION?i.canPlayType(e)||null:null},canPlayDASHType:function(t){if(typeof t!==this.STRING||t.length<1)return null;var e=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t)},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||t.indexOf("Android 2.")>-1||t.indexOf("Android 4.0")>-1||t.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return!(t&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),s=i&&i.name;e&&i?i&&t.setAttribute(s,i.value):!e&&s&&t.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(t=document.createElement("div"),e=uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=document,i=this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled);return!i&&(i=t&&t.webkitSupportsFullscreen),i},getDevice:function(){return r||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||t&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashUrl:function(t){return/\.mpd/i.test(t)},isSecure:function(){return _},setUrlProtocol:function(t){return _?t.replace("http:","https:"):t},getDrmType:function(t){var e="none";return t.enabled?((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine"),e):e}},A=function(){var t=/\s(\([^)]+\))/,e=new RegExp(t),i=e.exec(E.getUserAgent());i&&i.length&&i.length>1&&(i=i[1].replace(/_/gi,"."),y(i)||S(i)||m(i)||R(i))},m=function(t){if(-1!==t.indexOf(E.LINUX)||-1!==t.indexOf(E.ANDROID)){if(o=E.LINUX,-1!==t.indexOf(E.ANDROID)){var e=/\ Android\ ([^\s]+);/;t=new RegExp(e).exec(t),r=E.ANDROID,d=E.ANDROID,l=t&&t[1]?t[1]:""}return!0}return!1},y=function(t){var e,i;if(-1!==t.indexOf(E.MAC))return o=E.MAC,r=E.DESKTOP,-1!==t.indexOf(E.OSX)&&(e=/Mac\ OS\ X\ ([\d\.]+)/,i=new RegExp(e),t=i.exec(t),d=E.OSX,l=t&&t[1]?t[1]:null),!0;if(-1!==t.indexOf("like Mac OS X")){o=E.MAC,d=E.IOS;var s=/\(iPhone;/,n=/\(iPad;/,a=/\(iPod;/;i=/\sOS\s([^\s]*)\s/;var u=i.exec(t);if(u&&u[1]&&(l=u[1]),s.test(t))r=E.IPHONE;else if(n.test(t))r=E.IPAD;else{if(!a.test(t))return!1;r=E.IPOD}return!0}return!1},S=function(t){var e=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,i=/Windows\ NT\ ([^\s]+)[;\)]/,s=new RegExp(e);if((t=s.exec(E.getUserAgent()))&&t[2])return o=E.WINDOWS,d=E.WINDOWS_PHONE,l=t[2],r=E.PHONE,!0;if(s=new RegExp(i),(t=s.exec(E.getUserAgent()))&&t[1]){o=E.WINDOWS,d=E.WINDOWS;var n=t[1];return 6==n?d=E.WINDOWS_VISTA:6.1==n?(d=E.WINDOWS7,l=7):6.2==n?(d=E.WINDOWS8,l=8):10==parseInt(n)&&(d=E.WINDOWS10,l=n),r=E.DESKTOP,!0}return!1},D=function(){return!!(b()||P()||M()||O()||L()||N()||k()||C())},T=function(){return n},I=function(){return a},b=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=/(Opera|OPR)/,s=/Edge/,n=/CrKey/,a=E.getUserAgent(),r=e.test(a);return!(!t.test(a)&&!r||i.test(a)||s.test(a)||n.test(a)||(E.setBrowserVersion(E.CHROME,r?e:t),0))},C=function(){var t=/Playstation (\S+)/i;return!!t.test(E.getUserAgent())&&(E.setBrowserVersion(E.PLAYSTATION,t),!0)},R=function(){return null!=E.getUserAgent()&&E.getUserAgent().indexOf(E.CHROMECAST_USER_AGENT)>-1&&(o=E.LINUX,r=E.CHROMECAST,d=E.ANDROID,!0)},P=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(E.getUserAgent())?(E.setBrowserVersion(E.IE,t),!0):e.test(E.getUserAgent())?(E.setBrowserVersion(E.EDGE,e),!0):!!i.test(E.getUserAgent())&&(E.setBrowserVersion(E.IE,i),!0)},M=function(){var t=/Firefox\/(\S+)/;return!!t.test(E.getUserAgent())&&(E.setBrowserVersion(E.FIREFOX,t),!0)},O=function(){var t,e=/Version\/(\S+).*Safari\//,i=e.test(E.getUserAgent());return t=d===E.ANDROID?E.ANDROID:E.SAFARI,!!i&&(E.setBrowserVersion(t,e),!0)},L=function(){var t=/Opera|OPR\/(\S+)/,e=new RegExp(t),i=e.exec(E.getUserAgent());if(i){var s=-1!==i.indexOf("Opera Mini/")||-1!==i.indexOf("Opera Mobi")?E.OPERA_MOBILE:E.OPERA;return E.setBrowserVersion(s,/Opera|OPR\/(\S+)/),!0}return!1},N=function(){return!!/Silk/i.test(E.getUserAgent())&&(E.setBrowserVersion(E.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},k=function(){return!!/Android/.test(E.getUserAgent())&&(h=E.ANDROID_BROWSER,!0)},U=function(){var t=T(),e=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],i=null;t.requestFullscreen?i=e:t.webkitRequestFullscreen?i=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:t.mozRequestFullScreen?i=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:t.msRequestFullscreen?E.getBrowserVersion()<12?i=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(i=e.slice(),i[5]=null):(E.isIOS()||E.isAndroid())&&(i=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"]),function(t,e){t._fullscreenEventName=e?e[0]:null,t._fullscreenEnterEventName=e?e[1]:null,t._fullscreenExitEventName=e?e[2]:null,t._enterFullscreenMethodName=e?e[3]:null,t._exitFullscreenMethodName=e?e[4]:null,t._isFullscreenPropertyName=e?e[5]:null,t._fullscreenElementName=e?e[6]:null,t._fullscreenErrorEventName=e?e[7]:null}(E,i)};return E},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=uvpjs._,i=uvpjs.mediaCapabilities;if(this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,!e.isObject(t))return void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.");this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var s=uvpjs._;if(this.isEnabled||s.isUndefined(this.CDO)){if(!s.isString(t)||!s.isString(e)||s.isUndefined(i))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e);if(this.showAll||s.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e]){var n=this.showTimestamps?"["+this._timestamp()+"] ":"",a=s.drop(arguments,3),r=s.isEmpty(a)?"":a,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[t]("%sUVPJS %s %s",n,e,i,r);console[t]("%s%cUVPJS %c%s%c %s",n,o.bold,o.underline,e,o.normal,i,r)}}},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=uvpjs._,e=new Date,i=e-this.adjustedStartTime,s=i%1e3;i=(i-s)/1e3;var n=i%60;i=(i-n)/60;var a=i%60;i=(i-a)/60;var r=i%24-this.adjustedTimezone;return t.padStart(r,2,"0")+":"+t.padStart(a,2,"0")+":"+t.padStart(n,2,"0")+"."+t.padStart(s,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(!t)return e;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",e),e},_readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,n=i.length;s<n;s++){for(var a=i[s];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null}},function(t){var e,i=t._;t.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=e(),this.dom.outer.id=t.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return i.clone(this.dom)},createAdClickElement:function(){var t={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};this.adClickElement=document.createElement("div");for(var e in t)this.adClickElement.style[e]=t[e];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickElement:function(t){this.adClickElement&&(this.adClickElement.style.display=t?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var t=this.dom;if(t.outer.el=document.getElementById(t.outer.id),i.isNull(this.dom.outer.el))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id));t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB()},_createVideoElement:function(){var t,e=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=document.querySelectorAll(e);if(i instanceof NodeList&&i[0]instanceof HTMLElement&&i[0].id)return void this._checkVideoTagAttributes(i);if(e=[this.dom.outer.id,this.dom.video.id].join(" "),(i=document.querySelectorAll(e))instanceof NodeList&&i[0]instanceof HTMLElement){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}t=this._getOrCreateElement("video"),this._checkVideoTagAttributes(t),this.dom.content.el.appendChild(t),this.dom.video.el=t},_createPlaceholderContent:function(){var t=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||i.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!i.isNull(e)){var s=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!i.isNull(s)){if(t.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===s.src.indexOf(this.dom.video.url))return e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),void e.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),!i.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var t=this.dom.ad.el;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0"}},_getIdByPrefix:function(t){if(!i.isNull(t))return uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var e=this.dom[t],s=document.getElementById(e.id);return i.isNull(s)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+e.type+' id="'+e.id+'">.'),s=document.createElement(e.type),s.id=e.id),s}}),e=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",CDN_TYPE:{AKAMAI:"Akamai",FASTLY:"Fastly"},contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,
this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,i,s,n){if(!e.isString(t)||!e.isObject(i)||!e.isObject(s))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN"));this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=i,this.CDO=s,this.sessionOptions=n,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){if(e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState);var i=t.payload.newState;i!==uvpjs.mediaCapabilities.EMPTY&&i!==uvpjs.mediaCapabilities.LOADING&&i!==uvpjs.mediaCapabilities.STOPPED&&i!==uvpjs.mediaCapabilities.PLAYING&&i!==uvpjs.mediaCapabilities.PAUSED&&i!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&e.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){e.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){!e.isPlainObject(t)||t.target!==this.vidContId||e.isPlainObject(t.target.contextMetadata)},onResourceStart:function(t){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){e.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){e.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){e.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var i=void 0;return t&&e.isString(t)&&this.hasOwnProperty(t)&&!e.isFunction(this[t])&&(i=this[t]),i},getModule:function(t){if(e.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,i){if(e.isString(t)&&e.isString(i))return this.CDO.getModuleParam(t,i)},getModules:function(){return this.CDO.getModules()},isModuleEnabled:function(t){return!(!t||!e.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOption:function(t){return t?this.sessionOptions[t]:null},getClass:function(t){if(e.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProperty:function(t,e,i){return this.CDO.getClassListItemProperty(t,e,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var t={};return e.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return e.assign(t,this.adVideoState),t},getContentPlaybackState:function(){var t={};return e.assign(t,this.contentPlaybackState),t},getAdPlaybackState:function(){return e.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(t){this.contentVideoState.abrInfo=t,this.contentPlaybackState.abrInfo=t},setAdVideoState:function(t){this.adVideoState=e.assign({},this.adVideoStateDefaults,t||{})},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateItems:function(t){this._addItemsToInstanceObj("adPlaybackState",t)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(t){this.setAdVideoStateItems(this._removeDefaults(t,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),s=this.getModuleParam(e,t);if(i&&s)return s},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var t=this;e.forOwn(this.sessionOptions,function(i,s){if(e.isString(i))return e.has(t.contentVideoState,s)?void(t.contentVideoState[s]=i):e.has(t.adVideoState,s)?void(t.adVideoState[s]=i):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(t,i){return e.omitBy(t,function(e,s){return t[s]===i[s]})},_addItemsToInstanceObj:function(t,i){var s,n,a;if(!(s=this[t]))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t));if(!e.isObject(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",i));this.debug;for(n in s)a=i[n],!i.hasOwnProperty(n)||e.isUndefined(a)||e.isFunction(a)||(s[n]=a)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(t,i,s){var n,a;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=i,this.timeout=s||this.REQUEST_TIMEOUT,e.isString(t)&&this.urls.push(t),e.isArray(t)&&(this.urls=t),a=this.urls.length,n=0;n<a;n++)this._getScript(this.urls[n])},_getScript:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",t);var i=this,s=function(t,s){if(!e.isFunction(i._onScriptLoaded)||i._onScriptLoaded.done)return void(i.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called."));i.urls=e.without(i.urls,t),i._onScriptLoaded({url:t,error:s})},n=document.createElement("script");n.src=this._setUrlProtocol(t),n.async=!0,n.onreadystatechange=n.onload=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||s(t)},n.onerror=function(e){uvpjs.error(i.DEBUG_ID,"_getScript "+e.target.src+" is not accessible."),s(t,e)},document.querySelector("head").appendChild(n),this.timeoutHandle=setTimeout(function(t){-1===e.indexOf(i.urls,t)||(this.debug&&uvpjs.warn(i.DEBUG_ID,"_getScript request timeout"),s(t,"timeout"))}.bind(this,t),this.timeout)},_onScriptLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var i=e.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),i&&e.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=!1,i},loadXHR:function(t,i,s,n){var a,r;if(t=this._setUrlProtocol(t),!1===(a=this.createCORSRequest("GET",t)))return r="loadXHR CORS not supported for url = "+t,uvpjs.warn(this.DEBUG_ID,r),void s(a);n&&!uvpjs.util.isEmpty(n)&&(a.responseType=n),a.timeout=this.REQUEST_TIMEOUT,a.onload=function(){if(e.inRange(a.status,200,400))return void i(a);s(a)},a.onerror=function(){s(a)},a.ontimeout=function(){s(a)},a.send()},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuffer:function(t,e,i){this.loadXHR(t,e,i,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(t){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(t)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackType:function(t,e){this.initialPlaybackInfo.isAutoplay=t,this.initialPlaybackInfo.isMuteAtPlayStart=e},setContextMetadata:function(t){this.cviModel.contentVideoState.contextMetadata=t||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var i=this.cviModel.getSessionOption("adBlockerCallback"),s=!(!i||!i()),n=this.eventsMgr.eventTypes,a=uvpjs.ErrorInfo,r=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+s),s&&this.eventsMgr.dispatchEvent(n.AD_BLOCKED,{errorInfo:new a({eventType:n.AD_BLOCKED,errorCode:a.errorCodes.AD_BLOCKING_DETECTED,message:a.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),!s&&!r)return void this.eventsMgr.dispatchEvent(n.PLAYER_START_ERROR,{errorInfo:new a({eventType:n.PLAYER_START_ERROR,errorCode:a.errorCodes.IMA_SDK_MISSING,message:a.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId);if(r){if(!e.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var o=this.adsLoader.getSettings();o.setAutoPlayAdBreaks(!0),o.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},_createIMAAdDisplayContainer:function(t){var e,i,s;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),i=e.getElementsByTagName("video")[0],s=new google.ima.AdDisplayContainer(this.adVideoDiv,i,t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",s),s},onAdsManagerLoaded:function(t){var e,i=uvpjs.util,s=i.isEmpty(this.RPM),n=i.isEmpty(this.RPM.currRP),a=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),s||n||a)return e="CVI mgr: onAdsManagerLoaded; ",e+=s?"no RPM found":n?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,e),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+e,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var i=!e.isEmpty(this.RPM)&&this.RPM,s=i&&!e.isEmpty(i.currRP)&&i.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),!i||!s)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof s.handleAdsLoaderError&&s.handleAdsLoaderError(t)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),e.isNaN(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t));-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId)},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),e.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),e.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},setCaptionsStyleRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},resizeRequest:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+i),!e.isNaN(t)&&!e.isNaN(i)&&t>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:i},this.vidContId)},fullscreenRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),e.isPlainObject(t)},setNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),e.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return t?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(e)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t))},checkForPauseAd:function(){var t,e=this.cviModel.isModuleEnabled("PauseAd"),i=uvpjs.Configuration.path+"lib/PauseAdRetriever.js";e&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(t=new uvpjs.CodeLoader,t.loadScript(i,this.createPauseAdRetriever.bind(this))))}})}(uvpjs.register("uvpjs")),function(t){t.ErrorInfo=uvpjs.Class.subClass({init:function(t){var e=t||{};this.errorCode=e.errorCode||null,this.eventType=e.eventType||null,this.isFatal=!!e.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=e.message||null,this.adInfo=e.adInfo||null,this.serverCode=e.serverCode||null,this.hlsjsErrorCode=null}}),t.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},t.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){if(this.debug=uvpjs.debug,!t||t!==i)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance()."));this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,i){
if(!(t&&e.isString(t)&&i&&e.isFunction(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var s=this._returnValidEvtTypeAndNameSpace(t);if(!1===s)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS);var n=s[0],a=s[1];if(this.registeredEventsTable[n]||(this.registeredEventsTable[n]={}),this.registeredEventsTable[n][a])return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",n," ns = ",a));this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",n," ns = ",a),this.registeredEventsTable[n][a]=i},removeEventListener:function(t){if(!t||!e.isString(t))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(t);if(!1===i)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t));var s=i[0],n=i[1];if(!this.registeredEventsTable[s]||!this.registeredEventsTable[s][n])return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t));this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[s][n]},dispatchEvent:function(t,i,s){var n={};if(!t||!e.isString(t))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS);if(!e.isUndefined(i)&&!e.isPlainObject(i))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!e.isUndefined(s)&&!e.isString(s))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var a=this.registeredEventsTable[t];if(a){e.isUndefined(i)&&(i={}),e.isUndefined(s)&&(s=""),n.type=t,n.payload=i,n.target=s;for(var r in a)a.hasOwnProperty(r)&&a[r](n)}},_returnValidEvtTypeAndNameSpace:function(t){var e=[],i=t.split(".");if(i.length<2)return!1;var s=i[0];i.shift();var n=i.join("_");return!(!this._validateEventType(s)||n.indexOf("undefined")>-1)&&(e[0]=s,e[1]=n,e)},_validateEventType:function(t){var e=!1,i=this.eventTypes;for(var s in i)if(i.hasOwnProperty(s)&&i[s]===t){e=!0;break}return e},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,i,s,n){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var a={};if(!t||!e.isNumber(t)||!i||!e.isString(i)||!s||!e.isFunction(s)||n&&!e.isNumber(n)&&(n>=1||-1===n))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);t<this.uvpjsClockInterval&&(t=this.uvpjsClockInterval),i=i.split(".").join("_"),a={freq:t,ns:i,cb:s,rptCnt:-1,nextTime:Date.now()+t},n&&(a.rptCnt=n),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(a)},removeTimedEventCallback:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+i),!(t&&e.isNumber(t)&&i&&e.isString(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var s,n,a=i.split(".");for(i=a.join("_"),s=this.timerCBOs.length;s--;)n=this.timerCBOs[s],n.freq===t&&n.ns===i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",n.freq+" CBO.ns = "+n.ns),this.timerCBOs.splice(s,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var t,e,i=Date.now();for(t=this.timerCBOs.length-1;t>=0;t--)e=this.timerCBOs[t],i>=e.nextTime&&(e.cb(),e.nextTime=i+e.freq,-1!==e.rptCnt&&(e.rptCnt=e.rptCnt-1,0===e.rptCnt&&this.timerCBOs.splice(t,1)))},eventTypes:{FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),t.EventsManager._instance=null,t.EventsManager.destroyInstance=function(){this._instance=null},t.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(i)),this._instance}}(uvpjs.register("uvpjs")),function(t){t.AbstractId3Parser=uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(t){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,e){var i,s,n=[];if("string"==typeof t)for(i=t.split(","),s=i.length;s--;)n.push(i[s].trim());return e&&-1===n.indexOf("www.nielsen.com")&&n.push("www.nielsen.com"),n}})}(uvpjs.register("uvpjs")),function(t){t.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){var e,i=t.length;for(e=0;e<i;e++)t[e].data&&this.findId3(t[e])},findId3:function(t){var e,i,s,n,a,r,o,d=0,l=t.data;o=this.readStr(l,d,3),d+=3,"ID3"===o&&(d+=3,e=127&l[d++],i=127&l[d++],s=127&l[d++],n=127&l[d++],a=(e<<21)+(i<<14)+(s<<7)+n,r=d+a,this.findId3PrivateFrame(t,d,r))},findId3PrivateFrame:function(t,e,i){for(var s,n=t.data;e+8<=i;)s=this.readStr(n,e,4),e+=4,n[e++],n[e++],n[e++],n[e++],n[e++],n[e++],"PRIV"===s&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i,s,n,a=this.idLengths,r=this.totalIds,o=t.data;r--;)if(n=a[r],(s=this.readStr(o,e,n))===this.ownerIds[r]){e+=n,i="www.nielsen.com"===s?this.parseNielsen(s,o,e):this.readStr(o,++e,o.length),this.dataCallback({name:s,data:i,pts:t.pts});break}},parseNielsen:function(t,e,i){var s=t+this.readStr(e,i,e.length-(i+2));return 249===s.length?s:null},readStr:function(t,e,i){var s="",n=e||0,a=e+i;do{s+=String.fromCharCode(t[n++])}while(n<a);return s}})}(uvpjs.register("uvpjs")),function(t){t.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==e.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}})}(uvpjs.register("uvpjs")),function(t){t.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t={};for(var e in this.historyItems)t[e]=this.historyItems[e];return t},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js";return e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||e,uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===t._.get(ADB,"va.Heartbeat"))},getPath:function(t){var e=uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[i]:[e,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}},Segment:{isDefined:function(){return void 0!==window.analytics},getPath:function(){return[uvpjs.Configuration.path+"lib/tracking/segment-loader.js"]}}},init:function(t,e){var i=[],s=t.getModules(),n=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,n.isEmpty(s))return void this.invokeCallbackWithHistory();t.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var a=s.length;a--;){var r,o,d=s[a],l=d.name,u=this.sdkModules[d.name];if(d.enabled&&u)if(u.isDefined())this.addToHistory({name:d.name,loaded:!0});else for(r=u.getPath(t),o=r.length;o--;)i.push({name:l,path:r[o]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();setTimeout(function(){t(e)},1)},bulkLoad:function(t){var e=t,i=[],s=(this.handleAllLoadResults,function(t,s,a){i.push({name:t,result:a}),s.destroy(),0===e.length?this.handleAllLoadResults(i):n()}),n=function(){var t=e.shift(),i=new uvpjs.CodeLoader;i.loadScript(t.path,s.bind(this,t.name,i))}.bind(this);n()},handleAllLoadResults:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){if(!t.name)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",t));!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,!e.isEmpty(t)&&this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),!e.isString(t)||!e.isObject(i))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS"));this.vidContId=t,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1;var e=this._createResourceProvider(t.payload.rcObj);this.rscProviders.unshift(e),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);var i,s,n=t.payload.rcObjs,a=n.length;for(i=0;i<a;i++)s=this._createResourceProvider(n[i]),this.rscProviders.push(s);e.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e,i=t.payload.rcObjs,s=i.length,n=this.rscProviders,a=this.usedRPs,r=!1,o=!uvpjs.util.isEmpty(this.currRP);s--;)e=i[s],this.removeFromList(e,n),this.removeFromList(e,a),o&&!r&&(r=this.isMatchingResource(e,this.currRP.rco.rcoSeed));r&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,e.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),e.isEmpty(this.currRP)||e.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!e.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e,i,s={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:e=new uvpjs.RP_URL(s);break;case this.mc.RP_PLATFORM:e=new uvpjs.RP_Platform(s);break;case this.mc.RP_DAI:i=t.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider,e=new i(s);break;case this.mc.RP_IMA:e=new uvpjs.RP_IMA(s);break;case this.mc.RP_MDIALOG:e=new uvpjs.RP_Mdialog(s)}return e},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),e.isEmpty(this.currRP)||e.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!e.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!e.isEmpty(this.currRP)&&e.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,i,s,n,a){var r=!0===a.skin;if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),!(e.isString(t)&&e.isObject(i)&&e.isObject(s)&&e.isFunction(n)))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"-"));this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=i,this.CDO=s,this.vciReadyCB=n,this._usesIMA=a.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=a.enableUnmutedAutoplay,this._isMutedAutoplay=a.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!a.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:i,CDO:s,playerOptions:a,suppressFacadePlay:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,a)})},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName,controls:t.controls,template:t.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){var e=t.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(e),e.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){this.handleFirstGesture();var t=this.skinMgr,e=this.mc.PAUSED;setTimeout(function(){t.setPlaystate(e)},200)},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===t.adType&&"ima"===t.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load();var s=e.play();void 0!==s&&s.then(Function.prototype).catch(function(t){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){if(this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),!this.useBrowserNativeControls&&this._loadSkinFlag)return void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t}));this.onVCIReady()},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),!e.isString(t))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)"));this.CVI_Mgr.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(t){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),
uvpjs.util.isFunction(t)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void t())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(t){var e,i;if(!0!==t&&!this.canOverrideUserGesture())return e=uvpjs.ErrorInfo,i=this.eventsMgr,void i.dispatchEvent(i.eventTypes.PLAYER_START_ERROR,{errorInfo:new e({eventType:i.eventTypes.PLAYER_START_ERROR,errorCode:e.errorCodes.USER_GESTURE_REQUIRED,message:e.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(t,i){if(!t||!e.isString(t)||!e.isFunction(i))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId);this.eventsMgr.addEventListener(t,i)},removeEventListener:function(t){if(!t||!e.isString(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId);this.eventsMgr.removeEventListener(t)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),void this.playBlankVideo();i=this.createResourceConfig(t),e.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),void this.playBlankVideo();if(e.isArray(t)&&t.length>0){var i,s,n=[];for(i in t)s=this.createResourceConfig(t[i]),e.isObject(s)?n.push(s):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);n.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:n},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e,i,s,n,a,r,o,d="",l=!1,u=t.type===this.mc.RP_IMA,h="",c=!1,p=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),o=this.prevalidateRcObj(t),o.error)return d="Resource configuration error: "+o.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(d,null),!1;switch(t.type){case this.mc.RP_URL:i=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:i=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(d="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",l=!0),c=!0,i=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:i=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:c=!t.useSsb,i=uvpjs.DaiRco;break;default:h="Unknown resource type "+t.type,d="VCI createResourceConfig "+h+"; this.vidContId = "+this.vidContId,l=!0}return l?(this.dispatchStartError(d,null),!1):(this.rcoIdIndex++,e=this.rcoIdIndex+"_"+this.vidContId,s=new i(t,e,this.vidContId),o=s.getValidationInfo(),c&&this.checkForAdBlocker()?(!0===o.missingSDK&&(p=u?"IMA":"DAI"),this.dispatchAdBlocked(p,!0),!1):o.error?(d="VCI error initializing RCO: "+o.message,n=uvpjs.ErrorInfo,a=n.errorCodes,!0===o.missingSDK?(r=u?a.IMA_SDK_MISSING:a.DAI_SDK_MISSING,this.dispatchStartError(d,r)):this.dispatchStartError(d,null),!1):(this._replayRco=t,s))},prevalidateRcObj:function(t){var e=uvpjs.util,i="",s=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){var i=t?" (Missing "+t+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+i,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+i,isFatal:!!e})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){e.isArray(t)&&t.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),e.isEmpty(this.skinMgr)||e.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(t){e.isNaN(t)||this.CVI_Mgr.volumeChangeRequest(t)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),e.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+i),e.isNumber(t)||e.isNumber(i)||this.CVI_Mgr.resizeRequest(t,i)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!e.isEmpty(t)&&(e.isArray(t)&&t.length>0||uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,i){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",i),e.isEmpty(t)||e.isEmpty(i)||!e.isArray(t)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:i},this.vidContId))},fullscreen:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&e.isPlainObject(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},removeNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),e.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),e.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){if(!t||"number"!=typeof t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t));this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)},switchTo:function(t){var e="up,down",i=null!==t&&void 0!==t&&"string"==typeof t&&-1!==e.indexOf(t),s=null!==t&&void 0!==t&&"number"==typeof t&&!isNaN(t);if(!i&&!s)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,i,s,typeof t));this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",t),s?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)},setMinimumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,i={liveSegmentData:t};this.eventsMgr.dispatchEvent(e,i,this.vidContId)}})}(uvpjs.register("uvpjs")),function(t){var e=Math.random(),i=t._;t.VideoManager=uvpjs.Class.subClass({init:function(t){if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance)return void console.warn("UVPJS: An instance of VideoManager has already been created.");uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var s=uvpjs.Configuration,n=uvpjs.VideoManager._instance,a=uvpjs.DebugManager,r=this.validateParams(t,e,i),o=r.message,d=r.isValid;if(!o||(console[d?"warn":"error"](o),!d&&r.errorCb&&r.errorCb(o),d)){if(n){if(n.isInitializing())return void n.addInitCallback(e);if(n.isReady())return void(uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),uvpjs.log=a.log.bind(a),uvpjs.warn=a.warn.bind(a),uvpjs.error=a.error.bind(a),a.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,s){var n=uvpjs.util,a=null,r=!1,o="VideoManager.initialize()",d=n.isFunction(s)?s:null;return t&&i.isPlainObject(t)||(a=o+" was invoked with invalid session options.",r=!0),n.isFunction(e)||(a=o+": A success callback function is required.",r=!0),d||(a=o+" did not receive a valid error callback function.",r=!1),{errorCb:d,message:a,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){if(!i.isObject(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))},onSdkLoadManagerReady:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var e,i=t.isModuleEnabled("VideoPlaybackSettings"),s=i&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),n="string"==typeof s,a=n&&s.toLowerCase();s&&!uvpjs.util.isEmpty(s)&&(!0===s||1===s||n&&("1"===a||"y"===a||"yes"===a))&&(e=this.mc.canPlayHLSJS(!0),e&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=e)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){if(this.eventsMgr)return t&&i.isString(t)&&i.isFunction(e)?void this.eventsMgr.addEventListener(t,e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){if(!t||!i.isString(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS);this.eventsMgr.removeEventListener(t)},getVideoPlayers:function(){var t,e={};for(t in this.VCIs)e[t]=this.VCIs[t];return e},createVideoPlayer:function(t,e,s){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!i.isString(t)||!i.isFunction(e)||s&&!i.isPlainObject(s))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var n=[t,e];s&&n.push(s),this.createMultipleVideoPlayers([n])},destroyVideoPlayer:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),i.isString(t)?i.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(t){var e,s,n,a,r,o,d,l;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!i.isEmpty(this.VCIs)),!i.isArray(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(a=t.length,n=0;n<a;n++)if(r=t[n],o=r[0],d=r[1],l=r[2],r.length<2||!i.isString(o)||!i.isFunction(d)||!i.isUndefined(l)&&!i.isPlainObject(l))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),n=0;n<a;n++)r=t[n],o=r[0],d=r[1],l=r[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",o),l=this.CDO.getSessionOptions(l),e=this.validateAutoplay(l),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(l.enableMutedAutoplay=!1,l.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),s=new uvpjs.VideoControlInterface,this.VCIs[o]=s,s.initialize(o,this.eventsMgr,this.CDO,d,l);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(t){t&&i.isPlainObject(t)&&this.CDO.overrideSessionOptions(t)},onVideoProgress:function(t){if(!(this._allowConcurrentPlayback||!i.isPlainObject(t)||i.isUndefined(t.target)||i.isUndefined(t.payload)||i.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING)){var e=t.target;i.isEmpty(this.currActiveVCI)&&!i.isUndefined(this.VCIs[e])&&(this.currActiveVCI=this.VCIs[e]),e===this.currActiveVCI.vidContId||i.isUndefined(this.VCIs[e])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",e),this.VCIs[e].pauseVideo())}},onVideoPlaybackInitiated:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),!this._allowConcurrentPlayback&&i.isPlainObject(t)&&!i.isUndefined(t.target)){var e=t.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),i.isEmpty(this.VCIs)||i.isUndefined(this.VCIs[e])||this.currActiveVCI&&this.currActiveVCI.vidContId===e||(this.currActiveVCI=this.VCIs[e],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(t){t?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),t.VideoManager._instance=null,t.VideoManager.destroyInstance=function(){this._instance=null},t.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(e)),this._instance}}(uvpjs.register("uvpjs")),function(t){var e,i,s,n,a,r,o,d,l,u,h,c,p,v,g,f=t._;t.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=i(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._trackMode="hidden",this._disabled=!1,this.ccDisplayRequested=!1,this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,!this._ccEl&&this._createCaptionsElement()},showCaptions:function(t){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing")},hideCaptions:function(t){this.ccDisplayRequested=!1,this._toggleVisibility(t,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:f.clone(this.styles)},setStyles:function(t){var e,i,s,n=this._pageStyles,a=t.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",t);a--;)s=t[a],e=p(s.name),i=s.value,n[e]=i;this._updateStylesObject(n),this._applyStyles()}},setCueProperty:function(t,e){var i;if(!this._disabled){if(i=this._getActiveTrack(),!(t&&e&&i&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=isNaN(e)?e:Number(e)}},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace,s=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",s),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this._cviModel.contentVideoState.isLive,this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i)},_createTrackElement:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=uvpjs.util,e=this._styleEl,i=document.createElement("div"),s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);if(i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),!s)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container."));s.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)},_dispatchCaptionsError:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onVideoComplete:function(t){var e,i,s=t.target,n=this._videoEl;s===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",s),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,n&&n.removeEventListener("loadeddata",this._onLoadedData),n&&n.removeEventListener("timeupdate",this._onTimeUpdate),i=this._getTextTracks(),i&&(i.onaddtrack=null),e=this._getActiveTrack(),e instanceof window.TextTrack&&o(e)&&(e.mode="disabled",e.oncuechange=null,e.textTrack1&&(e.textTrack1=!1),e.textTrack2&&(e.textTrack2=!1)),this._trackCount++)},_onContentDataLoaded:function(t){var e,i=uvpjs.util,s=t.target,n=t.payload.vidState,a=n.closedCaptionPath;n.isLive,s===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",s),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,e=this._getTextTracks(),e&&(e.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),i.isDefinedString(a)&&(this._captionsUrl=a))},_onLoadedData:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),
this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var e;t.target===this._containerId&&(e=t.payload.url,f.isString(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(e)))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(t){var e=t.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",t);try{e=e.replace(/\n/g,""),e=e.substr(e.indexOf("<?xml"));var i=new DOMParser,s=i.parseFromString(e,"text/xml");this._xmlToCues(s)}catch(t){var n="Error parsing closed captions XML.";this._dispatchCaptionsError(n),this.debug&&uvpjs.error(this.DEBUG_ID,n,t)}},_onLoadError:function(t){var e=t.status,i="Unknown error";switch(e){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+e,this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),o(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){if(t)return e?void(t.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e;if(t.target===this._containerId){var i=this._getActiveTrack();if(this._syncCCTrackMode(i,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(i&&i.activeCues&&(e=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);e--;)t.payload.currentTime-i.activeCues[e].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{!t&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),!!this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=f.get(this._captionsJson,"tt.head.styling.style");if(t=f.isArray(t)?t[0]:t,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),!t)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file."));this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}},_applyStyles:function(){var t,i,s,n=uvpjs.util,a=this.styles,r=this._styleSelector,o=[];this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",a);for(i in a){switch(s=a[i],t=!1,i){case"background-opacity":case"font-opacity":t=!0;break;case"text-position":t=!0,this._setPosition(s);break;case"background-color":s=e(s,a["background-opacity"]);break;case"color":case"font-color":i="color",s=e(s,a["font-opacity"]);break;case"text-edge-style":i="text-shadow",s=v(s)}t||(d(i,s)?o.push({name:i,value:s}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",i,s))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",r,o),n.addCSSRules(this._styleEl,r,o)},_updateStylesObject:function(t){var e,i,n;for(e in t){if(!(i=t[e])||!e)return;if((n=p(e))in this.styles){switch(n){case"font-size":i=s(i)}this.styles[n]=i}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",n)}},_hasCaptions:function(){return o(this._getActiveTrack())},_loadOrDeferCaptions:function(t){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(t)},_loadCaptionsUrl:function(t){var e,i=uvpjs.util.isDefinedString(t),s=i&&-1!==t.indexOf(".vtt");if(i&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),s)return void this._createTrackElement(t);e=new uvpjs.CodeLoader,e.loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),!this._hasCaptions())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize."));this._finalizeTrackElement(),this._finalizeLiveCaptions()},_clearAllCaptionTracks:function(){var t=this._ccEl,e=this._getTextTracks(),i=e&&e.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",e);i--;)this._clearCaptionTrack(e[i]);t&&(t.innerHTML="")},_clearCaptionTrack:function(t){var e,i;if(o(t)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),e=t&&t.cues,i=e&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this._ccEl&&(this._ccEl.style.display=!1===t?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var t,e,i,s=this._getTextTracks(),n=s&&s.length||0;for(i=0;i<n;i++)if(t=s[i],(e=t&&t.cues)&&e.length&&o(t))return t},enableCaptionsTracks:function(){for(var t,e=this._getTextTracks(),i=e&&e.length||0;i--;)t=e[i],o(t)&&(t.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCues:function(){var t=this._getActiveTrack();return t&&t.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var t,e,i,s=this._cviModel.getModule(this.CONFIG_MODULE_NAME),n={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",s),s?!0!==s.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):f.isEmpty(s.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(f.each(s.params,function(s){t=s.name,e=s.value,t&&e&&(i=p(t),n[t]=e)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(n,null,2)),void(this._configStyles=n)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(t){var e=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"],i=e.indexOf(t)>-1?t:"bottom-center-floated";this._setPositionCSS(i)},_setPositionCSS:function(t){var e,i,s,n,a,r,o,d,l=uvpjs.util,u=this._styleEl,h=this._ccEl,c=h&&h.style.marginBottom,p=parseInt(this.BASE_CONTROLS_HEIGHT);u&&h&&(i=t.split("-"),n=i[0],s=i[1],o="inherit"===c?0:parseInt(c),d=o>p?10:p-o,a={top:"0",middle:"50%",bottom:"auto"}[n],r={top:"auto",middle:"auto",bottom:d+"px"}[n],e={top:a,bottom:r,"text-align":s,transform:"initial"},"middle"===n&&(e.transform="translateY(-50%)"),l.addCSSObject(u,h,e,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){function t(){f.assign(_.style,u),E&&(f.assign(E.style,u),this._checkBottomPosition())}var e,i,s,n,a,r,o,d,l,u,h,c,p,v,g,_=this._videoEl,E=this._ccEl,A=_&&_.parentNode;_&&A&&(d=_.videoHeight,(l=_.videoWidth)&&d&&(i=_.getBoundingClientRect(),e=A.getBoundingClientRect(),s=i.height,n=i.width,o=d/l,r=s/n,a=r/o,p=e.height-i.height,c=e.width-i.width,v=a>1||0===c&&0!==p,g=a<1||0!==c&&0===p,u=v?{height:"auto","max-height":"100%",width:"100%",margin:0}:g?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0},u&&t.call(this),i=_.getBoundingClientRect(),e=A.getBoundingClientRect(),p=e.height-i.height,c=e.width-i.width,v?(h=p/2+"px",u={margin:"inherit","margin-top":h,"margin-bottom":h}):g&&(h=c/2+"px",u={margin:"inherit","margin-left":h,"margin-right":h}),E&&(u["font-size"]=this._calculateFontSize(i.width)),u&&t.call(this)))},_calculateFontSize:function(t){var e;try{e=t/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),e=Math.max(e,parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){var e=t&&t.target,i=e&&e.activeCues||this._getActiveCues();this._setCueProps(i)},_setAllCueProps:function(){var t=this._getAllCues();this._setCueProps(t)},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var e,i,s,r,o,d,l,h,c,p,v,_=g(t);if(this._captionsJson=_,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",_),!f.isEmpty(_)&&f.isPlainObject(_)){if(i=f.get(_,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),f.isUndefined(i)||f.isEmpty(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(e=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for(o=this._videoEl.addTextTrack("captions","English","en"),o.id=this._trackId,p=i.length,h=0;h<p;h++)if(c=h+1,l=i[h],r=i[c],d=l.text,!f.isEmpty(d)){for(d=d.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3"),d=d.replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3"),d=d.replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),v=n(d),l._lineCountPrev=l._lineCountPrev||0,l._lineCountNext=l._lineCountNext||0;(r&&r.begin)===l.begin;)r._lineCountPrev=v+l._lineCountNext,l._lineCountNext+=n(r.text),r=i[++c];s=new e(a(l.begin),a(l.end),d),s._lineCount=v,s._lineCountPrev=l._lineCountPrev,s._lineCountNext=l._lineCountNext,s._metadata=l.metadata,s=u.call(this,s),o.addCue(s)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(t){var e,i,s,n=uvpjs.util,a=this._ccEl,r='<div class="{{cntrClass}}">{{spans}}</div>',o="",d=t&&t.length;if(d){for(e=0;e<d;e++)i=t[e],s=i.text,n.isDefinedString(s)&&(s=s.replace(/(\r\n|\n|\r)/g,"<br/>"),o+='<span class="{{txtClass}}">'+s+"</span>",e+1!==d&&(o+="<br/>"));r=r.replace("{{spans}}",o),r=r.replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME),r=r.replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),a&&(a.innerHTML=r)}}}),e=function(t,e){var i=h(t)||r(t)||r(l(t));return i&&e?c(i.r,i.g,i.b,e):t},i=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},s=function(t){var e="100%";return t.indexOf("px")>-1?(e=t.replace("px",""),e/=18,e=100*e+"%"):t.indexOf("%")>-1&&(e=t),e},n=function(t){return t&&(t.match(/\n/g)||[]).length+1},a=function(t){var e,i,s,n,a,r;if(!f.isNull(t)&&!f.isUndefined(t))return r=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},a=t.split(":"),e=60*Number(a[0])*60,i=60*Number(a[1]),s=Number(a[2]),n=e+i+s,r(n,2)},r=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,s){return e+e+i+i+s+s});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},o=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},d=function(t,e){if(t&&e)return f.get(window,"CSS.supports")?window.CSS.supports(t,e):"string"==typeof document.createElement("div").style[t]},u=function(t){var e,i=t._metadata;return i&&(t.snapToLines=!0,e=Math.round(i.cccol/35*100),t.position=e,t.align=e<45?"start":e>55?"end":this._lineAlign,t.positionAlign=e<45?"line-left":e>55?"line-right":"center",t.line=i.ccrow-17+this._lineOffset,t._defaults={line:t.line,position:t.position,align:t.align,positionAlign:t.positionAlign}),t},l=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},h=function(t){var e;if(-1!==t.indexOf("rgba"))return e=t.substr(5,t.length).split(","),{r:e[0],g:e[1],b:e[2]}},p=function(t){if(f.isString(t)&&!f.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},c=function(t,e,i,s){return"rgba("+[t,e,i,s].join(",")+")"},v=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},g=function(t){var e={};if(1===t.nodeType&&t.attributes.length>0)for(var i=0,s=t.attributes.length;i<s;i++){var n=t.attributes.item(i);e[n.nodeName]=n.nodeValue}else 3===t.nodeType&&(e=t.nodeValue);if("p"===t.nodeName&&(e.text="",f.each(t.childNodes,function(t){if("metadata"!==t.nodeName){var i=(new XMLSerializer).serializeToString(t);1===t.nodeType&&(e.text+="br"===t.tagName?"\n":i),3===t.nodeType&&(e.text+=i)}})),t.hasChildNodes())for(var a=0,r=t.childNodes.length;a<r;a++){var o=t.childNodes.item(a),d=o.nodeName;if(void 0!==e[d]){if(void 0===e[d].push){var l=e[d];e[d]=[],e[d].push(l)}e[d].push(g(o))}else e[d]=g(o)}return e}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(t)},initialize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){var e;if(!uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams){this.adCallParams.standardParams={};for(e in t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e]}if(!uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams){this.adCallParams.customParams={};for(e in t.customParams)this.adCallParams.customParams[e]=t.customParams[e]}},overrideSessionOptions:function(t){var i=this.getSessionOptions(t);if(!i||!e.isPlainObject(i))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type."));this.sessionOptions=i},getSessionOption:function(t){return this.sessionOptions[t]||null},getSessionOptions:function(t){var i,s,n;if(i=e.clone(this.sessionOptions),!t||!e.isPlainObject(t))return i;if((s=t.skinConfig)&&!e.isEmpty(s)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object.");for(n in s)i.hasOwnProperty(n)&&(i[n]=s[n])}for(n in i)t.hasOwnProperty(n)&&(i[n]=t[n]);return i},getModule:function(t){return s(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){var i=s(this.modules,t),n=s(i.params,e);if(n&&n.hasOwnProperty("value"))return n.value},setModule:function(t){r(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);if(!e){var i="ConfigDataObject isModuleEnabled module not found: "+t;return this.debug&&uvpjs.log(this.DEBUG_ID,i),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled},isModuleSet:function(t){return!!this.getModule(t)},getClass:function(t){return s(this.classes,t)},getClasses:function(){return this.classes},getClassProperty:function(t,e){var i=s(this.classes,t),n=a.call(this,i,"properties",this.DEBUG_ID),r=s(n,e);return a.call(this,r,"value",this.DEBUG_ID)},getClassListItems:function(t){var e=s(this.classes,t);return a.call(this,e,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){var r=this.getClassListItems(t),o=n(r,e),d=a.call(this,o,"properties",this.DEBUG_ID),l=s(d,i);return a.call(this,l,"value",this.DEBUG_ID)},setClass:function(t){r(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return e.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()}});var i=function(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return!1},s=function(t,e){return i(t,"name",e)},n=function(t,e){return i(t,"id",e)},a=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},r=function(t,e,i,s){for(var n in t)if(t[n][i]==e[i])return this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",e),void(t[n]=e);this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(uvpjs.register("uvpjs")),function(t){var e=t._,i=Math.random();t.ConfigManager=uvpjs.Class.subClass({init:function(t,e,s){if(this.debug=uvpjs.debug,!t||t!==i)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance()."));this.initCallback=s,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.CDO.isCAN()&&this.configSources.push(uvpjs.ConfigManager.CAN_CONFIG_PATH),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(!this.configSources.length)return void(e.isFunction(this.initCallback)&&this.initCallback(this.CDO));var t=this.configSources.shift();if(null!==t&&void 0!==t)switch(t.constructor){case String:if(""===t)break;return void(new uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()},onLoadComplete:function(t){var e,i,s,n=t.responseText,a=t.getResponseHeader("Content-Type");a.indexOf("application/json")>-1?s=JSON.parse(n):a.indexOf("text/xml")>-1||a.indexOf("application/xml")>-1?(e=new DOMParser,i=e.parseFromString(n,"text/xml"),s=this.xmlToCDO(i)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",a),s&&this.updateCDO(s),this.loadConfig()},onLoadError:function(t){var e="unknown error";switch(t.status){case 0:e="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(t){if(e.isEmpty(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"));["classes","modules"].map(function(e){t.hasOwnProperty(e)&&(this.CDO[e]=s(this.CDO[e],t[e]))},this)},xmlToCDO:function(t){var e={},i=function(t){return"y"===t||"n"===t},s=function(t){return"y"===t},r=n(t);return r.hasOwnProperty("player-config")&&(r=r["player-config"]),e.modules=function(){var t,e=[];if(r.modules){t=a(r.modules.module);for(var n in t){var o=t[n],d={name:o.name,category:o.category,enabled:s(o.enabled),params:[]};if(t[n].hasOwnProperty("params")){var l=a(o.params.param);for(var u in l){var h=l[u];h.name&&(i(h.value)&&(h.value=s(h.value)),d.params.push(h))}}o.category,e.push(d)}return e}}(),e.classes=function(){var t=a(r.classes),e=[];for(var i in t){var s=t[i];if(s.hasOwnProperty("classDef")&&(s=s.classDef),s.name){var n={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var o=a(s.list.listitem);for(var d in o){var l=o[d];l.id&&(l.hasOwnProperty("properties")&&(l.properties=l.properties.property),n.list.push(l))}}s.hasOwnProperty("properties")&&(n.properties=s.properties.property),e.push(n)}}return e}(),e},getCDO:function(){return this.CDO}}),t.ConfigManager.CAN_CONFIG_PATH="//can.cbs.com/thunder/player/chrome/smart_tag/config.php?url=http://can.cbs.com/thunder/player/chromeless/uvp/can.xml",t.ConfigManager._instance=null,t.ConfigManager.destroyInstance=function(){this._instance=null},t.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new uvpjs.ConfigManager(i,t,e)),this._instance};var s=function(t,e){for(var i in e){var s=!1;for(var n in t)if(t[n].name===e[i].name){s=!0;break}s||t.push(e[i])}return t},n=function(t){var e,i={};if(1===t.nodeType&&t.attributes.length>0){e=t.attributes.length;for(var s=0;s<e;s++){var a=t.attributes.item(s);i[a.nodeName]=a.nodeValue}}if(t.hasChildNodes()){e=t.childNodes.length;for(var r=0;r<e;r++){var o=t.childNodes.item(r),d=o.nodeName;if(3!==o.nodeType)if(void 0!==i[d]){if(void 0===i[d].push){var l=i[d];i[d]=[],i[d].push(l)}i[d].push(n(o))}else i[d]=n(o)}}return i},a=function(t){if(void 0!==t&&t.constructor!==String)return t.constructor===Object&&(t=[t]),t}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=null,i=null,s=t._;t.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1},initialize:function(t){var s=t.resourceProvider,n=s.vidContId;this.resourceProvider=s,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=n,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+n,this.internalNS="."+n+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+n),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),s.createWatermark()&&!t.suppressWatermark&&(e=new uvpjs.Watermark({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),s.is360()&&!t.suppress360&&(i=new uvpjs.Kaleidoscope360({containerId:n,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){if(s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."));this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),e&&(e.destroy(),e=null),i&&(i.destroy(),i=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1},_updateVolumeSettings:function(t){var t=t||{},e=t.volume,i=!0===t.isMuted,s=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),uvpjs.util.inRange(e,0,1)&&s.volume!==e&&(s.volume=e),"isMuted"in t&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events");for(t in e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.addEventListener(e[t],this,!1);this.videoTagRef.addEventListener(e[i],this,!1)},_removeHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events");for(t in e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.removeEventListener(e[t],this,!1);this.videoTagRef.removeEventListener(e[i],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case e.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){var t;try{t=this.videoTagRef.buffered.end(0)||0}catch(e){t=0}var e={bufferLength:t,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!s.isNumber(t)||t<0?t=0:t>1&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,n=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,a=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:r=!1,n=e.MEDIA_ERR_ABORTED,a=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:n=e.MEDIA_ERR_NETWORK,a=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:n=e.MEDIA_ERR_DECODE,a=i.MEDIA_ERR_DECODE;break
;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:n=e.MEDIA_ERR_SRC_NOT_SUPPORTED,a=i.MEDIA_ERR_SRC_NOT_SUPPORTED}if(this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+n),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."));this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:n,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play())&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",t),isNaN(t)||this.videoTagRef&&t>=0&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var t=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(t)&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t)}},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){var e=!1!==t;this.videoTagRef&&(this.videoTagRef.muted=e,e&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!e&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(t){this.videoTagRef&&t>=0&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(t=this.videoTagRef.seekable.end(0)),t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){(!this.isAbrStreamingSupported()||"boolean"!=typeof t)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(t.length>0){var s=t.length,n=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[s-1][n])return s-1;for(;s--;)if(e>=t[s][n])return i?s+1:s}return 0},addSessionIdAndTicketToURL:function(t,e,i){if(!t)return t;var s=function(t){return-1!==t.indexOf("?")?"&":"?"};return e&&-1===t.indexOf("SessionId=")&&(t+=s(t)+"SessionId="+e),i&&-1===t.indexOf("Ticket=")&&(t+=s(t)+"Ticket="+i),t},processResponseHeader:function(t,e){switch(e){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)}},getCdnNameAtStartup:function(t){return this.resourceProvider.cviModel.CDN_TYPE.AKAMAI},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t,e=this.videoTagRef,i=e&&e.buffered,s=0,n=0;return i&&i.length>0&&(s=i.start&&i.start(0),n=i.end&&i.end(0)),(t=n-s)>0&&t||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(t){if(this.videoTagRef){var e=this.videoTagRef.hasAttribute(this.CONTROLS);t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(t){if(t!==this.playbackState){if(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),s.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(t)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!s.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var t;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(t)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e,i,s,n=Array.isArray(t)&&t.length||0,a=uvpjs.util,r=uvpjs.VPF_Flash.styleTransform;n--;)e=t[n],i=this.dashToCamel(e.name),s=r[i]?r[i](e.value):e.value,!a.isEmpty(e.value)&&this.player.setStyleAttribute(i,s)},setId3Options:function(t){this.id3Options=t},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){var e=!1===t?"false":"true";this.player.enableDynamicStreaming(e)},switchToBitrate:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&this.player.switchStreamingIndex(e.index)},setMinBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.min=e.bitrate,this.player.setMinimumStreamingIndex(e.index))},setMaxBitrateAllowed:function(t){var e=this.findClosestBitrate(t);-1!==e.index&&(this.bitrateInfo.max=e.bitrate,this.player.setMaximumStreamingIndex(e.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t),i=-1!==e.index&&this.bitrateInfo.bitrates.length;-1!==e.index&&e.index<i-1&&this.player.switchStreamingIndex(e.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t);-1!==e.index&&e.index>0&&this.player.switchStreamingIndex(e.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(t){for(var e,i=this.bitrateInfo.bitrates,s=i?i.length:0,n={bitrate:0,delta:1/0,index:-1};s--;)(e=Math.abs(t-i[s]))<n.delta&&(n.bitrate=i[s],n.index=s,n.delta=e);return n},hContentEvent:function(t){var e=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i,s=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(t){case s.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case s.VIDEO_PROGRESS:this.processCvioPayload(e);break;case s.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case s.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case s.VIDEO_DONE:this.processCvioPayload(e),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case s.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case s.VIDEO_TRANSITION_START:i=this.parsePayload(e),this.pendingSwitchMode=i.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e,i,s=this.parsePayload(t,"ContentVIO");if(s){i=s.ContentVIO;for(e in i)this.currFlashVideoState[e]=this.getCvioValue(i[e]);null===this.bitrateInfo.bitrates&&i.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)t[n]=+s[n],e[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var e=this.parsePayload(t,"Cuepoint"),i=this.id3Options,s={pts:null};!e||!i.dataCallback||e.text.indexOf("syncbak.cc")>=0||(s.name=i.findNielsen&&e.text.indexOf("www.nielsen.com")>-1?"www.nielsen.com":e.name,s.data=e.text,i.dataCallback(s))},getCvioValue:function(t){var e,i,s,n,a;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(e="NaN"===t||"null"===t||""===t,i=!e&&"true"===t.toLowerCase(),s=!e&&!i&&"false"===t.toLowerCase(),n=!e&&!i&&!s&&parseInt(t),a=isNaN(n)?t:n,e?-1:!!i||!s&&a):void 0},parsePayload:function(t,e){var i=null;if(0===t.indexOf("{")||0===t.indexOf("[")){try{i=JSON.parse(t)}catch(t){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i}return t},addUvpFlashEventListeners:function(){var t,e,i,s,n,a=uvpjs.VPF_Flash.uvpFlashEvent,r={};for(i in a){e=a[i];for(n in e)s=e[n],r[s]=function(t,e,i){return t["h"+(e.charAt(0).toUpperCase()+e.substr(1))+"Event"].bind(t,i)}(this,i,s)}t=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(r);for(i in t)this.player.addEventJSCallback(i,t[i])},loadVideo:function(){var t={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t,e={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(t in e)this.player.setStyleAttribute(t,e[t])},dashToCamel:function(t){return t.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacity:function(t){return 100*+t},backgroundOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontSize:function(t){var e=t.substr(0,t.indexOf("%")),i=.01*+e;return Math.round(14*i)}}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(t.startTime)&&(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&t.target.activeCues.length>=1&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(t){if(e.isEmpty(this.resourceProvider)||e.isEmpty(this.resourceProvider.cviModel))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t));var i=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,i)}})}(uvpjs.register("uvpjs")),function(t){t.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isLiveStreamKnown=!1,this._isHdStreamLive=!1,this._isPlayingLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy"),this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&t.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&t.startBitrate>-1&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&t.maxBitrate>-1&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&t.minBitrate>-1&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){var t=this.player,e=this.player.liveSyncPosition,i=this.isHDStreamLive();i&&t&&e?this.seekTo(e):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+i)},seekTo:function(t){var e=this.player,i=this.player.liveSyncPosition,s=this.isHDStreamLive();this._isPlayingLive=e&&s&&i&&t===i,this._super(t)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,i=isNaN(e)?this.bitrateList.length-1:e;t>=0&&t<=i?this.player.nextLevel=t:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",i," : Index=",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var t=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(t){if(this.player){this.player.config.minAutoBitrate=t-1;var e=this.getIndexForBitrate(this.bitrateList,t,!0);this.player.currentLevel<e&&(this.player.nextAutoLevel=e),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var t=this.player.maxAutoLevel;return void 0!==t?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(t){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(t=this.bitrateList[this.player.currentLevel].bitrate),t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t,e;if(this.player)return t=this.player.media,(e=t.getVideoPlaybackQuality)&&"function"==typeof e?e.call(t).droppedVideoFrames:t.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){return this._isPlayingLive},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.FRAG_LOADING,s,!1),this.player.on(t.FRAG_LOAD_PROGRESS,s,!1),this.player.on(t.FRAG_LOADED,s,!1),this.player.on(t.FRAG_PARSED,s,!1),this.player.on(t.FRAG_BUFFERED,s,!1),this.player.on(t.FRAG_CHANGED,s,!1),this.player.on(t.FRAG_PARSING_DATA,s,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.FRAG_LOADING,s),this.player.off(t.FRAG_LOAD_PROGRESS,s),this.player.off(t.FRAG_LOADED,s),this.player.off(t.FRAG_PARSED,s),this.player.off(t.FRAG_BUFFERED,s),this.player.off(t.FRAG_CHANGED,s),this.player.off(t.FRAG_PARSING_DATA,s),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e,i=t.levels,s=i.length,n=[];s--;)e=i[s],n.unshift({name:e.name||null,rate:e.bitrate,width:e.width,height:e.height});n.sort(function(t,e){var i=t.rate,s=e.rate;return i<s?-1:i>s?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:n})},onRequest:function(t,e){this.withCredentials=this.withCredentials||e.indexOf("akamaihd")>-1&&e.indexOf("csmil")>-1,t.withCredentials=this.withCredentials;var i=function(i){if(-1!==e.indexOf(".m3u8"))t.readyState===XMLHttpRequest.DONE&&200===t.status&&(this._isHdStreamLive=-1===t.responseText.indexOf("STREAM-INF")&&-1===t.responseText.indexOf("EXT-X-ENDLIST"),!this._isLiveStreamKnown&&this._isHdStreamLive&&(this._isPlayingLive=!0,this._isLiveStreamKnown=!0));else if(-1!==e.indexOf(".ts")&&t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var s=t.getAllResponseHeaders();this.multiCDNEnabled=-1!==s.indexOf(this.responseHeaders.MULTI_CDN);var n=this.multiCDNEnabled?t.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(e);this.processResponseHeader(n,this.responseHeaders.MULTI_CDN)}};(this.multiCDNEnabled||-1!==e.indexOf(".m3u8"))&&t.addEventListener("readystatechange",i.bind(this))},onLibraryEvent:function(t,e){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.MEDIA_ATTACHING:
case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:case i.LEVEL_UPDATED:case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onFragmentEvent:function(t,e){var i,s,n=Hls.Events;switch(t){case n.FRAG_LOAD_PROGRESS:break;case n.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case n.FRAG_LOADED:s=e.stats,i=8e3*s.loaded/Number(window.performance.now()-s.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case n.FRAG_CHANGED:}},onID3Event:function(t,e){this.resourceProvider.facadeId3Data(e.samples)},onError:function(t,e){var i=!1,s=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===s.indexOf(e.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case Hls.ErrorTypes.NETWORK_ERROR:i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts,i&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var s=uvpjs.ErrorInfo,n=Hls.ErrorTypes,a=uvpjs.ErrorInfo.errorCodes;switch(t){case n.NETWORK_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case n.MUX_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:a.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case a.RESOURCE_GEOBLOCKED:return new s({errorCode:a.RESOURCE_GEOBLOCKED,hlsjsErrorCode:a.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(t){["network","media"].forEach(function(e){t[e]&&t[e].attempts&&"number"==typeof t[e].attempts&&(this.errorRecovery[e+"RetryAttempts"]=t[e].attempts)}.bind(this))}})}(uvpjs.register("uvpjs")),function(t){"use strict";function e(t){if(!isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}t.Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(e=t.videoEl,this._videoEl=e,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),!this._diagEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window."));this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t,e,i,s=uvpjs.util,n=this._styleEl,a=this._contentEl;this._template,this._params,a&&(t=document.createElement("div"),t.id=this._diagnosticId,a.insertBefore(t,a.firstChild),i=uvpjs.util.htmlToElement("<span>x</span>"),i.addEventListener("click",this._handleCloseButton.bind(this),!0),t.appendChild(i),e=document.createElement("table"),t.appendChild(e),s.addCSSObject(n,t,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),s.addCSSObject(n,t,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),s.addCSSObject(n,t,{color:"#fff"},"span:hover"),s.addCSSObject(n,t,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),s.addCSSObject(n,t,{background:"transparent"},"table td"),s.addCSSObject(n,t,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),s.addCSSObject(n,t,{width:"60px"},"table td:last-child"),this._diagEl=t,this._diagTableEl=e,this._hideDiagBtn=i)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;if(t)return"block"===t.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(this._containerEl,!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners."));this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(this._containerEl,!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners."));e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)},_updateTableHtml:function(){var t,e,i="",s=this._params;for(t in s)null!==(e=s[t])&&void 0!==e&&(i+="<tr><td>"+t+"</td><td>"+e+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(t){var i=t.payload,s=i.facadeState,n=this._params,a=s.minABRLevel,r=s.maxABRLevel;t.target===this._containerId&&(n["stream type"]=i.streamType,n.duration=i.duration,n["current time"]=i.currentTime.toFixed(2),n["buffer length"]=i.bufferLength.toFixed(2),n["total dropped frames"]=i.droppedFrames>=0&&i.droppedFrames||null,n["average dropped (fps)"]=i.averageDroppedFPS>=0&&i.averageDroppedFPS.toFixed(2)||null,n["playback framerate (fps)"]=i.playbackFramerate>=0&&i.playbackFramerate.toFixed(2)||null,n["current bandwidth (B/s)"]=i.currentBandwidth>=0&&e(i.currentBandwidth)||null,n["switching mode"]=i.switchingMode,n["current index bitrate (B/s)"]=e(s.currentAbr&&s.currentAbr.bitrate),n["start index bitrate (B/s)"]=e(s.startBitrate),void 0!==a&&void 0!==r&&(n["available indexes"]=a+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){if(!this._imgEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark."));this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null},_createImage:function(){var t;this._contentEl&&(t=document.createElement("img"),t.id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeImage:function(){var t=this._imgEl;t&&t.parentNode&&t.parentNode.removeChild(t)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showImage:function(){var t=this._imgEl;t&&(t.style.display="block")},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,s,n,a,r,o,d,l,u,h,c,p,v,g,f,_,E,A,m,y;e=this._contentEl,i=this._videoEl,(t=this._imgEl)&&i&&e&&(p=i.videoHeight,(v=i.videoWidth)&&p&&(a=this.OFFSET,l=this.SIZE,r=i.getBoundingClientRect(),g=e.getBoundingClientRect(),o=r.height,d=r.width,c=p/v,h=o/d,u=h/c,s=d*c,n=o/c,f=g.bottom-r.bottom,_=g.right-r.right,u>1?(E=(o-s)/2,A=0,y=d*l+"px",m="auto"):(E=0,A=(d-n)/2,y="auto",m=o*l*(this.RATIO/c)+"px"),t.style.width=y,t.style.height=m,t.style.bottom=E+f+a+"px",t.style.right=A+_+a+"px"))}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){if(!this._360El||!this._kaleidoscopeViewer)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360."));this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null},_loadKaleidoscope:function(t){return"function"!=typeof t?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;if(!e||!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)}})}(uvpjs.register("uvpjs")),function(t){t.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},has:function(t){return!uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(t){return{error:!1,message:""}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),i=uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!i,message:e.error?e.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(t){t.DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(t){this.cmsRefGuid=t,this.daiParams.daiVideoId=t},canMakePlatformCall:function(t){var e=uvpjs.util.isDefinedString(t),i=this.has("selectorCall")&&this.selectorCall||e&&t;return!!i&&(i.indexOf("$PID$")>-1?this.has("pid"):!(i.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(t),s=this._super(t),n=(t.useSsb||e)&&i&&!s.error,a=e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!n,missingSDK:!e,message:s.error?s.message:a}},populateSelf:function(t){var e,i;for(e in t)i=t.hasOwnProperty(e),i&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=uvpjs.util,i=!e.isEmpty(t.adTagParameters),s=!e.isEmpty(t.contentSourceId);return t.useSsb||i&&s?t.useSsb?!e.isEmpty(t.assetURL):i&&s:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var t,e=uvpjs.util,i=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;i&&"string"!=typeof i&&e.isPlainObject(i)&&(t=e.queryStrFromObj(i),this.daiParams.adTagParameters.cust_params=encodeURIComponent(t))}})}(uvpjs.register("uvpjs")),function(t){t.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&google.ima,i=this._super(t);return{error:!(e&&!i.error),missingSDK:!e,message:i.error?i.message:"IMA SDK is missing."}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(t){t.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=uvpjs.util,i=e.isDefinedString(t.pid),s=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),n=this._super(t);return{error:!(!n.error&&(i||s||e.isDefinedString(t.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.UvpSwfService=uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var t;this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype;for(t in this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var t=this.getContainerSize(),e=t.width,i=t.height;this.swf&&this.swf.setSize(e,i,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){if(!t.success)return void this.callback(null,this.svcC.error.EMBED_FAILED);this.startTimer()},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t,e,i=this.dom;if(!this.svcC.hasFlash())return void this.callback(null,this.svcC.error.FLASH_NOT_DETECTED);this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),t=document.createElement("div"),t.id=this.swfName,e=i.querySelector("video"),e.style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(t,e),this.embed(t)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(t)&&parseInt(t)>0},t.UvpSwfService.setWindowMethods=function(t){var e,i,s,n=uvpjs.util;for(e in t)i=t[e],s="f_"+n.uid8(),window[s]=i,t[e]=s;return t},t.UvpSwfService.swfobject=function(){function t(){if(!K&&document.getElementsByTagName("body")[0]){try{var t,e=_("span");e.style.display="none",t=B.getElementsByTagName("body")[0].appendChild(e),t.parentNode.removeChild(t),t=null,e=null}catch(t){return}K=!0;for(var i=G.length,s=0;s<i;s++)G[s]()}}function e(t){K?t():G[G.length]=t}function i(t){if(typeof w.addEventListener!=M)w.addEventListener("load",t,!1);else if(typeof B.addEventListener!=M)B.addEventListener("load",t,!1);else if(typeof w.attachEvent!=M)A(w,"onload",t);else if("function"==typeof w.onload){var e=w.onload;w.onload=function(){e(),t()}}else w.onload=t}function s(){var t=B.getElementsByTagName("body")[0],e=_(O);e.setAttribute("style","visibility: hidden;"),e.setAttribute("type",N);var i=t.appendChild(e);if(i){var s=0;!function a(){if(typeof i.GetVariable!=M)try{var r=i.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),q.pv=[E(r[0]),E(r[1]),E(r[2])])}catch(t){q.pv=[8,0,0]}else if(s<10)return s++,void setTimeout(a,10);t.removeChild(e),i=null,n()}()}else n()}function n(){var t=V.length;if(t>0)for(var e=0;e<t;e++){var i=V[e].id,s=V[e].callbackFn,n={success:!1,id:i};if(q.pv[0]>0){var l=f(i);if(l)if(!m(V[e].swfVersion)||q.wk&&q.wk<312)if(V[e].expressInstall&&r()){var u={};u.data=V[e].expressInstall,u.width=l.getAttribute("width")||"0",u.height=l.getAttribute("height")||"0",l.getAttribute("class")&&(u.styleclass=l.getAttribute("class")),l.getAttribute("align")&&(u.align=l.getAttribute("align"));for(var h={},c=l.getElementsByTagName("param"),p=c.length,v=0;v<p;v++)"movie"!=c[v].getAttribute("name").toLowerCase()&&(h[c[v].getAttribute("name")]=c[v].getAttribute("value"));o(u,h,i,s)}else d(l),s&&s(n);else S(i,!0),s&&(n.success=!0,n.ref=a(i),n.id=i,s(n))}else if(S(i,!0),s){var g=a(i);g&&typeof g.SetVariable!=M&&(n.success=!0,n.ref=g,n.id=g.id),s(n)}}}function a(t){var e=null,i=f(t)
;return i&&"OBJECT"===i.nodeName.toUpperCase()&&(e=typeof i.SetVariable!==M?i:i.getElementsByTagName(O)[0]||i),e}function r(){return!Y&&m("6.0.65")&&(q.win||q.mac)&&!(q.wk&&q.wk<312)}function o(t,e,i,s){var n=f(i);if(i=g(i),Y=!0,b=s||null,C={success:!1,id:i},n){"OBJECT"==n.nodeName.toUpperCase()?(T=l(n),I=null):(T=n,I=i),t.id=k,(typeof t.width==M||!/%$/.test(t.width)&&E(t.width)<310)&&(t.width="310"),(typeof t.height==M||!/%$/.test(t.height)&&E(t.height)<137)&&(t.height="137");var a=q.ie?"ActiveX":"PlugIn",r="MMredirectURL="+encodeURIComponent(w.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+a+"&MMdoctitle="+encodeURIComponent(B.title.slice(0,47)+" - Flash Player Installation");if(typeof e.flashvars!=M?e.flashvars+="&"+r:e.flashvars=r,q.ie&&4!=n.readyState){var o=_("div");i+="SWFObjectNew",o.setAttribute("id",i),n.parentNode.insertBefore(o,n),n.style.display="none",p(n)}h(t,e,i)}}function d(t){if(q.ie&&4!=t.readyState){t.style.display="none";var e=_("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(l(t),e),p(t)}else t.parentNode.replaceChild(l(t),t)}function l(t){var e=_("div");if(q.win&&q.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(O)[0];if(i){var s=i.childNodes;if(s)for(var n=s.length,a=0;a<n;a++)1==s[a].nodeType&&"PARAM"==s[a].nodeName||8==s[a].nodeType||e.appendChild(s[a].cloneNode(!0))}}return e}function u(t,e){var i=_("div");return i.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+t+"'>"+e+"</object>",i.firstChild}function h(t,e,i){var s,n=f(i);if(i=g(i),q.wk&&q.wk<312)return s;if(n){var a,r,o,d=_(q.ie?"div":O);typeof t.id==M&&(t.id=i);for(o in e)e.hasOwnProperty(o)&&"movie"!==o.toLowerCase()&&c(d,o,e[o]);q.ie&&(d=u(t.data,d.innerHTML));for(a in t)t.hasOwnProperty(a)&&(r=a.toLowerCase(),"styleclass"===r?d.setAttribute("class",t[a]):"classid"!==r&&"data"!==r&&d.setAttribute(a,t[a]));q.ie?x[x.length]=t.id:(d.setAttribute("type",N),d.setAttribute("data",t.data)),n.parentNode.replaceChild(d,n),s=d}return s}function c(t,e,i){var s=_("param");s.setAttribute("name",e),s.setAttribute("value",i),t.appendChild(s)}function p(t){var e=f(t);e&&"OBJECT"==e.nodeName.toUpperCase()&&(q.ie?(e.style.display="none",function t(){if(4==e.readyState){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}else setTimeout(t,10)}()):e.parentNode.removeChild(e))}function v(t){return t&&t.nodeType&&1===t.nodeType}function g(t){return v(t)?t.id:t}function f(t){if(v(t))return t;var e=null;try{e=B.getElementById(t)}catch(t){}return e}function _(t){return B.createElement(t)}function E(t){return parseInt(t,10)}function A(t,e,i){t.attachEvent(e,i),H[H.length]=[t,e,i]}function m(t){t+="";var e=q.pv,i=t.split(".");return i[0]=E(i[0]),i[1]=E(i[1])||0,i[2]=E(i[2])||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]}function y(t,e,i,s){var n=B.getElementsByTagName("head")[0];if(n){var a="string"==typeof i?i:"screen";if(s&&(R=null,P=null),!R||P!=a){var r=_("style");r.setAttribute("type","text/css"),r.setAttribute("media",a),R=n.appendChild(r),q.ie&&typeof B.styleSheets!=M&&B.styleSheets.length>0&&(R=B.styleSheets[B.styleSheets.length-1]),P=a}R&&(typeof R.addRule!=M?R.addRule(t,e):typeof B.createTextNode!=M&&R.appendChild(B.createTextNode(t+" {"+e+"}")))}}function S(t,e){if(W){var i=e?"visible":"hidden",s=f(t);K&&s?s.style.visibility=i:"string"==typeof t&&y("#"+t,"visibility:"+i)}}function D(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=M?encodeURIComponent(t):t}var T,I,b,C,R,P,M="undefined",O="object",L="Shockwave Flash",N="application/x-shockwave-flash",k="SWFObjectExprInst",U="onreadystatechange",w=window,B=document,j=navigator,F=!1,G=[],V=[],x=[],H=[],K=!1,Y=!1,W=!0,z=!1,q=function(){var t=typeof B.getElementById!=M&&typeof B.getElementsByTagName!=M&&typeof B.createElement!=M,e=j.userAgent.toLowerCase(),i=j.platform.toLowerCase(),s=/win/.test(i||e),n=/mac/.test(i||e),a=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),r="Microsoft Internet Explorer"===j.appName,o=[0,0,0],d=null;if(typeof j.plugins!=M&&typeof j.plugins[L]==O)(d=j.plugins[L].description)&&typeof j.mimeTypes!=M&&j.mimeTypes[N]&&j.mimeTypes[N].enabledPlugin&&(F=!0,r=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=E(d.replace(/^(.*)\..*$/,"$1")),o[1]=E(d.replace(/^.*\.(.*)\s.*$/,"$1")),o[2]=/[a-zA-Z]/.test(d)?E(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof w.ActiveXObject!=M)try{var l=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");l&&(d=l.GetVariable("$version"))&&(r=!0,d=d.split(" ")[1].split(","),o=[E(d[0]),E(d[1]),E(d[2])])}catch(t){}return{w3:t,pv:o,wk:a,ie:r,win:s,mac:n}}();return function(){q.w3&&((typeof B.readyState!=M&&("complete"===B.readyState||"interactive"===B.readyState)||typeof B.readyState==M&&(B.getElementsByTagName("body")[0]||B.body))&&t(),K||(typeof B.addEventListener!=M&&B.addEventListener("DOMContentLoaded",t,!1),q.ie&&(B.attachEvent(U,function e(){"complete"==B.readyState&&(B.detachEvent(U,e),t())}),w==top&&function e(){if(!K){try{B.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}t()}}()),q.wk&&function e(){if(!K)return/loaded|complete/.test(B.readyState)?void t():void setTimeout(e,0)}()))}(),G[0]=function(){F?s():n()},function(){q.ie&&window.attachEvent("onunload",function(){for(var t=H.length,e=0;e<t;e++)H[e][0].detachEvent(H[e][1],H[e][2]);for(var i=x.length,s=0;s<i;s++)p(x[s]);for(var n in q)q[n]=null;q=null;for(var a in swfobject)swfobject[a]=null;swfobject=null})}(),{registerObject:function(t,e,i,s){if(q.w3&&t&&e){var n={};n.id=t,n.swfVersion=e,n.expressInstall=i,n.callbackFn=s,V[V.length]=n,S(t,!1)}else s&&s({success:!1,id:t})},getObjectById:function(t){if(q.w3)return a(t)},embedSWF:function(t,i,s,n,a,d,l,u,c,p){var v=g(i),f={success:!1,id:v};q.w3&&!(q.wk&&q.wk<312)&&t&&i&&s&&n&&a?(S(v,!1),e(function(){s+="",n+="";var e={};if(c&&typeof c===O)for(var g in c)e[g]=c[g];e.data=t,e.width=s,e.height=n;var _={};if(u&&typeof u===O)for(var E in u)_[E]=u[E];if(l&&typeof l===O)for(var A in l)if(l.hasOwnProperty(A)){var y=z?encodeURIComponent(A):A,D=z?encodeURIComponent(l[A]):l[A];typeof _.flashvars!=M?_.flashvars+="&"+y+"="+D:_.flashvars=y+"="+D}if(m(a)){var T=h(e,_,i);e.id==v&&S(v,!0),f.success=!0,f.ref=T,f.id=T.id}else{if(d&&r())return e.data=d,void o(e,_,i,p);S(v,!0)}p&&p(f)})):p&&p(f)},switchOffAutoHideShow:function(){W=!1},enableUriEncoding:function(t){z=typeof t===M||t},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:m,createSWF:function(t,e,i){return q.w3?h(t,e,i):void 0},showExpressInstall:function(t,e,i,s){q.w3&&r()&&o(t,e,i,s)},removeSWF:function(t){q.w3&&p(t)},createCSS:function(t,e,i,s){q.w3&&y(t,e,i,s)},addDomLoadEvent:e,addLoadEvent:i,getQueryParamValue:function(t){var e=B.location.search||B.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return D(e);for(var i=e.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==t)return D(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Y){var t=f(k);t&&T&&(t.parentNode.replaceChild(T,t),I&&(S(I,!0),q.ie&&(T.style.display="block")),b&&b(C)),Y=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(t){var e=t._;t.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,i,s){var n;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=s,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",n=this.cviModel.contentVideoState,n.sendResumeEvent=!1,n.startTime=0,n.elapsedTime=0,n.showPreroll=!0,n.playedChapterTime=0,n.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({defaults:this.cviModel.contentVideoStateDefaults,eventsManager:this.eventsMgr}),e.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(t){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(t)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var s,n=uvpjs.ErrorInfo;if(i)return s=new n({errorCode:n.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:s},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecision:function(t,e){this.setNewAssetUrlAndCdn(e),this.doFlashCheck(t)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,s=!e&&t.isDesktop&&uvpjs.UvpSwfService.hasFlash(),n=this.mc.isHlsUrl(this._getAssetUrl()),a=uvpjs.Configuration.env;return!("local"!==a&&"dev"!==a&&"stage"!==a||!window.forceFlash||!s)||n&&!i&&s},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions();break;case e.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions()}},finishLoadVideoAndBeginPlayback:function(t){var e,i=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),i.incrementMedNum(),this.createFacade(),e=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(e),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),e===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e,i,s,n=t&&t.providers||null,a=n&&n[0]?n[0]:null,r=a&&a.host||null,o=a&&a.provider||null;r&&(e=this._getAssetUrl(),i=uvpjs.util.parseUrl(e),r!==i.host&&(s=i.protocol+"//"+r+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=s)),o&&this.setContentVideoStateCdn(o)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCdn:function(t){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var t=function(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)},e=function(t){var e=i.getSessionOption(t);return"number"==typeof e&&e>=0?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1},i=this.cviModel,s=e(i.START_BITRATE),n=e(i.MIN_BITRATE),a=e(i.MAX_BITRATE),r=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),d=t(i.DASHJS_FAST_SWITCH_ABR),l=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),h=Number(this.rco.startBitrate)||-1,c=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,v=Number(this.rco.liveSyncDurationCount)||-1,g=this.rco.capLevelToPlayerSize,f=this.rco.enableDashJSFastSwitchABR,_=this.rco.useDynamicSwitching,_=this.rco.useDynamicSwitching,E=this.rco.errorRecovery;h>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",h),i.setStartBitrate(h)):i.setStartBitrate(s),c>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",c),i.setMinBitrate(c)):i.setMinBitrate(n),p>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(a),v>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",v),i.setLiveSyncDurationCount(v)):i.setLiveSyncDurationCount(r),"boolean"==typeof g?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",g),i.setCapLevelToPlayerSize(g)):i.setCapLevelToPlayerSize(o),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",f),i.setDashJSFastSwitchABR(f)):i.setDashJSFastSwitchABR(d),"boolean"==typeof _?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",_),i.setUseDynamicSwitching(_)):i.setUseDynamicSwitching(l),"object"==typeof E?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",E),i.setErrorRecovery(E)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e,i=this.id3EventQueue,s=i&&i.length||0;s--;)e=i[s],t>=e.pts&&(this.dispatchCuepointEvent(e),this.id3EventQueue.splice(s,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),s={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",s),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(s.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(s.swfService=this.uvpSwfService);var n=this.facade.initialize(s);!n||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:n,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;if(this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),!t)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up."));this.facade.destroy(),this.facade={}},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModule:function(t){return this.cviModel.getModule(t)},getModuleParam:function(t,e){return this.cviModel.getModuleParam(t,e)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,e=t?"Fatal ERROR encountered":"";this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+e),!t&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId)},dispatchVideoStateChange:function(t){isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(t){t&&t.abrInfo&&this.cviModel.setAbrInfo(t.abrInfo)},facadeProgress:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(parseInt(t.duration)))},facadeDurationChanged:function(t){uvpjs.util.isEmpty(t)||"object"!=typeof t||t.duration},setModelDuration:function(t){t>0&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),!this._seekFromTime)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE."));this._seekToTime=t.seekToTime,this.dispatchSeekDone()},facadeError:function(t){var e,i,s,n,a=uvpjs.util,r=this.RPM&&this.RPM.currRP,o=this.eventsMgr,d=this.cviModel,l=!a.isEmpty(d),u=t.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),l&&u&&(e=this.cviModel.getContentVideoState(),i=e.playbackStarted,s=a.isDefinedString(e.overrideAssetURL),!i&&s&&!this._overrideAssetUrlFailure))return void this._handleOverrideAssetURLError(t);if(l||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),a.isEmpty(o)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(n=t.eventType||o.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=n,o.dispatchEvent(n,{errorInfo:t},this.vidContId)),u){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),l&&(d.contentPlaybackState.fatalError=!0),r&&r.rco&&r.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void r.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:i},this.vidContId)},facadeVideoTransitionComplete:function(t,e){var i=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+i),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:i},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeId3Data:function(t){this.id3Parser&&this.id3Parser.parse(t)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e,i=this.mc.STREAMING,t=t||this._getAssetUrl(),s=this.mc.isHlsUrl(t),n=this.mc.isDashUrl(t),a=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(a||s||n)&&this._setDeliveryType(i),!a&&s)this.mc.canPlayHLSJS()&&(e=new uvpjs.VPF_HLSJS);else if(!a&&n)if(uvpjs.VPF_DASHJS)e=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));e=new uvpjs.VPF_SHAKA}else a&&(e=new uvpjs.VPF_Flash);return e||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i)},_getAssetUrl:function(t){var e=uvpjs.util,i=t||this.cviModel.getContentVideoState(),s=i.overrideAssetURL,n=e.isDefinedString(s)&&!this._overrideAssetUrlFailure,a=n?s:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+n+")",a),a},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),t.eventType=s,t.message=n,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.bitrate,n=this.cviModel,a=this.facade;if(e===this.vidContId&&s&&this._hasFacade())switch(typeof s){case"string":if("up"===s)n.setUseDynamicSwitching(!1),a.switchUp();else if("down"===s)n.setUseDynamicSwitching(!1),a.switchDown();else{if(s=Number(s),isNaN(s))return;n.setUseDynamicSwitching(!1),a.switchToBitrate(s)}break;case"number":n.setUseDynamicSwitching(!1),a.switchToBitrate(s);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",s)}},onUseDynamicSwitching:function(t){if(t&&t.target===this.vidContId&&t.payload){var e=t.payload.data;this.cviModel.setUseDynamicSwitching(e),this._hasFacade()&&(this.facade.useDynamicSwitching(e),e&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",e)}},onMinimumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMinBitrate(i),this._hasFacade()&&s.setMinBitrateAllowed(i)}},onMaximumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,s=this.facade;if(t.target===this.vidContId){if(!i||"number"!=typeof i)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i));this.cviModel.setMaxBitrate(i),this._hasFacade()&&s.setMaxBitrateAllowed(i)}},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.cviModel.contentVideoState.duration,a=this.cviModel.contentPlaybackState.currentTime,r=this.facade;if("number"==typeof s&&e===this.vidContId){if(s<0||s>n)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||a,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&r.seekTo(s)}},onVideoSeekToLive:function(){var t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!e.isNaN(t)&&e.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){var e={data:t};t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,e,this.vidContId)},facadeTimeUpdate:function(t){this.cviModel.setContentPlaybackStateItems({currentTime:t})},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var e=t&&t.target,i=this.facade
;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.pauseVideo()},onPlayVideo:function(t){var e=t&&t.target,i=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&i.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted,r=this.facade;e===this.vidContId&&n&&!a&&this._hasFacade()&&r.setVolume(s)},onMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.muteVideo()},onUnMuteVideo:function(t){var e=t&&t.target,i=this.facade;e===this.vidContId&&this._hasFacade()&&i.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var t={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!e.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var i=this.getVideoProgressPayload();this.setModelDuration(i.duration),this.id3HandlingEnabled&&this.checkId3Events(i.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,i,this.vidContId)}},checkBuffering:function(t){var e,i=this.cviModel?this.cviModel.contentPlaybackState:null;i&&i.playbackStarted&&i.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(e=t||i.currentTime||0,!this.bufferingDetected&&e<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&e>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=e)},getVideoProgressPayload:function(){var t=(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),e={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:t,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(e),e},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,s=localStorage.getItem("UVPJS.resumeEpochTime")||null,n=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),s&&(t.resumeEpochTime=s),n&&(t.resumeSessionId=n))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var t=this.cviModel;t&&(t.resetAdVideoState(),t.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(t){var e=t._,i={DOUBLECLICK_IMA:"pubads.g.doubleclick.net",DOUBLECLICK:"ad.doubleclick.net",PHP:"request.php",JSP:"Request.jsp"};t.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.opts.defaults&&this.populateDefaults(this.opts.defaults),this.eventsMgr=this.opts.eventsManager,delete this.opts.defaults,this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(t){var e;for(e in t)this.opts[e]=t[e]},getModel:function(){return this.mdl},getProperty:function(t){return this.mdl[t]},setProperty:function(t,e){this.mdl[t]=e},loadData:function(t,e){var i,s="callback=uvpHandleJsonpResult",n=e||this.opts.queryParams,a=!1,r=!uvpjs.util.isEmpty(n);if(this.opts.url=t,this.opts.queryParams=e,r){t+=t.indexOf("?")<0?"?":"&";for(i in n)t+=(a?"&":"")+i+"="+n[i],a=!0}t.indexOf(s)<0&&(t+=(t.indexOf("?")<0?"?":"&")+s),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(t){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(t)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(t){var e,i,s,n,a,r,o,d,l,u=t.getElementsByTagName("ref"),h=null,c=u[0],p=!1,v=this.mdl,g=c&&this.checkForPlatformError(c);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),g&&g.error)return g;if(e=t.getElementsByTagName("switch"),i=e[0]?e[0].getElementsByTagName("video"):t.getElementsByTagName("video"),null===i[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(v.chapterTimesString="",c)for(s=0,n=u.length;s<n;s++)a=u[s],o=a.attributes.src.nodeValue,this.isAdCallURL(o)?(!p&&(v.imaAdCall=o),p=!0):h||(h=a,v.assetURL=h.getAttribute("src"),d=a.getElementsByTagName("param")),null!==a.getAttribute("clipEnd")&&(v.chapterTimesString+=a.getAttribute("clipEnd")+",");for(s=0,n=i.length;s<n&&(r=i[s],o=r.attributes.src.nodeValue,h||(h=r,v.assetURL=h.getAttribute("src"),d=r.getElementsByTagName("param"),null!==r.getAttribute("clipEnd")));s++)null!==r.getAttribute("clipEnd")&&(v.chapterTimesString+=r.getAttribute("clipEnd")+",");return l=d&&this.extractParams(d)||{},this.populateModelFromContentNodeAndParams(h,l),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i,s,n=this.mdl,a=uvpjs.mediaCapabilities,r={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},o={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},d="true";for(q in r)n[q]=t.getAttribute(r[q])||"";for(q in o)n[q]=e[o[q]]||"";n.mediaId=this.getMediaId(e),n.duration=this.getDuration(t),n.sourceOwner=this.getSourceOwner(e),n.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",n.isEmbedable=e.Embeddable===d,n.isLive=e.IsLive===d,n.episodeFlag=e.EpisodeFlag===d,n.useWatermark=e.WatermarkPlayback===d,n.chapterTimesString.length>0?(i=n.chapterTimesString,s=i.length-1,i.lastIndexOf(",")===s&&(n.chapterTimesString=i.substring(0,s)),n.chapterStartTimes=this.convertChapterTimesToSeconds(n.chapterTimesString)):n.chapterStartTimes=[],n.assetURL.indexOf(a.M3U)>-1?(n.cdn="",n.fileType=a.M3U):n.assetURL.indexOf(a.MP3)>-1?n.fileType=a.MP3:n.fileType=a.MP4},handleData:function(t){var e=t.responseText,i=uvpjs.util,s=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),n=this.isValidJsonStr(s)&&JSON.parse(s)||null,a=i.isEmpty(n)?null:n.metafile,r=a&&new DOMParser,o=r&&r.parseFromString(a,"application/xml"),d=o&&this.parseSmilXML(o);if(this.callAttempts=0,d){if(d.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+d.errorInfo.message),void this.signalError(d.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(t.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(t)?(e=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+e,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),e)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){var e=t.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==e&&404!==e&&403!==e&&0!==e},defineProperties:function(){},checkForPlatformError:function(t){var e=t&&this.parseSmilRefNodeForException(t);return e?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(e),serverCode:e.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+s+(t.exception||"Resource Unavailable.")+" "+n},populateDefaults:function(t){!uvpjs.util.isEmpty(t)&&e.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e,i=t.getElementsByTagName("param"),s={};if(i&&i.length){for(e=i.length;e--;)s[i[e].getAttribute("name")]=i[e].getAttribute("value");if("true"===s.isException)return s.abstract=t.getAttribute("abstract")||"",s}return null},extractParams:function(t){var e,i,s,n,a={};if(uvpjs.util.isEmpty(t))return a;for(n=t.length;n--;)e=t[n],i=e.getAttribute("name"),s=e.getAttribute("value"),i&&s&&(a[i]=s);return a},isAdCallURL:function(t){return t.indexOf(i.DOUBLECLICK)>-1||t.indexOf(i.DOUBLECLICK_IMA)>-1||t.indexOf(i.PHP)>-1||t.indexOf(i.JSP)>-1},getMediaId:function(t){var e,i,s,n="",a=t.trackingData;if(uvpjs.util.isEmpty(a))return"";for(e=a.split("|"),i=0,s=e.length;i<s;i++)e[i].indexOf("cid=")>-1&&(n=e[i].split("=")[1]);return n},getSourceOwner:function(t){var e=t.Source;return uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){var e=parseInt(t.getAttribute("dur"))||0;return e>0?.001*e:e},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),s=i.length;s--;)e.unshift(function(t){var e=parseInt;switch(t=i[s].split(":"),t.length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}}(i[s]));return e}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(t,e,i){this._super(t,e,i)},loadData:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),!e.isFunction(t)||!e.isFunction(i))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS);this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}})}(uvpjs.register("uvpjs")),function(t){t.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(t,e){var i=this.getSelectorCall(),s=i.url||null,n=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof e&&e(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(s,n)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t,e,i,s,n,a,r,o,d,l=this.rco,u=l.has("selectorCall")&&l.selectorCall||null;if(!u){if(u=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"),s=u&&u.indexOf("$PID$")>-1,n=u&&u.indexOf("$GUID$")>-1,t=l.has("pid")&&l.pid||null,e=l.has("cmsRefGuid")&&l.cmsRefGuid||null,a=!s&&!n,i=!t&&!e,a||i)return o="Config error: "+(a?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(s?"pid":"cmsRefGuid")),{error:!0,message:o};r=s?t:e,d=s?/\$PID\$/g:/\$GUID\$/g,u=u.replace(d,r),u=u.replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:u}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t,e,i,s,n,a,r,o,d=this.cviModel.contentVideoState,l=this.contentDataProxy,u=this.rco;this.populateContentVideoStateFromLocalStorage(),e=Date.now()-+d.resumeEpochTime,l.setProperty("resumePid",d.resumePid),l.setProperty("resumeEpochTime",+d.resumeEpochTime),l.setProperty("resumeSessionId",d.resumeSessionId),l.setProperty("resumeContentTime",+d.resumeContentTime),l.setProperty("playedChapterTime",+d.playedChapterTime),l.setProperty("showPreroll",d.showPreroll),l.setProperty("sendResumeEvent",!1),l.getProperty("episodeFlag")&&!0!==d.isLive&&(i=function(){var t=l.getProperty("duration");return!uvpjs.util.isEmpty(u.globalResumeTime)&&u.globalResumeTime>0&&t>0&&t-u.globalResumeTime>20}(),n=!i&&u.pid===d.resumePid,i||n?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),s=i?u.globalResumeTime:+d.resumeContentTime||0,t=i?0:e||0,o=!i&&e>this.ONE_HOUR_MS,r=i?this.cviModel.sessionId:"",a=this.getPlayedChapterTimeForContentResume(s),l.setProperty("sendResumeEvent",!0),l.setProperty("startTime",s),l.setProperty("elapsedTime",t),l.setProperty("showPreroll",o),l.setProperty("playedChapterTime",a),l.setProperty("previousSessionId",r),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(n?"local":"global")+"Resume"]},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e,i=0,s=this.contentDataProxy.getProperty("chapterStartTimes"),n=s.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",s),n)for(;n--;)if(e=s[n],t>=e){t-e>=4?i=e:(this.contentDataProxy.setProperty("startTime",t-4),n>0&&(i=s[n-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,i){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),!e.isFunction(t))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS);this.dataLoadedCB=t,this.dataLoadErrorCB=i,this.dataLoadedCB()}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){var s,n;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(s=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(s.eventType,{errorInfo:s},i)):(n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=n.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,n=this.imaScenario===this.PLATFORM,a=s||(n?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(a)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,a)):this.doFlashCheck(a))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(t){e.isString(t)&&!e.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),i=null!=t&&1==t.enabled,s=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),n=null;return i&&!e.isUndefined(s)&&(n=s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(n||"null")),n},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var t,e="",i=this.contentDataProxy,s=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(e="1"),s.length>0&&(t=s.indexOf(i.getProperty("playedChapterTime")))>=0&&(t+=2,e=e.length>0?e+","+String(t):String(t)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",e),e},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var e=t&&t.id,i=this.trueXInteractionIds;switch(e){case i.CLOSED_BEFORE_CREDIT:case i.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case i.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case i.OPT_OUT:case i.TIME_OUT:this.resetTrueXStatus();break;case i.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex,s=0===i?"pre":-1===i?"post":"mid_"+i;if(this.currAdPod=this.APM.getAdPodById(s),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var n=this.currAdPod;return n.adCount=e.totalAds,n.podDuration=e.maxDuration,n.isBumper=e.isBumper,n.imaPodIndex=e.podIndex,n.timeOffset=e.timeOffset,n.totalAds=e.totalAds,n.imaAdPostion=e.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(t,e){var i=t.getAdPodInfo(),s=e||{};return s.adPosition=i.getAdPosition(),s.isBumper=i.getIsBumper(),s.maxDuration=i.getMaxDuration(),s.podIndex=i.getPodIndex(),s.timeOffset=i.getTimeOffset(),s.totalAds=i.getTotalAds(),s},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var i,s=t.getAdData(),n=t.getAd(),a=google.ima.AdEvent.Type;if(t.type===a.INTERACTION)return void this.processInteractionEvent(s);if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case a.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",n),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(n))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(n));break;case a.STARTED:var r,o,d=n.getContentType();this.ad=n,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=n.getDuration(),this._populateAdVideoState(n,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==d&&"application/x-shockwave-flash"!==d||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===d&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(n),this.trackAdEvent(a.STARTED),r=n.getAdPodInfo(),r&&(o=r.getTotalAds()),this._dispatchAdStart(o),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case a.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case a.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case a.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case a.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case a.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||e.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case a.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),i=this.cviModel.getAdVideoState(),i.paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:i},this.vidContId);break;case a.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case a.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case a.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case a.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,i=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:i,adCallUrl:this.adCallUrl},this.vidContId),
uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case a.LOG:var l,u=s&&s.adError,h=(uvpjs.ErrorInfo,null===n);this.eventsMgr.eventTypes.AD_ERROR,!u&&h?(l=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof l&&l()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(u,n,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),h&&!u&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",a))}},_populateAdVideoState:function(t,i){var s,n;if(!e.isObject(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN"));if(n=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.IMA),i)for(s in i)n[s]=i[s];this.cviModel.setAdVideoState(n),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())},_requestAdsManager:function(t){var e=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=t,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(e.isAutoplay),i.setAdWillPlayMuted(e.isMuteAtPlayStart&&!e.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(t){var i,s,n,a=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,r=this.cviModel.contentPlaybackState.facadeState.currentBitrate,o=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),o.isEmpty(this.RPM)||o.isEmpty(this.RPM.currRP)||o.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var d=this.renderSettings;d.bitrate=r>0&&r/1e3||900,d.restoreCustomPlaybackStateOnAdBreakComplete=!1,d.enablePreloading=!1,d.loadVideoTimeout=this._returnIMATimeout(),i=this.adsManager=t.getAdsManager(a,d),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",i.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",i.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",i.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(s=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",s)),this.imaCuePoints=this.adsManager.getCuePoints(),e.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",s),this.APM.initialize(this.vidContId,s,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),n=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,n),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},startAds:function(){var t,e,i=null,s=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(n){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),e=uvpjs.ErrorInfo,t=e.messages.NO_AD_CONTENT,n&&"function"==typeof n.getMessage&&(t+=": "+n.getMessage(),i=n.getErrorCode(),s=n.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new e({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:e.errorCodes.IMA_AD_ERROR,message:t,imaErrorCode:i,imaVastErrorCode:s,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var t,i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),e.isEmpty(this.facade)||(i=this.cviModel.contentVideoState.isLive,t=this.imaUsesContentVideoTag(),!t&&this.facade.hideVideo(),i&&!t?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),t&&(this.savedSeekToTime=i?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!e.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),!e.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN"));if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),e.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!e.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&(e=this.cviModel.getAdVideoState(),e.skipped=!0===t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},i="function"==typeof t.getAd?t.getAd():{};return("function"==typeof i.getMediaUrl?i.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){var i,s,n;t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(i=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),s=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),i===this.containerWidth&&s===this.containerHeight||(this.containerWidth=i,this.containerHeight=s,this.adsManager&&(n=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,n))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var t=this.adsManager.getRemainingTime();this._checkForStuckAd(t),this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})}},_checkForStuckAd:function(t){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=t,!1;var e=this.previousRemainingTime-t;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+e),0===e?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var i="Ad playback stuck for "+this.stuckIntervals+" intervals.",s=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:i,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,i,s),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:s,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=t,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var s,n,a,r=null,o=null,d=null,l="Unknown",u=uvpjs.ErrorInfo,h=uvpjs.util,c=h.isFunction;t&&c(t.getMessage)&&(r=t.getMessage(),o=t.getErrorCode()||"n/a",d=t.getVastErrorCode()||"n/a",l=" imaErrorCode: "+o+"; vastErrorCode: "+d,r+=l),t&&c(t.getInnerError)&&(s=t.getInnerError())&&(!r&&(r=""),n=c(s.getMessage)?s.getMessage():s.message||"n/a",a=c(s.getErrorCode)?s.getErrorCode():"n/a",r+=" Inner error: "+n+"; inner error code: "+a),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+r),i&&(r=i+" "+r),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new u({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:u.errorCodes.IMA_AD_ERROR,message:u.messages.IMA_AD_ERROR_EVENT_RECEIVED+(r||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:o,imaVastErrorCode:d,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),e.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var t=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(t){var e;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null!==this.adsManager)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call"));this.dynamicMidRollPodCount++,e=uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=e,this._requestAdsManager(e)},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var i,s,n,a=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target!==this.vidContId||e.isEmpty(this.facade)||!this.canSeek(t&&t.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):e.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(t)):(i=t.payload.seekTime,this._seekFromTime=a,s=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,n=this.APM.returnPrecedingUnplayedAdPod(s),void(e.isEmpty(n)||n.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",n.startTime),this.savedSeekToTime=s,n.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=n.startTime)))},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&t.seekTime>=0&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){e.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&t.payload.vol>=0&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){e.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var t,e=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),t=this.onAdEvent,e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.addEventListener(i.LOADED,t),e.addEventListener(i.STARTED,t),e.addEventListener(i.FIRST_QUARTILE,t),e.addEventListener(i.MIDPOINT,t),e.addEventListener(i.THIRD_QUARTILE,t),e.addEventListener(i.COMPLETE,t),e.addEventListener(i.ALL_ADS_COMPLETED,t),e.addEventListener(i.CLICK,t),e.addEventListener(i.PAUSED,t),e.addEventListener(i.RESUMED,t),e.addEventListener(i.USER_CLOSE,t),e.addEventListener(i.SKIPPED,t),e.addEventListener(i.LOG,t),e.addEventListener(i.VOLUME_CHANGED,t),e.addEventListener(i.VOLUME_MUTED,t),e.addEventListener(i.INTERACTION,t)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=google.ima.AdEvent.Type;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t,e,i,s,n,a=uvpjs.util,r=this.cviModel.contentPlaybackState.facadeState.currentBitrate,o=!a.isEmpty(r)&&r>0,d=r/1e3!==this.renderSettings.bitrate,l=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,u=!a.isEmpty(this.adsManager),h=!a.isEmpty(this.facade);if(u&&o&&d&&(this.renderSettings.bitrate=r/1e3,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),l&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:h?(t=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=t):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return s=u&&l&&(this.cviModel.sessionOptions.adBlockerCallback||null),e=s&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),n=s&&(i=(new Date).getTime())&&(this.lastAdBlockCheckTime<i||e),n&&(this.lastAdBlockCheckTime=i+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&h&&this.checkId3Events(t),this.playbackState===this.mc.PLAYING){var c=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},_checkForCloseToMidrollPod:function(t){var e,i,s,n=this.APM.getMidRollPods();if(t<=0)return!1;for(e=n.length;e--;)if(s=n[e],(i=s.startTime-t)>0&&i<1&&!s.hasPlayed&&!s.hasBeenChecked)return s.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=uvpjs.util,i=this._getAssetUrl(t),s=e.isDefinedString(t.pid),n=e.isDefinedString(t.cmsRefGuid),a=e.isDefinedString(t.selectorCall),r=e.isDefinedString(t.assetURL);return s||n&&!r||a?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),i=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&this.duration>5&&i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),i=e&&e.enabled,s=i&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return s&&(t=parseInt(s),t=t>0?1e3*t:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i=(t._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),s=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];t.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,i,s){var n=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+s),a=n.getElementsByTagName("video")[0];!e&&(e=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new e.StreamManager(a),this.adClickElement=this.createAdClickElement(a),this.streamManager.setClickElement(this.adClickElement),this._super(t,i,s),this.resetAdStates(),this.contentVideoDiv=n,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(t)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,s=this.cviModel,n=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(n),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),!(e=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.requestStream(e)},requestStream:function(t){
var i=this.cviModel.contentVideoState.isLive,s=i?e.LiveStreamRequest:e.VODStreamRequest,n=new s,a=t||testRsrcDef;n.apiKey=a.apiKey||null,n.adTagParameters=a.adTagParameters,i?(n.assetKey=a.assetKey,n.attemptPreroll=!0,this.id3HandlingEnabled=!0):(n.contentSourceId=a.contentSourceId,n.videoId=a.videoId),this.streamManager.requestStream(n)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){var e=t.getStreamData().url;if(!uvpjs.util.isDefinedString(e))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null},hCuePointsChanged:function(t){this.currAdPod=this.getNewPod(t.getStreamData().cuepoints)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.currAdPod?(this.trackAdEvent(t.type),this.dispatchAdPodStart()):this.dispatchError(this.eventsMgr.eventTypes.AD_ERROR,uvpjs.ErrorInfo.messages.DAI_ADPOD_ERROR,uvpjs.ErrorInfo.errorCodes.DAI_AD_ERROR)),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var i,s,n,a=t.type,r=e.StreamEvent.Type,o=null;switch(a){case r.FIRST_QUARTILE:o=25;break;case r.MIDPOINT:o=50;break;case r.THIRD_QUARTILE:o=75;break;case r.AD_PROGRESS:i=t.getStreamData(),s=i&&i.adProgressData,(n=s&&this.createAdProgressPayload(s))&&this.dispatchVideoProgress(n)}o&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=o,this.dispatchAdQuartile(o))},hStreamError:function(t){var e=t.getStreamData(),i=e&&e.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+i,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,i||"Uknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,a=this._hasFacade(),r=n.getDuration(),o=this.facade.getCurrentTime();if("number"==typeof s&&e===this.vidContId){if((s=this.streamManager.streamTimeForContentTime(s))<0||s>r)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||o,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&n.seekTo(s)}},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e,i,s=null,n=t&&t.length;for(n&&!this.adPods&&this.createAdPods(t);n--;)e=t[n],i=this.adPods["t_"+e.start],s||i.hasPlayed===e.played||(s=i),i.hasPlayed=e.played;return s},createAdPods:function(t){var e,i,s,n,a=0,r=[],o=t.length;for(this.adPods={},i=0;i<o;i++)e=t[i],s=function(t){return t===o-1?"post":0===t?"pre":"mid"}(i),n=e.start,r.push(n),this.adPods["t_"+n]={startTime:n,hasPlayed:!1,adPodId:s+("mid"===s?"_"+a++:"_0"),adCount:0,podDuration:e.end-n};this.cviModel.contentVideoState.chapterStartTimes=r},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){var e=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.DAI);this.cviModel.setAdVideoState(e)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=e.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t,e,i;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(e=this.facade.getCurrentTime(),this.checkForAdBlocker(e,!1),t=this.streamManager.contentTimeForStreamTime(e),!this.contentStartOpen&&t>0&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(t),i=this.createVideoProgressPayload(t,e),this.dispatchVideoProgress(i))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,s=e||i,n=s&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return s&&(this.lastAdBlockCheckTime=t),n&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!n},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId();return t&&e&&i?{adTagParameters:t,videoId:e,contentSourceId:i}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var n,a="add"===t?"addEventListener":"removeEventListener",r="addEventListener"===a,o=e.StreamEvent.Type,d=i.length,l=[];d--;)n=o[i[d]],l.push(n),r&&(this.hMap[n]=s[d]);this.streamManager[a](l,this.hStreamEvent,!1)},createAdClickElement:function(t){var e,i,s,n,a=t.nextSibling;if(a&&"uvpjsDaiContainer"===a.getAttribute("data-role"))return a;e=document.createElement("div"),e.setAttribute("data-role","uvpjsDaiContainer"),i={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},n=e.style;for(s in i)n[s]=i[s];return t.insertAdjacentElement("afterend",e),e},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),a=this.cviModel.isMuted;e===this.vidContId&&n&&!a&&this._hasFacade()&&(this.facade.setVolume(s),this.isAdPlaying()&&this.trackAdEvent(t.type))},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},facadeId3Data:function(t){var e,i,s;for(e=t.length,s=0;s<e;s++)i=t[s],this.streamManager.processMetadata("ID3",i.data,i.pts)},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){var s=i||"log";uvpjs[s](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var e={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e,i=this.rco,s=this.cviModel;if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),s.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),s.setContentVideoStateItems(i),s.mergeCDOData(),this.killDataProxy(),this.contentDuration=s.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),!(e=this.assembleAssetUrl(i)))return void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=e,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(i.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()},assembleAssetUrl:function(t){var e,i,s=t.assetURL,n=uvpjs.util;return n.isEmpty(s)?null:s.indexOf("?")>-1?s:(i=t.getAdTagParameters(),e=i?n.queryStrFromObj(i):null,n.isEmpty(e)?s:s+"?"+e)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){var e=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:e})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return t>0&&this.contentDuration>0?t-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var t,e,i=this.getVideoProgressPayload(),s=this.facade.getCurrentTime(),n=this.getPrerollAdDuration(),a=Math.floor(s/n*100);switch(a){case 25:t=this.quartiles[25],e=25;break;case 50:t=this.quartiles[50],e=50;break;case 75:t=this.quartiles[75],e=75}return e&&!t&&this.dispatchAdQuartile(e),e&&(this.quartiles[String(e)]=1),i.isAd=!0,i.duration=n,i.currentTime=s,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(s),i.lastPercentageCompleted=a,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var t,e=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,i=this.isAdPlaying(),s=this.contentStartOpen,n=e&&this.facade.getCurrentTime();e&&(t=i?this.createAdProgressPayload():s?this.createVideoProgressPayload():null,n>1&&!s&&!i&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+n),this.contentStartTime=n,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(n),t&&this.dispatchVideoProgress(t))},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,a=this._hasFacade(),r=a&&(this.absoluteDuration||n.getDuration()),o=this.getPrerollAdDuration(),d=this.facade.getCurrentTime();if("number"==typeof s&&e===this.vidContId&&r){if((s+=o>0?o:0)<0||s>r)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s));this._seekFromTime=this._seekFromTime||d,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),a&&n.seekTo(s)}},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){!this.absoluteDuration&&(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){this.vidEl.textTracks.removeEventListener("addtrack",this.hAddTextTrack,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange.bind(this),!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var i,s,n=t.value;"TXXX"===n.key&&(i=""!==n.info?n.info:n.data,(s=e[i])&&this[s](t.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(t,e,i){var s=i||"log";uvpjs[s](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.P2pClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){if(e)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),void t(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.MultiCdnClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(t){var e;this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),e=new uvpjs.CodeLoader,e.loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(t){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(t.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(t){t()}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions,i=e.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,i),t.requiredParams):i?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,s){var n=this.getClientObject(t,e);n||i(!0),n.loadScripts(i,s)},validateScriptLoad:function(t,e){var i=this.getClientObject(t,e);return i&&i.validateScriptLoad()||!1},createClient:function(t,e){return new t(e)},getClientOptions:function(t){var e,i,s,n,a,r,o,d,l,u=this.model,h=this.getSupportedClients(t),c={canUse:!1,clientName:null};if(t===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return c;for(e in h)if(i=e,s=h[i],(d=s&&s.uvpcModuleName)&&u.isModuleEnabled(d)){for(n=s.requiredParams,a=n&&n.length||0,o={},l=!0;a--;){if(r=u.getModuleParam(d,n[a]),uvpjs.util.isEmpty(r)){l=!1;break}o[n[a]]=r}return{canUse:l,clientName:i,requiredParams:o}}return c},getSupportedClients:function(t){var e,i,s={},n=t.clientMap;if(!n)return s;for(e in n)i=n[e],s[e]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return s},getClientObject:function(t,e){return t.clientMap[e]||null}});var e=t.VideoDeliveryPluginService;e.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},e.load=function(t,e,i){(new uvpjs.CodeLoader).loadScript(t,e,i)}}(uvpjs.register("uvpjs")),function(t){t.FullscreenManager=uvpjs.Class.subClass({init:function(t){var e=uvpjs.util,i=t||{},s=uvpjs.mediaCapabilities;if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,!i.videoElement||!i.container)return void uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.");this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=e.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=e.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=s.getEnterFullscreenMethodName(),this.exitMethod=s.getExitFullscreenMethodName(),this.fsElementName=s.getFullScreenElementName(),this.isFullscreenProperty=s.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t,e,i,s,n=uvpjs.mediaCapabilities;if(this.hasFsApiSupport=n.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(s=n.getFullscreenEventName(),t=n.isFirefox()||n.isIE()?document:this.container,t.addEventListener(s,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,e=n.getFullscreenEnterEventName(),i=n.getFullscreenExitEventName(),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement.addEventListener(i,this.hFullScreenEvent,!1),this.enterEvt=e,this.exitEvt=i),this.validateEntryAndExitMethods(),!this.hasValidEntryMethod)return void(this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo()));this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener("loadedmetadata",this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())}}),t.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,s,n,a=t._;t.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{
name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){var t=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=uvpjs.util,i=uvpjs.Configuration.path,s=this._containerId,n=t.customCSS;this._namespace="."+s+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._controls=t.controls,this._template=t.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(t){this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),a.includes(this._disabledButtons,t)||this._disabledButtons.push(t),this._disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),a.pull(this._disabledButtons,t),this._enableButton(t)},_handleFullscreenMgrReady:function(t){t&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",t),a.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),!this._isIOS&&t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t&&t instanceof uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),!this._isIOS&&t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],a=n.length;a--;)"_onClosedCaptionBtnClick"===n[a]&&this._isIOS||(this[n[a]]=this[n[a]].bind(this));var r=this._onUVPJSGestureEvent,o=this._hNonTap,d=this._onProgressSliderEvent,l=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",r,!0),e.addEventListener("mouseleave",r,!0),e.addEventListener("mousemove",r,!0),e.addEventListener("mousedown",r,!1),e.addEventListener("mouseup",r,!1),e.addEventListener("click",r,!1),e.addEventListener("touchstart",r,!0),e.addEventListener("touchend",r,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,d,!1),this._progressSlider.addEventListener("mousedown",d,!1),this._progressSlider.addEventListener("mouseup",d,!1),this._progressSlider.addEventListener("touchstart",d,!0),this._progressSlider.addEventListener("touchend",d,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,l,!1),this._volumeSlider.addEventListener("mouseover",l,!1),this._volumeSlider.addEventListener("mouseout",l,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),!s&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),!s&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),!s&&this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),!s&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),!s&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,a=this._onVolumeSliderEvent,r=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",s,!0),e.removeEventListener("mouseleave",s,!0),e.removeEventListener("mousemove",s,!0),e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",s,!1),e.removeEventListener("click",s,!1),e.removeEventListener("touchstart",s,!0),e.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,a,!1),this._volumeSlider.removeEventListener("mouseover",a,!1),this._volumeSlider.removeEventListener("mouseout",a,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",r,!1),this._volumeBtn.removeEventListener("mouseover",r,!1),this._volumeBtn.removeEventListener("mouseout",r,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var t=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(t,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t=!0;for(var e in this._controlList)this._checkControlOnDOM(this._controlList[e])||(t=!1);return t},_waitForControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls."),setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void t.call(this):void this._waitForControls(t)}.bind(this),50)},_clearMouseMoveInterval:function(t){var e=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[e]&&(clearInterval(this._intervals[e]),this._intervals[e]=-1)},_clearIntervals:function(){var t,e=this._intervals;for(t in e)-1!==e[t]&&(clearInterval(e[t]),e[t]=-1)},_setupDom:function(){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),e(this._containerEl,this.PRIMARY_BLOCK),e(this._contentEl,this._getClassName(t.CONTENT)),e(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&e(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t)},_generateSettingsMenu:function(t,e){function i(t){var e=t.value,i=t.property,s=i&&f[i];return!((s&&s.toLowerCase())!==(e&&e.toLowerCase()))}function s(t,e){var s={};if(!1!==t.enabled)return void 0===t.value?(s.el="SETTINGS_MENU_ITEM",s.type="button",s.label=t.label,s.target=e):(s.el="SETTINGS_MENU_INPUT",s.type="menu",s.label=t.label||t.value,s.value=t.value,s.property=e&&a.last(e.split(":")),s.selected=i(s)),s}var n,r,o,d,l,u,h,c,p,v=this._queryByElementName(this.css.SETTINGS_MENU),g=this._getClassName(this.css.SETTINGS_MENU_ITEM),f=a.assign({},this._menuSelections,this._getCaptionsStyle()),_=document.createRange(),E=uvpjs.util,A=[],m=this.shouldTrapTaps();for(p=t&&t.length,c=0;c<p;c++)u=t[c],l=u.name,d=e,l&&(d=E.isDefinedString(e)&&[e,l].join(":")||l),A.push(s(u,d));for(e&&(o=this._findMenuItem(e),d=e.split(":").slice(0,-1).join(":"),h=s(o,d),h.cls=g+"--back",A.unshift(h)),_.selectNodeContents(v),_.deleteContents(),v.insertAdjacentHTML("beforeend",this._templateToHTML(A)),n=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),r=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),c=n&&n.length;c--;)!m&&n[c].addEventListener("click",this._onSettingsMenuBtnClick);for(c=r&&r.length;c--;)!m&&r[c].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var t,e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(t=e&&e.length;t--;)e[t].removeEventListener("click",this._onSettingsMenuBtnClick);for(t=i&&i.length;t--;)i[t].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var e={items:this.settingsMenu};if(a.isEmpty(t))return e;var i=this,s=t.split(":");return a(s).each(function(t){i.debug&&uvpjs.log(i.DEBUG_ID,"_findMenuItem key",t),e=a.find(e.items,function(e){return e.name===t})}),e},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(e);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=uvpjs.util,e=this.css,i=e.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME),e={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(e).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId===t.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed||this._disable(e.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._isIOS&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=t.payload,s=0===i.playlistLength;this._containerId===e&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&s?this._setupReplay():this._captionsLoaded=!1,this._resetProgressSlider())},_onVideoProgress:function(t){var e,i,s=t.payload,n=s.playbackState,a=this.vci.getVolume(),r=this.css.TIME_DURATION,o=this.css.TIME_CURRENT,d=!1;this._containerId===t.target&&(a!==Number(this._volumeSlider.value)&&this._updateVolumeUI(a),n!==this._playbackState&&(this._playbackState=n,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(s),n!==this.mc.PLAYING||this._isSliding||s.duration!==1/0&&(e=this._queryByElementName(r),i=this._queryByElementName(o),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&s.duration>=3600&&(this.durationChecked=d=!0):(this.durationChecked=!0,s.duration>=3600&&(d=!0)),d&&(i.parentNode.style.width="100px"),e.innerHTML=this._formatTimestampByType(r,s.duration),i.innerHTML=this._formatTimestampByType(o,s.currentTime),this._updateProgressUI(s)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(t){a.has(t,"target")&&this._containerId===t.target&&a.isObject(t)&&a.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),a.isObject(t)&&this._containerId===t.target&&a.isObject(t.payload)&&a.isNumber(parseInt(t.payload.newState))&&(!this.ignoreVideoStateChange||e===this.mc.PAUSED||e===this.mc.PLAYING)){var e=t.payload.newState;e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=t,t?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){var e=t.target;return{isVolumeButton:-1!==e.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==e.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEvent:function(t){switch(t.type){case"click":case"touchend":this._onVolumeBtnClick(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._showControlBar(t))},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e,i=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(this._touchStartTime=t.timeStamp,!this._previewCallbackDone)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet."));if(!this._hasDisabled(this.css.CONTROLS)&&i!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider)){var s=t.target.getBoundingClientRect(),n=(t.pageX||t.targetTouches[0].pageX)-s.left;e=1-(t.target.clientWidth-n)/t.target.clientWidth,this._onProgressSliderChange(t,e)}},_onUVPJSTouchEnd:function(t){function e(){this._hasPaused()||(i=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}var i,s,n,a,r=this.css,o=this._isTap(t.timeStamp),d=[r.CLOSED_CAPTION_BTN,r.VOLUME_BTN,r.PLAYSTATE_BTN,r.SETTINGS_BTN,r.SETTINGS_MENU,r.SETTINGS_MENU_ITEM,r.SETTINGS_MENU_INPUT,r.LARGE_PLAY_BTN,r.FULLSCREEN_BTN],l=d.length,u=t.target.className;if(t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(!this._hasDisabled(r.CONTROLS)){for(;l--&&!(s=s||u.indexOf(d[l])>-1););if(this.shouldTrapTaps()&&s&&l<d.length-1)return t.stopPropagation(),t.preventDefault(),void this.handleTap(d[l],t);n=!(s||this._isTouchActive&&o),n&&t.preventDefault(),n&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),a=i||n?this.HIDE_DELAY:0,i&&clearTimeout(i),i=setTimeout(e.bind(this),a)}},handleTap:function(t,e){var i=this.css;if(!this._queryByElementName(t).hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(t){t.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci,i=e.getPlayerMuted()
;this._hasDisabled(this.css.VOLUME_BTN)||(i?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var e=parseFloat(t.target.value),i=this.vci.getPlayerMuted();i&&e>0&&this.vci.unMute(),this.vci.setVolume(e),this._updateVolumeUI(e,i)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive())return void(this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()));var e=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",e),e===this.mc.PAUSED||e===this.mc.EMPTY||e===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();e!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())},_onPreviewBtn:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(t.timeStamp))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback."));t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();var e=this.css.CLOSED_CAPTION_BTN;if(this._hasActive(e))return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var e=this.css.SETTINGS_MENU,i=this._hasHidden(e);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i)return this._addModifier(e,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(e);this._removeModifier(e,this.ACTIVE_MODIFIER),this._hide(e)},_onSettingsMenuBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e);var i=this._findMenuItem(e);this._generateSettingsMenu(i.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target,i=e.parentNode,s=i.getAttribute("data-target");switch(s&&s.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var e=t.target,i=e.parentNode,s=e.getAttribute("data-property"),n=e.getAttribute("data-value").toLowerCase();if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",s,n),a(i.children).each(function(t){t.setAttribute("data-selected","false")}.bind(this)),e.setAttribute("data-selected","true"),"text-position"===s)return void this._setCCPosition(n);this.vci.setCaptionsStyleProperty(s,n)},_onSettingsControlsChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value").toLowerCase(),n="#"+this._containerId+" ";if("background-opacity"===i){i="background-color";var a=this._queryByElementName(this.css.CONTROL_BAR),r=getComputedStyle(a).getPropertyValue(i);if(-1===r.indexOf("rgba"))return;s=r.split(",").slice(0,-1).join(",")+", "+s+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",s),n+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(n,i,s)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value"),n="true"===e.getAttribute("data-selected"),a=!n;this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=s,e.setAttribute("data-selected",a),a?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(a.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=a.debounce(function(){if(this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch)return void this._hideControlBar.hide.cancel();this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS)},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e=this.css;this._hasDisabled(e.VOLUME_BTN)||this._hasDisabled(e.CONTROLS)||(this._hasActive(e.SETTINGS_MENU)&&this._hide(e.SETTINGS_MENU),this._setDataAttribute(this._containerEl,e.VOLUME_SLIDER,!0),this._addModifier(e.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(e.VOLUME_SLIDER))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._hasModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER)&&this.vci.showCaptions())},_disableCaptions:function(){this._isIOS||(this._disableButton(this.css.SETTINGS_BTN),this._disableButton(this.css.CLOSED_CAPTION_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),a.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i,s=uvpjs.util,n=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":t>.85?i="full":s.inRange(t,.5,.85)?i="high":s.inRange(t,.15,.5)?i="medium":s.inRange(t,0,.15)&&(i="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(n,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i,s,n=this.vci.getContentVideoData(),a=this.vci.getCurrentPlaybackState(),r=this.css.TIME_CURRENT,o=this._queryByElementName(r),d=e||this._progressSlider.value;d=d>1?1:d<0?0:d,i=Math.ceil(d*n.duration*1e4)/1e4,s=Math.abs((a.currentTime-i)/i),this._updateProgressSlider(d),o.innerHTML=this._formatTimestampByType(r,i),this._hasActive(this.css.PROGRESS_SLIDER)||s<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(t){var e=this.css;if(this._hasAd()||this._hasDisabled(e.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(t){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(t){var e,i;this._isLive()||(e=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,a.isNaN(e)||e===1/0||e<=0||(this._downloaded=e,this._hasAd()||(i=this._queryByElementName(this.css.PROGRESS_LOADED),i.value=this._downloaded)))},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){var e=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(e)},_updateSliderUI:function(t,e,i){var s=this,n={};if(!a.isUndefined(this._vendorPrefix)&&!a.isUndefined(t)){if(n.id="#"+this._containerId,n.cls=s._getClass(e),n.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[s._vendorPrefix],this._isMSEdge&&(n.pseudo=""),n.add=function(t,e,i){if(!a.isUndefined(this.pseudo)){var n=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo;s._addCSSRule(n,"background-size",100*t+"% 100%")}},n.before=function(t,e){var i=s._getClass(s.PRIMARY_BLOCK);e&&(i+=s._getClass(s.PRIMARY_BLOCK,e)),this.add(t,i,null)},n.after=function(t,e){this.add(t,null,e)},e===s.css.VOLUME_SLIDER)return void n.add(i);var r=i*t.offsetWidth,o=(.5-i)*t.offsetHeight,d=r/t.offsetWidth,l=(r+o)/t.offsetWidth;t.value=i;var u=s._hasAd();n.before(d,u?s.AD_MODIFIER:null),u||n.after(l,":hover"),this._isTouch&&n.before(l,s.TOUCH_MODIFIER)}},_checkControlOnDOM:function(t){var e=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[e]},_getClassName:function(t,e){var i=this.PRIMARY_BLOCK;return t!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+t),e&&(i+=this.ELEMENT_MODIFIER_DELIMITER+e),i},_getClass:function(t,e){return this.CLASS_SELECTOR_PREFIX+this._getClassName(t,e)},_queryByClassName:function(t){var e,i;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),i=this._controlCache[e]||document.querySelector(e),i&&(this._controlCache[e]=i),i},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementName:function(t){return this._queryAllByClassName(this._getClassName(t))},_show:function(t){if(t===this.css.PROGRESS&&!this._isLive()){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")}this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){if(t===this.css.PROGRESS){var e=this._queryByElementName(t),i=e.querySelector("input"),s=e.querySelector("progress");e&&(e.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")}this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disable:function(t){this._addModifier(t,this.DISABLED_MODIFIER)},_enableMenuItem:function(t){var e;t&&(e=this._findMenuItem(t))&&(e.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(t){return this._hasModifier(t,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreaming:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.STREAMING},_hasModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,e),n=this._queryByElementName(t);return!!n&&i(n,s)},_addModifier:function(t,i){a.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var s=this._getClassName(t,i),n=this._queryByElementName(t);n&&e(n,s)},_removeModifier:function(t,e){var i,n=this._queryByElementName(t);a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),i=this._getClassName(t,e),n&&s(n,i)},_toggleModifier:function(t,e){a.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));var i=this._getClassName(t,e),s=this._queryByElementName(t);s&&n(s,i)},_setDataAttribute:function(t,e,i){t.setAttribute("data-"+e,i)},_removeDataAttribute:function(t,e){t.removeAttribute("data-"+e)},_formatTimestamp:function(t){var e,i;return uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(isNaN(t)&&(t=0),e=new Date(null),e.setSeconds(Math.round(t)),i=e.toISOString(),t>=3600?i.substr(11,8):i.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var s=this._styleEl.sheet,n=s.cssRules.length,r=this._cssRules[t];if(!a.isUndefined(r)){var o=s.rules||s.cssRules;if(o.length>0&&o[r])return void(o[r].style[e]=i)}this._cssRules[t]=n,uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(t){var e=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(i){this._styleEl=i,e||"function"!=typeof t||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),e=!0,t())}.bind(this))},_templateToHTML:function(t){function e(t){var r="";return a(t).each(function(t){t&&("CLOSED_CAPTION_BTN"!==t.el&&"SETTINGS_BTN"!==t.el||!n)&&(t.cls=a.isUndefined(t.cls)?i(t.el):[t.cls,i(t.el)].join(" "),t.children&&(t.children=e(t.children)),r+=a.template(s[t.type],{variable:"o"})(t))}),r}if(a.isArray(t)&&!a.isEmpty(t)){var i=function(t){return this._getClassName(this.css[t]||t)}.bind(this),s=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},n=this._isIOS;return e(t)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}),i=function(t,e){return!a.isNull(t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))},e=function(t,e){i(t,e)||(t.className=(t.className+=" "+e).trim())},s=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},n=function(t,n){if(i(t,n))return void s(t,n);e(t,n)}}(uvpjs.register("uvpjs")),function(t){var e=t._;t.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,i,s,n){if(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",s)),!e.isArray(i))return void(this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN"));this.vidContId=t,this._generateAdPods(i,s,n)},_generateAdPods:function(t,e,i){var s,n,a,r=e.length,o=function(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},r>0&&(e.indexOf(0)>-1&&(this.adPods[this.PRE]=o(this.PRE+"_0",i)),e.indexOf(-1)>-1&&(this.adPods[this.POST]=o(this.POST+"_0",i))),s=0;s<r;s++)n=0===e[0]?s:s+1,a=e[s],isNaN(a)||0===a||-1===a||(this.adPods[this.MID_+n]=o(this.MID_+n,i,a));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),e.isString(t)){var i=this.adPods[t];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t,e=[];if(!this.midRollPods){e=[];for(t in this.adPods)t.indexOf(this.MID)>=0&&e.push(this.adPods[t]);this.midRollPods=e}return this.midRollPods},isPreRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.MID)>-1},isPostRoll:function(t){return!e.isUndefined(t.adPodId)&&t.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var t in this.adPods)if(t.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(t){var e,i,s,n=null,a="No eligible ad pod found.";for(s in this.adPods)this.adPods.hasOwnProperty(s)&&(e=this.adPods[s],this.isPreRoll(e)||this.isPostRoll(e)||e.startTime<=t&&(n?t-e.startTime<t-n.startTime&&(n=e):n=e));return n&&(i=n.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",a="Found Ad pod; adPodId = "+n.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+a),n}})}(uvpjs.register("uvpjs")),function(t){var e,s=t._;t.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",SEGMENT_MODULE_NAME:"Segment",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t,e=this.agents.length;e--;)this.agents[e]&&"function"==typeof this.agents[e].destroy&&this.agents[e].destroy(),this.agents.splice(e,1);for(t in this.eventCBs)this.eventsMgr.removeEventListener(t+this.internalNS+".agent"),delete this.eventsMgr[t];for(t in this.progressEvents)delete this.progressEvents[t];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),s.isString(t)&&s.isObject(e)&&(this.vidContId=t,this.eventsMgr=e.getEventsMgr(),this.cviModel=e.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._createAgentsArray(),this._addTrackingEventListeners(),this._initializeAgents())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,s=t.length;s-- >0;){var n=t[s];if(n.name===e){i=n;break}}return i},doTrackingConfigOverrides:function(t){if(!this.hasTrackingConfigOverrides(t))return void(this.agentConfigs=t.getModules().slice(0));for(var e=t.getModules().slice(0),i=e.length;i-- >0;){var s=e[i],n=this.getAgentConfig(t.trackingConfigOverrides,s.name);null!==n&&(e[i]=n)}this.agentConfigs=e},isTrackingAgentEnabled:function(t){var e,i=this.getAgentConfig(this.agentConfigs,t),s=this.mc.systemInfo.trackingAvailability,n=!1;for(e in uvpjs.tracking)if(uvpjs.tracking[e]===t&&s[e]){n=!0;break}return this.debug&&i&&i.enabled&&!n&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,s),null!==i&&i.enabled&&n},_createAgentsArray:function(t){var e,i,s,n,a,r,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=t||this.cviModel,this.doTrackingConfigOverrides(i),this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),n=i.isModuleEnabled.bind(i),a=i.isModuleSet.bind(i),s={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr},o=this.getPlayerName(),this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),s.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,s.playerName=o,e=new uvpjs.AdobeHeartbeatAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),s.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new uvpjs.AkamaiAnalyticsAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),s.moduleName=this.COMSCORE_SS_MODULE_NAME,s.playerName=this.getPlayerName("|","_"),e=new uvpjs.ComScoreAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),s.moduleName=this.CONVIVA_MODULE_NAME,s.playerName=o,e=new uvpjs.ConvivaAgent(s),this.agents.push(e)),r=n(this.DW_MODULE_NAME),(r||n(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),s.moduleName=r?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,s.playerName=this.getPlayerName(";"),e=new uvpjs.DWAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),s.moduleName=this.NIELSEN_MODULE_NAME,s.playerName=o,e=new uvpjs.NielsenAgent(s),this.agents.push(e)),a(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var d=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);s.moduleName=this.MUX_MODULE_NAME,s.playerName=this.PLAYER_NAME_ONLY,s.playerVersion=this.PLAYER_VERSION_ONLY,s.useDefaultProperty=!d("propertyKey"),e=new uvpjs.MuxAgent(s),this.agents.push(e)}var l=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(l&&l.params&&l.params.length>0)for(var u=l.params.length;u-- >0;)this.beaconEndPoint[l.params[u].name]=l.params[u].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(s.moduleName=this.OZTAM_MODULE_NAME,s.playerName=o,s.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.OzTamAgent(s),this.agents.push(e)),this.isTrackingAgentEnabled(this.SEGMENT_MODULE_NAME)&&(s.moduleName=this.SEGMENT_MODULE_NAME,s.playerName=o,s.playerVersion=this.PLAYER_VERSION_ONLY,e=new uvpjs.SegmentAgent(s),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),s.isEmpty(this.agents))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."));for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()},fireTrackingPixel:function(t){var e=document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(s.isPlainObject(t)&&!s.isEmpty(t))for(var e in t)this.eventCBs[e]=this.eventCBs[e]||[],this.eventCBs[e].push(t[e])},registerProgressEvents:function(t){if(s.isPlainObject(t)&&!s.isEmpty(t))for(var e in t)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",e),this.progressEvents[e]=this.progressEvents[e]||[],this.progressEvents[e].push(t[e])},getContentPlayhead:function(){var t=this.cviModel.contentPlaybackState.currentTime;return parseInt(t)},getPlayerName:function(t,e){var i=this.PLAYER_NAME;return s.isEmpty(i)?"UVPJS":(t&&(i=i.replace("_",t)),e&&(i=i.replace(/\./g,e)),i)},getAdLength:function(){return this._adLength=e(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=e(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var e,i=this.eventCBs[t.type];if(!s.isEmpty(i)){e=i.length;for(var n=0;n<e;n++)i[n](t)}}},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var e,n=this.progressEvents[t];if(!s.isEmpty(n))for(e=n.length,i=0;i<e;i++)n[i]()},_onPlaybackDurationResume:function(e){var i=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),s=this.cviModel.getContentVideoState(),n={ts:Math.floor(Date.now()/1e3),contentid:s.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:i("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:s.isPaidContent,affiliate:s.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},a=(new t.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(n).devMode(this.debug).buildUrl();this.fireTrackingPixel(a)},_onVideoProgress:function(t){var e,i=t.payload,n=Math.floor(i.currentTime),a=i.duration;if(n&&a&&!i.isAd&&!(this._lastContentSecondCompleted>=n)){if(this._lastContentSecondCompleted=n,n%15==0&&n<=60||n%60==0){if(this._contentTimeFired[n])return;this._contentTimeFired[n]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",n),this._onProgressEvent(this.progressEvents.TIMED)}i.isPlayingLive||a<=10||(e=Math.floor(n/a*100),e!==this.percentDone&&(this.percentDone=e),s.inRange(e,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),s.inRange(e,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),e>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,
this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),e=function(t,e){var i=e>0?Math.floor(1e3*e):0;return uvpjs.util.inRange(t,i-1e3,i+1e3)?t:i}}(uvpjs.register("uvpjs")),function(t){"use strict";var e,i,s,n,a,r;r=t._,t.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata={},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),r.isUndefined(this._visitorData.marketingCloudOrgId))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."));this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){var i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),!r.isFunction(t))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"));i=e?e.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=i.usesTealium;var s=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),s=r.without(s,this.scriptPaths.APP_MEASUREMENT)),n()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(s,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return e.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this.mc.isSecure()&&(r.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),r.isString(e)&&(e=e.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var t=this.cviModel.sessionOptions;this._usesTealium=t.usesTealium;var e={ftag:"ftag",netwk:"Network"};r.each(e,function(e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",e,i);var s=t[i];r.isNull(s)||r.isUndefined(s)||r.isEmpty(s)||(this._sessionMetadata[e]=s)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function t(t){this._agent=t}var o,d,l,u;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),n())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded."));if(this._mediaHeartbeat)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used."));if(e=ADB.va.MediaHeartbeat,i=ADB.va.MediaHeartbeatConfig,s=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!a(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)d=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(o=this._appMeasurementData.account,r.isString(o)&&r.isEmpty(o))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));u=new Visitor(this._visitorData.marketingCloudOrgId),u.trackingServer=this._visitorData.trackingServer,u.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),d=new AppMeasurement(o),d.visitor=u,d.account=o,d.trackingServer=this._appMeasurementData.trackingServer,d.pageName=this._appMeasurementData.pageName,d.charSet=this._appMeasurementData.charSet,d.visitorID=this._appMeasurementData.visitorID}if(r.isNull(d))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."));l=new i,l.trackingServer=this._heartbeatData.trackingServer,l.playerName=this._playerName,l.channel=this._heartbeatData.channel,l.debugLogging=this._heartbeatDebug,l.appVersion=this.SDK_VERSION,l.ssl=this.mc.isSecure(),l.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",l),r.extend(t.prototype,s.prototype),t.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},t.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new e(new t(this),l,d),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),a(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),r.has(window,"s")&&a(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,i){if(r.isNull(this._mediaHeartbeat))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined"));switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(e.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(e.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(e.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(e.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(e.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(e.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(e.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(i)}},_getContentVideoMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=this._contextMetadata,n=this._sessionMetadata,a={};for(t in s)s.hasOwnProperty(t)&&(a[t]=s[t]);for(t in n)n.hasOwnProperty(t)&&(a[t]=n[t]);if(i.contextMetadata){e=i.contextMetadata;for(t in e)e.hasOwnProperty(t)&&(a[t]=e[t])}return a.tl=i.videoTitle,a.mediaAutoPlay=this.cviModel.isAutoplay.toString(),a.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),a.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",a),a},_onContextMetadata:function(t){var e,i=t.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),!r.isEmpty(i)&&(this._contextMetadata=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),r.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),e=i[this.PAGE_SITE_ACCOUNT_KEY],!r.isEmpty(e))){var s=r.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=e,s&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+e),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var i,s,n,a,r,o=t.chapterStartTimes,d=o&&o.length||0,l=parseInt(t.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),isNaN(l)&&(l=1),i=l<0?0:l-1,s=i<=0?0:o[i],n=i+1>d?t.duration:o[i+1],r=n-s,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",n,s),a={},a.name="",a.length=isNaN(r)?0:r,a.position=l,a.startTime=o[i],this._chapterObject=e.createChapterObject(a.name,a.position,a.length,a.startTime),this._chapterInfo=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var i,s,n,a,o,d;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),d=t.payload.adData,o=d.adClipID.split("_"),a=o[0],"pre"===a?n=1:"mid"===a?n=parseInt(o[1])+1:"post"===a&&(n=this.cviModel.getNumberOfAdPods()),s={},s.name=r.isEmpty(d.adVideoTitle)?"na":d.adVideoTitle,s.position=n,s.playerName=this._playerName,s.startTime=this.getCurrentPlaybackTime(),i={},i.id=r.isEmpty(d.adVideoId)?r.isEmpty(d.adVatId)?"na":d.adVatId:d.adVideoId,i.name=s.name,i.length=d.duration,i.position=d.adPosition,this._adObject=e.createAdObject(i.name,i.id,i.position,i.length),this._adBreakObject=e.createAdBreakObject(s.name,s.position,s.startTime),this._adInfo=i,this._adBreakInfo=s,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){var e=!0===t.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),e&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",e),this._contentStarted=!0,this._sendInitialPlay(),e.chapterStartTimes.length>0&&(this._setChapterInfo(e),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){var e=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",e),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&e.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,i=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&e===this.mc.PAUSED&&this._onControlPause(t))},_updateVideoInfo:function(){var t,i=this.cviModel.getCurrentPlaybackState(),s=this.cviModel.getContentVideoState(),n=e.StreamType,a=s.duration,o=s.isLive,d=s.episodeFlag,l={};r.isEmpty(s.cmsRefGuid)?r.isEmpty(s.mediaId)?r.isEmpty(s.pid)?r.isEmpty(s.assetURL)?l.id="na":l.id=s.assetURL:l.id=s.pid:l.id=s.mediaId:l.id=s.cmsRefGuid,l.name=s.videoTitle,l.playerName=this._playerName,l.length=o?-1:isNaN(a)?0:a,l.playhead=i.currentTime,o?t=n.LIVE:(t=n.VOD,t+=":"+(d?this.FULL_EPISODES:this.CLIPS)),l.streamType=t,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",e),this._mediaObject=e.createMediaObject(l.name,l.id,l.length,l.streamType),this._videoInfo=l,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var e=t&&t.facadeState,i=this._qosObject;e&&i&&(i.bitrate=e.currentBitrate||0,i.droppedFrames=e.droppedFrames||0,i.fps=e.playbackFramerate||0)},_updatePlayhead:function(t){var e=t.payload;this._videoInfo&&e&&(e.isAd||(this._updateQosObj(e),this._videoInfo.playhead=e.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)}}),n=function(){return"undefined"==typeof ADB||"undefined"===r.get(ADB,"va.Heartbeat")},a=function(t){return r.isObject(t)&&!r.isEmpty(t)&&r.isFunction(t.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(t){var e,i=t._,s=function(t){return(t>0&&t<10?"0":"")+t.toString()},n={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};t.ComScoreAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"3005086",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){if(e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."));this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),a=(this.cviModel.getContentPlaybackState(),uvpjs.util),r=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),o=this.cviModel.getContentVideoState().isLive,d=parseInt(i.episodeNumber),l=parseInt(i.seasonNumber),u=(i.seriesTitle,i.videoTitle),h=u&&u.split("-")[1],c=!isNaN(d),p=!isNaN(l),v=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,g=u;return c&&p&&(t=s(d),e=s(l),g+="--"+e+t),{ns_st_ci:a.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:o?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[n.publisherBrand],ns_st_pr:a.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:h,ns_st_sn:p&&e||"*null",ns_st_en:c&&t||"*null",ns_st_ge:i.category||"*null",ns_st_ia:o?1:0,ns_st_ddt:"*null",ns_st_tdt:"*null",ns_st_st:r("c4")||"*null",ns_st_ce:i.episodeFlag?1:0,c3:r("c3")||this._playerName,c4:v||r("c4")||"*null",c6:r("c6")||g}},_onAdStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);var e=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?e.Live:e.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgress:function(t){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=t.util.copyObjectWithKeyMap(n).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[n.stationTitle]},_getAdType:function(){var t,e=ns_.ReducedRequirementsStreamingAnalytics.AdType,i=this.cviModel.getAdVideoState().adClipID.split("_")[0];return t="pre"===i?e.LinearOnDemandPreRoll:"mid"===i?e.LinearOnDemandMidRoll:e.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(t=e.LinearLive),t}}),e=function(){return"undefined"==typeof ns_||i.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(t){"use strict";t.ConvivaAgent=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0===window.Conviva)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded."));var t=this.eventTypes,e=this.adEventHandlerMap={};e[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))},_getAdType:function(t){var e="string"==typeof t?t.toLowerCase():null,i=Conviva.Client.AdPosition,s=uvpjs.ConvivaAgent.adPositions;return e?e.indexOf(s.PRE)>=0?i.PREROLL:e.indexOf(s.MID)>=0?i.MIDROLL:e.indexOf(s.POST)>=0?i.POSTROLL:void 0:i.PREROLL},_getArgsForStartAd:function(t){var e=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,s="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:s?e.SEPARATE:e.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,
this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var i=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(i.key,i.stream,i.player,i.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",i),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){var i=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,i),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(s)||s===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){var i=t.errorInfo;this.hasConvivaAdSession?(this._sendError(i.message,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",i)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",i)},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,e=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(t){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===s.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(t):i===s.PAUSED?this._onContentPaused(t):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){var e=t.payload.errorInfo;e.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(e.message,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(e.message,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){var e=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(e>0&&(e*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",e),this.convivaPlayerStateManager.setBitrateKbps(e))},_createConvivaSession:function(){if(this.convivaClient){var t=this.cviModel,e=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:t.getSessionOption("userId"),userPPID:t.getSessionOption("userPPID"),userStatus:t.getSessionOption("userStatus")}),i=new Conviva.ContentMetadata;this._setContentMetadata(i,e),this.convivaSessionKey=this.convivaClient.createSession(i),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){if(this.hasConvivaSession){var s="";!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+t)}},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,s=Conviva.ContentMetadata.StreamType,n=i.contentVideoState,a=n.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(n.videoTitle,"N/A"),t.defaultBitrateKbps=a&&a>0?a:700,t.defaultResource=this._validateStr(n.cdn,""),t.duration=n.duration,t.streamType=n.isLive?s.LIVE:s.VOD,t.streamUrl=this._validateStr(n.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._validateStr(n.episodeTitle,n.videoTitle),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height&&(e=window.screen.height)),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t,e=this.moduleParams;return this._isValidStr(e.customerKey)&&this._isValidStr(e.serviceUrl)?(t=new Conviva.ClientSettings(e.customerKey),t.heartbeatInterval=e.heartbeatInterval||this.defaultHeartbeatInterval,t.gatewayUrl=e.serviceUrl,t):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),e=new Conviva.SystemSettings;return this._setConvivaSystemProps(e),new Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e,i,s,n,a={};return uvpjs.ConvivaAgent.adPositions,t?(void 0!==t.podDuration&&(a.podDuration=String(t.podDuration)),t.adPodId?(e=t.adPodId.split("_"),i=e[0].toLowerCase(),s=i.charAt(0).toUpperCase()+i.slice(1),n=String(t.imaPodIndex+1),a.podPosition=s+"-roll",a.podIndex=this.podCount,a.absoluteIndex=n,a):a):null},_buildAdInfo:function(t){var e=new Conviva.ContentMetadata,i=t.adData,s=t.imaAdData,n=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(n,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=Conviva.ContentMetadata.StreamType.VOD;var a=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId,"c3.ad.system":s.adSystem,"c3.ad.position":a.charAt(0).toUpperCase()+a.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":s.adPodInfo.adPosition,"c3.ad.creativeId":s.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){var e=t.split("?");return"mp4"===e[0].substr(e[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t,e=this.cviModel,i=e.getModule(this.moduleName),s=i.params,n=s.length,a={};n--;)t=s[n],a[t.name]=t.value;this.moduleParams=a},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),a=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.CONTENT_DATA_LOADED]=s,e[t.CONTENT_START]=s,e[t.CONTENT_END]=s,e[t.VIDEO_STATE_CHANGE]=n,e[t.VIDEO_TRANSITION_COMPLETE]=n,e[t.VIDEO_DONE]=n,e[t.RESOURCE_END]=n,e[t.PLAYER_START_ERROR]=a,e[t.VIDEO_START_ERROR]=a,e[t.VIDEO_PLAYBACK_ERROR]=a,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(t){"use strict";t.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t,e,i,s=this.cviModel,n=this._metadata,a=s.sessionOptions.partner,r=s.getModule(this._moduleName),o=r.params,d=o.length,l={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");d--;)t=o[d],""!==t.value&&(l[t.name]=t.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:l[this.NIELSEN_SFCODE_PARAM_NAME],apid:l[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:l[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},a){case"chow":e="us-700144",i="c06";break;case"tvcom":e="us-200330",i="c03";break;case"cbs":case"can":e="us-700144",i="c01";break;case"cbssports":case"cbssports_test":e="us-201669",i="c02";break;case"news":e="us-700144",i="c03";break;case"gamespot":e="us-200330",i="c13";break;case"cnettv":e="us-200330",i="c05";break;default:e="us-700144",i="c01"}n.ci=l.clientid||e,n.c6=l.vcid||i,n.iag_sid=l.iag_sid,n.iag_tfid=l.iag_tfid,n.channelName=l.channelName,n.segB=l.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",l,n)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){if(e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."));this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams),this._setupEventCallbacks()},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e,i,s,n,a,r,o,d,l=uvpjs.mediaCapabilities.isMobile(),u=this._metadata;t.payload&&(e=t.payload.vidState,s=e.chapterStartTimes.length>0?"lf":"sf",a=e.episodeNumber,r=e.seasonNumber,o=e.seriesTitle,d=e.videoTitle,i=e.duration,n=[d,r,a,s].join("|"),""===r&&(r="0"),""===a&&(a="0"),e.isAffiliateFeed&&(u.tv="true"),(e.isLive||-1===i)&&(i=this.NIELSEN_LIVE_VIDEO_DURATION),u.pc=u.ci+u.c6+u.cmsRefGuid,u.c10="plt,"+(l?"MBL":"DSK"),u.sd=i,u.dur=i,u.cg=o,u.tl=n,u.videotype="content",u.guid=e.cmsRefGuid,u.seriestitle=o,u.episodetitle=d,u.isfullepisode=e.episodeFlag?"y":"n",u.crossId1=e.mediaId,u.iag_pgm=d,u.iag_epi=n,u.iag_pd=location.hostname,u.iag_fp=s,u.iag_cte="na",u.iag_oad="na",u.iag_seg=1,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",u))},_onAdStart:function(t){var e,i,s,n,a,r,o,d,l,u,h=this.cviModel.getContentVideoState(),c=t.payload;c&&(this._metadata.hasAds=1,this._adDisplayed=!0,u=uvpjs._.clone(this._metadata),e=c.adData,i=e.adClipID.split("_"),n=i[0],d=this.cviModel.getNumberOfAdPods(),l="post"===n?d:++i[1],s=["dav0",h.videoTitle,h.seasonNumber,h.episodeNumber].join("-"),o=[d,l,this._numAdsInPod,i[2]].join("_"),a=e.adVatId,r=e.adVideoUrl,""!==a&&(r+="|"+a),u.videotype=n+"roll",u.iag_cte=r,u.iag_pod=o,u.iag_apt="na",u.tl=s,u.c3="st,a","pre"===n&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",u),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,u))},_onAdPodStart:function(t){var e=t.payload;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",e.adPod.adCount),this._numAdsInPod=e.adPod.adCount)},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e,i=t.payload;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),i){if(this._metadata.iag_seg&&this._metadata.iag_seg++,e=t.payload.contentData,e.duration>0&&Math.abs(e.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(t){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e,i=t.payload;if(i&&!((e=Math.floor(i.currentTime))<0)){if(i.isAd){if(this._lastAdSecond===e)return;this._lastAdSecond=e}else{if(this._lastContentSecond===e)return;this._lastContentSecond=e}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,e)}},_onVideoCuepoint:function(t){var e=t.payload,i=e.data;e.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&i&&"string"==typeof i&&this._notifySDK(this.events.SEND_ID3,i)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t}});var e=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(t){var e,i,s,n=t._;t.DWAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),s=t.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities,a=this._tags.content,r=this._tags.ad,o=this.trackingMgr;r.adastid=e===o.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(a.medastid)||0===a.medastid||"0"===a.medastid)&&(i.isLive?i.isAffiliateFeed?a.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?a.medastid="601":a.medastid="0":a.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",a.medastid,r.adastid))},_loadConfigParams:function(){for(var t,e,i,s=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),a=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],r=a.length;r--;)e=a[r],t=this._getTagType(e),i=s(e),n.isUndefined(t)||n.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",e,i),this._tags[t][e]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t,e,i,s=window.DW&&window.DW.pageParams||{};this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams");for(t in s)s.hasOwnProperty(t)&&(i=s[t],n.isEmpty(i)||(this._pageParams[t]=i,e=this._getTagType(t),n.isUndefined(e)||(this._tags[e][t]=i)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,n=e.event,a=n===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:s(this._gestval),n!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,a+=i(e),t&&(a+="&"+i(this._tags.ad)),this.trackingMgr.fireTrackingPixel(a),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",a),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,e=uvpjs.mediaCapabilities,i=e.isMobile()?"mobile%20web":"desktop%20web",s=this.cviModel.getSessionOption("userStatus"),a=this.cviModel.getSessionOption("userId"),r=this._tags.content,o=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=t.href,r.srchost=t.host,r.ursuid=a,r.v16=o.viewguid,r.v17=o.topic,r.v18=o.topicbrcrm,r.v19=o.pagetype,r.v20=o.assetguid,r.v21=e.isChromecast()?"chromecast":i,r.v23=o.rsid,r.v25=n.isEmpty(s)?"anon":s,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:s.pct=25;break;case e.MID_QUARTILE:s.pct=50;break;case e.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(t){this._tags.ad,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var e=this._tags.ad,i=t.payload.adData,s=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),e.adid=n.isEmpty(i.adVideoId)?"999":i.adVideoId,e.adnum=this.cviModel.adNum,e.adtime=0,e.adtitle=i.adVideoTitle,e.adtype=i.isLinear?1:2,e.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),e.adbreak="",e.adpos=s[0],e.adpod=s[1],e.adpodpos=s[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var e=this.cviModel,i=e.getContentVideoState(),s=this._tags.content,a=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),s.event=this.events.START,s.codec=i.fileType,s.distntwrk=e.getSessionOption("netwk"),s.playersz=this._getPlayerSize(),s.sdlvrytype=this._getStreamType(),s.v22=i.cmsRefGuid,s.medid=i.mediaId,s.medlength=this.trackingMgr.getContentLength()/1e3,s.mednum=e.medNum,s.medrls=i.pid,s.medtitle=i.videoTitle,s.contsessid=i.previousSessionId,n.isEmpty(i.contPlayState)||(a.autoplay=i.contPlayState),a.paywall=i.isPaidContent?"1":"0",a.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var e=t&&t.payload,i=e&&e.seekFromTime,s=e&&e.seekToTime,n=s-i,a=this._tags.content;a.eventdur=Math.floor(Math.abs(n)),a.event=n>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:s,seekDuration:n,event:a.event,eventdur:a.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var e,i,s,a,r,o,d,l=this._tags.content,u=this._gestval,h=t.payload.gestureInfo,c=this.cviModel.contentVideoState,p=c.elapsedTime,v="",g=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"==typeof h&&-1===h.indexOf("event="))return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");if(n.isArray(h)){if(h.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");v=h[0]}if(c=this.cviModel.contentVideoState,"string"==typeof h)a=/event=([^&]*)(?:&gestval=(.*))?/,r=a.exec(h),o=r[1],d=r[2],l.event=o,l.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===d?"":d;else if(v===g.GLOBAL_RESUME||v===g.LOCAL_RESUME)u.prevcomponentid=c.previousSessionId,u.eventdur=p>0?Math.round(p/1e3):0,u.paywall=c.isPaidContent?"1":"0",l.event=this.events.RESUME,
l.medtime=c.resumeContentTime;else if(v===g.CONT_CANCEL)u.action=this.events.PROMPT;else switch(l.medtime=this.cviModel.contentPlaybackState.currentTime,v){case g.RELATED_OVERLAY:l.event=g.RELATED_OVERLAY;break;case g.RELATED_CLICK_GESTURE:h.length>=2&&(u.related_pid=h[1]),l.event=g.RELATED_CLICK_GESTURE;break;case g.SHARE_OVERLAY:l.event=g.SHARE_OVERLAY;break;case g.SHARE_NETWORK_GESTURE:h.length>=2&&(u.network=h[1]),l.event=g.SHARE_NETWORK_GESTURE;break;case g.SEND_GESTURE:h.length>=2&&(e=h[1].split(","),i=e.shift(),s=e.join(","),u.sender=i,u.recipient=s),l.event=g.SEND_GESTURE;break;case g.EMBED_GESTURE:l.event=g.EMBED_GESTURE;break;case g.LINK_GESTURE:l.event=g.LINK_GESTURE;break;case g.REPLAY_GESTURE:l.event=g.REPLAY_GESTURE;break;case g.END_CARD_OVERLAY:l.event=g.END_CARD_OVERLAY;break;case g.ERROR_OVERLAY:l.event=g.ERROR_OVERLAY;break;case g.RECOMMEND_NOW:h.length>=3?(u.mediaid=h[1],u.pid=h[2]):(u.mediaid="",u.pid=""),l.event=g.RECOMMEND_NOW;break;case g.RECOMMEND_NEXT:h.length>=3?(u.mediaid=h[1],u.pid=h[2]):(u.mediaid="",u.pid=""),l.event=g.RECOMMEND_NEXT;break;case g.RECOMMEND_CLOSE:l.event=g.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",v)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",l),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",u)),this._sendDWEvent()},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(t){return n.has(this._tags.ad,t)?"ad":n.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=uvpjs.mediaCapabilities,i=t.deliveryType,s=t.isLive;return i===e.STREAMING?s?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,e=n.isDate(t)&&parseInt((new Date-t)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",e),e},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var t=uvpjs.mediaCapabilities,e=window.screen,i={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return s(i)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),e=function(t,e,i){var s,a,r=[];for(s in t)t.hasOwnProperty(s)&&(a=n.isUndefined(t[s])?"":encodeURIComponent(t[s]),r.push([s,a].join(e)));return r.join(i)},i=function(t){return e(t,"=","&")},s=function(t){return e(t,":",";")}}(uvpjs.register("uvpjs")),function(t){var e;t._,t.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."));t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(t),this._setupEventCallbacks()},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,s=t.getContentVideoState(),n=t.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin){var e=t.payload.newState;e!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),e===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t);var e,i;if(this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI)){i=t.payload.paramsObj;for(e in i)this.akamaiPlugin.setData(e,i[e])}}}),e=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(t){"use strict";var e=t._;t.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var t=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!t&&!0===t[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){if(console.log("[MUX] _initializePlugin"),void 0===window.mux)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded."));this.cviModel&&this._setupEventCallbacks()},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var t=this.cviModel,i=this.moduleParams,s=e.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:i&&!uvpjs.util.isEmpty(i.experimentName)?i.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(i.subPropertyId)?t.getSessionOption("partner"):i.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?s.property_key=this.MUX_DEFAULT_PROPERTY_KEY:s.property_key=i.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:s}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){var e=t.payload.errorInfo;e&&e.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:e.errorCode,player_error_message:e.message}))},_gatherModuleParams:function(t){var e,i=this.cviModel,s=i.getModule(t),n=s.params,a={};if(!n)return null;for(var r=n.length;r--;)e=n[r],a[e.name]=e.value;return a},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),a=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=s,e[t.PLAYER_START_ERROR]=n,e[t.VIDEO_START_ERROR]=n,e[t.VIDEO_PLAYBACK_ERROR]=n,e[t.AD_ERROR]=n,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=a,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=a,e[t.AD_LOADED]=a,e[t.AD_START]=a,e[t.VIDEO_STATE_CHANGE]=a,e[t.AD_SKIPPED]=a,e[t.AD_END]=a,e[t.AD_ERROR]=a,e[t.AD_REQUEST]=a,e[t.AD_RESPONSE]=a,e[t.AD_QUARTILE]=a,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=t.payload.adData?t.payload.adData.adAssetUrl:t.payload.adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(e||(e={ad_tag_url:"",ad_asset_url:""}),e.ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEvent:function(t){window.mux.emit(this.videoElement,t)},_onAdEvent:function(t){var e=this.eventTypes,i=this.MUX_AD_EVENTS,s=this.MUX_EVENTS;switch(t.type){case e.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(s.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case e.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(s.PLAY),this._dispatchMuxEvent(s.PLAYING));break;case e.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t));break;case e.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t));break;case e.VIDEO_STATE_CHANGE:if(!t.payload.isAd)return;var n=t.payload.newState,a=t.payload.currentState;n===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(t)):a==this.mc.PAUSED&&n===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t)));break;case e.AD_SKIPPED:case e.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(t));break;case e.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(t));break;case e.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(t));break;case e.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(t));break;case e.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(uvpjs.register("uvpjs")),function(t){t.OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isPaused:!1,isBuffering:!1,init:function(t){this.options=t,this.ozTamVo=new uvpjs.OzTamVo(this);var e=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(e.publisherId,e.vendorVersion,e.productionMode,e.verboseLogging,e.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",e,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out"));switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDone:function(t){this.ozTamService.seekComplete()},onContentEnd:function(t){this.ozTamService.complete()},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.ozTamService.haltProgress());break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.ozTamService.resumeProgress()),this.isBuffering&&(this.isBuffering=!1,this.ozTamService.resumeProgress())}},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}})}(uvpjs.register("uvpjs")),function(t){t.SegmentAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"production"!==uvpjs.Configuration.env,options:null,segmentVo:null,hasSegmentSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.segmentVo=new uvpjs.SegmentVo(this),this.segmentEvent=this.segmentVo.Event,window.analytics&&"function"==typeof window.analytics.load&&(analytics.load(this.segmentVo.getApiKey()),this.hasSegmentSdk="function"==typeof analytics.track),this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Sdk",this.hasSegmentSdk)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.CONTENT_END]=this.onContentEnd.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),this.options.trackingMgr.registerEventCallbacks(e),t=this.options.trackingMgr.progressEvents,e={},e[t.FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.segmentEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.segmentEvent.SESSION_START,this.segmentVo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.hasContentStart=!0,this.trackContentStartEvent=!0},onQuartileProgress:function(t){this.sendTrackEvent(t,this.segmentVo.getQuartileInfo())},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.segmentEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.segmentEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.segmentEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.segmentEvent.BUFFER_COMPLETE))}},onSeekStart:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_START,this.segmentVo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.segmentEvent.SEEK_COMPLETE,this.segmentVo.getSeekInfo())},onContentEnd:function(t){this.sendTrackEvent(this.segmentEvent.CONTENT_COMPLETE)},onResourceEnd:function(t){this.hasContentStart&&(this.sendTrackEvent(this.segmentEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},onAdPodStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_START,this.segmentVo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.segmentEvent.AD_START,this.segmentVo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.segmentEvent.AD_CLICK)},onAdEnd:function(t){this.sendTrackEvent(this.segmentEvent.AD_COMPLETE)},onVideoTransition:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.segmentEvent.QOS,this.segmentVo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.sendTrackEvent(this.segmentEvent.CONTENT_START,this.segmentVo.getContentStartInfo()))},sendTrackEvent:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Segment Track",t,e||{}),this.hasSegmentSdk&&analytics.track(t,e||{})},destroy:function(){this.segmentVo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.segmentVo=null,this.contextMetadata=null}})}(uvpjs.register("uvpjs")),function(t){t.OzTamVo=uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.agent.options.playerVersion,productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getMediaInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration;return{mediaId:e.ozTamMediaId||e.cmsRefGuid||e.mediaId,url:e.assetURL,mediaDuration:e.isLive?-1:isNaN(i)?0:i,mediaType:e.isLive?"live":"vod",mediaPositionFunction:function(){return t.getCurrentPlaybackState().currentTime}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=this.agent.ozTamService,s={};return e.ozTamMediaId&&(s[i.PROP_ALT_MEDIA_ID]=e.cmsRefGuid||e.mediaId),s},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}})}(uvpjs.register("uvpjs")),function(t){t.SegmentVo=uvpjs.Class.subClass({Event:{SESSION_START:"Video Playback Started",CONTENT_START:"Video Content Start",CONTENT_COMPLETE:"Video Content Completed",PAUSE:"Video Playback Paused",STOP:"Video Playback Interrupted",BUFFER_START:"Video Playback Buffer Started",BUFFER_COMPLETE:"Video Playback Buffer Completed",SEEK_START:"Video Playback Seek Started",SEEK_COMPLETE:"Video Playback Seek Completed",PLAY_RESUME:"Video Playback Resumed",SESSION_END:"Video Playback Completed",AD_BREAK_START:"Video Ad Break Started",AD_BREAK_COMPLETE:"Video Ad Break Completed",AD_START:"Video Ad Started",AD_COMPLETE:"Video Ad Completed",AD_CLICK:"Video Ad Clicked",QOS:"Video Quality Updated",FIRST_QUARTILE:"Video Playback First Quartile",MID_QUARTILE:"Video Playback Mid Quartile",THIRD_QUARTILE:"Video Playback Third Quartile"},agent:null,channelName:null,apiKey:null,init:function(t){this.agent=t;var e=this.agent.options;this.getModuleParam=e.cviModel.getModuleParam.bind(e.cviModel,e.trackingMgr.SEGMENT_MODULE_NAME),this.apiKey=this.getModuleParam("apiKey"),this.channelName=this.getModuleParam("channelName")},getApiKey:function(){return this.apiKey},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:isNaN(i)?0:i;return{adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,contentAssetId:e.cmsRefGuid||e.mediaId,currentIndex:1,"drm.dash.playreadyURL":e.drm.dash.playreadyURL,"drm.dash.widevineURL":e.drm.dash.widevineURL,"drm.enabled":e.drm.enabled,"drm.fairplay.appCertURL":e.drm.fairplay.appCertURL,"drm.ticket":e.drm.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:n,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sessionId:t.sessionId,sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:n,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName,viewguid:t.dwPageParams.viewguid}},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:isNaN(i)?0:i;return{assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,contextMetadata:this.agent.contextMetadata,dfpMediaId:e.dfpMediaId,duration:n,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:n}},getContentCompleteInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState;return{contentAssetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,mediaId:e.mediaId,playbackBitrate:s.currentBitrate,playheadTime:this.getPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:e.isLive?-1:isNaN(i)?0:i}},getQuartileInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState();return{contentAssetId:e.cmsRefGuid||e.mediaId,playheadTime:this.getPlayhead(),playerTime:this.getPlayerElapsedTime(),sessionId:t.sessionId}},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,i=t.contentPlaybackState.facadeState;return{averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:e.currentTime,currentBitrate:i.currentBitrate,droppedFPS:i.droppedFPS,droppedFrames:i.droppedFrames,playbackFramerate:i.playbackFramerate}},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),s=1
;return"post"===e.adType?s=t.getNumberOfAdPods():"mid"===e.adType&&(s=parseInt(i[1])+1),{indexPosition:s,startTime:this.getPlayhead(),title:e.adVideoTitle}},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return{adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration}},getSeekInfo:function(){return{seekPosition:this.getPlayhead()}},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}})}(uvpjs.register("uvpjs")),function(t){var e={concurrencyBeacon:{prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"}},i=!1,s=null,n=null,a=function(t){return t=t.replace(/\s/g,""),t.search(/^\/\//)>-1?t:"//"+t};t.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(t){return n=e.concurrencyBeacon,t&&t.prodUrl&&t.stageUrl&&(n.prodUrl=a(t.prodUrl),n.stageUrl=a(t.stageUrl)),this},queryParams:function(e){return s=t.util.queryStrFromObj(e,!1),this},devMode:function(t){return i=t,this},buildUrl:function(){return null===n?"Unable to build url.":(i?n.stageUrl:n.prodUrl)+n.path+(null===s?"":"?"+s)}})}(uvpjs.register("uvpjs")),function(t){var e=t._;t.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),!e)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null);if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}if(!this.videoTagRef.webkitKeys)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null);var s=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),n=this.videoTagRef.webkitKeys.createSession("video/mp4",s);if(!n)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null);n.contentId=e,n.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),n.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),n.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)},loadAppCert:function(){e.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var s=0,n=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),a=new DataView(n);new Uint8Array(n,s,t.byteLength).set(t),s+=t.byteLength,a.setUint32(s,e.byteLength,!0),s+=4;var r=new Uint8Array(n,s,e.byteLength);return r.set(e),s+=r.byteLength,a.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");var s=encodeURIComponent(this.base64EncodeUint8Array(e.message)),n="spc="+s+"&"+i.session.contentId;i=this.setRequestHeaders(i),i.send(n)},onLicenseRequestLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var i=t.target,s=i.session,n=null;e.inRange(i.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?n=this.base64DecodeUint8Array(i.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(n=new Uint8Array(i.response)),s.update(n)},onError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",t)},getLicenseServerUrl:function(t){var i=null;return i=e.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:this.drm.fairplay.licenseURL,this.appendDRMQueryParams(i)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!e.isEmpty(this.drm.fairplay.header)){var i=this.drm.fairplay.header;for(var s in i){var n=encodeURIComponent(i[s]);t.setRequestHeader(s,n)}}return t},getId:function(t){var e=uvpjs.util.objFromQueryStr(t);return e.ContentId||e.contentId||e.assetId||null},base64EncodeUint8Array:function(t){var e=String.fromCharCode.apply(null,t);return btoa(e)},base64DecodeUint8Array:function(t){var e=window.atob(t),s=e.length,n=new Uint8Array(new ArrayBuffer(s));for(i=0;i<s;i++)n[i]=e.charCodeAt(i);return n},stringToArray:function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),s=0,n=t.length;s<n;s++)i[s]=t.charCodeAt(s);return i}})}(uvpjs.register("uvpjs"))}();
define("libs/cbsi-player/uvpjs-2.9.52", function(){});


/*	
 *	jQuery dotdotdot 1.6.1
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

!function(t){function e(t,e,n){var o=t.children(),i=!1;t.empty();for(var a=0,d=o.length;a<d;a++){var l=o.eq(a);if(t.append(l),n&&t.append(n),r(t,e)){l.remove(),i=!0;break}n&&n.detach()}return i}function n(e,i,a,d,l){var s=e.contents(),c=!1;e.empty();for(var u=0,f=s.length;u<f&&!c;u++){var h=s[u],p=t(h);void 0!==h&&(e.append(p),l&&e[e.is("table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style")?"after":"append"](l),3==h.nodeType?r(a,d)&&(c=o(p,i,a,d,l)):c=n(p,i,a,d,l),c||l&&l.detach())}return c}function o(t,e,n,a,s){var c=!1,u=t[0];if(void 0===u)return!1;for(var f=l(u),h=-1!==f.indexOf(" ")?" ":"　",p="letter"==a.wrap?"":h,v=f.split(p),g=-1,w=-1,m=0,y=v.length-1;m<=y&&(0!=m||0!=y);){var b=Math.floor((m+y)/2);if(b==w)break;w=b,d(u,v.slice(0,w+1).join(p)+a.ellipsis),r(n,a)?y=w:(g=w,m=w),y==m&&0==y&&a.fallbackToLetter&&(p="",v=v[0].split(p),g=-1,w=-1,m=0,y=v.length-1)}if(-1==g||1==v.length&&0==v[0].length){var x=t.parent();t.remove();var C=s?s.length:0;if(x.contents().size()>C)c=o(x.contents().eq(-1-C),e,n,a,s);else{var T=x.prev(),u=T.contents().eq(-1)[0];if(void 0!==u){var f=i(l(u),a);d(u,f),s&&T.append(s),x.remove(),c=!0}}}else f=i(v.slice(0,g+1).join(p),a),c=!0,d(u,f);return c}function r(t,e){return t.innerHeight()>e.maxHeight}function i(e,n){for(;t.inArray(e.slice(-1),n.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),n.lastCharacter.noEllipsis)<0&&(e+=n.ellipsis),e}function a(t){return{width:t.innerWidth(),height:t.innerHeight()}}function d(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function l(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function s(e,n){return void 0!==e&&!!e&&("string"==typeof e?(e=t(e,n),!!e.length&&e):"object"==typeof e&&void 0!==e.jquery&&e)}function c(t){for(var e=t.innerHeight(),n=["paddingTop","paddingBottom"],o=0,r=n.length;o<r;o++){var i=parseInt(t.css(n[o]),10);isNaN(i)&&(i=0),e-=i}return e}function u(t,e){return!!t&&(e="string"==typeof e?"dotdotdot: "+e:["dotdotdot:",e],void 0!==window.console&&void 0!==window.console.log&&window.console.log(e),!1)}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(o){if(0==this.length)return o&&!1===o.debug||u(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(o)});var i=this;i.data("dotdotdot")&&i.trigger("destroy.dot"),i.data("dotdotdot-style",i.attr("style")),i.css("word-wrap","break-word"),"nowrap"===i.css("white-space")&&i.css("white-space","normal"),i.bind_events=function(){return i.bind("update.dot",function(o,a){o.preventDefault(),o.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:c(i),l.maxHeight+=l.tolerance,void 0!==a&&(("string"==typeof a||a instanceof HTMLElement)&&(a=t("<div />").append(a).contents()),a instanceof t&&(d=a)),g=i.wrapInner('<div class="dotdotdot" />').children(),g.empty().append(d.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var s=!1,u=!1;return h.afterElement&&(s=h.afterElement.clone(!0),h.afterElement.remove()),r(g,l)&&(u="children"==l.wrap?e(g,l,s):n(g,i,g,l,s)),g.replaceWith(g.contents()),g=null,t.isFunction(l.callback)&&l.callback.call(i[0],u,d),h.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(i[0],h.isTruncated),h.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(i[0],d),d}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),i.unwatch().unbind_events().empty().append(d).attr("style",i.data("dotdotdot-style")).data("dotdotdot",!1)}),i},i.unbind_events=function(){return i.unbind(".dot"),i},i.watch=function(){if(i.unwatch(),"window"==l.watch){var e=t(window),n=e.width(),o=e.height();e.bind("resize.dot"+h.dotId,function(){n==e.width()&&o==e.height()&&l.windowResizeFix||(n=e.width(),o=e.height(),v&&clearInterval(v),v=setTimeout(function(){i.trigger("update.dot")},10))})}else p=a(i),v=setInterval(function(){var t=a(i);p.width==t.width&&p.height==t.height||(i.trigger("update.dot"),p=a(i))},100);return i},i.unwatch=function(){return t(window).unbind("resize.dot"+h.dotId),v&&clearInterval(v),i};var d=i.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,o),h={},p={},v=null,g=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),h.afterElement=s(l.after,i),h.isTruncated=!1,h.dotId=f++,i.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&i.watch(),i},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var f=1,h=t.fn.html;t.fn.html=function(t){return void 0!==t?this.data("dotdotdot")&&"function"!=typeof t?this.trigger("update",[t]):h.call(this,t):h.call(this)};var p=t.fn.text;t.fn.text=function(e){if(void 0!==e){if(this.data("dotdotdot")){var n=t("<div />");return n.text(e),e=n.html(),n.remove(),this.trigger("update",[e])}return p.call(this,e)}return p.call(this)}}}(jQuery);
define("libs/jquery/dotdotdot-1.6.1", function(){});


define('quantum/videoPlayer',[
    'jquery',
    'version!fly/managers/debug',
    'managers/client-storage',
    'translations/video',
    'version!fly/managers/components',
    'utils/cookie',
    'managers/device',
    'managers/edition',
    'managers/events',
    'version!fly/managers/history',
    'managers/page-vars',
    'managers/global-functions',
    'managers/tealium',
    'managers/mpulse',
    'version!fly/utils/url-helper',
    'managers/waypoints',

    'version!fly/components/base',
    'version!libs/cbsi-player/uvpjs',
    'version!libs/waypoints/inview',
    'version!libs/jquery/dotdotdot'
], function(
    $,
    debug,
    clientStorage,
    translations,
    components,
    cookie,
    device,
    edition,
    eventMgr,
    history,
    pageVars,
    globalFunctions,
    tealium,
    mpulseMgr,
    urlHelper,
    waypoints
) {
    var namespace = 'videoPlayer';

    debug = debug.init(namespace);

    // Initialize the waypoints manager so that waypoints are refreshed periodically.
    waypoints.init();

    // Static Variables

    /**
     * A list of mpulse performance tracking measurements.
     *
     * @property mpulseUserTiming
     * @type {{cnetvideocreate: number, playerloaded: number, showplayoverlay: number, adstart: number, adend: number, contentstart: number}}
     * @default populated object
     */
    var mpulseUserTiming = {
        cnetvideocreate: 0,
        playerloaded: 0,
        showplayoverlay: 0,
        adstart: 0,
        adend: 0,
        contentstart: 0
    };

    /**
     * The number of players that have been initialized since the initial page load.  Used for applying unique ids to
     * new players as they are added to the page.
     *
     * @property playersInitialized
     * @type number
     * @default 0
     */
    var playersInitialized = 0;

    /**
     * The uvp video manager responsible for creating and keeping track of all video players.
     *
     * @property videoManager
     * @type object
     * @default instance of uvpjs.VideoManager
     */
    var videoManager = new window.uvpjs.VideoManager();

    /**
     * Turn an element into a video player.  This acts as a wrapper for uvpjs.
     *
     * For more information on uvpjs, see:
     * https://sites.google.com/a/cbsinteractive.com/video-technology/home/developer/uvpjs-home
     * http://vtstage.cbsinteractive.com/sites/uvpjs/docs/api/
     *
     * @class $.cnet.videoPlayer
     * @extends $.fly.base
     * @constructor
     *
     * @param [apeList=false] {boolean} Whether or not the initial playlist of videos is an "AutoPlay Everywhere"
     *          playlist.  This special type of playlist is included on pages that have no videos related to them and
     *          changes its order based on which videos within it the user has already seen.
     * @param [autoplay=false] {boolean|string} Determines how autoplay should work; if 'load', autoplay begins when the
     *          player loads; if 'scroll', autoplay begins when the player scrolls into view; if 'first', autoplay begins
     *          when the player loads only if it is the first player on the page; if false, autoplay is disabled.
     * @param [classActive='active'] {string} The class name to apply to control elements while they are on, active, or enabled.
     * @param [classCaptions='captions'] {string} The class name to apply to the player while captions are on during muted autoplay.
     * @param [classCaptionsMissing='captionsMissing'] {string} The class name to apply to the player when captions would normally display but are missing for the current video.
     * @param [classPlaying='playing'] {string} The class name to apply to elements while the video is playing.
     * @param [config=null] {object} The global video config data.  TODO: We only use comscore configs from this, so should we remove this?
     * @param [contentType='vod-curated'] {string} Content type for tracking heartbeat content type
     * @param [customCSS=null] {string} URL for customCSS file.
     * @param [enableHistoryUpdates=false] {boolean} Whether or not the window location should be updated with current video url
     * @param [eventChannels=null] {array} A list of channels to publish events to.
     * @param [eventSubscriptions=null] {object} A channel/event/callback mapping as expected by the event manager.
     * @param [getPlaylistSelector=null] {string} Selector for element with a data-video-playlist. If present, will append to playlist
     * @param [getRelatedPlaylist=false] {boolean} Determines if the player should attempt to load related video playlist
     * @param [getShortcodeVideo=false] {boolean} Determines if the player should attempt to play video shortcode on page
     * @param [idPrefix='videoPlayer'] {string} The prefix to apply to the id of each video player element; this is
     *          supplemented with a number to ensure each player's id is unique.
     * @param [loaderSelector='#related-area'] {string} Element to append loader to.
     * @param [loop=true] {boolean} Whether or not the playlist should start over once the last video completes.
     * @param [mainPlayer=false] {boolean} Whether or not this is the main player on the page.  Only one player on the
     *          page should have this option enabled.  If true, any elements on the page with a data-load-video
     *          attribute will load playlist data (data-video-playlist) into this player and play it.  Data should follow the same format as
     *          the playlist option.
     * @param [mutedVideoCountThreshold=10] {number} The maximum number of videos to autoplay while player is muted
     * @param [playlist=[]] {Array} The initial list of videos to play.
     * @param [resizePlayer] {boolean} Automatically resize player when aspect ratio of content changes
     * @param [selectorScrollingAutoplayDisabled='.inviewElement.exited'] {string} When a parent has this selector, disable scrolling autoplay waypoints.
     * @param [showAsModal=false] {boolean} Player initially hidden. Will display as modal when playing.
     * @param [showPreviewMetadata=false] {boolean} If true, will display additional video information (title and duration) on the preview button
     * @param [suppressAds=false] {boolean} Whether or not ads should be suppressed.
     * @param [tagTopicPlaylistRoute=''] {string} Generated path to request a tag or topic based playlist.
     * @param [titleTagPostText=''] {string} Post text after the video name.  Used for updating the title tag.
     * @param [uvpPartner='cnet'] {string} The partner to use in uvp configs.
     */
    $.widget('cnet.videoPlayer', $.fly.base, {

        // Options
        options: {
            apeList: false,
            autoplay: false,
            classActive: 'active',
            classCaptions: 'captions',
            classCaptionsMissing: 'captionsMissing',
            classDisabled: 'disabled',
            classHidden: 'hidden',
            classNoAutoplay: 'pausedAtStartup',
            classPlaybackStarted: 'playbackStarted',
            classPlaying: 'playing',
            config: null,
            contentType: 'vod-curated',
            customCSS: null,
            enableHistoryUpdates: false,
            eventChannels: null,
            eventSubscriptions: null,
            getPlaylistSelector: null,
            getRelatedPlaylist: false,
            getShortcodeVideo: false,
            idPrefix: 'videoPlayer',
            loaderSelector: '#related-area',
            loop: true,
            mainPlayer: false,
            mutedVideoCountThreshold: 10,
            playlist: [],
            resizePlayer: true,
            selectorScrollingAutoplayDisabled: '.inviewElement.exited',
            showAsModal: false,
            showPreviewMetadata: false,
            suppressAds: false,
            tagTopicPlaylistRoute: '',
            titleTagPostText: '',
            uvpPartner: 'cnet',
            videoShortcodeSelector: '.video.shortcode'
        },

        // Variables

        /**
         * Timestamp of the last adPodStart event.
         *
         * @property adPodStartTimestamp
         * @type int
         * @default 0
         */
        adPodStartTimestamp: 0,

        /**
         * Determines how autoplay should work. Defaults to options.autoplay value, unless overridden
         * by some other criteria (e.g. content with "TV-MA" rating should not autoplay).
         *
         * @property autoplayState
         * @type boolean|string
         * @default null
         */
        autoplayState: null,

        /**
         * The maximum number of videos to autoplay when browser loses focus.
         *
         * @property blurredVideoCountThreshold
         * @type int
         * @default null
         */
        blurredVideoCountThreshold: null,

        /**
         * The chapter data for the active video.  Each chapter is stored with a key indicating what time it corresponds
         * to within the video progress (e.g. "time30" for 30 seconds in)
         *
         * @property chapters
         * @type object
         * @default null
         */
        chapters: null,

        /**
         * Time stamp when content starts. Used for Chartbeat tracking.
         *
         *
         * @property contentStartTimeStamp
         * @type Date
         * @default null
         */
        contentStartTimeStamp: null,

        /**
         * The most recent content video state: EMPTY: -2, LOADING: -1, STOPPED: 0, PLAYING: 1, PAUSED: 2
         *
         * @property contentVideoState
         * @type int
         * @default -2
         */
        contentVideoState: -2,

        /**
         * Contains various error strings
         *
         * @property errorDetails
         * @type object
         * @default object
         */
        errorDetails: {
            MANIFEST_LOAD_ERROR: 'manifestLoadError',
            MANIFEST_LOAD_TIMEOUT: 'manifestLoadTimeOut',
            MANIFEST_PARSING_ERROR: 'manifestParsingError',
            MANIFEST_INCOMPATIBLE_CODECS_ERROR: 'manifestIncompatibleCodecsError'
        },

        /**
         * Tracks whether we have received firstGesture event
         *
         * @property haveFirstGesture
         * @type boolean
         * @default false
         */
        haveFirstGesture: false,

        /**
         * The id of the video player instance and the element associated with it.
         *
         * @property id
         * @type string
         * @default null
         */
        id: null,

        /**
         * Whether or not the player has been initialized.  Used to avoid initializing the player more than once which
         * could occur if autoplay on scroll is enabled.
         *
         * @property initialized
         * @type boolean
         * @default false
         */
        initialized: false,

        /**
         * Whether or not the player was playing a video and was interrupted by some other action.  Used for things like
         * overlays so the player can resume playing when the overlays are closed.
         *
         * @property interrupted
         * @type boolean
         * @default false
         */
        interrupted: false,

        /**
         * Whether or not the player is currently playing a video ad
         *
         * @property isAd
         * @type boolean
         * @default false
         */
        isAd: false,

        /**
         * Whether or not the player is currently playing a video.
         *
         * @property isPlaying
         * @type boolean
         * @default false
         */
        isPlaying: false,

        /**
         * Reference to initialized history manager
         *
         * @property history
         * @type object
         * @default null
         */
        history: null,

        /**
         * Whether or not mobile autoplay is allowed.  Only iOS 10+ is supported.  Chrome on iOS is not supported.
         *
         * @property mutedAutoplayEnabled
         * @type boolean
         * @default false
         */
        mutedAutoplayEnabled: false,

        /**
         * Flag for AB test
         *
         * @property mutedAutoplayTest
         * @default false
         */
        mutedAutoplayTest: false,

        /**
         * Tracks if a modal player has been closed
         *
         * @property closePlayerRequested
         * @type boolean
         * @default false
         */
        closePlayerRequested: false,

        /**
         * The uvp video player instance associated with this component.
         *
         * @property player
         * @type object
         * @default null
         */
        player: null,

        /**
         * The current list of videos to play in the player.
         *
         * @property playlist
         * @type Array
         * @default []
         */
        playlist: [],

        /**
         * Tracks if playlist has been paused
         *
         * @property playlistPaused
         * @type boolean
         * @default false
         */
        playlistPaused: false,

        /**
         * The waypoint that controls playing and pausing a video based on whether or not it is in view.
         *
         * @property scrollingAutoplayWaypoint
         * @type Inview.Waypoint
         * @default null
         */
        scrollingAutoplayWaypoint: null,

        /**
         * Tracks whether a new playlist has been requested, but has not started playback.
         *
         * @property startingNewPlaylist
         * @type boolean
         * @default false
         */
        startingNewPlaylist: false,

        /**
         * A list of timeline ajax requests.
         *
         * @property timelineRequests
         * @type array
         * @default null
         */
        timelineRequests: null,

        /**
         * Whether or not ads should be suppressed.
         *
         * @property suppressAds
         * @type boolean
         * @default false
         */
        suppressAds: false,

        /**
         * UVPJS-generated object containing system/playback properies.
         *
         * @property systemInfoObject
         * @type object
         * @default {}
         */
        systemInfoObject: {},

        /**
         * Name of test group user is in
         *
         * @property testGroup
         * @default null
         */
        testGroup: null,

        /**
         * Name of test user is in
         *
         * @property testName
         * @default null
         */
        testName: null,

        /**
         * Test video url. This can be replaced with uvpjs.b64TestVideo when upgraded to 2.8.0.
         *
         * @property testVideoUrl
         * @default string
         */
        testVideoUrl: "data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",

        /**
         * Whether or not the user has enabled autoplay.
         *
         * @property userAutoplayEnabled
         * @type boolean
         * @default true
         */
        userAutoplayEnabled: true,

        /**
         * Holds the current UVP payload from video events
         *
         * @property uvpPayload
         * @type object
         * @default {}
         */
        uvpPayload: {},

        /**
         * The active video within the current playlist.
         *
         * @property video
         * @type object
         * @default null
         */
        video: null,

        /**
         * The number of videos watched
         *
         * @property video
         * @type int
         * @default 0
         */
        watchedVideoCount: 0,

        /**
         * Tracks whether window has focus or not
         *
         * @property windowHasFocus
         * @type boolean
         * @default true
         */
        windowHasFocus: true,

        /**
         * A list of event handlers for uvp events.  For more information about these events and more, see:
         * http://vtstage.cbsinteractive.com/sites/uvpjs/docs/api/global.html#EventType
         *
         * @property uvpEvents
         * @type object
         * @default an object populated with functions
         */
        uvpEvents: {
            adError: function(data) {
                // Track the error.
                this._trackEvent('logError', 'trackVideoAdError', data);

                // Log what caused the ad to fail.
                if (this.suppressAds) {
                    debug.error('UVPJS encountered a potentially fatal ad creative exception:', data);
                } else {
                    debug.info('Ad failed to load because ads are being suppressed.', data);
                }
            },
            controlMute: function(data) {
                this._trackEvent('trackClick', 'mute', {});
            },
            controlUnmute: function(data) {
                // Set a timer to remove the mobile autoplay unmute overlay.
                if(this.mutedAutoplayTest || this.mutedAutoplayEnabled) {
                    this.$element.find('[data-overlay=mute]').addClass('hide');
                    this.$element.removeClass(this.options.classCaptions + ' ' + this.options.classCaptionsMissing);

                    setTimeout(function() {
                        this.$element.find('[data-overlay=mute]').removeClass('visible');
                    }.bind(this), 2000);
                }

                // Only mute one time
                this.mutedAutoplayTest = false;
                this.mutedAutoplayEnabled = false;

                this._trackEvent('trackClick', 'unmute', {});
            },
            firstGesture: function(data) {

                if (this.haveFirstGesture) {
                    return;
                } else {
                    this.haveFirstGesture = true;
                }

                var self = this;
                var videoElement = this.$element.find('#content_' + this.id + " video")[0];

                // If playlist has been paused
                if (this.playlistPaused && videoElement) {
                    // Temp video data url. Can use uvpjs.b64TestVideo when upgraded to 2.8.0.
                    videoElement.src = self.testVideoUrl;
                    var p = videoElement.play();

                    if (p) { // we got a Promise
                        p.then(function() {
                            debug.log("Promise fulfilled...");
                            if (self.player.getPlayerMuted()) {
                                self.unmute();
                            }
                            self._resumePlaylist();
                        }).catch(function(e) {
                            debug.error("Promise not met...", e);
                        });
                    } else {
                        debug.log("no Promise");
                    }
                } else {
                    if (self.player.getPlayerMuted()) {
                        self.unmute();
                        self.$element.removeClass(self.options.classCaptions + ' ' + self.options.classCaptionsMissing);
                    }
                }
            },
            onAdBlocked: function(data) {
                // Track the blocked ad.
                this._trackEvent('logError', 'trackVideoAdBlocked', data);

                // Log what caused the ad to fail.
                if(this.suppressAds) {
                    debug.error('UVPJS encountered a potentially fatal ad creative blockage:', data);
                } else {
                    debug.info('Ad failed to load because ads are being suppressed.', data);
                }
            },
            onAdEnd: function(data) {

                this.isAd = false;

                // Track the performance event.
                this._trackPerformanceEvent('adend');
            },
            onAdPodStart: function(data) {
                // Remember when the ad pod started for comparison later.
                this.adPodStartTimestamp = Date.now();

                // Mute ad if in AB test
                if (this.mutedAutoplayTest) {
                    this.$element.find('[data-overlay=mute]').addClass('visible').addClass('muted');
                    this.mute();
                }
            },
            onAdStart: function(data) {

                this.isAd = true;

                // Notify any other components on the page that need to know about this event.
                if(this.options.eventChannels) {
                    eventMgr.publish(this.options.eventChannels, 'onAdStart');
                }

                setTimeout(function(){
                    // IMA will resize its' container immediately after the onAdStart event. This delayed ad start should account for that.
                    if(this.options.eventChannels) {
                        eventMgr.publish(this.options.eventChannels, 'onDelayedAdStart');
                    }
                }.bind(this), 250);

                // Track the performance event.
                this._trackPerformanceEvent('adstart');

                // Get the time it took to fetch the IMA creative.
                var adReqTime = Date.now() - this.adPodStartTimestamp;

                if (adReqTime < 1001) {
                    adReqTime = '0 - 1000 ms';
                } else if (adReqTime < 1501) {
                    adReqTime = '1001 - 1500 ms';
                } else if (adReqTime < 2001) {
                    adReqTime = '1501 - 2000 ms';
                } else if (adReqTime < 2501) {
                    adReqTime = '2001 - 2500 ms';
                } else if (adReqTime < 3001) {
                    adReqTime = '2501 - 3000 ms';
                } else {
                    adReqTime = '3001 and more';
                }

                // Track the ad start.
//                this._trackEvent('trackClick', 'trackVideoAdTimer', data, {
//                    videoSegments: '0:A:PRE:0:1',
//                    _fetchAdsTimer: adReqTime
//                });


                // Reset aspect ratio
                this._setAspectRatio(true);

            },
            onCaptionsReady: function(data) {
                // Enable captions button
                var $captionsButton = this.$element.find('[data-control=captions]');
                $captionsButton.removeClass(this.options.classDisabled);
            },
            onCaptionsUnavailable: function(data) {
                // Throw a warning about the missing captions.
                debug.warn('Unable to fetch captions.');

                // Track the missing captions.
                this._trackEvent('logError', 'trackVideoCaptionsUnavailable', data);
            },
            onContentEnd: function(data) {
                // Track the video end.
                this._trackPerformanceEvent('contentend');

                // Count video as watched
                this.watchedVideoCount++;

                // Reset the video chapters.
                this.$element.find('.chapters').empty();

                // Reset state of captions button. Will be enabled with onCaptionsReady event.
                var $captionsButton = this.$element.find('[data-control=captions]');
                $captionsButton.addClass(this.options.classDisabled);

            },
            onContentStart: function(data) {
                var self = this;

                // Notify any other components on the page that need to know about this event.
                if(this.options.eventChannels) {
                    eventMgr.publish(this.options.eventChannels, 'onContentStart');
                }

                // Set/reset time stamp
                this.contentStartTimeStamp = new Date().getTime();

                // Track the video start.
                this._trackPerformanceEvent('contentstart');

                // Mute video if in AB test
                if (this.mutedAutoplayTest) {
                    this.$element.find('[data-overlay=mute]').addClass('visible').addClass('muted');
                    this.mute();
                }

                // Turn on mobile player captions if muted.
                if(this.player.getPlayerMuted() && this.mutedAutoplayEnabled && device.isMobile()) {
                    if (this.video.closedCaptionPath) {
                        setTimeout(function() {
                            try {
                                this.player.showCaptions();
                            } catch(error) {
                                debug.log('UVP had trouble showing captions.', error);
                            }
                            this.$element.addClass(this.options.classCaptions).removeClass(this.options.classCaptionsMissing);
                        }.bind(this), 500);
                    } else {
                        this.$element.addClass(this.options.classCaptionsMissing).removeClass(this.options.classCaptions);
                    }
                }

                // Create chapter dots
                this._showChapterStarts();

                // Set aspect ratio
                this._setAspectRatio();

            },
            onResourceEnd: function(data) {

                if (this.testName === "video_recs" && this.testGroup === "iris") {
                    this.$element.addClass('irisTransition');
                }

                if (!this.windowHasFocus && (this.watchedVideoCount % this.blurredVideoCountThreshold === 0) && !this.player.getPlayerMuted()) {
                    // Check if window has focus
                    debug.log("onResourceEnd: paused out of focus playlist after " + this.blurredVideoCountThreshold + " videos");
                    this._pausePlaylist();
                } else if (this.mutedAutoplayEnabled && this.player.getPlayerMuted() && !this.haveFirstGesture) {
                    // Pause playback if the player is autoplaying muted, and has reached threshold
                    if (this.watchedVideoCount === this.options.mutedVideoCountThreshold) {
                        this._pausePlaylist();
                    }

                } else if(data.payload.playlistLength === 0 && this.options.loop && !this.startingNewPlaylist) {
                    // Start the playlist over again if this is the last video, looping is enabled, and a new playlist has not been requested
                    // Verify that content matches last video in playlist. 'playlistLength' can incorrectly be 0 when destroyPlaylist() is called.
                    var lastItem = this.playlist[this.playlist.length - 1];
                    if (data.payload.rco && data.payload.rco.cmsRefGuid === lastItem.id) {
                        this.playlist = this.options.playlist;
                        this._setPlaylist(this.playlist);
                    }
                }

            },
            onResourceStart: function(data) {

                if (this.testName === "video_recs" && this.testGroup === "iris") {
                    this.$element.removeClass('irisTransition');
                }

                var self = this;
                self.uvpPayload = data.payload;

                // Reset flag
                this.startingNewPlaylist = false;

                // Store the current video.
                this.video = this._getVideoFromPlaylist(data.payload.rco.index) || data.payload.rco;

                // Fetch playlist, if necessary
                if (this.options.getRelatedPlaylist) {
                    this._getRelatedPlaylist();
                }

                // Set heartbeat data.
                this._setPageContextMetadata();

                // Show unmute button is playback is muted
                if (this.player.getPlayerMuted()) {
                    this.$element.find('[data-overlay=mute]').addClass('visible').addClass('muted');
                }

                // Store the video's chapter data for easy access.
                this.chapters = {};

                if(this.video.chapters && this.video.chapters.data) {
                    for (var i = 0; i < this.video.chapters.data.length; i++) {
                        this.chapters['time' + this.video.chapters.data[i].time] = $.extend(true, {
                            hasSeen: false
                        }, this.video.chapters.data[i]);
                    }
                }

                // If this is an "AutoPlay Everywhere" playlist, add the video to the list of recently watched videos.
                if(this.options.apeList) {
                    var apeList = cookie.read("apeList");
                    var watchedIds = apeList ? apeList.split(',') : [];

                    if(watchedIds.indexOf(this.video.id) < 0) {
                        watchedIds.unshift(this.video.id);
                        cookie.write('apeList', watchedIds.slice(0, 10), {
                            expires: 1
                        });
                    }
                }

                // Update displayed video info
                this._showVideoInfo();

                // Add close button to player
                this._showCloseButton();

                // Update history
                if (this.options.enableHistoryUpdates) {
                    this.updateHistory();

                    // Update document title
                    if (document.title.indexOf(this.video.title) === -1 && this.options.titleTagPostText !== '') {
                        document.title = this.video.title + this.options.titleTagPostText;
                    }
                }

            },
            onStateChange: function(data) {

                this.contentVideoState = (data.payload.isAd) ? -2 : data.payload.newState;

                switch (data.payload.newState) {
                    case 0:
                        // Stop
                        debug.info('onStateChange: stop');
                        this.isPlaying = false;
                        this.$element.removeClass(this.options.classPlaying);
                        this._setEmbeddedVideoState(false);
                        break;
                    case 1:
                        // Play
                        debug.info('onStateChange: play');
                        this.isPlaying = true;
                        this.$element.addClass(this.options.classPlaying);
                        this.$element.addClass(this.options.classPlaybackStarted);
                        this._setEmbeddedVideoState(true);
                        if (this.closePlayerRequested) {
                            this.pause();
                            this._closePlayerComplete();
                        }

                        // Pause playback if player is not displayed
                        if (this.$element.css('display') === "none") {
                            this.pause();
                        }

                        // Notify any other components on the page that need to know about this event.
                        if(this.options.eventChannels) {
                            eventMgr.publish(this.options.eventChannels, 'playVideo');
                        }

                        break;
                    case 2:
                        // Pause
                        debug.info('onStateChange: pause');
                        if (this.closePlayerRequested) {
                            this._closePlayerComplete();
                        }
                        this.isPlaying = false;
                        this.$element.removeClass(this.options.classPlaying);
                        this._setEmbeddedVideoState(false);
                        break;
                }
            },
            onVideoProgress: function(data) {
                var self = this;

                // If content is playing, fire any chapter marker events that have occurred.
                if(!data.payload.isAd) {

                    self.uvpPayload = data.payload;

                    var currentTime = data.payload.currentTime;
                    var duration = data.payload.duration;

                    var timeKey = 'time' + Math.round(currentTime);

                    if (this.chapters[timeKey] && !this.chapters[timeKey].hasSeen) {

                        // Indicate that the user has seen the chapter.
                        this.chapters[timeKey].hasSeen = true;

                        // Highlight chapter
                        var $chapter = this.$element.find('#' + timeKey);
                        $chapter.addClass('highlight');
                        setTimeout(function() {
                            $chapter.removeClass('highlight');
                        }.bind(this), 3000);

                        // Echo the event for other components that might need to react to it.
                        this.$element.trigger('timelineEvent', this.chapters[timeKey]);
                    }

                    // Show up next
                    var $vidTitle = self.$element.siblings('[data-video-info=upnext]');
                    if (Math.floor(duration - currentTime) <= 30 && $vidTitle.hasClass(self.options.classHidden) && device.isDesktopUserAgent()) {
                        var next = this._getNextVideo(this.video.id);
                        if (next.title && this.playlist.length > 1) {
                            $vidTitle.html("<div><b>" + translations.upnext + ":</b> " + next.title + "</div>");
                            $vidTitle.off('click.' + namespace); // remove any previously-set handlers
                            $vidTitle.on('click.' + namespace, function(event) {
                                $(this).addClass(self.options.classHidden);
                                self._trackEvent('trackClick', 'video-nudge-click', event);
                                if (self.testName === "video_recs" && self.testGroup === "iris" && window.IrisEngine) {
                                    window.IrisEngine.emit("SKIP_FORWARD");
                                }
                                self.player.advancePlayList();
                            });
                            setTimeout(function(){
                                $vidTitle.removeClass(self.options.classHidden);
                                $vidTitle.dotdotdot({watch:"window"});
                                $vidTitle.css('background-image', 'url(' + next.thumbnail + ')');
                            }, 100);
                        }
                    }
                }
            },
            playerStartError: function(data) {
                // Throw an error about the player failing to start.
                debug.error('UVPJS encountered a fatal exception starting the player: ', data);

                // Track the error.
                this._trackEvent('logError', 'trackPlayerStartError', data);
            },
            videoPlaybackError: function(data) {
                // Throw an error about the video failing to play.
                debug.error('UVPJS encountered a fatal exception while playing the video: ', data);

                // Check error type
                if (data.payload && data.payload.errorInfo) {
                    var errorMsg = data.payload.errorInfo.message || "";
                    if (errorMsg.indexOf(this.errorDetails['MANIFEST_INCOMPATIBLE_CODECS_ERROR']) > -1) {
                        // Halt playback, nothing more can be done if codec is not supported.
                        $('[data-video-info]').empty();
                        this.player.destroyPlaylist();
                    }
                }

                // Track the error.
                this._trackEvent('logError', 'trackVideoPlaybackError', data);
            },
            videoStartError: function(data) {
                // If the IMA plugin failed, disable ads until the next page hard load; otherwise, just log the error.
                if (data && data.payload && data.payload.errorInfo && 1001 === data.payload.errorInfo.errorCode && !this.suppressAds) {
                    // Throw a warning about the IMA plugin failing to load.
                    debug.warn('IMA failed to load; attempting to play video without ads due to UVPJS exception:', data);

                    // Track the error.
                    this._trackEvent('logError', 'trackVideoStartImaError', data);
                } else {
                    // Throw an error about the video failing to start.
                    debug.error('UVPJS encountered a fatal error starting the video: ', data);

                    // Track the error.
                    this._trackEvent('logError', 'trackVideoStartError', data);
                }
            }
        },

        /**
         * Initialize the video player.
         *
         * @private
         * @method _create
         */
        _create: function() {
            var self = this;

            globalFunctions.gdprConsentCallback("video_player", function() {
                require([
                    'comscore-video',
                    'optional!' + (!window.CnetPageVars.services.googleima || !window.CnetPageVars.services.googleima.enabled ? 'feature-disabled' : 'google-ima')
                ], function() {
                    self._setup();

                    // Check if device can play any supported video type
                    var mc = window.uvpjs.mediaCapabilities;
                    if (!(mc.canPlayType('video/mp4') || mc.canPlayNativeHLS() || mc.canPlayHLSJS())) {
                        debug.error('This device is unable to play supported video types.');
                        // Disable cannotPlay message until we figure out how to keep it out of Google search results. CNETDEV-20761
                        //self.$element.html('<div class="cannotPlay">' + translations.cannotPlay + '</div>');
                        self.$element.addClass(self.options.classPlaybackStarted);
                        self._showCloseButton();
                        return;
                    }

                    self.testGroup = pageVars.tracking.data.testGroup;
                    self.testName = pageVars.tracking.data.testName;

                    // Subscribe to any events that this instance needs to listen to.
                    if(self.options.eventSubscriptions) {
                        eventMgr.subscribe(self, self.options.eventSubscriptions);
                    }

                    // Keep track of the number of players that have been initialized.
                    playersInitialized++;

                    // Assign a unique id to the player for the sake of uvp.
                    self.id = self.options.idPrefix + playersInitialized;
                    self.$element.attr('id', self.id);

                    // Modify the playlist of videos if it is an "AutoPlay Everywhere" playlist.
                    if (self.options.apeList) {
                        self._setupApeList();
                    }

                    // Disable related playlists in test
                    if (self.testName === "video_recs" && self.testGroup != "control") {
                        self.options.getRelatedPlaylist = false;
                    }

                    // Modify the playlist of videos with video shortcodes if requested
                    if (self.options.getShortcodeVideo) {
                        var shortcodeVideos = [];
                        $(self.options.videoShortcodeSelector).each(function(){
                            shortcodeVideos.push($(this).data('videoPlaylist')[0]);
                        });

                        // Remove shortcode videos from playlist
                        var dedupedPlaylist = [];
                        $.each(self.options.playlist, function(i) {
                            var isUnique = true;
                            $.each(shortcodeVideos, function() {
                               if (self.options.playlist[i].id === this.id) {
                                   isUnique = false;
                               }
                            });
                            if (isUnique) {
                                dedupedPlaylist.push(self.options.playlist[i]);
                            }
                        });

                        // Don't append remaining videos when in recs test. Will be filled by recommendations.
                        if (self.testName === "video_recs" && $.inArray(self.testGroup, ['cnet','iris']) > -1) {
                            self.playlist = self.options.playlist;
                            self.options.playlist = shortcodeVideos;
                        } else {
                            self.options.playlist = shortcodeVideos.concat(dedupedPlaylist);
                        }

                        // Get remaining playlist items
                        if (self.options.getRelatedPlaylist) {
                            self.playlist = self.options.playlist;
                            self._getRelatedPlaylist();
                        }
                    }

                    // Re-index
                    $.each(self.options.playlist, function(i) {
                        self.options.playlist[i].index = i;
                    });

                    // Modify playlist to receive recommendations
                    if ((self.testName === "video_recs" && !self.options.getShortcodeVideo) || self.testGroup === "iris") {
                        self.options.playlist = [self.options.playlist[0]];
                    }

                    // Get external playlist, if requested
                    if (self.options.getPlaylistSelector) {
                        self._getExternalPlaylist();
                    }

                    // Listen for appendPlaylist events
                    $(window).on('appendPlaylist', function(e, payload) {
                        self.appendPlaylist(payload.data);
                    });

                    // Initialize the uvp video manager.
                    videoManager.initialize(self._getUvpConfigs(), function (sysInfo) {
                        self.systemInfoObject = sysInfo;

                        // If using modal, hide player on load
                        if (self.options.showAsModal) {
                            self.$element.addClass(self.options.classHidden);
                        }

                        // Add listener for PLAYER_INIT event to get an early reference to player (in non-autoplay scenarios)
                        videoManager.addEventListener(uvpjs.EventType.PLAYER_INIT + '.' + self.id, function(data) {
                            if (self.id === data.target) {
                                self.player = data.payload.player;

                                // Echo the event for other components that might need to react to it.
                                self.$element.trigger("onVideoPlayerReady", self.video);
                                debug.log("onVideoPlayerReady");

                                // Show video info on preview
                                if (self.options.showPreviewMetadata && self.options.playlist.length > 0) {
                                    self.$element.find('[data-video-info=previewDuration]').html('<svg class=" video"><use aria-hidden="false" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#video"></use></svg>' + self._formatTime(self.options.playlist[0].duration));
                                    self.$element.find('[data-video-info=previewTitle]').text((self.options.playlist[0].title) ? self.options.playlist[0].title : '');
                                    var author = self.options.playlist[0].author;
                                    if (author && author.firstName.length > 0) {
                                        self.$element.find('[data-video-info=previewAuthor]').html('<div><span class="by">' + translations.by + '</span> ' + author.firstName + ' ' + author.lastName + '</div>');
                                    }
                                }

                                $('[data-video-info]').dotdotdot({watch:"window"});
                            }
                        });

                        // Prepare data that is reused across the component.
                        self._setupData();

                        // If using modal, hide player on load
                        if (self.options.showAsModal) {
                            self.$element.addClass(self.options.classHidden);
                        }

                        // Setup buttons outside the player that need to interact with it.
                        self._setupExternalEvents();

                        // If enabled, setup autoplay on scroll and delay creating the player until it scrolls into view.
                        if(self.autoplayState === 'scroll') {
                            self._setupScrollingAutoplay();
                        // Otherwise, create the player immediately.
                        } else {
                            if (self.testName === "video_recs" && self.testGroup === "cnet") {
                                self._getRecommendedVideos();
                            } else {
                                self._setupPlayer();
                            }
                        }
                    });

                    // Track the player creation.
                    self._trackPerformanceEvent('cnetvideocreate');
                });
            });
        },

        /**
         * Revert the video player to its pre-initialization state.
         *
         * @private
         * @method _destroy
         */
        _destroy: function() {
            // Revert all dom events by removing them.
            this.$document.off('.' + namespace);
            this.$element.off('.' + namespace);
            this.$element.find('[data-control=autoplay]').off('.' + namespace);
            this.$element.find('[data-control=share]').off('.' + namespace);
            this.$element.find('[data-control=playlist]').off('.' + namespace);

            // Revert the player by destroying it.
            videoManager.destroyVideoPlayer(this.id);

            // Revert html changes by removing anything that was added.
            this.$element.removeAttr('id').html('');
            $('[data-load-video]').removeClass(this.options.classPlaying);
        },

        /**
         * Close the requested overlays.
         *
         * @private
         * @method _closeOverlays
         *
         * @param $overlays {jQuery} The overlay element(s) to close.
         * @param resume {boolean} Whether or not the player should resume playing the current video when the overlay is closed.
         */
        _closeOverlays: function($overlays, resume) {
            // Destroy the overlay close button.
            $overlays.find('[data-item=close]').off('.' + namespace);

            // Clear the overlay content.
            $overlays.removeClass(this.options.classActive).html('');

            // Resume the video if one was playing before the overlay was opened.
            if(resume) {
                this.interrupted = false;
                this.play();
            }
        },

        /**
         * Pause, hide, and close the player.
         *
         * @public
         * @method closePlayer
         */
        closePlayer: function() {
            var playbackState = this.player.getCurrentPlaybackState().playbackState;
            var mc = window.uvpjs.mediaCapabilities;

            // Monitor the close request if not PAUSED
            if (playbackState !== mc.PAUSED) {
                this.closePlayerRequested = true;
                this.mute();
            }

            // Don't try to pause player if in an EMPTY state
            if (playbackState !== mc.EMPTY) {
                this.pause();
            }

            // Mark the container or player as hidden.
            if (this.$element.closest('[data-video-player="container"]').length > 0) {
                this.$element.closest('[data-video-player="container"]').addClass(this.options.classHidden);
            } else {
                this.$element.addClass(this.options.classHidden);
            }


            // Alert any other components on the page that want to know when the player closes. TODO: Add data that identifies the player instance.
            this.$window.trigger('closePlayer');
        },

        /**
         * Reset player state after modal player has closed
         *
         * @private
         * @method _closePlayerComplete
         */
        _closePlayerComplete: function() {
            this.closePlayerRequested = false;
            // Delay unmute to avoid audio pop
            setTimeout(function() {
                this.unmute();
            }.bind(this), 500);
        },

        /**
         * Format seconds as time string (ex. 90 = 01:30)
         *
         * @private
         * @method _formatTime
         */
        _formatTime: function(seconds) {
            seconds = !isNaN(parseInt(seconds)) ? seconds : 0;
            var date = new Date(null);
            date.setSeconds(seconds);
            return date.toISOString().substr(14,5);
        },

        /**
         * Get recommended videos
         *
         * @private
         * @method _getRecommendedVideos
         */
        _getRecommendedVideos: function () {

            var self = this;

            var id = this.options.playlist[0].mpxRefId;
            var url = "/videos/video-recs/" + id + "/xhr/";

            debug.log("video recs request", url);

            $.ajax({
                dataType: 'json',
                type: 'GET',
                url: url
            }).done(function(response) {

                if (response && response.length > 0) {

                    debug.log("video recs response", response);

                    if (self.options.getShortcodeVideo) {

                        $.each(self.options.playlist, function(i) {
                            $.each(response, function(x) {
                                if (self.options.playlist[i].id === this.id) {
                                    response.splice(x,1);
                                }
                            });
                        });
                        self.playlist = self.options.playlist.concat(response);

                    } else {
                        self.playlist = response;
                    }

                    // Re-index playlist
                    $.each(self.playlist, function(i) {
                        self.playlist[i].index = i;
                    });

                    debug.log("video recs new playlist", self.playlist);
                    self.options.playlist = self.playlist;

                    self.$element.on("onVideoPlayerReady", function() {
                        self.$element.find('[data-video-info="title"]').text(self.playlist[0].title);
                    });

                } else {
                    debug.log("video recs - none available", response);

                    self.playlist = self.options.playlist;

                    if (self.options.getShortcodeVideo) {
                        self.options.getRelatedPlaylist = true;
                    }
                }

            }).fail(function(jqXHR, textStatus, errorThrown) {
                debug.log("video recs failed to load", jqXHR, textStatus, errorThrown);
            }).always(function() {
                debug.log("video recs complete");
                self._setupPlayer();
            });

        },

        /**
         * Get Iris recommended videos
         *
         * @private
         * @method _getRecommendedIrisVideos
         */
        _getRecommendedIrisVideos: function(videoRec) {

            var self = this;
            var id = pageVars.tracking.data.articleId;
            var url = "/videos/video-recs/iris/xhr/" + "?ids=" + videoRec.platform_id;
            debug.log("video recs iris request", url);

            $.ajax({
                dataType: 'json',
                type: 'GET',
                url: url
            }).done(function(response) {

                if (response) {

                    self.startingNewPlaylist = true;
                    debug.log("video recs iris response", response);

                    // Set new playlist.  Starts playing new video.
                    self._setPlaylist(response);

                } else {
                    debug.log("video recs iris: none available", response);
                }

            }).fail(function(jqXHR, textStatus, errorThrown) {
                debug.log("video recs failed to load", jqXHR, textStatus, errorThrown);
            }).always(function() {
                debug.log("video recs iris: complete");
                self._setupPlayer();
            });

        },

        /**
         * Build the ad config url used in the video selector request.
         * TODO: This is one of the most complicated parts of this component; it would be nice if we could find a way to simplify it.
         *
         * @private
         * @method _getAdUrl
         *
         * @param video {object} The video to generate the ad config url from.
         * @param index {int} Index of video in playlist
         *
         * @return {string} The ad config url.
         */
        _getAdUrl: function(video, index) {
            var gpt = pageVars.ads.data.gpt;
            var adData = gpt.targeting;
            var baseUrl = 'sz={param:sz}&iu=/8264/{param:region}-cnet/{param:device}/{param:partner}&ciu_szs={param:ciu_szs}&impl=s&gdfp_req=1&env=vp&output={param:output}&unviewed_position_start=1&url={param:referrer_url}&description_url={param:referrer_url}&correlator={param:timestamp}&cmsid=2289&vid={param:mpxRefId}&pp={param:pp}&cust_params=';
            var customParams = 'vid={param:mpxRefId}&ptype={param:ptype}&vguid={param:vguid}&session={param:session}&subses={param:sub_session}&microsite={param:microsite}&campaign={param:campaign}&cid={param:cid}&collection={param:collection}&mfr={param:mfr}&carrier={param:carrier}&section={param:section}&userGroup={param:userGroup}&tag={param:tag}&edition={param:edition}&test={param:test}&score={param:score}&subcollection={param:subcollection}&topic={param:topic}&sectopic={param:sectopic}&pid={param:pid}&pv={param:pv}&akb={param:akb}';
            var regionMapping = {
                au: 'vau',
                uk: 'vuk'
            };
            var isMobile = device.isMobileUserAgent() || device.isIPhone() || device.isIPad();

            // Determine the ad partner based on edition, brand, and device.
            var adPartner = 'cnet';

            if (pageVars.tracking.data.siteEdition === 'es') {
                adPartner = 'es-cnet';
            } else if (pageVars.tracking.data.brand === 'roadshow') {
                adPartner = 'roadshow';
            }

            if (isMobile) {
                adPartner += '_mobile';
            }

            // Build the list of ad config url parameters.
            var params =  {
                sz:             (this.mutedAutoplayEnabled && index === 0) ? "640x483" : "640x480",
                device:         isMobile ? 'mobile_web' : 'desktop',
                partner:        adPartner,
                ciu_szs:        '300x60',
                output:         (device.isDesktopUserAgent()) ? 'xml_vmap1' : 'xml_vast2',
                microsite:      (typeof(adData.microsite) == 'string' ? adData.microsite : ''),
                campaign:       '', // TODO: Unused?
                referrer_url:   location.protocol + '//' + location.host + location.pathname,
                timestamp:      new Date().getTime(),
                ptype:          pageVars.tracking.data.pageType,
                vguid:          pageVars.guid,
                session:        adData.session,
                sub_session:    adData.subses,
                cid:            adData.cid,
                collection:     adData.collection,
                subcollection:  adData.subcollection,
                mfr:            adData.mfr,
                carrier:        adData.carrier,
                section:        adData.section,
                userGroup:      adData.userGroup,
                tag:            adData.tag,
                edition:        adData.edition,
                region:         regionMapping[gpt.region] || 'vaw',
                test:           adData.test,
                score:          adData.score,
                topic:          (adData.topic && adData.topic.constructor === Array) ? adData.topic.join() : adData.topic,
                sectopic:       (adData.sectopic && adData.sectopic.constructor === Array) ? adData.sectopic.join() : adData.sectopic,
                mpxRefId:       video.mpxRefId,
                pp:             'vpaid_js',
                pid:            adData.pid,
                pv:             adData.pv,
                akb:            typeof($.cookie('bm_cnet')) === "string" ? $.cookie('bm_cnet').replace('-',',') : null
            };

            // Set any adTargeting_{key} query string params that are on the url.
            $.each(urlHelper.getAllParams(), function(key, value) {
                var adTargetingMatch = key.match(/adTargeting_(.+)/);
                if (adTargetingMatch && adTargetingMatch[1]) {
                    params[adTargetingMatch[1]] = value;
                } else if (key === 'adNetwork') {
                    params.network = value;
                }
            });

            // Apply the parameters data to the parameters url template, and strip out any unwanted values.
            $.each(params, function(key, value) {
                var re = new RegExp('{param:' + key + '}', 'g');
                var cleanValue = (value && value !== '||') ? value : '';

                baseUrl = baseUrl.replace(re, cleanValue);
                customParams = customParams.replace(re, cleanValue);
            });

            // Build the ad config url.
            return baseUrl + encodeURIComponent(customParams);
        },

        /**
         * Gets a playlist from data-video-playlist element on host page
         *
         * @private
         * @method _getExternalPlaylist
         */
        _getExternalPlaylist: function() {
            var additionalVideos = $(this.options.getPlaylistSelector).data('videoPlaylist');
            if (additionalVideos) {
                this.appendPlaylist(additionalVideos);
            }
        },

        /**
         * Build the media url used in the video selector request.
         *
         * @private
         * @method _getMediaUrl
         *
         * @param video {object} The video to generate the media url from.
         *
         * @returns {string} The media url as an m3u8 file if supported, mp4 otherwise.
         */
        _getMediaUrl: function(video) {
            var mc = window.uvpjs.mediaCapabilities;
            var canPlayHls = !(mc.isAndroid() && parseInt(mc.getOSVersion()) < 7) && (window.MediaSource || window.WebKitMediaSource || mc.canPlayNativeHLS() === true);
            var mediaUrl = video.mp4;

            // Prefer m3u8 over mp4 if possible.
            if (canPlayHls && video.m3u8) {
                // Determine the device type the video should play for; this may not match up with the actual device being used.
                var deviceType = 'ott';

                if (device.isMobileUserAgent() || device.isIPhone()) {
                    deviceType = 'mobile';
                } else if (device.isIPad() || window.uvpjs.mediaCapabilities.isChromeOS()) {
                    deviceType = 'tablet'; // ChromeOS doesn't support the highest-bitrate video files, give it the tablet subset
                }

                // Build the m3u8 url.
                mediaUrl = video.m3u8;
                mediaUrl += mediaUrl.indexOf('?') == -1 ? '?' : '&'; // TODO: Can m3u8 actually have a query string?
                mediaUrl += 'device=' + deviceType;
                mediaUrl += '&change-to-host=cnetmedia-a.akamaihd.net';
            }

            return mediaUrl;
        },

        /**
         * Get the uvp configs for the current playlist of videos.  Ads are disabled for all videos if ads are being
         * suppressed, or ads are disabled on just the first video if mobile autoplay is enabled.
         *
         * @private
         * @method _getPlaylistConfigs
         *
         * @param playlist {Array} The playlist of videos to get configs for.
         * @param suppressFirstAd {boolean} Whether or not the first ad should be suppressed; even if this is set to true, the first ad will only be suppressed if the browser meets muted autoplay criteria on mobile devices. (See mutedAutoplayEnabled)
         *
         * @returns {Array} A list of config objects, one per video in the playlist.
         */
        _getPlaylistConfigs: function(playlist, suppressFirstAd) {

            var self = this;
            var playlistConfigs = {};

            playlistConfigs = playlist.map(function(video, index) {
                return {
                    cmsRefGuid: video.id,
                    duration: video.duration,
                    index: video.index,
                    adCall: '//pubads.g.doubleclick.net/gampad/ads?' + self._getAdUrl(video, index),
                    assetURL: self._getMediaUrl(video),
                    seriesTitle: 'CNET Video',
                    type: self.suppressAds || ((self.mutedAutoplayEnabled && device.isMobile()) && index === 0 && suppressFirstAd) ? window.uvpjs.mediaCapabilities.RP_URL : window.uvpjs.mediaCapabilities.RP_IMA,
                    vidContId: self.id,
                    videoTitle: video.title,
                    closedCaptionPath: video.closedCaptionPath
                };
            });

            debug.log('playlistConfigs', playlistConfigs);
            return playlistConfigs;
        },

        /**
         * Get playlist of videos in the same collection/topic
         *
         * @private
         * @method _getRelatedPlaylist
         */
        _getRelatedPlaylist: function () {
            var self = this;
            var slug = null;

            // Use slug of last video in playlist
            slug = self.playlist[self.playlist.length-1].slug;

            var editionCode = edition.getEdition();
            var url =  (editionCode === 'us' ? '' : '/' + editionCode) + "/videos/related-playlist/" + slug + "/xhr/";

            if (slug) {
                $.ajax({
                    dataType: 'json',
                    type: 'GET',
                    url: url
                }).done(function(response) {

                    if (response && response.length > 0) {

                        self.playlist = self.playlist.concat(response);

                        // Re-index playlist
                        $.each(self.playlist, function(i) {
                            self.playlist[i].index = i;
                        });

                        self.options.playlist = self.playlist;

                        if (self.player && self.userAutoplayEnabled) {
                            self.player.addResourcesToPlaylist(self._getPlaylistConfigs(response, false));
                        }

                        self.options.getRelatedPlaylist = false;

                        debug.log("_getRelatedPlaylist new playlist", self.playlist);
                    }

                }).fail(function(jqXHR, textStatus, errorThrown) {
                    debug.log("_getRelatedPlaylist failed to load", jqXHR, textStatus, errorThrown);
                });
            }

        },


        /**
         * Get the uvp config object.
         *
         * @private
         * @method _getUvpConfigs
         *
         * @returns {object} The config object for uvp.
         */
        _getUvpConfigs: function() {
            var debugUvp = document.location.search.indexOf(namespace) > 0;

            // Get the comscore c4 value based on the current site section.
            var section = pageVars.tracking.data.siteSection;
            var id = $.inArray(section, ['home', 'how_to', 'news', 'reviews', 'videos']) ? section : 'id';
            var c4 = (this.options.config && this.options.config.tracking) ? escape(this.options.config.tracking['comscore_sense_' + id]) : '';

            // Get the nielsen apid value based on the current page type.
            var apids = {
                'news': 'P50B755CF-7443-484D-80EB-15D0499ACEB9',
                'reviews': 'P051D033D-BD8F-4F2B-93B7-A1F9F1402AB1',
                'videos': 'PB2485A3C-22F7-433C-B50B-332EF2270710'
            };
            var apid = apids[pageVars.tracking.data.siteSection] || 'P0EA7CD2E-455C-4925-95F9-FC8A7E69BB99';

            // Generate the uvp config object.
            return {
                allowConcurrentPlayback: false,
                capLevelToPlayerSize: true,
                cms: 'platform',
                controls: [
                    {el: 'PREVIEW_BTN', type: 'buttonContainer', label: 'Start video', children: [
                        {el: 'duration', type: 'previewTitle', name: 'title'},
                        {el: 'title', type: 'previewDuration', name: 'duration'}
                    ]},
                    {el: 'REPLAY_BTN', type: 'button', label: 'Replay video'},
                    {el: 'LARGE_PLAY_BTN', type: 'button', label: 'Large play-pause toggle'},
                    {el: 'CONTROL_BAR', type: 'div', children: [
                        {el: 'title', type: 'videoInfo', videoInfo: 'title'},
                        {el: 'PLAYSTATE_BTN', type: 'svgToggle', label: 'Play pause', svgOn: 'pause', svgOff: 'play'},
                        {el: 'VOLUME_BTN', type: 'svgToggle', label: 'Volume', svgOn: 'speaker-on', svgOff: 'speaker-off'},
                        {el: 'autoplay', type: 'toggle', text: 'Autoplay', textOn: 'On', textOff: 'Off', control: 'autoplay'},
                        {el: 'TIME_CURRENT', type: 'span', text: '00:00'},
                        {el: 'TIME_DURATION', type: 'span', text: (this.options.playlist[0] && this.options.playlist[0].duration) ? this._formatTime(this.options.playlist[0].duration): 0},
                        {el: 'btn-share', type: 'svg', label: 'Share', svg: 'share', control: 'share'},
                        //{el: 'btn-playlist', type: 'svg', label: 'Playlist', svg: 'playlist'},
                        {el: 'CLOSED_CAPTION_BTN', type: 'svg', control: 'captions', label: 'Closed captions', svg: 'captions'},
                        {el: 'SETTINGS_BTN', type: 'button', label: 'Settings'},
                        {el: 'FULLSCREEN_BTN', type: 'svg', label: 'Fullscreen', svg: 'fullscreen'}
                    ]},
                    {el: 'PROGRESS', type: 'div', children: [
                        {el: 'PROGRESS_SLIDER', type: 'range', label: 'Progress', value: 0, step: 0.0001},
                        {el: 'PROGRESS_LOADED', type: 'progress', value: 0, step: 0.0001}
                    ]},
                    {el: 'VOLUME_SLIDER', type: 'range', value: 1, step: 0.05},
                    {el: 'SETTINGS_MENU', type: 'div', children: []},
                    {el: 'overlays', type: 'wrapper', name: 'overlays', children: [
                        {el: 'share', type: 'overlay', name: 'share'},
                        {el: 'mute', type: 'overlay', name: 'mute'}
                        //{el: 'playlist', type: 'overlay', name: 'playlist'}
                    ]}
                ],
                netwk: 'cnet',
                partner: this.options.uvpPartner,
                playsInline: true,
                skin: true,
                customCSS: this.options.customCSS,
                template: {
                    button: '<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',
                    buttonContainer: '<button class="${ o.cls }" aria-label="${ o.label }">${ o.children }</button>\n',
                    div: '<div class="${ o.cls }">${ o.children }</div>\n',
                    menu: '<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',
                    overlay: '<div class="overlay ${ o.name }" data-overlay="${ o.name }"></div>\n',
                    previewDuration: '<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div></div>',
                    previewTitle: '<div class="videoMeta ${ o.name }"><div data-video-info="${ o.type }" class="${ o.type }"></div><div data-video-info="previewAuthor" class="previewAuthor"></div></div>',
                    progress: '<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n',
                    range: '<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }"  aria-label="${ o.label }" />\n',
                    span: '<span class="${ o.cls }">${ o.text }</span>\n',
                    svg: '<button class="${ o.cls }" data-control="${ o.control }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svg }"><use xlink:href="#${ o.svg }"/></svg></button>\n',
                    svgToggle: '<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }"><svg class="${ o.svgOn }"><use xlink:href="#${ o.svgOn }"/></svg><svg class="${ o.svgOff }"><use xlink:href="#${ o.svgOff }"/></svg></button>\n',
                    toggle: '<span class="${ o.cls }" data-control="${ o.control }">${ o.text }<button class="on" aria-label="${ o.text } ${ o.textOff }">${ o.textOn }</button><button class="off" aria-label="${ o.text } ${ o.textOn }">${ o.textOff }</button></span>\n',
                    videoInfo: '<span class="${ o.cls }" data-video-info="${ o.videoInfo }">' + ((this.options.playlist.length > 0 && this.options.playlist[0].title) ? this.options.playlist[0].title : '') + '</span>\n',
                    wrapper: '<div class="${ o.name }">${ o.children }</div>\n'
                },
                usesIMA: true,
                uvpc: {
                    modules: [
                        {
                            name: 'UVPJSDebug',
                            category: 'internal',
                            enabled: debugUvp,
                            params: [{
                                name: 'showAll',
                                value: true
                            }]
                        },
                        {
                            name: 'ComScore_ss',
                            category: 'tracking',
                            enabled: true,
                            params: [
                                {
                                    name: 'partnerID',
                                    value: 'cnet'
                                },
                                {
                                    name: 'c1',
                                    value: '19'
                                },
                                {
                                    name: 'c2',
                                    value: '3005086'
                                },
                                {
                                    name: 'publishersSecret',
                                    value: '2cb08ca4d095dd734a374dff8422c2e5'
                                },
                                {
                                    name: 'c3',
                                    value: ''
                                },
                                {
                                    name: 'c4',
                                    value: c4
                                }
                            ]
                        },
                        {
                            "category": "qos",
                            "enabled": true,
                            "name": "MuxQOSPluginJS",
                            "params": [
                                {
                                    "name": "propertyKey",
                                    "value": (pageVars.environment === 'prod') ? 'f13b9be8b7851594e8da77ea2' : '930577dfc824ba10a4d593063'
                                },
                                {
                                    name: "experimentName",
                                    value: pageVars.ads.data.gpt.targeting.test === "||" ? '' : pageVars.ads.data.gpt.targeting.test
                                }
                            ]
                        },
                        {
                            name: 'SiteCatalyst',
                            category: 'qos',
                            enabled: true,
                            params: [
                                {
                                    name: 'account',
                                    value: ''
                                },
                                {
                                    name: 'brand',
                                    value: 'cnet'
                                },
                                {
                                    name: 'edition',
                                    value: 'us'
                                },
                                {
                                    name: 'charSet',
                                    value: 'UTF-8'
                                },
                                {
                                    name: 'currencyCode',
                                    value: 'USD'
                                },
                                {
                                    name: 'visitorNamespace',
                                    value: 'cbsinteractive'
                                },
                                {
                                    name: 'TrackLiveStreams',
                                    value: 'y'
                                },
                                {
                                    name: 'trackingServer',
                                    value: 'saa.cbsi.com'
                                },
                                {
                                    name: 'heartbeatTrackingServer',
                                    value: 'cbsinteractive.hb.omtrdc.net'
                                },
                                {
                                    name: 'heartbeatAdobePublisherId',
                                    value: '10D31225525FF5790A490D4D@AdobeOrg'
                                },
                                {
                                    name: 'heartbeatVisitorMarketingCloudOrgId',
                                    value: '10D31225525FF5790A490D4D@AdobeOrg'
                                }
                            ]
                        },
                        {
                            category: 'tracking',
                            name: 'NielsenTracking_SDK',
                            enabled: true,
                            params: [
                                {
                                    name: 'apid',
                                    value: apid
                                },
                                {
                                    name: 'clientid',
                                    value: 'us-200330'
                                },
                                {
                                    name: 'sfcode',
                                    value: (pageVars.environment === 'prod') ? 'us' : 'dcr-cert'
                                },
                                {
                                    name: 'vcid',
                                    value: 'c07'
                                },
                                {
                                    name: 'channelInfo',
                                    value: ''
                                },
                                {
                                    name: 'iag_sid',
                                    value: '1000011'
                                },
                                {
                                    name: 'iag_tfid',
                                    value: '902'
                                },
                                {
                                    name: 'channelName',
                                    value: 'cbs'
                                },
                                {
                                    name: 'segB',
                                    value: 'CNET.com'
                                },
                                {
                                    name: 'nol_devDebug',
                                    value: debugUvp ? 'console' : ''
                                }
                            ]
                        }
                    ]
                }
            };
        },

        /**
         * Get next video in playlist
         *
         * @private
         * @method _getNextVideo
         *
         * @param id {string} The id of the current video.
         *
         * @return {object} The video object matching the id or null if none was found.
         */
        _getNextVideo: function(id) {
            var self = this, next = {};
            $.each(this.playlist, function(index) {
                if (id === this.id) {
                    next = self.playlist[index+1] || self.playlist[0];
                    return false;
                }
            });

            return next;

        },

        /**
         * Get current video and player data
         *
         * @private
         * @method getVideo
         *
         * @return {object} The video object matching the id or null if none was found.
         */
        getVideo: function() {

            if (!(this.video && this.video.id)) {
                return null;
            }

            // Set autoplay type needed for Chartbeat
            var autoplayType = "MANUAL";
            if ((this.autoplayState === 'load' || (this.autoplayState === 'first' && this.$element.is($('[data-component*=' + namespace + ']').first()))) && this.userAutoplayEnabled) {
                if (this.playlist.length > 1 || this.options.getRelatedPlaylist) {
                    autoplayType = "CONTINUOUS";
                } else if (this.autoplayState) {
                    autoplayType = "AUTOPLAY";
                }
            }

            // Set videostate needed for Chartbeat
            var videoState;
            switch (this.contentVideoState) {
                case -2:
                    videoState = "UNPLAYED";
                    break;
                case -1:
                case 1:
                case 2:
                    videoState = "PLAYED";
                    break;
                case 0:
                    videoState = "STOPPED";
                    break;
                default:
                    videoState = "COMPLETED";
                    break;
            }

            return $.extend(true, {}, this.video,
                {
                    'apeList': this.options.apeList,
                    'autoplayType': autoplayType,
                    'currentPlaybackState': this.player.getCurrentPlaybackState(),
                    'contentStartTimeStamp': this.contentStartTimeStamp,
                    'mediaUrl': this._getMediaUrl(this.video).split("?")[0],
                    'videoState': videoState
                }
            )
        },

        /**
         * Get a video from the playlist by its id.
         *
         * @private
         * @method _getVideoFromPlaylist
         *
         * @param index {string} The index of the video to find.
         *
         * @return {object} The video object matching the id or null if none was found.
         */
        _getVideoFromPlaylist: function(index) {
            // Get all videos from the playlist that match the id (there should only be one).
            var matchingVideos = this.playlist.filter(function(video) {
                return video.index === index;
            });

            // Return the first matching video and assume the rest are duplicates.
            return matchingVideos[0] || null;
        },

        /**
         * Determines if page is a filtered show page by testing if hash matches element on page. Used to disable autoplay.
         *
         * @private
         * @method _isFilteredShowPage
         *
         * @return {boolean}
         */
        _isFilteredShowPage: function() {
            try {
                var $element = $(window.location.hash);
                return $element.length === 1;
            } catch(error) {
                return false;
            }
        },

        /**
         * Initialize Iris
         *
         * @private
         * @method _initializeIrisService
         */
        _initializeIrisService: function() {
            var self = this;
            debug.log('iris: initialize');

            require(['iris'], function () {

                var irisOptions = {
                    settings: {
                        number: 9,
                        platform: "cbsuvp",
                        client_token: 'RUGGU41MBLBDXN4',
                        ssl: true, // optional (determines whether to make API calls, load assets, etc. over http or https,
                        player_id: 'video_' + self.id,
                        platform_id: self.options.playlist[0].mpxRefId
                    },
                    debug: document.location.search.indexOf(namespace) > 0, // for development only. Logs additional information in the JS console.
                    global: 'iris' // optional. Sets a global var accessible through the JS console.
                }

                var currentTime = function(id){
                    var time = null;
                    var state = self.player.getCurrentPlaybackState();
                    if (state.playbackStarted && state.playbackState === 1 && !self.isAdPlaying()) {
                        time = state.currentTime;
                    }
                    return time;
                }

                var currentDuration = function(id) {
                    var duration = null;
                    var state = self.player.getCurrentPlaybackState();
                    if (state.playbackStarted && state.playbackState === 1 && !self.isAdPlaying()) {
                        duration = state.duration;
                    }
                    return duration;
                }

                var play = function(videoObject) {
                    debug.log('iris: play', videoObject);
                    self._getRecommendedIrisVideos(videoObject);
                }

                window.IrisEngine = initializeIrisPlugin(irisOptions);
                window.IrisEngine.registerFunction("currentTime", currentTime);
                window.IrisEngine.registerFunction("currentDuration", currentDuration);
                window.IrisEngine.registerFunction("play", play);

                debug.log('iris: complete', window.IrisEngine);

            });
        },


        /**
         * Used to determine if player is in an ad break
         *
         * @public
         * @method isAdPlaying
         */
        isAdPlaying: function() {
            return this.isAd;
        },

        /**
         * Load a chapter.
         *
         * @private
         * @method _loadChapter
         *
         * @param chapter {object} The chapter data to load and display in the progress bar.
         */
        _loadChapter: function(chapter) {
            var self = this;

            // Prepare the timeline ajax request list.
            this.timelineRequests = this.timelineRequests || [];

            // Fetch the chapter html and inject it into the marker.
            if (chapter.slug) {
                this.timelineRequests.push($.ajax({
                    dataType: 'html',
                    type: "POST",
                    url: '/videos/video-timeline/' + chapter.slug + '/',
                    data: {
                        id: chapter.objectId,
                        image: (chapter.image) ? chapter.image : null,
                        link: chapter.link,
                        rating: (chapter.metaData && chapter.metaData.starRating) ? chapter.metaData.starRating : null,
                        slug: chapter.slug,
                        text: chapter.text,
                        title: chapter.title,
                        typeLabel: chapter.typeLabel,
                        typeName: chapter.typeName
                    },
                    success: function (result) {

                        // Get the html for the chapter.
                        var chapterPosition = (chapter.time * 100) / self.video.duration;
                        var $chapter = $('<div class="chapterDot" style="left:' + chapterPosition + '%" id="time' + (chapter.time) + '"></div>');
                        var $result = $(result);

                        // Pause the player when the user clicks out to the related timeline page.
                        $result.on('click', function (event) {
                            self.pause();
                        });

                        // Inject the chapter html into the progress bar.
                        $chapter.append($result);
                        self.$element.find('.chapters').append($chapter);
                    }
                }));
            }
        },

        /**
         * Mute the video player.
         *
         * @public
         * @method mute
         */
        mute: function() {
            if(this.player) {
                this.player.mute();
            }
        },

        /**
         * Open the requested overlay, and close any others that may already be open.
         *
         * @private
         * @method _openOverlay
         *
         * @param $overlay {jQuery} The overlay element to open.
         * @param content {string} The html content to place inside the overlay element.
         */
        _openOverlay: function($overlay, content) {
            var self = this;

            // Pause the video if one is playing.
            if(this.isPlaying) {
                this.pause();
                this.interrupted = true;
            }

            // Close any overlays that may already be open.
            this._closeOverlays(this.$element.find('[data-overlay]'), false);

            // Set the overlay content.
            $overlay.addClass(this.options.classActive).html(content);
            components.process($overlay);

            // Initialize the overlay close button.
            $overlay.find('[data-item=close]').on('click.' + namespace, function(event) {
                self._closeOverlays($overlay, self.interrupted);
            });
        },

        /**
         * Pause the video player.
         *
         * @public
         * @method pause
         */
        pause: function() {
            if(this.player) {
                this.player.pauseVideo();
            }
        },

        /**
         * Pause the playlist.
         *
         * @private
         * @method _pausePlaylist
         */
        _pausePlaylist: function() {
            this.player.pausePlaylist();
            this.playlistPaused = true;

            // Put controls into paused state
            this.$element.find('[data-overlay=mute]').removeClass('visible');
            this.$element.find('.uvpjs__controlbar').css('pointer-events', 'none');
            if (device.isDesktop()) {

                if (!this.haveFirstGesture) {
                    // Override play button to resume playlist via firstGesture
                    this.$element.find('button.uvpjs__btn-large-play').addClass(this.options.classDisabled);
                    this.$element.find('.uvpjs__controls').addClass(this.options.classActive);
                } else {
                    var self = this;
                    this.$element.find('button.uvpjs__btn-large-play').one('click', function(event) {
                        event.stopPropagation();
                        self._resumePlaylist();
                    });
                }
            }
            try {
                this.$element.find('button.uvpjs__btn-large-play').css('background-image', 'url(' + this.playlist[this.watchedVideoCount].image.path + ')');
                this.$element.find('[data-video-info="title"]').text(this.playlist[this.watchedVideoCount].title);
            } catch(e) {
                // image not available
            }

            // Hide up next
            this.$element.siblings('[data-video-info=upnext]').addClass(this.options.classHidden);

        },

        /**
         * Play the video player.
         *
         * @public
         * @method play
         */
        play: function() {
            if(this.player) {
                this.player.playVideo();
            } else {
                this.$element.find('.uvpjs__btn-preview').trigger('click');
            }
        },

        /**
         * Used to play a video from elsewhere on the page
         *
         * @public
         * @method playVideoClip
         *
         * @param playlist
         */
        playVideoClip:function(playlist, e) {
            if (playlist) {
                if (e && e.type && e.type === window.uvpjs.EventType.RESOURCE_END && this.playlist.length > 1) {
                    // If playVideoClip called as a result of an onResourceEnd event, just continue playlist (if available). Primary use case is video door.
                    this.play();
                } else {
                    this.unmute();
                    this._setPlaylist(playlist);
                }
            }
        },

        /**
         * Wrapper for all uvp events.  Extra tasks include:
         * 1. Log the event.
         * 2. Ensure the event was meant for this player rather than another one.
         * 3. Echo the event off of the component element so other components can react.
         *
         * @private
         * @method _processEvent
         *
         * @param data {object} The event data provided by uvp.
         */
        _processEvent: function(data) {
            // Only proceed if the event was meant for this player.
            if(data && data.target === this.id) {
                var silencedEvents = ['onVideoProgress'];

                // Log the event if it shouldn't be silenced.
                if(silencedEvents.indexOf(data.type) < 0) {
                    debug.log(data.type, data);
                }

                // Forward the event to its respective handler.
                this.uvpEvents[data.type].call(this, data);

                // Echo the event for other components that might need to react to it.
                this.$element.trigger(data.type, this.video);
            }
        },

        /**
         * Resume a paused playlist.
         *
         * @private
         * @method _resumePlaylist
         */
        _resumePlaylist: function() {
            this.player.resumePlaylist();
            this.playlistPaused = false;
            this.$element.find('.uvpjs__controlbar').css('pointer-events', '');
            this.$element.find('button.uvpjs__btn-large-play').css('background-image', '');
            if (device.isDesktop()) {
                this.$element.find('button.uvpjs__btn-large-play').removeClass(this.options.classDisabled);
                this.$element.find('.uvpjs__controls').removeClass(this.options.classActive);
            }

        },

        /**
         * Resize player to match video aspect ratio of vertical content
         *
         * @private
         * @method _setAspectRatio
         *
         * @param reset {boolean} If true, return player to default size
         */
        _setAspectRatio: function(reset) {

            if (this.options.resizePlayer) {

                if (reset === true) {
                    this.$element.css('height', '');
                } else if (this.video.isVertical) {
                    var newHeight = $(window).height() - this.$element.find('.uvpjs__controlbar').height()
                    this.$element.css('height', newHeight + 'px');
                }

            }
        },


        /**
         * Sets classname for embedded shortcode video
         *
         * @private
         * @method _setEmbeddedVideoState
         */
        _setEmbeddedVideoState: function(isPlaying) {
            var self = this;
            $('[data-load-video]').each(function() {
                var playlist = $(this).closest('[data-video-playlist]').data('videoPlaylist');
                var index = $(this).data('loadVideo');
                var showPlaying = false;

                if (playlist && playlist[index] && (playlist[index].id == self.video.id)) {
                    showPlaying = true;
                } else if ($(this).data('videoId') == self.video.id) {
                    showPlaying = true;
                }

                // Add active class on element
                if (showPlaying) {
                    $(this).addClass(self.options.classActive);
                } else {
                    $(this).removeClass(self.options.classActive);
                }

                // Show/hide playing class on element
                if (showPlaying && isPlaying) {
                    $(this).addClass(self.options.classPlaying);
                } else {
                    $(this).removeClass(self.options.classPlaying);
                }
            });
        },

        /**
         * Set/update Heartbeat metadata
         *
         * @private
         * @method _setPageContextMetadata
         */
        _setPageContextMetadata: function() {

            var primaryCollectionId = (this.video.primaryCollection != null) ? this.video.primaryCollection.id : '';
            var datePublished = (this.video.datePublished) ? this.video.datePublished.slice(0,10) : '';

            this.player.setPageContextMetadata(
                $.extend(true, {}, tealium.getHbParams(),
                    {
                        'collectionId': primaryCollectionId,
                        'contentType': this.options.contentType,
                        'a.media.originator': [(this.video.author != null) ? this.video.author.firstName + " " + this.video.author.lastName : null],
                        'a.media.airDate': datePublished
                    }
                )
            );
        },


        /**
         * Replace the current playlist with a new one, and play the new one.  If the previous playlist was playing,
         * it will be stopped.
         *
         * @private
         * @method _setPlaylist
         *
         * @param playlist {Array} The new playlist to replace the previous one.
         */
        _setPlaylist: function(playlist) {
            if(playlist.length > 0) {

                // Set flag that new playlist has been requested
                this.startingNewPlaylist = true;

                // Store the new active playlist.
                this.playlist = playlist;

                // Stop and clear any playlist that is currently playing.
                this.player.destroyPlaylist();

                // Play the new playlist.
                this.player.addResourcesToPlaylist(this._getPlaylistConfigs(playlist, true));

                // Add playing class to element
                this.$element.addClass(this.options.classPlaying);

            } else {
                debug.error('No videos found in the playlist.');
            }
        },

        /**
         * Modify the playlist based on "AutoPlay Everywhere" business logic.  The playlist should be rearranged to
         * begin with a video the user hasn't seen recently, and it should begin with a special curated global video
         * unless the user has already seen it.
         *
         * @private
         */
        _setupApeList: function() {
            // Prepend a special global video to the initial playlist unless the user has already seen it once today.
            if(pageVars.video.prepend && !cookie.read('viewedPrepend')) {
                // Prepend the video.
                this.options.playlist.unshift(pageVars.video.prepend);

                // Indicate that the user has seen it today.
                cookie.write('viewedPrepend', '1', {
                    expires: 1
                });
            }

            // Rearrange the playlist so videos the user has seen recently are moved to the end.
            var apeList = cookie.read('apeList');

            if(apeList) {
                var i = 0;
                var watchedIds = apeList.split(',');

                // Keep pulling videos off the front of the playlist and moving them to the end until an unwatched video is found.
                while(i < this.options.playlist.length && watchedIds.indexOf(this.options.playlist[0].id) >= 0) {
                    this.options.playlist.push(this.options.playlist.shift());
                    i++;
                }
            }
        },


        /**
         * Setup miscellaneous video player data.
         *
         * @private
         * @method _setupData
         */
        _setupData: function() {

            // Set first video
            this.video = (this.options.playlist.length > 0) ? this.options.playlist[0] : {};

            // Determine whether or not ads should be suppressed.
            var adSuppressionString = urlHelper.getParam('adSuppress') || cookie.read('adSuppress') || '';

            this.suppressAds = this.options.suppressAds
                                || adSuppressionString === 'all'
                                || adSuppressionString.split(',').indexOf(namespace) >= 0
                                || (pageVars.services.googleima && !pageVars.services.googleima.enabled);

            // Initialize history manager
            this.history = history.init();

            // Set autoplay state
            if (!(this.systemInfoObject.supportsMutedAutoplay || this.systemInfoObject.supportsUnmutedAutoplay) || (this.video.ratingVChip && this.video.ratingVChip == "TV-MA") || this._isFilteredShowPage()) {
                // Disable autoplay for mature content or unsupported
                this.autoplayState = false;
            } else {
                this.autoplayState = this.options.autoplay;
            }

            // Determine whether or not the user has autoplay enabled.
            this.userAutoplayEnabled = ((urlHelper.getParam('autoplayEnabled') !== 'off') && (clientStorage.read('autoplayEnabled') !== 'off')) || ('disable_wnr' === pageVars.tracking.data.testName & 'test' === pageVars.tracking.data.testGroup);

            // Determine whether or not muted autoplay is allowed.
            this.mutedAutoplayEnabled = ($.inArray(this.autoplayState, ['load', 'scroll']) > -1 || (this.autoplayState === 'first' && this.$element.is($('[data-component*=' + namespace + ']').first())))
                && this.userAutoplayEnabled
                && this.systemInfoObject.supportsMutedAutoplay
                && !this.systemInfoObject.supportsUnmutedAutoplay;

            // Muted autoplay AB test
            this.mutedAutoplayTest = this.userAutoplayEnabled
                && this.testGroup === "bucket_1" && this.testName === "mute_article";

        },

        /**
         * Setup events outside the player.
         *
         * @private
         * @method _setupExternalEvents
         */
        _setupExternalEvents: function() {
            var self = this;


            this.$document.on('click.' + self.id, '[data-load-video]', function(event) {

                event.preventDefault();
                var $button = $(this);
                var idx = $button.data('loadVideo') || 0;
                var $playlist = $button.closest('[data-video-playlist]');
                var playlist = $playlist.data('videoPlaylist');

                // If element has an attached video id, see if we can find it in the current playlist
                if ($button.data('videoId')) {
                    var newIndex = null;
                    $.each(self.options.playlist, function(index, video) {
                        if (video.id === $button.data('videoId')) {
                            newIndex = index;
                            return false;
                        }
                    });
                    if (newIndex != null) {
                        idx = newIndex;
                        playlist = self.options.playlist;
                    }
                }

                // Reorder playlist based on video that was clicked
                var playlistStart = playlist.slice(idx);
                var playlistEnd = playlist.slice(0, idx);
                playlist = playlistStart.concat(playlistEnd);

                var videoId = (playlist && playlist.length > 0) ? playlist[0].id : null;
                var isPlaying = $button.hasClass(self.options.classPlaying);
                var isPlaylistTarget = parseInt(self.id.replace(self.options.idPrefix,'')) === $button.closest('[data-playlist-target]').data('playlistTarget');
                var isShortcode = $(this).is(self.options.videoShortcodeSelector);

                if (self.options.mainPlayer || isPlaylistTarget) {

                    if (self.options.showAsModal) {
                        self.$element.removeClass(self.options.classHidden);
                        self._showCloseButton();
                    }

                    if (!isPlaying) {
                        self.$element.closest('[data-video-player="container"]').removeClass(self.options.classHidden);
                        $(window).trigger('playerShowing');
                        self.unmute();

                        if (playlist && playlist.length > 0 && (!self.video || self.video && self.video.id != videoId)) {

                            if (!self.player.getCurrentPlaybackState().playbackStarted) {
                                // Player has not started yet, call overrideUserGesture()
                                self.options.playlist = playlist;
                                self.player.overrideUserGesture(true);
                            } else {
                                // Start playing new playlist.
                                self._setPlaylist(playlist);
                            }

                        } else {

                            // Play current playlist
                            if (!self.player.getCurrentPlaybackState().playbackStarted) {
                                // Player has not started yet, call overrideUserGesture()
                                self.player.overrideUserGesture(true);
                            } else if (self.player.getCurrentPlaybackState().playbackStarted) {
                                // Player is paused, unpause/play current video
                                self.play();
                            } else {
                                // Test for required user gesture
                                var videoElement = self.$element.find('#content_' + self.id + " video")[0];
                                if (videoElement) {
                                    videoElement.src = self.testVideoUrl;
                                    var p = videoElement.play();

                                    if (p) { // we got a Promise
                                        p.then(function() {
                                            debug.log("Promise fulfilled...");
                                            $('.uvpjs__btn-preview').trigger('click');
                                        }).catch(function(e) {
                                            debug.error("Promise not met...", e);
                                        });
                                    } else {
                                        debug.error("no Promise");
                                    }
                                }
                            }
                        }

                        if ($button.data('scrollToTop')) {
                            $('html, body').animate({
                                scrollTop: self.$element.offset().top
                            }, 1000);
                        }

                        // Mark which playlist started playing.
                        $('[data-load-video]').removeClass(self.options.classActive);
                        $('[data-load-video]').removeClass(self.options.classPlaying);
                        $button.addClass(self.options.classActive);
                        $button.addClass(self.options.classPlaying);


                        // Track play click if video shortcode
                        if (isShortcode) {
                            self._trackEvent('trackClick', 'inbody|videoplay', event);
                        }

                        // Track playlist play click if requested
                        if ($button.data('trackPlaylist')) {
                            self._trackEvent('trackClick', 'playlist_play', event);
                        }

                        // Track playlist play click for ab test redesign if requested
                        if ($button.data('trackPlaylistRedesign')) {
                            self._trackEvent('trackClick', 'video-playlist|playlist-item|'+$button.data('trackPlaylistRedesign'), event);
                        }

                    } else {
                        self.pause();

                        // Track pause click if video shortcode
                        if (isShortcode) {
                            self._trackEvent('trackClick', 'inbody|videopause', event);
                        }

                        // Track playlist play click if requested
                        if ($button.data('trackPlaylist')) {
                            self._trackEvent('trackClick', 'playlist_pause', event);
                        }

                   }


                }
            });

            // Clicks on video tags.  Loads tag playlist and replaces the current playlist.
            this.$document.on('click', '[data-replace-video-playlist]:not([data-active-video-playlist])', function(event) {
                var slug = event.target.getAttribute('data-replace-video-playlist');
                var tagType = event.target.getAttribute('data-video-tag-type');
                var url = self.options.tagTopicPlaylistRoute.replace('replace-me', slug);
                var $tagContainer = $('[data-tag-playlist-container]').first();
                // Pass current video to exclude from playlist request.
                url += '?currentVideo=' + self.video.id;

                self.loader = $.cnet.loading({
                    disabled: false
                });
                self.loader.$element.appendTo($(self.options.loaderSelector));
                self.loader.add();

                self._trackEvent('trackClick', 'video-playlist|' + tagType + '|' + slug, {});

                // If a tag playlist has already been clicked
                if ($tagContainer.hasClass('loaded')) {
                    // Remove loaded classes from previous tag playlist container
                    $tagContainer.removeClass('loaded fullLoad');
                    $tagContainer.addClass('reset');

                    // Remove html from previous tag playlist container
                    setTimeout(function() {
                        $('[data-tag-playlist]').first().empty();
                    }, 500);
                }

                $.ajax({
                    dataType: 'json',
                    type: 'GET',
                    url: url
                }).done(function(response) {
                    if (response && response.template !== undefined && response.playlist !== undefined) {
                        // Store new playlist
                        self.playlist = response.playlist;

                        // Remove loader
                        self.loader.remove();

                        // Set new playlist.  Starts playing new video.
                        self._setPlaylist(self.playlist);

                        // Add the new playlist onto the page
                        $('[data-tag-playlist]').first().append(response.template);

                        // Class for animation.
                        $tagContainer.addClass('loaded');
                        $tagContainer.removeClass('reset');

                        // Remove active class on any tags
                        $('[data-replace-video-playlist]').removeAttr('data-active-video-playlist');

                        // Add attribute to clicked tag.
                        $(event.target).attr('data-active-video-playlist', 'true');

                        // Add class to original playlist after CSS animation
                        setTimeout(function() {
                            $tagContainer.addClass('fullLoad');
                        }, 500);

                        // Enable any components in the container.
                        components.process($tagContainer);
                    }
                });
            });

            // Clicks on active video tags.  Reverts back to initial page playlist.
            this.$document.on('click', '[data-active-video-playlist]', function(event) {
                //var currentPlaylist = self.playlist;
                var $tagContainer = $('[data-tag-playlist-container]').first();

                // Classes for animations
                $tagContainer.removeClass('loaded fullLoad');
                $tagContainer.addClass('reset');

                // Remove active class from click tag
                $(event.target).removeAttr('data-active-video-playlist');

                // Set playlist back to initial.
                self.playlist = self.options.playlist;

                // Set new playlist.  Starts playing new video.
                self._setPlaylist(self.playlist);

                // Remove html from tag playlist container after CSS animation finishes
                setTimeout(function() {
                    $('[data-tag-playlist]').first().empty();
                }, 500);
            });

            if (self.testName === "video_focus" && $.inArray(self.testGroup, ['a','b','c']) > -1) {

                if (self.testGroup === 'a') {
                    self.blurredVideoCountThreshold = 5;
                } else if (self.testGroup === 'b') {
                    self.blurredVideoCountThreshold = 10;
                } else if (self.testGroup === 'c') {
                    self.blurredVideoCountThreshold = 20;
                }

                this.$window.on('blur.' + this.id, function (e) {
                    self.windowHasFocus = false;
                });

                this.$window.on('focus.' + this.id, function (e) {
                    self.windowHasFocus = true;
                    if (self.playlistPaused) {
                        self._resumePlaylist();
                    }
                });

            }

            this.$element.on('onVideoPlayerReady', function() {
                $('body').addClass('videoPlayerReady');
            });

        },

        /**
         * Setup video player events.
         *
         * @private
         * @method _setupInternalEvents
         */
        _setupInternalEvents: function() {
            var self = this;

            // Bind this component to every uvp event handler function.
            $.each(this.uvpEvents, function(eventName) {
                self.player.addEventListener(eventName + '.' + self.id, self._processEvent.bind(self));
            });

            // Setup the autoplay control.
            var $autoplay = this.$element.find('[data-control=autoplay]');

            if(this.userAutoplayEnabled) {
                $autoplay.addClass(this.options.classActive);

                // Look for any video playlist where its first video matches the first autoplaying video.
                $('[data-load-playlist^="[{\"id\":\"' + this.options.playlist[0].id + '"]').addClass(this.options.classPlaying);
            }

            $autoplay.on('click.' + namespace, function(data) {
                // Toggle the autoplay setting.
                self.userAutoplayEnabled = !self.userAutoplayEnabled;

                // Store the setting for later.
                clientStorage.write('autoplayEnabled', self.userAutoplayEnabled ? 'on' : 'off');

                // Update the control state, and pause the video if autoplay was disabled.
                if(self.userAutoplayEnabled) {
                    $autoplay.addClass(self.options.classActive);
                    self._trackEvent('trackClick', 'autoplay|on', data);
                } else {
                    $autoplay.removeClass(self.options.classActive);
                    self.pause();
                    self._trackEvent('trackClick', 'autoplay|off', data);
                }
            });

            // Setup the share control.
            this.$element.find('[data-control=share]').on('click.' + namespace, function(event) {
                var $shareOverlay = self.$element.find('[data-overlay=share]');

                // Reset and hide the overlay if it is already active.
                if($shareOverlay.hasClass(self.options.classActive)) {
                    self._closeOverlays($shareOverlay, self.interrupted);
                    // Otherwise, get the overlay content for the current video and show it.
                } else {
                    var editionCode = edition.getEdition();

                    $.ajax({
                        url: (editionCode === 'us' ? '' : '/' + editionCode) + "/videos/video-share-xhr/" + self.video.slug + "/"
                    }).done(function(response) {
                        self._openOverlay($shareOverlay, response);
                    });
                }
            });

            // Setup player focus-related events so it can be styled differently when the user interacts with something inside it.
            this.$element.on('click.' + namespace, function(event) {
                // Ignore the event if the player is already active.
                if(!self.$element.hasClass(self.options.classActive)) {
                    var focusLossHandler = function (event) {
                        // Remove the active state.
                        self.$element.removeClass(self.options.classActive);

                        // Remove the focus loss listener to optimize page speed.
                        self.$document.off('tap', focusLossHandler);
                    };

                    // Apply the active state.
                    self.$element.addClass(self.options.classActive);

                    // Temporarily add a focus loss listener so the active state can be removed.
                    self.$document.on('tap.' + namespace, focusLossHandler);
                }
            });

            // Create container for timeline tag display
            this.$element.find('.uvpjs__progress').append('<div class="chapters"></div>');


            // Enable history listener if requested
            if (this.options.enableHistoryUpdates) {

                this.history.stateChange(function (state) {

                    // Is new video in current playlist?
                    var index = -1;
                    $.each(this.playlist, function(idx) {
                        if (state.data.id === this.id) {
                            index = idx;
                            return false;
                        }
                    });

                    if (index > -1) {
                        // Reorder playlist with selected first first.
                        var playlistStart = this.playlist.slice(index);
                        var playlistEnd = this.playlist.slice(0, index);
                        this.playlist = playlistStart.concat(playlistEnd);
                    } else {
                        // If video is no longer in playlist, add it to the beginning and play
                        this.playlist = [state.data].concat(this.playlist);
                    }

                    // Play new playlist
                    this._setPlaylist(this.playlist);

                }.bind(this));
            }

            // Set up unmute overlay
            if (this.mutedAutoplayTest || this.mutedAutoplayEnabled) {

                var events = "click";
                // Also add mouseover in tests c, d
                if ($.inArray(this.testGroup, ['c','d']) > -1) {
                    events += " mouseover";
                }

                var $unMute = this.$element.find('[data-overlay=mute]');
                $unMute.html('<div class="speaker-off"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#speaker-on"></use></svg><span class="label">' + translations.playSound + '</span></div>');
                $unMute.one(events, function(event) {
                    $(this).removeClass('muted');
                    self.unmute();
                    self.$element.removeClass(self.options.classCaptions + ' ' + self.options.classCaptionsMissing);
                });

            }

        },

        /**
         * Initialize the video player core.
         *
         * @private
         * @method _setupPlayer
         */
        _setupPlayer: function() {
            var self = this;

            // Ensure the player has not already been initialized.
            if(!this.initialized) {
                // Prevent the player from being initialized more than once.
                this.initialized = true;

                // Show close button if not autoplaying
                if (!(this.autoplayState && this.userAutoplayEnabled)) {
                    this.$element.addClass(this.options.classNoAutoplay);
                    this.$window.trigger(this.options.classNoAutoplay);
                    this._showCloseButton();
                }

                // Initialize the uvp video player.
                videoManager.createVideoPlayer(self.id, function (videoPlayer) {

                    // Store the player instance for future use.
                    self.player = videoPlayer;

                    // Set heartbeat data.
                    self._setPageContextMetadata();

                    self._trackPerformanceEvent('playerloaded');

                    // Attach events to the player.
                    self._setupInternalEvents();

                    // Set the initial playlist; if autoplay on load is enabled, a video will play immediately.
                    self._setPlaylist(self.options.playlist);

                    // Add player to Chartbeat
                    var _cbv = window._cbv || (window._cbv = []);
                    _cbv.push(self.player.DOMMgr.dom.video.el);

                    // Initialize Iris
                    if (self.testName === "video_recs" && self.testGroup === "iris") {
                        self.options.loop = false;
                        self._initializeIrisService();
                    }

                    // Echo the event for other components that might need to react to it.
                    self.$element.trigger("onVideoPlayerReady", self.video);

                }, {
                    enableMutedAutoplay: this.mutedAutoplayEnabled,
                    enableUnmutedAutoplay: ($.inArray(self.autoplayState, ['load', 'scroll']) > -1 || (self.autoplayState === 'first' && self.$element.is($('[data-component*=' + namespace + ']').first()))) && self.userAutoplayEnabled && self.systemInfoObject.supportsUnmutedAutoplay, // If autoplay is requested and supported, enable it regardless of which type was requested.
                    previewImage: (self.options.playlist.length > 0 && self.options.playlist[0].image && self.options.playlist[0].image.path) ? self.options.playlist[0].image.path : ''
                });
            }
        },

        /**
         * Display close button
         *
         * @private
         * @method _showCloseButton
         */
        _showCloseButton: function() {
            if (this.$element.find('[data-item=closeButton]').length == 0) {
                var closeDiv = "<button class='closeButton' data-item='closeButton' aria-label='Close player'><svg class='close'><use xlink:href='#close'></use></svg></button>";
                this.$element.prepend(closeDiv);

                var self = this;
                this.$element.find('[data-item=closeButton]').click(function(event){
                    event.stopPropagation();
                    self.closePlayer();
                    self._trackEvent('trackClick', 'close-scroll-video', event);
                });

            }
        },


        /**
         * Display video info on the page.
         *
         * @private
         * @method _showVideoInfo
         */
        _showVideoInfo: function() {
            var self = this;

            $('[data-video-info]').each(function() {
                // Get the video info type and default text.
                var $videoInfo = $(this);
                var type = $videoInfo.data('videoInfo');
                var text = self.video[type] || '';

                // Get special text for certain info types.
                if(self.watchedVideoCount === 0 && type === 'title' && self.video.primaryCollection && self.video.primaryCollection.id === "0d8f9ac8-61cb-4e36-9263-552d5468e04b") {
                    text = self.video.primaryCollection.title || '';
                } else if(type === 'author' && self.video.author) {
                    text = (self.video.author.firstName || '') + ' ' + (self.video.author.lastName || '');
                } else if(type === 'collection' && self.video.primaryCollection) {
                    text = self.video.primaryCollection.title || '';
                } else if(type === 'upnext') {
                    text = '';
                    $videoInfo.addClass(self.options.classHidden);
                }

                // Display the video info.
                $videoInfo.text(text);

            });

            setTimeout(function() {
                $('[data-video-info]').dotdotdot({watch:"window"});
            }, 100);


        },

        /**
         * Play the active video when the player scrolls into view, and pause it when it scrolls out of view if it is
         * muted.
         *
         * @private
         * @method _setupScrollingAutoplay
         */
        _setupScrollingAutoplay: function() {
            var self = this;

            // Helper function for playing video on scroll.
            var playVideo = function(direction) {
                // Play the video if it's ready.
                if(self.player) {
                    // For normal scrolling autoplay, play the video
                    self.play();
                } else {
                    // Otherwise, create the player so it can begin autoplaying.
                    self._setupPlayer();
                }
            };

            // Helper function for pausing video on scroll.
            var pauseVideo = function(direction) {
                // Pause the video if it's ready and playing and scrolling autoplay is currently enabled.
                if(self.player && self.$element.closest(self.options.selectorScrollingAutoplayDisabled).length === 0) {
                    var playbackState = self.player.getCurrentPlaybackState();

                    if(playbackState.playbackStarted) {
                        self.pause();
                    }
                }
            };

            // Create the waypoint.
            this.scrollingAutoplayWaypoint = new Waypoint.Inview({
                element: this.$element,
                entered: playVideo, // "Entered" is for the initial page load in case the video is only partially visible and the browser pauses it automatically.
                enter: playVideo, // "Enter" is for when the video begins to scroll back into view.
                exited: pauseVideo // "Exited" is for when the video has completely scrolled out of view.
            });
        },

        /**
         * Draws dots on progress bar when chapters are present
         *
         * @private
         * @method _showChapterStarts
         */
        _showChapterStarts: function() {
            // Cancel any in-progress timeline ajax requests.
            if(this.timelineRequests) {
                for (var i = 0; i < this.timelineRequests.length; i++) {
                    this.timelineRequests[i].abort();
                }
            }

            // Reset the video chapters.
            this.$element.find('.chapters').empty();

            // Ensure a video is currently active.
            if (this.video && this.video.chapters) {
                for (var chapter in this.video.chapters.data) {
                    this._loadChapter(this.video.chapters.data[chapter]);
                }
            }
        },


        /**
         * Used to check if browser can autoplay video. TODO: replace this with UVPJS method when upgraded to 2.7.0
         *
         * @public
         * @method supportsAutoplay
         */
        supportsAutoplay: function() {
            var si = this.systemInfoObject;

            return si.supportsUnmutedAutoplay || si.supportsMutedAutoplay;
        },

        /**
         * Fire a video tracking event ping.
         *
         * @private
         * @method _trackEvent
         *
         * @param eventName {string} The name of the event to fire (pev2).
         * @param action {string} The action to track (v46).
         * @param uvpData {object} Event data provided by uvp.
         * @param additionalData {object} Any additional tracking-related data that should be included.
         */
        _trackEvent: function(eventName, action, uvpData, additionalData) {

            // Temporarily disable logError tracking. CNETDEV-17846
            if (eventName === "logError") {
                return;
            }

            // Provide default additional data if none was provided.
            additionalData = additionalData || {};

            // Generate an error code for the event if there is an error.
            var error = '';

            if(uvpData.errorInfo) {
                var internalErrorCode = uvpData.errorInfo.errorCode || 'null';
                var externalErrorCode = uvpData.errorInfo.serverCode || 'null';

                // HLSJS_PLAYBACK_ERROR is a very generic error; extract a more detailed error ID from the message.
                if (3005 === internalErrorCode && 'string' === typeof uvpData.errorInfo.message) {
                    var message = uvpData.errorInfo.message.split(' ');
                    externalErrorCode += '_' + message[message.length - 1];
                }

                // Build the error code.
                error = internalErrorCode + '_' + externalErrorCode;
            }

            // Check if the error is a noisy error.
            var isBufferError = -1 < error.indexOf('3005_null_buffer');
            var isBitrateError = -1 < error.indexOf('3005_null_levelLoad');
            var isErrorSuppressable = isBufferError || isBitrateError;

            // Ensure there is an active video and suppress tracking noisy errors.
            if (!isErrorSuppressable && this.video) {
                // Fire the tracking ping.
                tealium.trackCustomEvent(eventName, $.extend(true, {
                    articleAuthorId:    this.video.author ? [this.video.author.id] : null,
                    articleAuthorName:  this.video.author ? [this.video.author.firstName + ' ' + this.video.author.lastName] : null,
                    articleId:          pageVars.tracking.data.articleId,
                    articleTitle:       pageVars.tracking.data.articleTitle,
                    articleType:        pageVars.tracking.data.articleType,
                    brand:              pageVars.tracking.data.brand,
                    channel:            'video',
                    clickGenericText:   action, // v46
                    collectionId:       this.video.primaryCollection ? [this.video.primaryCollection.id] : null,
                    deviceType:         pageVars.tracking.data.deviceType,
                    error:              error,
                    pageType:           pageVars.tracking.data.pageType,
                    siteEdition:        pageVars.tracking.data.siteEdition,
                    siteHier:           pageVars.tracking.data.siteHier,
                    siteSection:        pageVars.tracking.data.siteSection,
                    siteType:           pageVars.tracking.data.siteType,
                    videoAdIds:         uvpData.adData ? uvpData.adData.adVideoId : null,
                    videoAdTitle:       uvpData.adData ? uvpData.adData.adVideoTitle : null,
                    videoContentType:   'video',
                    videoId:            this.video.id,
                    videoTitle:         this.video.title || this.video.headline,
                    _pageChannelType:   pageVars.tracking.data._pageChannelType,
                    _pageTitle:         pageVars.tracking.data._pageTitle,
                    _pageViewGuid:      pageVars.tracking.data._pageViewGuid
                }, additionalData));
            }
        },

        /**
         * Track a performance-related event in mpulse.
         * TODO: This function has been left largely untouched and might warrant a refactor.
         *
         * @private
         * @method _trackPerformanceEvent
         *
         * @param cval {string} The name of the performance event to track.
         */
        _trackPerformanceEvent: function(cval) {
            // Publicly announce video performance events.
            debug.info('Firing event: cnet_video.' + cval);
            pageVars.video = pageVars.video || {};
            pageVars.video.performance = pageVars.video.performance || {};
            pageVars.video.performance[cval] = true;

            try {
                $(window).trigger('cnet_video.' + cval);
            } catch (e){
                debug.error('Unable to trigger event cnet_video.' + cval);
            }

            try {
                if(performance.getEntriesByName(cval)[0] === undefined) {
                    performance.mark("cnet_video_" + cval);
                }
            } catch (e){
                debug.error('Unable to set performance mark cnet_video_' + cval);
            }

            try {
                var isFirstOccurrence = mpulseUserTiming[cval] === undefined || mpulseUserTiming[cval] === 0;
                var isTargetedPage = ['video_page', 'article', 'product_main'].indexOf(pageVars.tracking.data.pageType) > -1;
                if(isFirstOccurrence && isTargetedPage) {
                    mpulseUserTiming[cval] = performance.now();

                    /*
                     * The following is a mapping to capture deltas between events for mPulse
                     * [ <mPulse variable name> , '<previous event to calculate delta>']
                     *
                     * NOTE: mPulse has a character limit on variable names: 15 total = 9 here + 6 down below
                     *
                     * cnetvideocreate = performance timer from beginning of page life
                     * playerloaded = time between create event and loading of player
                     * showplayoverlay = (non-autoplay) time between loaded player and showing controls
                     * adstart = time it took for an ad to load after player was loaded
                     * adpodstart = time between playerloaded and the IMA plugin receiving the DFP response
                     */
                    var mapPerformanceSoasta = {
                        'cnetvideocreate' : ['create'],
                        'playerloaded'    : ['ploaded', 'cnetvideocreate'],
                        'adstart'         : ['adStart', 'playerloaded'],
                        'showplayoverlay' : ['showoverl', 'playerloaded']
                    };

                    // Get the event timestamp (relative to page load or the previous event)
                    var mpulseTimerValue =  mpulseUserTiming[cval];
                    var mpulseMapping = mapPerformanceSoasta[cval];
                    if($.isArray(mpulseMapping)) {
                        var previousEventTime = mpulseUserTiming[mpulseMapping[1]] || 0;
                        mpulseTimerValue = mpulseUserTiming[cval + '_from_' + mpulseMapping[1]] = mpulseUserTiming[cval] - previousEventTime;
                    }

                    // Send the timer to mpulse based on the above mappings
                    var mpulseVar = $.isArray(mpulseMapping) ? mpulseMapping[0] : '';
                    // don't send timers for adstart or cnetvideocreate - would remove the calls to this function for those
                    // as well but other timers depend on their values being set
                    if(-1 === ([ 'adstart', 'cnetvideocreate' ].indexOf(cval)) && mpulseVar) {
                        mpulseMgr.sendBeacon('video_' + mpulseVar, mpulseTimerValue);
                    }

                    // Cumulative timer that runs until the first video ad starts
                    if ('adstart' === cval) {
                        mpulseMgr.sendBeacon('video_adStart_c', mpulseUserTiming[cval]);
                    }
                }
            } catch (e) {
                debug.error('mpulse error tracking ' + cval + ': ' + e);
            }
        },

        /**
         * Unmute the video player.
         *
         * @public
         * @method unmute
         */
        unmute: function() {
            if(this.player && this.player.getPlayerMuted()) {
                this.player.unMute();
                this.player.hideCaptions();
            }
        },

        /**
         * Update the url of page with current video slug
         *
         * @public
         * @method updateHistory
         */
        updateHistory: function() {
            var isNewPage = document.location.pathname.indexOf(this.video.slug) === -1;
            var editionCode = edition.getEdition();

            if (isNewPage && this.video.slug) {
                this.history.navigate({
                    title:      this.video.title,
                    data:       this.video
                }, {
                    replace:    false,
                    url:        (editionCode === 'us' ? '' : '/' + editionCode) + "/videos/" + this.video.slug + "/" + window.location.search
                });
                $(window).trigger('historystatechange');
            }
        },

        /**
         * Appends additional videos to current playlist
         *
         * @public
         * @method appendPlaylist
         *
         * @param additionalVideos array List of videos to add to playlist
         */
        appendPlaylist: function(additionalVideos) {
            var self = this;
            if(additionalVideos.length > 0) {
                // If playlist is already set, add the additional videos to it.
                if (this.playlist.length > 0) {

                    // Update options playlist so that these new videos don't get removed later when setplaylist is called.
                    this.options.playlist = this.options.playlist.concat(additionalVideos);

                    // Re-index
                    $.each(self.options.playlist, function(i) {
                        self.options.playlist[i].index = i;
                    });

                    // Store the new active playlist.
                    this.playlist = this.options.playlist;


                    // Play the new playlist.
                    if (this.player) {
                        this.player.addResourcesToPlaylist(this._getPlaylistConfigs(additionalVideos));
                    }
                } else {
                    // Playlist not set
                    // Update options playlist so that these new videos don't get removed later when setPlaylist is called.
                    // Or the playlist is not set yet. So update the options playlist, so that when the playlist is created it will have the additional videos.
                    this.options.playlist = this.options.playlist.concat(additionalVideos);

                    // Re-index
                    $.each(self.options.playlist, function(i) {
                        self.options.playlist[i].index = i;
                    });
                }
            } else {
                debug.error('No videos found in the playlist.');
            }

            debug.log('appendPlaylist: new videos', additionalVideos);
            debug.log('appendPlaylist: new playlist', this.options.playlist);

        }



});

});

define('quantum/inviewElement',[
    'jquery',
    'managers/client-storage',
    'version!fly/managers/debug',
    'managers/events',

    'version!fly/components/base',
    'version!libs/waypoints/inview'
], function(
    $,
    clientStorage,
    debug,
    eventMgr
) {
    debug = debug.init('inviewElement');

    /**
     * Give an element classes and trigger events based on its inview state.
     *
     * @class $.cnet.inviewElement
     * @extends $.fly.base
     * @constructor
     *
     * @param [containerAwareClassPrefix=null] {string} The class prefix to apply to some container with the current state so other elements can know what state this inview element is in; use in conjunction with containerAwareSelector.
     * @param [containerAwareSelector=null] {string} The selector for some container to apply this inview element's state to for the benefit of other elements on the page; use in conjunction with containerAwareClassPrefix.
     * @param [contentsClass=''] {string} Classname to use for contentsSelector element
     * @param [contentsSelector=''] {string} Selector for nested element to set contentsClass on.
     * @param [customChildSelector=''] {string} Selector for child custom waypoint logic.
     * @param [customEventPercentage=''] {string} Custom event to trigger waypoint at set percentage.  '.5'
     * @param [events=['enter', 'entered', 'exit', 'exited']] {array} The inview events to listen to; any list passed in must be a subset of the default list.
     * @param [eventChannels=null] {array} A list of channels to publish events to.
     * @param [eventSubscriptions=null] {object} A channel/event/callback mapping as expected by the event manager.
     * @param [exitDirection='both'] {string} The direction to trigger exit events: 'up', 'down', or 'both'.
     * @param [repeat=true] {boolean} Whether the events should trigger repeatedly or only once.
     * @param [setStateOnLoad=false] {boolean} Set state of inview element on page load
     * @param [waypointParentOffsetSelector=''] {string} Parent selector for customEvent offset selector.  Get height of different element other than this.element.
     */
    $.widget('cnet.inviewElement', $.fly.base, {

        // Options
        options: {
            containerAwareClassPrefix: null,
            containerAwareSelector: null,
            contentsClass: null,
            contentsSelector: null,
            customEventPercentage: '',
            events: ['enter', 'entered', 'exit', 'exited'],
            eventChannels: null,
            eventSubscriptions: null,
            exitDirection: 'both',
            repeat: true,
            setStateOnLoad: false,
            waypointParentOffsetSelector: ''
        },

        /**
         * Whether or not this inview element is enabled.
         *
         * @property enabled
         * @type boolean
         * @default true
         */
        enabled: true,

        /**
         * The inview waypoint that updates the state of the element.
         *
         * @property inviewWaypoint
         * @type object
         * @default null
         */
        inviewWaypoint: null,

        /**
         * Initialize the element's inview handler.
         *
         * @private
         * @method _create
         */
        _create: function() {
            this._setup();
            this._setupWaypoints();
            this._setupEvents();
            if (this.options.setStateOnLoad) {
                this._setState();
            }
        },

        /**
         * Revert the inview element to its pre-initialization state.
         *
         * @private
         * @method _destroy
         */
        _destroy: function() {
            // Destroy the inview waypoint handler.
            this.inviewWaypoint.destroy();

            // Remove classes associated with the waypoint events.
            this.$element.removeClass(this.options.events.join(' '));

            // Remove content class
            if (this.options.contentsSelector) {
                this.$element.find(this.options.contentsSelector).removeClass(this.options.contentsClass);
            }

        },

        /**
         * Disable this inview element.
         *
         * @public
         * @method disable
         */
        disable: function() {
            for(var i = 0; i < this.inviewWaypoint.waypoints.length; i++) {
                this.inviewWaypoint.waypoints[i].disable();
            }
            this.$element.removeClass(this.options.events.join(' '));
        },

        /**
         * Enable this inview element while disabling all others on the page.
         *
         * @public
         * @method enable
         */
        enable: function() {
            // Disable all other inview elements on the page.
            $('[data-component*=inviewElement]').not(this.$element).each(function(index, element) {
                try {
                    $(element).inviewElement('disable');
                } catch(e) {
                    debug.log('Inview element not ready to be disabled.', e);
                }
            });

            // Enable this inview element.
            for(var i = 0; i < this.inviewWaypoint.waypoints.length; i++) {
                this.inviewWaypoint.waypoints[i].enable();
            }
        },

        /**
         * Set state of inview element on page load
         *
         * @private
         * @method _setState
         */
        _setState: function() {
            if ((clientStorage.read('autoplayEnabled') !== 'off') && this.$element.is($('[data-component*=inviewElement]').first())) {
                var elementTop = this.$element.offset().top;
                var elementBottom = elementTop + this.$element.outerHeight();

                var viewportTop = $(window).scrollTop();
                var viewportBottom = viewportTop + $(window).height();

                var inView = (elementBottom > viewportTop && elementTop < viewportBottom);

                if (!inView) {
                    this.$element.addClass('exit exited');
                    if (this.options.contentsSelector) {
                        this.$element.find(this.options.contentsSelector).addClass(this.options.contentsClass);
                    }
                }
            }
        },


        /**
         * Set up events for the inview element.
         *
         * @private
         * @method _setupEvents
         */
        _setupEvents: function() {
            var self = this;

            // Request to close video player (TODO: Integrate this into the new event manager)
            $(window).on('closePlayer', function() {
                self.$element.find(self.options.contentsSelector).removeClass(self.options.contentsClass);
            });

            // Subscribe to any events that this instance needs to listen to.
            if(this.options.eventSubscriptions) {
                eventMgr.subscribe(this, this.options.eventSubscriptions);
            }
        },

        /**
         * Initialize the waypoints for the inview element.
         *
         * @private
         * @method _setupWaypoints
         */
        _setupWaypoints: function() {
            var self = this;

            if (this.options.customEventPercentage !== '' && this.options.contentsSelector) {
                this.customWaypoint = new Waypoint({
                    element: this.$element,
                    handler: function (direction) {
                        if (direction === 'up') {
                            self.$element.find(self.options.contentsSelector).removeClass(self.options.contentsClass);
                        } else {
                            if (self.options.customChildSelector) {
                                var $child = self.$element.find(self.options.customChildSelector);
                                if ($child.length === 0 || ($child.length > 0 && $child.hasClass('playing'))) {
                                    // Add class for 'exit' or 'exited' events
                                    self.$element.find(self.options.contentsSelector).addClass(self.options.contentsClass);
                                }
                            } else {
                                self.$element.find(self.options.contentsSelector).addClass(self.options.contentsClass);
                            }
                        }
                    },
                    offset: function () {
                        // Custom selector to get parent element.  Needed for watch and read.  When the player is docked, this.element.height() is 0px.
                        var elementHeight = self.options.waypointParentOffsetSelector === '' ? this.element.height() : $(this.element).closest(self.options.waypointParentOffsetSelector).height();
                        return -(elementHeight * parseFloat(self.options.customEventPercentage));
                    }
                });
            } else {
                // Generate the event handlers for the requested events.
                var eventHandlers = this.options.events.reduce(function (events, event) {
                    // Assign an event handler to each requested event.
                    events[event] = function (direction) {
                        debug.log('Waypoint ' + event + ' ' + direction + ' triggered.');

                        // Remove all other state classes, and add the current state class.
                        if(event.indexOf('exit') < 0 || self.options.exitDirection === 'both' || self.options.exitDirection === direction) {
                            self.$element.removeClass(self.options.events.join(' ')).addClass(event);

                            if (self.options.containerAwareClassPrefix && self.options.containerAwareSelector) {
                                self.$element.parents(self.options.containerAwareSelector).removeClass(self.options.events.map(function (eventName) {
                                    return self.options.containerAwareClassPrefix + eventName;
                                }).join(' ')).addClass(self.options.containerAwareClassPrefix + event);
                            }
                        }

                        // Update contents class
                        if (self.options.contentsSelector) {
                            if (event.indexOf('enter') === 0) {
                                // Remove class for 'enter' or 'entered' events
                                self.$element.find(self.options.contentsSelector).removeClass(self.options.contentsClass);
                            } else {
                                // If contents contains video, make sure it is playing
                                var $player = self.$element.find('[data-component=videoPlayer]');
                                if ($player.length === 0 || ($player.length > 0 && $player.hasClass('playing'))) {
                                    // Add class for 'exit' or 'exited' events
                                    self.$element.find(self.options.contentsSelector).addClass(self.options.contentsClass);
                                }
                            }
                        }

                        // If the inview waypoint is not supposed to repeat, destroy the inview waypoint.
                        // TODO: It would be nice to be able to destroy individual events, but that will likely require splitting this into separate waypoints instead of using the Inview shortcut.
                        if (!self.options.repeat && self.inviewWaypoint) {
                            self.inviewWaypoint.destroy();
                        }
                    };

                    // Return the accumulated list of event handlers.
                    return events;
                }, {});

                // Initialize the inview waypoint handler.
                this.inviewWaypoint = new Waypoint.Inview($.extend(true, {
                    element: this.$element
                }, eventHandlers));
            }
        }
    });
});
define('components/ellipsis',["jquery","version!fly/managers/debug","version!libs/jquery/dotdotdot","version!fly/components/base"],function(e,t){t=t.init("ellipsis"),e.widget("cnet.ellipsis",e.fly.base,{options:{selectors:{target:"[data-ellipsis]"}},_create:function(){var t=this.options;this._super(),e.each(this.$element.find(t.selectors.target),function(t,s){var i=e(s),o=i.data("ellipsis")||{};i.dotdotdot(o)})}})});
define('translations/image-gallery',["managers/edition"],function(e){var n={en:{page:"Page",pictures:"pictures"},es:{page:"Página",pictures:"imagenes"}};return e.getTranslation(n)});
define('translations/social-links',["managers/edition"],function(e){var o={en:{cnet:"CNET",roadshow:"Roadshow",copied:"URL copied to clipboard"},es:{cnet:"CNET_Es",copied:"URL copiado al portapapeles"},en_AU:{cnet:"CNET",copied:"URL copied to clipboard"},en_GB:{cnet:"CNET",copied:"URL copied to clipboard"}};return e.getTranslation(o)});

define('fly/components/social-links-1.0',[
    'jquery',
    'version!fly/managers/debug',
    'version!fly/utils/string-vars',
    'version!fly/components/base'
], function($, debugMgr, stringVars) {

    var clickEventName = ($.support.touch) ? 'vclick' : 'click', // support touch events
        debug = debugMgr.init('socialLinks'); // initialize debugger

    /**
     * Allows for a group of social media links to be opened in a window pop
     *
     * @extends cbsi.base
     * @extends utils/string-helper
     * @extends managers/debug
     *
     * Examples:
     *
     *      $(selector).socialLinks();
     *
     * Markup:
     *      <div class="social-links" data-component="socialLinks" data-social-links-options="{}">
                <a data-popup="facebook">Facebook</a></li>
                <a data-link="email">Email</a></li>
     *      </div>
     *
     *
     */
    $.widget( 'fly.socialLinks', $.fly.base, {

        options: {
            title: '',
            url: '',
            description: '',
            shortUrl: '',
            via: '',
            //site specfic data
            data: {
                //related object
            },
            popupWidth: 620, // {Int} Width of popup window
            popupHeight: 440, // {Int} Height of popup window
            location: null // {String} Location of the component - used to differentiate multiple instances on the same page
        },

        // Global vars
        isLoading: false,

        // Identifiers for link functionality popupId for social links, linkId for site services e.g email and print
        popupId: 'popup',
        linkId: 'link',

        /**
         * Link url configuration
         */
        links: {
            facebook: 'http://www.facebook.com/sharer.php?u={url}&t={title}',
            reddit: 'http://reddit.com/submit?url={url}&title={title}',
            digg: 'http://digg.com/submit?url={url}&title={title}',
            stumbleupon: 'http://www.stumbleupon.com/submit?url={url}',
            twitter: function(data) {
                var link = 'https://twitter.com/intent/tweet?text={title}&related={related}';
                link += ((data.shortUrl) ? '&url={shortUrl}&counturl={url}' : '&url={url}');
                link += ((data.via) ? '&via={via}' : '');
                return link;
            },
            delicious: 'http://del.icio.us/post?url={url}&title={title}',
            googleplus: 'https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton',
            linkedin: 'http://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&summary={description}',
            pinterest: 'http://pinterest.com/pin/create/button/?url={url}&media={media}&description={description}',
            tumblr: 'http://www.tumblr.com/share/link?url={url}&description={description}',
            whatsapp: function(data) {
                var devices = {
                    ios: {
                        match: /(ipad|iphone|ipod)/,
                        store: "https://itunes.apple.com/app/whatsapp-messenger/id310633997",
                        url: "whatsapp://send?text={title}%20{url}"
                    },
                    androidChrome: { // make sure this is before "android" due to "android" being in both strings.
                        match: "androidChrome",
                        store: "market://details?id=com.whatsapp",
                        url: "intent://send?text={title}%20{url}#Intent;package=com.whatsapp;scheme=whatsapp;end;"
                    },
                    android: {
                        match: "android",
                        store: "market://details?id=com.whatsapp",
                        url: "whatsapp://send?text={title}%20{url}"
                    }
                };

                var ua = window.navigator.userAgent.toLowerCase();
                for (var device in devices) {
                     device = devices[device];

                     if (ua.match(device.match)) {

                        // we need to compile the link internally here since we'll use an iframe to embed or window.open 
                        // instead of returning like normal since we need to set a timeout for the backup link to store
                        device.url = stringVars.compile(device.url, data, ['urlencode']);
                        
                        var iframe = $('<iframe />').css('display', 'none').attr('src', device.url).appendTo('body');

                        setTimeout( function()
                        {
                            // open this in a new window
                            window.open(device.store, '_blank');

                            // cleanup
                            iframe.remove();
                        }, 300);
                        return false;
                    }
                }
            },
            print: function() {
                window.print();
                return false;
            },
            email: 'mailto:?subject={title}&body={url}%0D%0D{description}'

        },

        /**
         * Instantiate socialLink
         *
         * @public
         */
        _create: function() {
            var o = this.options,
                eventMapClick = {};

            this._setup();

            // Events
            eventMapClick[clickEventName+' [data-'+this.popupId+']'] = '_handlePopup';
            eventMapClick[clickEventName+' [data-'+this.linkId+']'] = '_handleLink';

            this._on(this.$element, eventMapClick);
        },

        /**
         * Handle the click event for popup action
         *
         * @param e {Event Object}
         *
         * @private
         */
        _handlePopup: function(e) {
            var $el = $(e.currentTarget), //get current target to prevent confusion on what's clicked
                name = $el.data(this.popupId);
            e.preventDefault();

            this.$el = $el;

            this._setupClickEvent(e, {'el':$el, 'name':name});

            this.popup(e, name);
        },

        /**
         * Handle the click event for link action
         *
         * @param e {Event Object}
         *
         * @private
         */
        _handleLink: function(e) {
            var $el = $(e.currentTarget), //get current target to prevent confusion on what's clicked
                name = $el.data(this.linkId);
            e.preventDefault();

            this.$el = $el;

            this._setupClickEvent(e, {'el':$el, 'name':name});

            this.link(e, name);
        },

        /**
         * Get the compiled url for a link
         *
         * @param name {string} The link name
         *
         * @private
         */
        _getLink: function(name) {
            var link = this.links[name.toLowerCase()],
                data = this._getLinkData();

            if ($.isFunction(link)) {
                link = link(data);
            }

            link = stringVars.compile(link, data, ['urlencode']);

            return link;
        },

        /**
         * Set your own links
         *
         * @param name - name of the social site
         * @param hash - url formula for social sharing
         *
         * @public
         */
        setLink: function(name, hash) {
            this.links[name] = hash;
        },

        /**
         * Collect all data needed to build link
         *
         * @private
         */
        _getLinkData: function() {
            var o = this.options;

            return $.extend({
                title: o.title,
                description: o.description,
                url: o.url,
                shortUrl: o.shortUrl,
                via: o.via
            }, o.data);
        },

        /**
         * Open up the url in a pop up window
         *
         * @param e {Event Object}
         * @param name {string} The link to open
         */
        popup: function(e, name) {
            var url = this._getLink(name),
                coords = this._getPopUpCoords(),
                $el = this.$el;

            if (url) {
                window.open(url, 'button_share', 'width='+coords.width+', height='+coords.height+', '+
                    'left='+coords.left+', top='+coords.top+', '+
                    'personalbar=0, toolbar=0, scrollbars=1, resizable=1');

                this._setupLoadEvent(e, {'el':$el, 'name':name, 'type':this.popupId});
            }
        },

        /**
         * Open url in same browser
         *
         * @param e {Event Object}
         * @param name {string}
         */

        link: function(e, name) {
            var url = this._getLink(name),
                $el = this.$el;

            if (url) {
                this._setupLoadEvent(e, {'el':$el, 'name':name, 'type':this.linkId});
                window.location = url;
            }
        },

        /**
         * Function to calculate and return window pop-up coordinates
         *
         * @param width {int}
         * @param height {int}
         *
         * @private
         */

        _getPopUpCoords: function (width, height) {
            var o = this.options,
                w = width || o.popupWidth,
                h = height || o.popupHeight,
                sw = screen.width,
                sh = screen.height;

            return {
                left: Math.round((sw/2)-(w/2)),
                top: (sh > h) ? Math.round((sh/2)-(h/2)) : 0,
                width: (sw > w) ? w : sw,
                height: (sh > h) ? h : sh
            };
        },

        _setupClickEvent: function(e, data){
            e = e || null;
            var loc = this.options.location;

            if (loc){
                $.extend(data, {'location': loc});
            }
            debug.log("clicked");
            this._trigger('clicked', null, data);
        },

        _setupLoadEvent: function(e, data){
            e = e || null;
            var loc = this.options.location;

            if (loc){
                $.extend(data, {'location': loc});
            }

            this._trigger('loaded', e, data);
        }
    });

});

define('fly/components/social-counts-1.0',[
    'jquery',
    'version!fly/managers/debug',
    'version!fly/utils/string-helper',
    'version!fly/utils/string-vars',
    'version!fly/utils/object-helper',
    'version!fly/components/social-links'
], function($, debugMgr, strHlpr, stringVars, objects) {


    var clickEventName = ($.support.touch) ? 'vclick' : 'click', // support touch events
        debug = debugMgr.init('socialCounts'); // initialize debugger

    /**
     * Gives developers access to social counts - can be used to create custom share bars
     *
     * @extends cbsi.base
     * @extends utils/string-helper
     * @extends managers/debug
     *
     * Examples:
     *
     *      var counts = $.fly.socialCounts(options);
     *      counts.get();
     *
     *      or
     *
     *      $(selector).socialCounts();
     *      $(selector).socialCounts('get');
     *
     * Data api:
     *
     *      <a data-action="social-count" data-options="{button:facebook}">FB</a>
     *
     *
     */
    $.widget( 'fly.socialCounts', $.fly.socialLinks, {

        /**
         * Optional data configuration
         * @define {object}
         */
        options: {
            url: null, // {String} url string
            facebookKey: null, // {String} facebook app key - used for graph API tracking purposes
            showZeros: false, // {Boolean} - show number if 0 is returned for counts
            countType: 'human', // Options are human e.g 10K or int e.g 10000 respectively
            containerClass: 'social-count', // Class for the counts container element
            containerTemplate: '<span></span>', //template for the counts container if one is not specified.
            loadingClass: 'loading', // {String} class for the loader
            loadedClass: 'loaded',  // {String} class added to element when all buttons are loaded
            googleButtonType: 'small', // {String} size of the google button
            showTotal: false, // {Boolean} - show total count
            totalContainerSelector: '.social-count-total', // {String} - selector of the total count container
            location: null, // {String} Location of the component - used to differentiate multiple instances on the same page
            timeout: 1000 // {int} Social APIs timout in ms
        },

        // VARS
        selectorId: 'counts',
        total: 0, // var for total counts
        countTotals: 0, // used to count the number of counts received

        services: {
            facebook: 'http://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json',
            twitter: 'http://cdn.api.twitter.com/1/urls/count.json?url={url}',
            linkedin: 'http://www.linkedin.com/countserv/count/share?url={url}',
            delicious: 'http://feeds.delicious.com/v2/json/urlinfo/data?url={url}',
            pinterest: 'http://api.pinterest.com/v1/urls/count.json?url={url}'
            // Getting parsing errors from API below
            //stumbleupon: 'http://www.stumbleupon.com/services/1.01/badge.getinfo?url={url}',
            //reddit: 'http://www.reddit.com/api/info.json?url={url}',
            //googleplus: 'https://clients6.google.com/rpc?key={googleplusKey}'
        },

         // What to look for in the response - default is count
        responseKeys: {
            facebook: 'like_count',
            twitter: null,
            reddit: 'score',
            linkedin: null,
            delicious: 'total_posts',
            stumbleupon: 'views',
            pinterest: null,
            googleplus: null
        },

        // Massage response - default is response
        responseObj: {
            facebook: function(response){
                return response[0];
            },

            delicious: function(response){
                return response[0];
            },

            reddit: function(response){
                return (response.children.length > 0) ? response.children[0] : null;
            }

        },

        // Datatype to send
        requestDataType: {},

        // Request data to send
        requestData: {},

        /**
         *
         * Instantiate Component
         * @constructor
         * public
         *
         */
        _create: function() {
            var o = this.options;

            //Call Parent _create
            this._super('_create');

            this.url = o.url || window.location.href;
            this.$links = this.$element.find('[data-'+ this.selectorId +']');

            this._setupRequests();
        },

        _setupRequests: function(){
            if (this.$links.length <= 0) { // Check to see if links exist
                debug.log('Error: No links found in element.', this.$element);
                return false;
            }

            var self = this,
                num  = this.$links.length,
                eventName;

            this.$links.each(function(i, el){
                var link = $(el),
                    name = link
                            .data(self.popupId)
                                .toLowerCase(),
                    service = self._getService(name),
                    loadFnName = '_load'+ strHlpr.capitalize(name),
                    isLast = (i === num-1) ? true : false,
                    buttonCount = 0;

                self._loader('add', link);

                if (service) {
                    self.load(name, service);
                    eventName = 'socialcountsloaded';

                } else if ($.isFunction(self[loadFnName])) {
                    self[loadFnName]();
                } else {
                    debug.log('Error: No service or custom function found for '+name, self.$element);
                    self._loader('remove', link);
                }

                self.$element.on(eventName, function(e, data){
                    buttonCount = data.count || 0;
                    self.total += buttonCount;
                    self._setTotal(num);
                });
            });
        },

        /**
         * Load service to the social counts
         *
         * @param url - service url for the counts
         * @param name - name of the social service
         *
         * @public
         */
        load: function(name, url){
            if(name.length <= 0 || url.length <= 0){
                debug.log('Error: Service url or name not defined');
                return false;
            }

            var self = this,
                responseKey = this.responseKeys[name] || 'count',
                requestDataType = this.requestDataType[name] || 'jsonp',
                requestData = this.requestData[name] || {};
            debug.log('Requesting: '+name+'('+url+')');

            $.ajax({
                dataType: requestDataType,
                url: url,
                data: requestData,
                timeout: self.options.timeout
            })
            .done(function(response, textStatus, jqXHR) {
                response = ( $.isFunction(self.responseObj[name]) ) ? self.responseObj[name](response) : response;
                var data = objects.deepFind(response, responseKey) || {};

                self.setContent(name, data);
            })
            .fail(function(jqXHR, textStatus, errorThrown) {
                debug.log('Error: '+name+'('+url+')'+' response failed', jqXHR, textStatus);
                self.setContent(name, {});
            });
        },


        /**
         * Get the compiled url for a link
         *
         * @param name {string} The link name
         *
         * @private
         */
        _getService: function(name) {
            var service = this.services[name],
                data = this._getServiceData();

            service = stringVars.compile(service, data, ['urlencode']);

            return service;
        },

        /**
         * Collect all data needed to build link
         *
         * @private
         */
        _getServiceData: function() {
            var o = this.options;

            return $.extend({
                url: this.url,
                googleplusKey: o.googleplusKey,
                facebookKey: o.facebookKey
            }, o.data);
        },

        _loadGoogleplus: function(){
            // https://plusone.google.com/u/0/_/+1/fastbutton?url=http://cnet.com&count=true&size=small
            var o = this.options,
                data = '<div class="g-plusone" data-size="'+o.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="handleGooglePlusCallback"></div>',
                $el = this._getLinkEl('googleplus'),
                self = this;

            $el.html(data);

            window.handleGooglePlusCallback = function(data) {
                var act = (data.state == 'on') ? 'plusone' : 'rmvplusone';
                // Callback functions here
            };

            require(['https://apis.google.com/js/plusone.js'], function() {
                window.handleGooglePlusCallback = function(data) {
                    var act = (data.state == 'on') ? 'plusone' : 'rmvplusone';
                    self._trigger(null, {'button': 'googleplus', 'type': act});
                }.bind(this);
                self._setupLoadEvent({'el':$el, 'name':'googleplus'});
            });
        },

        /**
         * Set the counts
         *
         * @public
         */
        setContent: function(name, count) {
            var o = this.options,
                selector = '[class='+o.containerClass+']',
                $el, $container,
                num = 0;

            $el = this._getLinkEl(name);

            $container = $el.find(selector);

            // Checks to see if you have a container already based on the class in the options
            // If container is not found, the container is created and inserted after the link
            $container = ($container.length) ? $container : $(o.containerTemplate).addClass(o.containerClass)
                                                                                    .addClass(o.containerClass+'-'+name)
                                                                                        .insertAfter($el)
                                                                                            .before(' ');

            if(o.showZeros && typeof(count) === 'object'){
                count = '0'; // show zeros for instances that have that option set
            }

            if(typeof(count) !== 'object') { // Make sure response isn't object
                num = parseInt(count, 10);

                if(o.countType === 'human'){
                    count = this._getNormalizedCount(num); // Humanize that data
                }

                $container.text(count);
                $el.addClass(o.loadedClass);
            }

            this._loader('remove', $el);

            this._setupLoadEvent({'el':$el, 'name':name, 'count':num, 'type': 'countSet'});
            return true;
        },

        /*
         * Set the total count
         *
        */
        _setTotal: function(num){
            var o = this.options,
                $el = this.$element.find(o.totalContainerSelector),
                total = (o.countType === 'human') ? this._getNormalizedCount(this.total) : this.total;

            this.countTotals++;

            if($el.length < 0){
                debug.log('Error: total container not found. Selector: '+o.totalContainerSelector);
                return false;
            } else {
                $el.text(total);
            }

            if(this.countTotals === num){
                this._setupLoadEvent({'el': this.$element, 'type':'totalSet'});
                this.$element.addClass(o.loadedClass);
            }
        },

        _setupLoadEvent: function(data){
            data = data || {};
            var loc = this.options.location

            if (loc){
                $.extend(data, {'location': loc});
            }

            this._trigger('loaded', null, data);
        },

        _getLinkEl: function(name){
            var self = this,
                $el;

            return this.$links.filter(function(i) {
                var $btn = $(this),
                    attrName = $btn.attr('data-'+self.popupId).toLowerCase();

                $el = (attrName === name) ? $(this) : false;

                return $el;
            });
        },

        _getNormalizedCount: function(num){
            if (num >= 1e9) {
                num = (num / 1e9).toFixed(2) + 'B';
            } else if (num >= 1e6) {
                num = (num / 1e6).toFixed(2) + 'M';
            } else if (num >= 1e3) {
                num = (num / 1e3).toFixed(1) + 'K';
            }

            return num;
        },

        _loader: function(type, $el) {
            var o = this.options;

            $el = $el || this.$element;

            if (type === 'add') {
                $el.addClass(o.loadingClass);
            } else {
                $el.removeClass(o.loadingClass);
            }
        }

    });
});


define('components/social-counts',["jquery","version!fly/managers/debug","translations/social-links","managers/page-vars","managers/tealium","managers/device","version!fly/utils/string-vars","version!fly/utils/object-helper","managers/edition","version!fly/components/social-counts","components/modal-email"],function(t,e,o,i,a,n,l,s,r){e=e.init("socialCounts");var c=t.support.touch?"vclick":"click";t.widget("cnet.socialCounts",t.fly.socialCounts,{options:{data:{media:t('meta[property="og:image"]').first().attr("content")}},$emailModal:null,totalCount:0,services:{facebook:"https://api.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={url}&format=json",twitter:"",linkedin:"https://www.linkedin.com/countserv/count/share?url={url}",delicious:"http://feeds.delicious.com/v2/json/urlinfo/data?url={url}",pinterest:"https://api.pinterest.com/v1/urls/count.json?url={url}"},ftags:{copy:"#ftag=COS-05-10aaa2d",email:"#ftag=COS-04-10aaa1a",facebook:"#ftag=COS-05-10aaa0i",googleplus:"#ftag=COS-05-10aaa1c",linkedin:"#ftag=COS-05-10aaa1h",pinterest:"#ftag=COS-05-10aaa1d",reddit:"?ftag=COS-05-10aaa1e",tumblr:"#ftag=COS-05-10aaa1g",twitter:"#ftag=COS-05-10aaa0j",sms:"#ftag=CAD-05-10aai5g",flipboard:"#ftag=COS-05-10aaa2f"},links:{email:function(e){if(n.isMobile())window.location=l.compile("mailto:?subject={title}&body={url}%0D%0A%0D%0A{description}",e,["urlencode"]);else if(this.$emailModal)this.$emailModal.modalEmail("open");else{var o={openOnInit:!0,pageTitle:e.title,pageUrl:e.url};this.options.isAuto&&(o.emailType="friendRoadshow"),this.$emailModal=t.cnet.modalEmail(o).$element}},googleshare:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",twitter:function(t){var e="https://twitter.com/intent/tweet?text={title}&related={related}"+(t.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}");if("none"!=t.via){var i;i=null!==t.url.match(/\/roadshow\//)?o.roadshow:o.cnet,e+="&via="+i}return e},tumblr:"http://www.tumblr.com/share/link?url={url}",flipboard:"https://share.flipboard.com/bookmarklet/popout?v=2&title={title}&url={url}&utm_source=cnet&utm_medium=article-share&utm_campaign=publisher",sms:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent||navigator.vendor||window.opera)&&!window.MSStream?"sms:&body={title}%20{url}":"sms:?body={title}%20{url}"},copy:function(i){element=this.$el;var a=function(){t(element).children(".copy").append('<div class="copyNotice">'+o.copied+"</div>"),setTimeout(function(){t(".copyNotice").detach()},3e3);var e=null;return document.addEventListener("copy",function(t){if(null!==e)try{t.clipboardData.setData("text/plain",e),t.preventDefault()}finally{e=null}}),function(t){e=t,document.execCommand("copy")}}();return e.log("copied:",i.url),a(i.url)}},getTotal:function(){return this.totalCount},_create:function(){var o=this,i={};this._super(),this._setupTracking(),t.each(this.links,function(t,e){"function"==typeof e&&(o.links[t]=e.bind(o))}),this._on(this.$element,i),"counts"===this.options.type&&this.options.noLinks&&(o._handlePopup=function(t){e.log("Blocked _handlePopup event")},o._handleLink=function(t){e.log("Blocked _handleLink event")})},_getLink:function(e,o,i){this._setupUrl(e);var a=this,n="json";if(!this.options.data.shortUrl&&"twitter"==e){var l=(r.isEspanol()?"/es":"")+"/ShareBarUrlShortener/";null!==this.options.url.match(/\/roadshow\//)&&(l="/roadshowurlshortener/"),"www.cnet.com"!==window.location.host&&(n="jsonp",l=window.location.protocol+"//www.cnet.com"+l);var s=a._super;t.ajax({url:l,data:{longUrl:this.options.url},dataType:n,callback:"callback",jsonpCallback:"handle_callback",async:!1,cache:!0,success:function(t){a.options.data.shortUrl=void 0!==t.short_url?t.short_url:t.data.url,i(s.call(a,e),o)}})}if("json"==n)return this._super(e)},popup:function(t,e){function o(t,o){t&&(window.open(t,"button_share_"+e,"width="+o.width+", height="+o.height+", left="+o.left+", top="+o.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")||(window.location=t))}var i=this._getPopUpCoords(),a=this._getLink(e,i,o),n=this.$el;a&&(o(a,i),this._setupLoadEvent(t,{el:n,name:e,type:this.popupId}))},link:function(t,e){function o(t,e){t&&(window.location=t)}var i=this._getLink(e,{},o),a=this.$el;i?(o(i),this._setupLoadEvent(t,{el:a,name:e,type:this.linkId})):this.options.url&&"link"==e&&(i=this.options.url,o(i),this._setupLoadEvent(t,{el:a,name:e,type:this.linkId}))},_setupTracking:function(){t("[data-popup]",this.$element).on("click vclick ",function(e){var o=t(this).data("tracking"),i={facebooksend:1,facebook:2,googlePlus:3,linkedin:4,pinterest:5,reddit:6,stumbleupon:7,twitter:8,twitterfollow:9,delicious:12,tumblr:14,sms:27,flipboard:28};a.trackSocial({socialService:o,event:"share",eventt:"socialsite",socialId:i[o],wd:"sharelink",sharebarSection:t(this).closest("[section]").attr("section")}),t(this).off("click vclick")}),"counts"===this.options.type&&this._bindCountsEvents()},_bindCountsEvents:function(){t("[data-link]",this.$element).on(c,function(e){var o=t(this).data("link"),i={email:10};a.trackSocial({socialService:o,event:"share",eventt:"socialsite",socialId:i[o],wd:"sharelink",sharebarSection:t(this).closest("[section]").attr("section")}),t(this).off(c)}),t(".comment-count, .comment-countab",this.$element).on("click vclick",function(e){"object"==typeof i.tracking.data.collectionId?sharebarCollectionId=i.tracking.data.collectionId[0]:"string"==typeof i.tracking.data.collectionId?sharebarCollectionId=i.tracking.data.collectionId:sharebarCollectionId="",a.trackCustomEvent("trackShareBarComments",{_articleType:i.tracking.data.articleType,_pageType:i.tracking.data.pageType,brand:i.tracking.data.brand,siteEdition:i.tracking.data._siteEdition,_siteTypeDevice:i.tracking.data._siteTypeDevice,clickGenericText:"show_comments",dwLinkTag:a.getDwTag(t(this)),_collectionPrimaryId:sharebarCollectionId},"trackClick")})},_loadGoogleplus:function(){var t=this.options,e='<div class="g-plusone" data-size="'+t.googleButtonType+'" data-href="'+this.url+'" data-count="true" data-callback="$.cnet.google.trackPlusOne"></div>',o=this._getLinkEl("googleplus");o.html(e),google.isInitialized()?google.parse(o[0]):google.init()},_loadGooglepluscounts:function(){var o=[{method:"pos.plusones.get",id:"p",params:{nolog:!0,id:this.url,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}];t.ajax({url:"https://clients6.google.com/rpc",type:"POST",contentType:"application/json",data:JSON.stringify(o),dataType:"json",success:function(t){if("object"==typeof t&&t.length){var o=t[0].result.metadata.globalCounts.count;self.setContent("googlepluscounts",o),e.log("G+ Count:",o)}else e.log("Failed to get Google+ count")},error:function(){e.log("Failed to get Google+ count")}})},load:function(o,i){if(o.length<=0||i.length<=0)return e.log("Error: Service url or name not defined"),!1;var a=this,n=this.responseKeys[o]||"count",l=this.requestDataType[o]||"jsonp",r=this.requestData[o]||{};t.ajax({dataType:l,url:i,data:r,timeout:5e3}).done(function(e,i,l){e=t.isFunction(a.responseObj[o])?a.responseObj[o](e):e;var r=s.deepFind(e,n)||{};a.setContent(o,r),r===parseInt(r,10)&&(a.totalCount+=r,a.$element.trigger("socialCountTotalUpdate",a.totalCount))}).fail(function(t,i,n){e.log("Error: "+o+" response failed",t,i),a.setContent(o,{})})},_setupUrl:function(t){this.options.url=this.options.url.split("#")[0],t in this.ftags&&(this.options.url+=this.ftags[t],this.options.data.shortUrl=null)},setData:function(t,e){this.options.data[t]=e}})});
define('components/sharebar',["jquery","managers/tealium","managers/page-vars","managers/global-functions","version!fly/managers/debug","version!fly/utils/url-helper","components/social-counts","version!fly/components/base","version!libs/modernizr.custom","version!fly/libs/jquery.throttle-debounce","version!libs/waypoints/jquery.waypoints"],function(e,t,i,s,o,n){o=o.init("sharebar");var a=e.support.touch?"vclick":"click",l=!0;e.widget("cnet.sharebar",e.fly.base,{options:{viewClasses:{inline:"inline-view",side:"side-view"},enableViewToggling:!1,selectorContainer:null,containerClass:"count",showZeros:!0,throttle:!1,longform:!1,data:{media:e('meta[property="og:image"]').first().attr("content")},type:"counts",offsetElements:["#primary","#omnibar_top",".pageHeader","#specialHeader .fixation"],scrollToComments:!0},$buttons:null,$links:null,previousPath:null,lastScrollPosition:0,maxInnerHeight:0,isPastScrollTopZero:!1,disableScrollShowLogic:!1,_create:function(){this._setup(),this.options.title||(this.options.title=e("meta[property='og:title']").attr("content")),this.options.description||(this.options.description=e("meta[property='og:description']").attr("content")),this.options.url||(this.options.url=e("meta[property='og:url']").attr("content")),this.options.selectorContainer&&this.$element.appendTo(this.options.selectorContainer),this.options.enableViewToggling&&(this.updateView(null),this.$element.fixate&&this.$element.fixate("checkPosition")),this.$links=this.$element.socialCounts(this.options),this._setupEvents(),l&&window.location.hash.indexOf("#comment")>=0&&!e(".commentsContainer").parent().hasClass("selected")&&(l=!1,this.$element.find('a[href="#comments"], a[href="#comentarios"]').trigger("click"))},_setupEvents:function(){var o=this;this.options.enableViewToggling&&this.$window.on("resize.sharebar",function(){this.updateView()}.bind(this)),e(".share-button.googleButton .hoverWrap").on("mouseenter",function(t){e(".share-button.googleButton").addClass("active")}),e(".share-button.googleButton .hoverWrap").on("mouseleave",function(t){e(".share-button.googleButton").removeClass("active")}),e("div[data-close='comments']").on("click",function(){var e=null!=o.previousPath?o.previousPath+"#":"#";history.replaceState(null,null,e),o.previousPath=null}),this.$element.on("click",".comment-count-redesign a, a[href='#comments'], a[href='#comentarios']",function(a){a.preventDefault();var l,r,h,c=e(".commentsContainer"),d=e(this).parent().attr("data-conversation-id"),p=e("#disqusContainer-"+d);e(this.firstElementChild).hasClass("social-button-small-redesign")?l="left-social":e(this.firstElementChild).hasClass("wrapper")&&(l="bottom");var m=e(this).closest("div:data(sharebar-options)").first().data("sharebar-options");r=p.parent().hasClass("selected")?"hide":"show",h=l+"-"+r+"-comments";var u=e.extend({},i.tracking.data,{clickGenericText:h});if(t.trackCustomEvent("impression",u,"trackClick"),"hide"===r){var g=null!=o.previousPath?o.previousPath+"#":"#";return p.parent().removeClass("selected"),history.replaceState(null,null,g),void(o.previousPath=null)}o.previousPath=window.location.pathname+window.location.search,o.$window.trigger("beginSharebarCommentClick");var w=0;e.each(o.options.offsetElements,function(t,i){w+=e(i).outerHeight(!0)}),o.options.scrollToComments&&c.offset()&&e("html, body").animate({scrollTop:(0===c.length?p:c).offset().top-w},0);var v=window.location.hash,f=n.getPath(m.url)+window.location.search;"#comment"!==v.substring(0,"#comment".length)?f+="#comments":f+=v,history.replaceState(null,null,f),p.parent().addClass("selected").removeClass("hidden"),c.parent().removeClass("selected").addClass("hidden"),p.parent().addClass("selected").removeClass("hidden"),i.services.disqus.enabled&&s.gdprConsentCallback("script_disqus",function(){require(["managers/third-party/disqus"],function(e){"article"==i.pageType||"product_main"==i.pageType||"buy_guide"==i.pageType?e.init({enabled:!0,disqusSelector:"#disqusContainer-"+d+' [data-social="disqus"]'}):e.parse(p)})}),p.mouseover(function(){e("body").addClass("noScroll")}),p.mouseout(function(){e("body").removeClass("noScroll")})});var l=e(".cnet-content-panel .mobile-nav-share");l.length&&l.on(a,function(){o._displayHideSharebar()}),e(".kargo-ad-1").addClass("show"),this.options.throttle&&(this._on(this.$document,{scroll:e.throttle(200,this._checkShowSharebar)}),e("[data-sharebar-waypoint]").length&&(e("img[data-original]").each(function(){e(this).one("load",function(){Waypoint.refreshAll()})}),this._setupWaypoint()))},updateView:function(t){t?(e.each(this.options.viewClasses,function(e,t){this.$element.removeClass(t)}.bind(this)),this.$element.addClass(t)):this.$window.width()<1430?this.updateView(this.options.viewClasses.inline):this.updateView(this.options.viewClasses.side)},_checkShowSharebar:function(){var t=this.$window.scrollTop(),i=this;1==this.options.longform&&t<e(window).height()?(e(this.element).removeClass("show"),e(".kargo-ad-1").removeClass("show")):this.lastScrollPosition>=t&&e(window).scrollTop()+e(window).height()<e("body").height()&&!e(this.element).hasClass("show")&&!this.disableScrollShowLogic?(1==this.options.longform&&t>e(window).height()||1!=this.options.longform)&&(e(this.element).addClass("show"),e(".kargo-ad-1").addClass("show")):this.lastScrollPosition<=t&&e(window).scrollTop()>0&&e(this.element).hasClass("show")&&this.maxInnerHeight==window.innerHeight&&!this.disableScrollShowLogic&&(e(this.element).removeClass("show"),e(".kargo-ad-1").removeClass("show")),e(this.element).hasClass("show")&&e(window).scrollTop()<=0&&this.isPastScrollTopZero&&window.setTimeout(function(){e(i.element).removeClass("show"),e(".kargo-ad-1").removeClass("show")},2e3),this.lastScrollPosition=t,!this.isPastScrollTopZero&&t>0&&(this.isPastScrollTopZero=!0),this.maxInnerHeight<window.innerHeight&&(this.maxInnerHeight=window.innerHeight)},_displayHideSharebar:function(){e(this.element).hasClass("show")?e(this.element).hasClass("show")&&e(this.element).removeClass("show"):e(this.element).addClass("show")},_setupWaypoint:function(){var t=this;new Waypoint({element:e("[data-sharebar-waypoint]"),handler:function(i){t.disableScrollShowLogic=!0,e(t.element).addClass("show"),e(".kargo-ad-1").addClass("show"),window.setTimeout(function(){t.disableScrollShowLogic=!1},4e3),this.destroy()},offset:"bottom-in-view"})},_trackAction:function(s,o){t.trackCustomEvent("socialShareBarPosition",e.extend(!0,{},{pageType:i.tracking.data.pageType,siteEdition:i.tracking.data.siteEdition,siteType:i.tracking.data.siteType,brand:i.tracking.data.brand,deviceType:i.tracking.data.deviceType,siteSection:i.tracking.data.siteSection,_pageChannelType:i.tracking.data._pageChannelType,articleId:i.tracking.data.articleId,articleTitle:i.tracking.data.articleTitle,articleType:i.tracking.data.articleType,_collectionPrimaryId:i.tracking.data._collectionPrimaryId,siteHier:i.tracking.data.siteHier,_pageTitle:i.tracking.data._pageTitle},o),"trackClick")}})});
define('fly/components/image-gallery-1.0',[
    'jquery',
    'version!fly/managers/debug',
    'version!fly/utils/string-vars',
    'version!fly/managers/history',
    'version!fly/components/base'
], function($, debugMgr, strVars, historyMgr) {

    // TODO: temporarily commented until debug is fixed
    //'use strict';

    var clickEventName = ($.mobile) ? 'vclick' : 'click',
        debug = debugMgr.init('imageGallery');

    /**
     *     Image Gallery
     *
     *     @extends fly.base
     *
     *     Example:
     *
     *     $('#my-image-gallery').imageGallery({ index: 1, count: 2 });
     *
     *     <div id="my-image-gallery">
     *          <ul class="canvas">
     *              <li data-item="image" class="selected>
     *                  <img src="…" />
     *                  ...
     *              </li>
     *              <li data-item="image">
     *                  <img data-src="…" src="/placeholder/image" /> // preload
     *                  ...
     *              </li>
     *          </ul>
     *        
     *          <a data-to-image="previous">Previous</a>
     *          <a data-to-image="next">Next</a>
     *
     *          <a data-to-image="1">1</a>
     *          <a data-to-image="2">2</a>
     *          
     *          <div data-item="image-count">1 of 2</div>
     *     </div>
     *
     */

    $.widget('fly.imageGallery', $.fly.base, {

        /**
         * Options
         */
        options: {
            index: 0, // slide to show on load. 
            count: 0, // number of total images
            preloadThreshold: 2, // number of images to preload before and after the current image.
            selectors: {
                image: '[data-item="image"]', // image content container
                count: '[data-item="image-count"]' // count display
            },
            classes: {
                selected: 'selected', // added to selected images and thumbnails
                disabled: 'disabled' // added to disabled conrols
            },
            countTemplate: '<span class="index">{index}</span> / <span class="count">{count}</span>',
            pushState: {
                enabled: false,
                route: function(data) {
                    return (data.index > 1) ? './{index}' : './';
                },
                title: function(data) {
                    return '{title}' + ((data.index > 1) ? '- {index}' : '');
                }
            }
        },

        index: 1, // current image index
        indexPrevious: null, // previous image index
        count: 0, // total image count
        
        selectors: {
            control: '[data-to-image]',
            next: '[data-to-image="next"]',
            previous: '[data-to-image="previous"]',
            jump: '[data-to-image="{index}"]'
        },

        /**
         * Initialize Image Gallery
         *
         * @private
         */
        _create: function() {
            var o = this.options,
                self = this;

            this._setup();

            // set index and count
            this.index = parseInt(o.index, 10);
            this.count = parseInt(o.count, 10);

            // find element
            this.$images = this.$element.find(o.selectors.image);
            this.$count = this.$element.find(o.selectors.count);

            this._setupEvents();
            this._updateControls();
            this._preloadImages();
            
            if (o.pushState.enabled) {
                this._setupPushState();
            }
        },

        /**
         * Add events
         *
         * @private
         */        
        _setupEvents: function() {
            var eventMap = {};
                
            // prev/next events
            eventMap[clickEventName + ' ' + this.selectors.control] = '_handleControlClick';

            this._on(this.$element, eventMap);
        },

        /**
         * Setup pushState events
         *
         * @private
         */  
        _setupPushState: function() {
            var o = this.options,
                self = this;
            
            this.history = historyMgr.init(o.pushState, {index: this.index});
            
            this._on({
                'imagegalleryshown': function(e, data) {
                    var stateData = {index: data.index};
                    
                    if (data.action !== 'stateChange') {
                        self.history.navigate(stateData, {title: data.title, url: data.url});
                    }
                }
            });
            
            this.history.stateChange(function(state) {
                self.show(state.index, 'stateChange');
            });
        },

        /**
         * Handle click event on controls
         *
         * @param {Event} e The click event
         * @private
         */  
        _handleControlClick: function(e) {
            var to = $(e.target).closest(this.selectors.control).data('toImage');
            
            e.preventDefault();
            e.stopPropagation();

            switch (to) {
                case 'next':
                    this.next();
                    break;
                case 'previous':
                    this.previous();
                    break;
                default:
                    this.show(parseInt(to, 10), 'to');
            }
        },
        
        /**
         * Update control display
         *
         * @private
         */
        _updateControls: function() {
            var o = this.options,
                $previous = this.$element.find(this.selectors.previous),
                $next = this.$element.find(this.selectors.next),
                $jumpPrevious = this.$element.find( strVars.compile(this.selectors.jump, {index: this.indexPrevious }) ),
                $jumpCurrent = this.$element.find( strVars.compile(this.selectors.jump, {index: this.index }) );

            $next[(this.index === this.count) ? 'addClass' : 'removeClass'](o.classes.disabled);
            $previous[(this.index === 1) ? 'addClass' : 'removeClass'](o.classes.disabled);

            $jumpCurrent.addClass(o.classes.selected);
            $jumpPrevious.removeClass(o.classes.selected);
        },

        /**
         * Update count display
         *
         * @private
         */  
        _updateCount: function() {
            var o = this.options,
                data = {};
            
            if (!this.$count.length) return;
            
            data = {
                index: this.index,
                count: this.count
            };
            
            this.$count.html(strVars.compile(o.countTemplate, data));
        },

        /**
         * Show specific image content
         *
         * @param {number} index The image index to show
         */
        show: function(index, action) {
            var o = this.options,
                $previous,
                $current;
            
            if (index === this.index) return;
            
            // find the images
            $previous = this.$images.eq(this.index - 1);
            $current = this.$images.eq(index - 1);

            // make sure we've loaded this image
            this._loadImage($current);
            
            // add/remove show class
            $previous.removeClass(o.classes.selected);
            $current.addClass(o.classes.selected);

            // update the index
            this.indexPrevious = this.index;
            this.index = index;
            // update display
            this._updateControls();
            this._updateCount();

            this._trigger('shown', null, {
                $current: $current,
                $previous: $previous,
                index: this.index,
                action: action
            });

            // preload images
            this._preloadImages();
        },

        /**
         * Show next image content
         */
        next: function() {
            var o = this.options,
            nextIndex = this.index + 1;
            
            if (nextIndex > this.count) return;
            
            this.show(nextIndex, 'next');

            this._trigger('next');
        },

        /**
         * Show previous image content
         */
        previous: function() {
            var o = this.options,
            previousIndex = this.index - 1;
                
            if (previousIndex === 0) return;
            
            this.show(previousIndex, 'previous');

            this._trigger('previous');
        },
        

        /**
         * Collect a group of images to be preloaded
         *
         * @private
         */
        _preloadImages: function() {
            var o = this.options,
                self = this,
                indexStart, 
                indexEnd,
                $images;
                
            if (o.preloadThreshold === 0) return;

            indexStart = Math.max(1, this.index - o.preloadThreshold);
            indexEnd = Math.min(this.count, this.index + o.preloadThreshold);
            
            $images = this.$images.slice(indexStart - 1, indexEnd);

            $images.each(function(i, el) {
                self._loadImage($(el));
            });
        },

        /**
         * Load an image that is staged to be lazy loaded
         *
         * @image
         * @private
         */        
        _loadImage: function($imageCont) {
            var isLoaded = $imageCont.data('isLoaded') || false,
                $image,
                src;
            
            if (isLoaded) return;
            
            $image = $imageCont.find('img');
            src = $image.data('src');
            
            if ($image.length && src) {
                $image.attr('src', src);
                $image.removeData('src');
                $imageCont.data('isLoaded', true);
            }
        }

    });
});

define('components/image-gallery',["jquery","version!fly/managers/debug","managers/page-vars","fly/utils/string-vars-1.0","managers/tealium","translations/image-gallery","managers/guid","managers/device","version!fly/managers/history","managers/ad","components/sharebar","version!fly/components/base","version!fly/components/image-gallery"],function(e,t,i,a,o,n,r,s,l,d){var c=t.get("imageGallery");e.widget("cnet.imageGallery",e.fly.imageGallery,{options:{selectors:{gridControl:'[data-item="grid-control"]',meta:'[data-item="meta"]',control:"[data-to-image]",next:'[data-to-image="next"]',previous:'[data-to-image="previous"]',jump:'[data-to-image="{index}"]',container:"#galleryPage",modalContainer:"#bodyWrapper #galleryPage",count:'[data-item="image-count"] [data-item="index"]',taboola:'[data-component="taboola"]'},pushState:{enabled:!0,title:function(t){return e("#galleryPage .gallery-header h1").text()+(t.index>1?" - CNET - "+n.page+" {index}":"")}},nextOverride:"/"+n.pictures+"/",nextOverrideSection:null,defaultDek:"",edition:"",preloadThreshold:1},$container:null,$gallery:null,firstPageView:!0,isModal:!1,_create:function(){if("image_gallery"!==i.tracking.data.pageType)return void c.log("pageType !== image_gallery -- abort");var t=this.options;0!==e(".galleryModal").length&&(this.isModal=!0),this.isModal?this.$container=e(t.selectors.modalContainer):(window.scrollTo(0,0),this.$container=e(t.selectors.container)),this._setup(),this._super("_create"),this.$meta=this.$container.find(t.selectors.meta),this.$taboola=this.$container.find(t.selectors.taboola),this.defaultDek=e("meta[property='og:description']").attr("content"),this.edition=this.options.edition,this.$gallery=this.$container.find(".image-gallery"),this.$video=this.$container.find('[data-component="videoPlayer"]'),this._updateMetadata()},_setupEvents:function(){var e={},t={};e["click "+this.options.selectors.control]="_handleControlClick",t.keydown="_handleKeyboardControl",this._on(this.$container,e),this._on(document,t)},_setupPushState:function(){var t=this.options,i=this,a=document.createElement("a");a.href=t.pushState.route;var o=a.pathname;-1===e.inArray(o[0],[void 0,"/"])&&(o="/"+o),t.pushState.route=function(e){return(e.index>1?o+"{index}/":o)+window.location.search},this.history=l.init(t.pushState),this._on({imagegalleryshown:function(e,t){var a={index:t.index};"stateChange"!==t.action&&i.history.navigate(a,{title:t.title,url:t.url})}}),this.history.stateChange(function(t){c.log("stateChange",t.index),void 0!==t.index?i.show(t.index,"stateChange"):e("#bodyWrapper .closeModal").trigger("click")}),this.isModal?(this.history.navigate({},{replace:!0,url:document.location}),this.history.navigate({index:this.index})):this.history.navigate({index:this.index},{replace:!0,url:document.location})},_updateControls:function(){c.log("updateControls");var e=this.options,t=this.$container.find(e.selectors.previous),i=this.$container.find(e.selectors.next),o=this.$container.find(a.compile(e.selectors.jump,{index:this.indexPrevious})),n=this.$container.find(a.compile(e.selectors.jump,{index:this.index}));this.isModal?i.removeAttr("href"):this.index===this.count&&e.nextOverride?(i.attr("href",e.nextOverride),i.removeAttr("data-to-image"),e.nextOverrideSection&&i.attr("section",e.nextOverrideSection)):i.attr("data-to-image","next"),t[1===this.index?"addClass":"removeClass"](e.classes.disabled),n.addClass(e.classes.selected),o.removeClass(e.classes.selected),n.attr("aria-selected",!0),o.attr("aria-selected",!1),this._updateCount()},_handleKeyboardControl:function(t){switch(t.keyCode){case 37:c.log("Left arrow key is down"),this.previous("keyboard");break;case 39:c.log("Right arrow key is down");var i=this.options;this.index===this.count?i.nextOverride?window.location.href=i.nextOverride:this.isModal&&e('[data-item="modal-close"]').trigger("click"):this.next("keyboard");break;case 27:c.log("Escape button is down"),e('[data-item="modal-close"]').trigger("click")}},_handleControlClick:function(t){var i=this.options,a=e(t.target).closest(i.selectors.control).data("toImage"),o=e(t.target).closest(i.selectors.control).data("controlName");switch(t.preventDefault(),t.stopPropagation(),a){case"next":this.next(o);break;case"previous":this.previous(o);break;default:this.show(parseInt(a,10),"to",o)}},_updateCount:function(){var e=this.options;this.$container.find(e.selectors.count).text(this.index)},show:function(e,t,a){if(e!==this.index){c.log("Showing slide: ",e);var n=this.options;this.$video.videoPlayer&&this.$video.videoPlayer("pause");var s="next"==t?e-1:e+1;$previousMeta=this.$container.find("[data-item-meta="+s+"]"),$currentMeta=this.$container.find("[data-item-meta="+e+"]"),$previousMeta.removeClass(n.classes.selected),$currentMeta.addClass(n.classes.selected),this._superApply([e,t]),r.resetViewGuid();var l={event:"log",pageNum:e,mapp:"gallery",comptyp:"gallery",riaevent:"view",objtyp:"image",_pageViewGuid:i.guid,dwLinkTag:a,photoGalleryTitle:i.tracking.data.articleTitle,photoGalleryId:i.tracking.data.articleId,photoGalleryType:i.tracking.data.articleType,_siteEdition:i.tracking.data.siteEdition,siteEdition:i.tracking.data.siteEdition,brand:i.tracking.data.brand,mfr:i.tracking.data.mfr,pageType:i.tracking.data.pageType};i.services.chartbeat_tracking.enabled=!1,c.log("Track as new pageview"),o.trackPageLoad(l);try{c.log("refresh ads");var g=["skin","mpu_top","mpu_bottom","mpu_middle","mpu_middle2","leader_top","leader_middle","leader_bottom","omnibar_top"];"gallery_ad"===i.tracking.data.testName&&"control"!==i.tracking.data.testGroup&&g.push("intromercial"),d.refreshImproved({containerId:i.ads.data.gpt.containerId,adUnitNames:g,targeting:$currentMeta.data("customAdVars")})}catch(e){c.log("ImageGallery ad error occurred")}this._updateMetadata(),this._updateSharebar()}},next:function(t){c.log("next");var i=(this.options,this.index+1);this.index===this.count?this.isModal&&(c.log("if modal, close it!"),e('[data-item="modal-close"]').trigger("click")):this.show(i,"next",t);var a=this.defaultDek,o=e(".image.selected .image-meta .caption p").text();1!==this.index&&""!==o?e("meta[name='description']").attr("content",o):e("meta[name='description']").attr("content",a),this._trigger("next")},previous:function(t){c.log("previous");var i=(this.options,this.index-1);if(0!==i){if(1===this.index)c.log("first slide, go to last slide now."),c.log("index: ",this.count),this.show(this.count,"previous",t);else{this.show(i,"previous",t);var a=e(".image.selected .image-meta .caption p").text();""!==a&&1!==i?e("meta[name='description']").attr("content",a):e("meta[name='description']").attr("content",this.defaultDek)}this._trigger("previous")}},_updateMetadata:function(){var t=e(".image-gallery .images .selected");e("meta[property='og:url']").attr("content",window.location.href),e("meta[property='twitter:url']").attr("content",window.location.href),e("meta[property='twitter:title']").attr("content",e(e(t).children("div").children(".image-meta").children("h2")).html()),e('link[rel="canonical"]').attr("href",window.location.href),c.log("Done updating Meta Data!")},_updateSharebar:function(){var t=e(".image-gallery .images .selected"),i=e(":cnet-socialCounts");i.socialCounts("setUrl",window.location.href),i.socialCounts("setData","media",e(t.children("div").children("figure").children("img")).attr("src"))},_uiTracking:function(e,t){itemTracking=i.tracking.data,o.trackCustomEvent(e,{_articleTitle:itemTracking.photoGalleryTitle,_articleId:itemTracking.photoGalleryId,_authorPrimaryName:itemTracking.articleAuthorName,_articleType:itemTracking.articleType,_pageType:itemTracking.pageType,siteSection:itemTracking.siteSection,siteEdition:itemTracking.siteEdition,_siteEdition:itemTracking.siteEdition,_siteTypeDevice:itemTracking._siteTypeDevice,_siteHier:itemTracking.siteHier,_pageViewGuid:itemTracking._pageViewGuid,clickGenericText:t},"trackClick")}})});
define('components/image-gallery-modal',["jquery","managers/components.desktop","version!fly/managers/debug","managers/page-vars","managers/tracking","managers/tealium","managers/guid","managers/ad","managers/recommendation","version!fly/components/base"],function(e,t,a,o,i,r,l,s,n){a=a.init("imageGalleryModal"),e.widget("cnet.imageGalleryModal",e.fly.base,{options:{cssPath:"",trackUrl:"",url:"",index:1},cssLoadPath:"",latestDwLinkTag:"",url:"",hostUrl:"",hostState:{},hostScrollTop:0,hostAdData:{},hostGuid:0,isHostGallery:!1,_create:function(){var t=this;this._setup(),this.$video=e(".videoPlayer"),"www.theroadshow.com"!==window.location.hostname&&this.$element.on("click",function(a){t.cssLoadPath=t.options.cssPath,a.preventDefault(),t._clickControl(),t.latestDwLinkTag=r.getDwTag(e(a.target))})},_storeHostPageData:function(){this.hostUrl=window.location.href,this.hostState=window.history.state,this.hostScrollTop=e(window).scrollTop(),this.hostAdData=e.extend(!0,{},o.ads.data),this.hostTracking=e.extend(!0,{},o.tracking),this.hostImage=e('meta[property="og:image"]').attr("content").trim(),this.hostGuid=l.getViewGuid(),this.url=""!==this.options.url?this.options.url:this.$element.attr("href")},_clickControl:function(){var d=this,c=e("body");if($htmlTag=e("html"),e("#bodyWrapper").length>0){a.log("IGM: replacing gallery modal"),e("#bodyWrapper").data("persist","true"),e("#bodyWrapper .closeModal").trigger("click"),$htmlTag.removeClass("overflow");var p=e("<div id='bodyWrapper' class='loadingArea'></div>");c.append(p)}else{a.log("IGM: setting up gallery modal");var p=e("<div id='bodyWrapper' class='loadingArea'></div>");c.append(p),c.addClass("galleryModal image-gallery"),this._loadCss(this.cssLoadPath,"galleryCSS")}if(this.$video.length)if(a.log("video is present. pause it for the gallery modal"),"videoPlayer"==this.$video.attr("data-component"))try{this.$video.videoPlayer("pause")}catch(e){a.log("Failed to pause video player.")}else a.warn("Video not ready"),this.$video.on("onVideoPlayerReady",function(e){"videoPlayer"==this.$video.attr("data-component")&&this.$video.videoPlayer("pause")});"image_gallery"==o.tracking.data.pageType&&(d.isHostGallery=!0),d._storeHostPageData();var h=window.location.search,g=/ab=.*&/,y=/ab=.*/;g.test(h)?h=h.replace(g,""):y.test(h)&&(h=h.replace(y,"")),e.ajax({url:this.url+h,dataType:"json",context:document.body}).done(function(p){a.log("Gallery loaded");var h=document.createElement("a");h.href=d.options.trackUrl;var g=h.pathname;i.resetTrackingData(p.trackingData,g),l.resetViewGuid(),r.trackPageLoad(e.extend(!0,p.trackingData,{viewguid:l.getViewGuid(),title:p.trackingData.photoGalleryTitle,_pageViewGuid:l.getViewGuid(),_topicPrimaryId:p.trackingData.topicId[0],_pageUrl:d.options.trackUrl,pageUrl:d.options.trackUrl,photoGalleryTitle:p.trackingData.photoGalleryTitle,photoGalleryId:p.trackingData.photoGalleryId,photoGalleryType:p.trackingData.articleType,pageName:""!=d.options.trackUrl?d.options.trackUrl:o.tracking.data._pageName,dwLinkTag:d.latestDwLinkTag}));var y=e(p.template);e("#bodyWrapper").append(y),e("#bodyWrapper").removeClass("loadingArea"),t.process(e("#bodyWrapper"));try{s.loadImproved({adData:p.adData}),a.log("test loadAds")}catch(e){a.log("adMgr.loadImproved() had trouble: ",e)}n.registerOnScroll("#bodyWrapper"),this.$close=e('[data-item="modal-close"]'),this.$close.on("click",function(){d._closeModal(c,p.trackingData)}),e("#bodyWrapper").on("click",function(e){e.target===this&&d._closeModal(c,p.trackingData)})}).fail(function(){c.removeClass("galleryModal"),e("#bodyWrapper").remove(),window.location=d.$element.attr("href")})},_closeModal:function(t,a){r.trackCustomEvent("trackCloseGallery",e.extend({},o.tracking.data,{_articleTitle:a.photoGalleryTitle,_articleId:a.photoGalleryId,_authorPrimaryName:a.articleAuthorName,_articleType:a.articleType,_pageType:a.pageType,siteSection:a.siteSection,siteEdition:a._siteEdition,_siteTypeDevice:a._siteTypeDevice,_siteHier:a.siteHier,_pageViewGuid:a._pageViewGuid,clickGenericText:"close-gallery"}),"trackClick");var s=document.createElement("a");s.href=this.hostUrl;var n=s.pathname;i.resetTrackingData(this.hostTracking,n),o.ads.data=this.hostAdData,window.history.replaceState&&window.history.replaceState(this.hostState,"",this.hostUrl),e('meta[property="og:image"]').attr("content",this.hostImage),e("title").text(this.hostTracking.data._pageTitle),l.resetViewGuid(this.hostGuid),this.isHostGallery||$htmlTag.removeClass("overflow"),"true"===e("#bodyWrapper").data("persist")?(e("#bodyWrapper").remove(),e("#bodyWrapper").data("persist",null)):(e("#bodyWrapper").remove(),t.removeClass("galleryModal image-gallery"),e(window).resize(),e(window).scrollTop(this.hostScrollTop))},_loadCss:function(t,a){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("id",a),o.setAttribute("href",t),void 0!==o&&0==e("#"+a).length&&document.getElementsByTagName("head")[0].appendChild(o)},open:function(){this.cssLoadPath=this.options.cssPath,this._clickControl()}})});
define('components/shortcode-gallery',["jquery","version!fly/managers/debug","fly/utils/string-vars-1.0","version!fly/components/base","version!fly/components/image-gallery","version!libs/jquery/dotdotdot"],function(t,e,s){var i=e.init("shortcode-gallery"),n=t.support.touch?"vclick":"click";t.widget("cnet.shortcodeGallery",t.fly.imageGallery,{options:{index:1,preloadThreshold:3,countTemplate:'<span class="first">{first}</span> - <span class="last">{last}</span> of <span class="count">{count}</span>',selectors:{viewport:'[data-item="viewport"]',window:'[data-item="window"]'},visible:1},_create:function(){var e=this.options;this._super("_create"),this._setupViewports();var s=this.$element.find('[data-item="image-count"]').clone();s.find(".first").html("{first}"),s.find(".last").html("{last}"),s.find(".count").html("{count}"),e.countTemplate=s.html(),t.each(this.$element.find(".caption"),function(e,s){t(s).dotdotdot({watch:"window"})})},_setupEvents:function(){var e=this,s={};s[n+" "+this.selectors.control]="_handleControlClick",s.shortcodegalleryshown="_handleShown",this._on(this.$element,s),t(window).resize(function(t){e._handleResize(t)})},_setupViewports:function(){var e=this;this.$element.find(this.options.selectors.viewport).each(function(s,i){var n=t(i),o=n.find(e.options.selectors.image),h=0;o.each(function(e,s){h+=t(s).outerWidth(!0)}),n.width(h),e._updateWindowHeight(t(o[0]).height())})},_handleShown:function(t,e){var s=e.$current.position().left,i=parseInt(e.$current.css("marginLeft"),10),n=i+s,o=e.$current.closest(this.options.selectors.viewport);t&&t.preventDefault(),-n!=parseInt(o.css("left"),10)&&e.$current.closest(this.options.selectors.viewport).css("left",-n)},_handleResize:function(t){var e=this.$element.find(this.options.selectors.viewport),s=e.find("."+this.options.classes.selected);this._handleShown(null,{$current:s}),this._updateWindowHeight(this.$element.find(this.options.selectors.image+":first").height())},_updateWindowHeight:function(t){if(!(t<=0)){var e=this.$element.find(this.options.selectors.window);t!=e.height()&&e.height(t)}},_updateCount:function(){var t=this.options,e={};this.$count.length&&(e={first:this.index,last:Math.min(this.index+this.options.visible-1,this.count),count:this.count},this.$count.html(s.compile(t.countTemplate,e)))},_updatePushState:function(t,e){this.options.enablePushState&&history.pushState&&(i.log("pushState: "+t+": "+e),history.pushState({},"",e))},next:function(){var t=Math.min(this.index+this.options.visible,this.count-this.options.visible+1);t<0||t!==this.count&&(this.show(t),this._trigger("next"),this._updatePushState("next",t))},previous:function(){var t=Math.max(1,this.index-this.options.visible);1!==this.index&&(this.show(t),this._trigger("previous"),this._updatePushState("previous",t))},show:function(t){(t=Math.max(1,Math.min(t,this.count-this.options.visible+1)))!==this.index&&this._super(t)},_handleControlClick:function(e){var s=t(e.target).closest(this.selectors.control).data("toImage");switch(e.preventDefault(),s){case"next":this.next();break;case"previous":this.previous();break;default:this.show(parseInt(s,10))}},_updateControls:function(){this._super();var t=this.options;this.$element.find(this.selectors.next)[this.index+t.visible-1>=this.count?"addClass":"removeClass"](t.classes.disabled)}})});
define('components/disqus-count',["jquery","managers/page-vars","version!fly/managers/debug",window.CnetPageVars.services.disqus.enabled?"version!fly/components/disqus-count":""],function(s,e,n){n=n.init("disqusCount"),e.services.disqus.enabled&&s.widget("cnet.disqusCount",s.fly.disqusCount,{options:{shortname:e.disqus.shortname}})});
define('managers/third-party/social-flags',["managers/page-vars"],function(e){return{enabled:{facebook:e.services.facebook&&e.services.facebook.enabled,google:!0,linkedIn:e.services.linkedin&&e.services.linkedin.enabled,pinterest:e.services.pinterest&&e.services.linkedin.pinterest,twitter:e.services.twitterwidget&&e.services.linkedin.twitterwidget,disqus:e.services.disqus&&e.services.linkedin.disqus}}});
define('managers/third-party/twitter',["jquery","version!fly/managers/debug","managers/third-party/social-flags","managers/global-functions","managers/tealium"],function(t,e,n,i,o){e=e.init("twitter");var r=!1,a={onInit:null};return{init:function(o){var l=this;n.enabled.twitter&&(t.extend(!0,a,o),r?a.onInit&&a.onInit():(window.twttr=t.extend(!0,{_e:[],ready:function(t){window.twttr._e.push(t)}},window.twttr),twttr.ready(function(){r=!0,l.setupEvents(),a.onInit&&a.onInit(),e.log("Initialized")}),i.gdprConsentCallback("script_twitter",function(){require(["twitter"])})))},parse:function(){r?twttr.widgets.load():e.log("Parse failed -- not initialized yet")},isInitialized:function(){return r},setupEvents:function(){var t=this;twttr.events.bind("follow",function(n){e.log("Followed");var i={};t.trackFollow(i)}),twttr.events.bind("tweet",function(n){e.log("Tweeted");var i={};t.trackTweet(i)})},trackFollow:function(e){o.trackSocial(t.extend({socialService:"twitter",event:"connect",eventt:"followcnet",socialId:9},e))},trackTweet:function(e){o.trackSocial(t.extend({socialService:"twitter",event:"share",eventt:"socialsite",socialId:8},e))}}});
/**
 * Combine all files used by this page type.
 */
define('pages/desktop/article_video_test',[
    // Core site functionality
    'main.desktop',
    'managers/recommendation',
    'components/fixate',
    'components/iframe-hover-fix',
    'components/magnet',
    'components/toc-nav',
    'components/toggle',
    'components/touch-menu-hover',
    'components/sticky-element',
    'components/form-trim',
    'components/lazyload-images',
    'components/modal-enlarge-image',
    'utils/function-natives',
    'components/article',
    'components/page',
    'components/sliding-element',
    'components/sticky-column',
    'components/selfish-scroll',
    'components/update-area',

    // Ads & Tracking
    'components/sticky-leader',
    'components/track-download',
    'components/social-tracking',
    'components/external-link',
    'components/mobile-footer-link',

    // Quantum Video player
    'quantum/videoPlayer',
    'quantum/inviewElement',

    // Embedded galleries
    'components/ellipsis',
    'components/image-gallery',
    'components/image-gallery-modal',
    'components/shortcode-gallery',
    'version!libs/jquery/dotdotdot',
    'version!fly/components/image-gallery',


    // Social
    'components/disqus-count',
    'components/sharebar',
    'managers/edition-notifications',
    'managers/third-party/social',
    'managers/third-party/twitter'
], function(
    main,
    recommendation
) {
    recommendation.registerOnScroll();
});

